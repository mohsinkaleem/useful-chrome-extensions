function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s,a;function u(e,t){return e===t||(s||(s=document.createElement("a")),s.href=t,e===s.href)}function l(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function h(e){e.parentNode&&e.parentNode.removeChild(e)}function f(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function p(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function g(e){return document.createTextNode(e)}function m(){return g(" ")}function y(){return g("")}function v(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function b(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function w(e,t){t=""+t,e.data!==t&&(e.data=t)}function x(e,t){e.value=null==t?"":t}function k(e){a=e}function _(){if(!a)throw new Error("Function called outside component initialization");return a}function A(e){_().$$.on_mount.push(e)}function C(){const e=_();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}(t,n,{cancelable:r});return i.slice().forEach(t=>{t.call(e,o)}),!o.defaultPrevented}return!0}}const S=[],E=[];let P=[];const O=[],j=Promise.resolve();let D=!1;function B(e){P.push(e)}const M=new Set;let I=0;function K(){if(0!==I)return;const e=a;do{try{for(;I<S.length;){const e=S[I];I++,k(e),T(e.$$)}}catch(e){throw S.length=0,I=0,e}for(k(null),S.length=0,I=0;E.length;)E.pop()();for(let e=0;e<P.length;e+=1){const t=P[e];M.has(t)||(M.add(t),t())}P.length=0}while(S.length);for(;O.length;)O.pop()();D=!1,M.clear(),k(e)}function T(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(B)}}const q=new Set;function L(e,t){e&&e.i&&(q.delete(e),e.i(t))}function R(e){return void 0!==e?.length?e:Array.from(e)}function z(e,t){e.d(1),t.delete(e.key)}function $(e,n,o){const{fragment:s,after_update:a}=e.$$;s&&s.m(n,o),B(()=>{const n=e.$$.on_mount.map(t).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]}),a.forEach(B)}function F(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];P.forEach(r=>-1===e.indexOf(r)?t.push(r):n.push(r)),n.forEach(e=>e()),P=t}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function N(e,t){-1===e.$$.dirty[0]&&(S.push(e),D||(D=!0,j.then(K)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function U(t,i,o,s,u,l,c=null,f=[-1]){const d=a;k(t);const p=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:i.target||d.$$.root};c&&c(p.root);let g=!1;if(p.ctx=o?o(t,i.props||{},(e,n,...r)=>{const i=r.length?r[0]:n;return p.ctx&&u(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),g&&N(t,e)),n}):[],p.update(),g=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);p.fragment&&p.fragment.l(e),e.forEach(h)}else p.fragment&&p.fragment.c();i.intro&&L(t.$$.fragment),$(t,i.target,i.anchor),K()}k(d)}class W{$$=void 0;$$set=void 0;$destroy(){F(this,1),this.$destroy=e}$on(t,n){if(!i(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function V(e){return new Date(e).toLocaleDateString()}function H(e){if(e.faviconUrl)return e.faviconUrl;if(e.url&&(e.url.startsWith("http://")||e.url.startsWith("https://")))try{return`https://www.google.com/s2/favicons?domain=${e.domain||new URL(e.url).hostname}&sz=32`}catch(e){}return function(e){if(e.url.startsWith("http://")||e.url.startsWith("https://")){const t=e.domain||"unknown",n=t.charAt(0).toUpperCase(),r=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899"];return`data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="${r[t.length%r.length]}"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white" font-weight="bold">${n}</text></svg>`}switch(e.domain||""){case"chrome-internal":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23EA4335"/><circle cx="8" cy="8" r="3" fill="white"/></svg>';case"local-file":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23F59E0B"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">ðŸ“„</text></svg>';case"javascript-bookmarklet":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23F7DF1E"/><text x="8" y="12" font-family="Arial" font-size="8" text-anchor="middle" fill="black" font-weight="bold">JS</text></svg>';case"data-uri":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%2310B981"/><text x="8" y="12" font-family="Arial" font-size="8" text-anchor="middle" fill="white" font-weight="bold">D</text></svg>';case"contact-link":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%238B5CF6"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">@</text></svg>';case"other-protocol":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%236B7280"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">âš¡</text></svg>';default:return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23E5E7EB"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="%236B7280">?</text></svg>'}}(e)}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const Q={RELEVANCE:{key:"relevance",label:"Best Match",sort:(e,t)=>(t._searchScore||0)-(e._searchScore||0)},DATE_DESC:{key:"date_desc",label:"Newest First",sort:(e,t)=>t.dateAdded-e.dateAdded},DATE_ASC:{key:"date_asc",label:"Oldest First",sort:(e,t)=>e.dateAdded-t.dateAdded},TITLE_ASC:{key:"title_asc",label:"Title A-Z",sort:(e,t)=>(e.title||"").localeCompare(t.title||"")},TITLE_DESC:{key:"title_desc",label:"Title Z-A",sort:(e,t)=>(t.title||"").localeCompare(e.title||"")},DOMAIN_ASC:{key:"domain_asc",label:"Domain A-Z",sort:(e,t)=>(e.domain||"").localeCompare(t.domain||"")}};function Y(e){const t=Object.values(Q).find(t=>t.key===e);return t?t.sort:Q.DATE_DESC.sort}const G=[];function J(t,n=e){let r;const i=new Set;function s(e){if(o(t,e)&&(t=e,r)){const e=!G.length;for(const e of i)e[1](),G.push(e,t);if(e){for(let e=0;e<G.length;e+=2)G[e][0](G[e+1]);G.length=0}}}function a(e){s(e(t))}return{set:s,update:a,subscribe:function(o,u=e){const l=[o,u];return i.add(l),1===i.size&&(r=n(s,a)||e),o(t),()=>{i.delete(l),0===i.size&&r&&(r(),r=null)}}}}function X(t,n,o){const s=!Array.isArray(t),a=s?[t]:t;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const u=n.length<2;return l=(t,o)=>{let l=!1;const c=[];let h=0,f=e;const d=()=>{if(h)return;f();const r=n(s?c[0]:c,t,o);u?t(r):f=i(r)?r:e},p=a.map((t,n)=>function(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(t,e=>{c[n]=e,h&=~(1<<n),l&&d()},()=>{h|=1<<n}));return l=!0,d(),function(){r(p),f(),l=!1}},{subscribe:J(o,l).subscribe};var l}var Z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var te={exports:{}};te.exports=function(){
/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.
	    Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.
	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:Z,o=Object.keys,s=Array.isArray;function a(e,t){return"object"!=typeof t||o(t).forEach(function(n){e[n]=t[n]}),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var u=Object.getPrototypeOf,l={}.hasOwnProperty;function c(e,t){return l.call(e,t)}function h(e,t){"function"==typeof t&&(t=t(u(e))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(t).forEach(function(n){d(e,n,t[n])})}var f=Object.defineProperty;function d(e,t,n,r){f(e,t,a(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}var g=Object.getOwnPropertyDescriptor;function m(e,t){var n;return g(e,t)||(n=u(e))&&m(n,t)}var y=[].slice;function v(e,t,n){return y.call(e,t,n)}function b(e,t){return t(e)}function w(e){if(!e)throw new Error("Assertion Failed")}function x(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function k(e,t){return e.reduce(function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function _(e,t){if("string"==typeof t&&c(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=_(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return null==a?void 0:_(a,t.substr(s+1))}}function A(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){w("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)A(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var a=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?s(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var l=e[a];l&&c(e,a)||(l=e[a]={}),A(l,u,n)}}else void 0===n?s(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function C(e,t){"string"==typeof t?A(e,t,void 0):"length"in t&&[].map.call(t,function(t){A(e,t,void 0)})}function S(e){var t={};for(var n in e)c(e,n)&&(t[n]=e[n]);return t}var E=[].concat;function P(e){return E.apply([],e)}var O="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(P([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return i[e]}),j=new Set(O.map(function(e){return i[e]}));function D(e){var t={};for(var n in e)if(c(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||j.has(r.constructor)?r:D(r)}return t}function B(e){for(var t in e)if(c(e,t))return!1;return!0}var M=null;function I(e){M=new WeakMap;var t=K(e);return M=null,t}function K(e){if(!e||"object"!=typeof e)return e;var t=M.get(e);if(t)return t;if(s(e)){t=[],M.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(K(e[n]))}else if(j.has(e.constructor))t=e;else{var i=u(e);for(var o in t=i===Object.prototype?{}:Object.create(i),M.set(e,t),e)c(e,o)&&(t[o]=K(e[o]))}return t}var T={}.toString;function q(e){return T.call(e).slice(8,-1)}var L="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",R="symbol"==typeof L?function(e){var t;return null!=e&&(t=e[L])&&t.apply(e)}:function(){return null};function z(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var $={};function F(e){var t,n,r,i;if(1===arguments.length){if(s(e))return e.slice();if(this===$&&"string"==typeof e)return[e];if(i=R(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var N="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},U=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],W=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(U),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function H(e,t){this.name=e,this.message=t}function Q(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function Y(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Q(e,t)}function G(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=Q(e,this.failures)}p(H).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(Y).from(H),p(G).from(H);var J=W.reduce(function(e,t){return e[t]=t+"Error",e},{}),X=H,ee=W.reduce(function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=V[t]||n,this.inner=null)}return p(r).from(X),e[t]=r,e},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=U.reduce(function(e,t){return e[t+"Error"]=ee[t],e},{});function ne(e,t){if(!e||e instanceof H||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&d(n,"stack",{get:function(){return this.inner.stack}}),n}var re=W.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e},{});function ie(){}function oe(e){return e}function se(e,t){return null==e||e===oe?t:function(n){return t(e(n))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ue(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0!==o?o:n}}function le(e,t){return e===ie?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ae(r,this.onerror):r)}}function ce(e,t){return e===ie?t:function(n){var r=e.apply(this,arguments);a(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ae(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ae(o,this.onerror):o),void 0===r?void 0===s?void 0:s:a(r,s)}}function he(e,t){return e===ie?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}re.ModifyError=Y,re.DexieError=H,re.BulkError=G;var de="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pe(e,t){de=e}var ge={},me=100,ye="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,u(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,u(t),e]}(),ve=ye[0],be=ye[1],we=ye[2],xe=be&&be.then,ke=ve&&ve.constructor,_e=!!we;function Ae(){queueMicrotask(Ue)}var Ce=function(e,t){Me.push([e,t]),Ee&&(Ae(),Ee=!1)},Se=!0,Ee=!0,Pe=[],Oe=[],je=oe,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ie,pgp:!1,env:{},finalize:ie},Be=De,Me=[],Ie=0,Ke=[];function Te(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Be;if("function"!=typeof e){if(e!==ge)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ze(this,this._value))}this._state=null,this._value=null,++t.ref,Re(this,e)}var qe={get:function(){var e=Be,t=rt;function n(n,r){var i=this,o=!e.global&&(e!==Be||t!==rt),s=o&&!at(),a=new Te(function(t,a){Fe(i,new Le(pt(n,e,o,s),pt(r,e,o,s),t,a,e))});return this._consoleTask&&(a._consoleTask=this._consoleTask),a}return n.prototype=ge,n},set:function(e){d(this,"then",e&&e.prototype===ge?qe:{get:function(){return e},set:qe.set})}};function Le(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Re(e,t){try{t(function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&We();t&&"function"==typeof t.then?Re(e,function(e,n){t instanceof Te?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,$e(e)),n&&Ve()}},ze.bind(null,e))}catch(t){ze(e,t)}}function ze(e,t){if(Oe.push(t),null===e._state){var n=e._lib&&We();t=je(t),e._state=!1,e._value=t,Ye(e),$e(e),n&&Ve()}}function $e(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Fe(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Ie&&(++Ie,Ce(function(){0===--Ie&&He()},[]))}function Fe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ie,Ce(Ne,[n,e,t])}else e._listeners.push(t)}function Ne(e,t,n){try{var r,i=t._value;!t._state&&Oe.length&&(Oe=[]),r=de&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||-1!==Oe.indexOf(i)||Ge(t),n.resolve(r)}catch(e){n.reject(e)}finally{0===--Ie&&He(),--n.psd.ref||n.psd.finalize()}}function Ue(){dt(De,function(){We()&&Ve()})}function We(){var e=Se;return Se=!1,Ee=!1,e}function Ve(){var e,t,n;do{for(;Me.length>0;)for(e=Me,Me=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Me.length>0);Se=!0,Ee=!0}function He(){var e=Pe;Pe=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Ke.slice(0),n=t.length;n;)t[--n]()}function Qe(e){function t(){e(),Ke.splice(Ke.indexOf(t),1)}Ke.push(t),++Ie,Ce(function(){0===--Ie&&He()},[])}function Ye(e){Pe.some(function(t){return t._value===e._value})||Pe.push(e)}function Ge(e){for(var t=Pe.length;t;)if(Pe[--t]._value===e._value)return void Pe.splice(t,1)}function Je(e){return new Te(ge,!1,e)}function Xe(e,t){var n=Be;return function(){var r=We(),i=Be;try{return ht(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ht(i,!1),r&&Ve()}}}h(Te.prototype,{then:qe,_then:function(e,t){Fe(this,new Le(null,null,e,t,Be))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):Je(e)}):this.then(null,function(e){return e&&e.name===t?n(e):Je(e)})},finally:function(e){return this.then(function(t){return Te.resolve(e()).then(function(){return t})},function(t){return Te.resolve(e()).then(function(){return Je(t)})})},timeout:function(e,t){var n=this;return e<1/0?new Te(function(r,i){var o=setTimeout(function(){return i(new ee.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(Te.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=ft(),h(Te,{all:function(){var e=F.apply(null,arguments).map(ut);return new Te(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(i,o){return Te.resolve(i).then(function(n){e[o]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof Te?e:e&&"function"==typeof e.then?new Te(function(t,n){e.then(t,n)}):new Te(ge,!0,e)},reject:Je,race:function(){var e=F.apply(null,arguments).map(ut);return new Te(function(t,n){e.map(function(e){return Te.resolve(e).then(t,n)})})},PSD:{get:function(){return Be},set:function(e){return Be=e}},totalEchoes:{get:function(){return rt}},newPSD:ot,usePSD:dt,scheduler:{get:function(){return Ce},set:function(e){Ce=e}},rejectionMapper:{get:function(){return je},set:function(e){je=e}},follow:function(e,t){return new Te(function(n,r){return ot(function(t,n){var r=Be;r.unhandleds=[],r.onunhandled=n,r.finalize=ae(function(){var e=this;Qe(function(){0===e.unhandleds.length?t():n(e.unhandleds[0])})},r.finalize),e()},t,n,r)})}}),ke&&(ke.allSettled&&d(Te,"allSettled",function(){var e=F.apply(null,arguments).map(ut);return new Te(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(e,i){return Te.resolve(e).then(function(e){return r[i]={status:"fulfilled",value:e}},function(e){return r[i]={status:"rejected",reason:e}}).then(function(){return--n||t(r)})})})}),ke.any&&"undefined"!=typeof AggregateError&&d(Te,"any",function(){var e=F.apply(null,arguments).map(ut);return new Te(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(e,o){return Te.resolve(e).then(function(e){return t(e)},function(e){i[o]=e,--r||n(new AggregateError(i))})})})}),ke.withResolvers&&(Te.withResolvers=ke.withResolvers));var Ze={awaits:0,echoes:0,id:0},et=0,tt=[],nt=0,rt=0,it=0;function ot(e,t,n,r){var i=Be,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++it,De.env,o.env=_e?{Promise:Te,PromiseProp:{value:Te,configurable:!0,writable:!0},all:Te.all,race:Te.race,allSettled:Te.allSettled,any:Te.any,resolve:Te.resolve,reject:Te.reject}:{},t&&a(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=dt(o,e,n,r);return 0===o.ref&&o.finalize(),s}function st(){return Ze.id||(Ze.id=++et),++Ze.awaits,Ze.echoes+=me,Ze.id}function at(){return!!Ze.awaits&&(0===--Ze.awaits&&(Ze.id=0),Ze.echoes=Ze.awaits*me,!0)}function ut(e){return Ze.echoes&&e&&e.constructor===ke?(st(),e.then(function(e){return at(),e},function(e){return at(),mt(e)})):e}function lt(e){++rt,Ze.echoes&&0!==--Ze.echoes||(Ze.echoes=Ze.awaits=Ze.id=0),tt.push(Be),ht(e,!0)}function ct(){var e=tt[tt.length-1];tt.pop(),ht(e,!1)}function ht(e,t){var n=Be;if((t?!Ze.echoes||nt++&&e===Be:!nt||--nt&&e===Be)||queueMicrotask(t?lt.bind(null,e):ct),e!==Be&&(Be=e,n===De&&(De.env=ft()),_e)){var r=De.env.Promise,o=e.env;(n.global||e.global)&&(Object.defineProperty(i,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function ft(){var e=i.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function dt(e,t,n,r,i){var o=Be;try{return ht(e,!0),t(n,r,i)}finally{ht(o,!1)}}function pt(e,t,n,r){return"function"!=typeof e?e:function(){var i=Be;n&&st(),ht(t,!0);try{return e.apply(this,arguments)}finally{ht(i,!1),r&&queueMicrotask(at)}}}function gt(e){Promise===ke&&0===Ze.echoes?0===nt?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+xe).indexOf("[native code]")&&(st=at=ie);var mt=Te.reject;function yt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Be.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===J.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return yt(e,t,n,r)})):mt(i)}return i._promise(t,function(e,t){return ot(function(){return Be.trans=i,r(e,t,i)})}).then(function(e){if("readwrite"===t)try{i.idbtrans.commit()}catch(e){}return"readonly"===t?e:i._completion.then(function(){return e})})}if(e._state.openComplete)return mt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return mt(new ee.DatabaseClosed);e.open().catch(ie)}return e._state.dbReadyPromise.then(function(){return yt(e,t,n,r)})}var vt="4.2.1",bt=String.fromCharCode(65535),wt=-1/0,xt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",kt="String expected.",_t=[],At="__dbnames",Ct="readonly",St="readwrite";function Et(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Pt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ot(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=I(t))[e],t}}function jt(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Dt(e,t){try{var n=It(e),r=It(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return Mt(Kt(e),Kt(t));case"Array":return Bt(e,t)}}catch(e){}return NaN}function Bt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var s=Dt(e[o],t[o]);if(0!==s)return s}return n===r?0:n<r?-1:1}function Mt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}function It(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=q(e);return"ArrayBuffer"===n?"binary":n}function Kt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Tt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){var r=n.updatesTable;return t?e.db.table(r).where("k").anyOf(t).delete():e.db.table(r).clear()})).then(function(){return n})):n}var qt=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var t,n=this["@@propmod"];if(void 0!==n.add){var i=n.add;if(s(i))return r(r([],s(e)?e:[],!0),i,!0).sort();if("number"==typeof i)return(Number(e)||0)+i;if("bigint"==typeof i)try{return BigInt(e)+i}catch(e){return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(void 0!==n.remove){var o=n.remove;if(s(o))return s(e)?e.filter(function(e){return!o.includes(e)}).sort():[];if("number"==typeof o)return Number(e)-o;if("bigint"==typeof o)try{return BigInt(e)-o}catch(e){return BigInt(0)-o}throw new TypeError("Invalid subtrahend ".concat(o))}var a=null===(t=n.replacePrefix)||void 0===t?void 0:t[0];return a&&"string"==typeof e&&e.startsWith(a)?n.replacePrefix[1]+e.substring(a.length):e},e}();function Lt(e,t){for(var n=o(t),r=n.length,i=!1,s=0;s<r;++s){var a=n[s],u=t[a],l=_(e,a);u instanceof qt?(A(e,a,u.execute(l)),i=!0):l!==u&&(A(e,a,u),i=!0)}return i}var Rt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||Be.trans,i=this.name,o=de&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function s(e,n,r){if(!r.schema[i])throw new ee.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var a=We();try{var u=r&&r.db._novip===this.db._novip?r===Be.trans?r._promise(e,s,n):ot(function(){return r._promise(e,s,n)},{trans:r,transless:Be.transless||Be}):yt(this.db,e,[this.name],s);return o&&(u._consoleTask=o,u=u.catch(function(e){return console.trace(e),mt(e)})),u}finally{a&&Ve()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?mt(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(s(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=o(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return e.keyPath.indexOf(t)>=0})){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==bt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&de&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function a(e,t){return 0===Dt(e,t)}var u=t.reduce(function(t,n){var r=t[0],o=t[1],u=i[n],l=e[n];return[r||u,r||!u?Et(o,u&&u.multi?function(e){var t=_(e,n);return s(t)&&t.some(function(e){return a(l,e)})}:function(e){return a(l,_(e,n))}):o]},[null,null]),l=u[0],c=u[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(c):n?this.filter(c):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,s(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var n=this,r=n.db,i=n.name;this.schema.mappedClass=e,e.prototype instanceof jt&&(e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),Object.defineProperty(n.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),n.prototype.table=function(){return i},n}(e));for(var o=new Set,s=e.prototype;s;s=u(s))Object.getOwnPropertyNames(s).forEach(function(e){return o.add(e)});var a=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!o.has(r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){function e(e){a(this,e)}return this.mapToClass(e)},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ot(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{A(e,o,t)}catch(e){}return t})},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(i){return n.core.get({trans:i,key:e}).then(function(o){var s=null!=o?o:{};return Lt(s,t),r&&A(s,r,e),n.core.mutate({trans:i,type:"put",values:[s],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):!!o})})})},e.prototype.update=function(e,t){if("object"!=typeof e||s(e))return this.where(":id").equals(e).modify(t);var n=_(e,this.schema.primKey.keyPath);return void 0===n?mt(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ot(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{A(e,o,t)}catch(e){}return t})},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(n){return Tt(t,[e],n)}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):void 0})})},e.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Pt}).then(function(t){return Tt(e,null,t)})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,l=a&&s?e.map(Ot(a)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:l,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new G("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,l=a&&s?e.map(Ot(a)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:l,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new G("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),o=[];return this._trans("readwrite",function(s){return n.getMany({trans:s,keys:r,cache:"clone"}).then(function(a){var u=[],l=[];e.forEach(function(e,n){var r=e.key,i=e.changes,s=a[n];if(s){for(var c=0,h=Object.keys(i);c<h.length;c++){var f=h[c],d=i[f];if(f===t.schema.primKey.keyPath){if(0!==Dt(d,r))throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else A(s,f,d)}o.push(n),u.push(r),l.push(s)}});var c=u.length;return n.mutate({trans:s,type:"put",keys:u,values:l,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(0===n)return c;for(var i=0,s=Object.keys(r);i<s.length;i++){var a=s[i],u=o[Number(a)];if(null!=u){var l=r[a];delete r[a],r[u]=l}}throw new G("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(c," operations failed"),r)})})})},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e}).then(function(n){return Tt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new G("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),o)})},e}();function zt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(e,r,i){if("object"==typeof e)return u(e);r||(r=he),i||(i=ie);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter(function(t){return t!==e}),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function u(e){o(e).forEach(function(t){var n=e[t];if(s(n))a(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ee.InvalidArgument("Invalid event config");var r=a(t,oe,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){x(function(){e.apply(null,t)})})})}})}}function $t(e,t){return p(t).from({prototype:e}),t}function Ft(e){return $t(Rt.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:zt(null,{creating:[ue,ie],reading:[se,oe],updating:[ce,ie],deleting:[le,ie]})})}function Nt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ut(e,t){e.filter=Et(e.filter,t)}function Wt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Et(r(),t())}:t,e.justLimit=n&&!r}function Vt(e,t){e.isMatch=Et(e.isMatch,t)}function Ht(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Qt(e,t,n){var r=Ht(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Yt(e,t,n,r){var i=e.replayFilter?Et(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(e,n,r){if(!i||i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),c(o,a)||(o[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Gt(Qt(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Gt(Qt(e,r,n),Et(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Gt(e,t,n,r){var i=Xe(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=ie},function(t){e.fail(t),n=ie})||i(e.value,e,function(e){return n=e}),n()})})}var Jt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Et(t.algorithm,e)},e.prototype._iterate=function(e,t){return Yt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&a(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Yt(t,e,n,t.table.core)})},e.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(Nt(n,!0))return r.count({trans:e,query:{index:Ht(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Yt(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function a(e,t){return Dt(o(e,i),o(t,i))*s}return this.toArray(function(e){return e.sort(a)}).then(t)},e.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if("next"===n.dir&&Nt(n,!0)&&n.limit>0){var r=n.valueMapper,i=Ht(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){var t=e.result;return r?t.map(r):t})}var o=[];return Yt(n,function(e){return o.push(e)},e,n.table.core).then(function(){return o})},e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Nt(t)?Wt(t,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}):Wt(t,function(){var t=e;return function(){return--t<0}})),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},e.prototype.until=function(e,t){return Ut(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Ut(this._ctx,function(t){return e(t.value)}),Vt(this._ctx,e),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Nt(t,!0)&&t.limit>0)return this._read(function(e){var n=Ht(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Ut(this._ctx,function(e){var t=e.primaryKey.toString(),r=c(n,t);return n[t]=!0,!r}),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i;i="function"==typeof e?e:function(t){return Lt(t,e)};var s=n.table.core,a=s.schema.primaryKey,u=a.outbound,l=a.extractKey,c=200,h=t.db._options.modifyChunkSize;h&&(c="object"==typeof h?h[s.name]||h["*"]||200:h);var f=[],d=0,p=[],g=function(e,t){var n=t.failures,r=t.numFailures;d+=e-r;for(var i=0,s=o(n);i<s.length;i++){var a=s[i];f.push(n[a])}},m=e===Xt;return t.clone().primaryKeys().then(function(t){var o=Nt(n)&&n.limit===1/0&&("function"!=typeof e||m)&&{index:n.index,range:n.range},a=function(h){var f=Math.min(c,t.length-h),d=t.slice(h,h+f);return(m?Promise.resolve([]):s.getMany({trans:r,keys:d,cache:"immutable"})).then(function(p){var y=[],v=[],b=u?[]:null,w=m?d:[];if(!m)for(var x=0;x<f;++x){var k=p[x],_={value:I(k),primKey:t[h+x]};!1!==i.call(_,_.value,_)&&(null==_.value?w.push(t[h+x]):u||0===Dt(l(k),l(_.value))?(v.push(_.value),u&&b.push(t[h+x])):(w.push(t[h+x]),y.push(_.value)))}return Promise.resolve(y.length>0&&s.mutate({trans:r,type:"add",values:y}).then(function(e){for(var t in e.failures)w.splice(parseInt(t),1);g(y.length,e)})).then(function(){return(v.length>0||o&&"object"==typeof e)&&s.mutate({trans:r,type:"put",keys:b,values:v,criteria:o,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:h>0}).then(function(e){return g(v.length,e)})}).then(function(){return(w.length>0||o&&m)&&s.mutate({trans:r,type:"delete",keys:w,criteria:o,isAdditionalChunk:h>0}).then(function(e){return Tt(n.table,w,e)}).then(function(e){return g(w.length,e)})}).then(function(){return t.length>h+f&&a(h+c)})})};return a(0).then(function(){if(f.length>0)throw new Y("Error modifying one or more objects",f,d,p);return t.length})})})},e.prototype.delete=function(){var e=this._ctx,t=e.range;return!Nt(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(Xt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(e){var n=e.failures,r=e.numFailures;if(r)throw new Y("Could not delete some values",Object.keys(n).map(function(e){return n[e]}),t-r);return t-r})})})},e}(),Xt=function(e,t){return t.value=null};function Zt(e){return $t(Jt.prototype,function(t,n){this.db=e;var r=Pt,i=null;if(n)try{r=n()}catch(e){i=e}var o=t._ctx,s=o.table,a=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:a!==oe?a:null}})}function en(e,t){return e<t?-1:e===t?0:1}function tn(e,t){return e>t?-1:e===t?0:1}function nn(e,t,n){var r=e instanceof hn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function rn(e){return new e.Collection(e,function(){return cn("")}).limit(0)}function on(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function sn(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function an(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),a=-1,u=0;u<s;++u){var l=t[u];if(l!==r[u])return i(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[u],l)<0&&(a=u)}return s<r.length&&"next"===o?e+n.substr(e.length):s<e.length&&"prev"===o?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function un(e,t,n,r){var i,o,s,a,u,l,c,h=n.length;if(!n.every(function(e){return"string"==typeof e}))return nn(e,kt);function f(e){i=on(e),o=sn(e),s="next"===e?en:tn;var t=n.map(function(e){return{lower:o(e),upper:i(e)}}).sort(function(e,t){return s(e.lower,t.lower)});a=t.map(function(e){return e.upper}),u=t.map(function(e){return e.lower}),l=e,c="next"===e?"":r}f("next");var d=new e.Collection(e,function(){return ln(a[0],u[h-1]+r)});d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var f=o(i);if(t(f,u,p))return!0;for(var d=null,g=p;g<h;++g){var m=an(i,f,a[g],u[g],s,l);null===m&&null===d?p=g+1:(null===d||s(d,m)>0)&&(d=m)}return n(null!==d?function(){e.continue(d+c)}:r),!1}),d}function ln(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function cn(e){return{type:1,lower:e,upper:e}}var hn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?rn(this):new this.Collection(this,function(){return ln(e,t,!n,!r)})}catch(e){return nn(this,xt)}},e.prototype.equals=function(e){return null==e?nn(this,xt):new this.Collection(this,function(){return cn(e)})},e.prototype.above=function(e){return null==e?nn(this,xt):new this.Collection(this,function(){return ln(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return null==e?nn(this,xt):new this.Collection(this,function(){return ln(e,void 0,!1)})},e.prototype.below=function(e){return null==e?nn(this,xt):new this.Collection(this,function(){return ln(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return null==e?nn(this,xt):new this.Collection(this,function(){return ln(void 0,e)})},e.prototype.startsWith=function(e){return"string"!=typeof e?nn(this,kt):this.between(e,e+bt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):un(this,function(e,t){return 0===e.indexOf(t[0])},[e],bt)},e.prototype.equalsIgnoreCase=function(e){return un(this,function(e,t){return e===t[0]},[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=F.apply($,arguments);return 0===e.length?rn(this):un(this,function(e,t){return-1!==t.indexOf(e)},e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=F.apply($,arguments);return 0===e.length?rn(this):un(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,bt)},e.prototype.anyOf=function(){var e=this,t=F.apply($,arguments),n=this._cmp;try{t.sort(n)}catch(e){return nn(this,xt)}if(0===t.length)return rn(this);var r=new this.Collection(this,function(){return ln(t[0],t[t.length-1])});r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,o){for(var s=e.key;n(s,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(s,t[i])||(r(function(){e.continue(t[i])}),!1)}),r},e.prototype.notEqual=function(e){return this.inAnyRange([[wt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=F.apply($,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return nn(this,xt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[wt,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===e.length)return rn(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0}))return nn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var u=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers;function c(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=s(o[0],t[0]),o[1]=a(o[1],t[1]);break}}return n===i&&e.push(t),e}var h,f=i;function d(e,t){return f(e[0],t[0])}try{(h=e.reduce(c,[])).sort(d)}catch(e){return nn(this,xt)}var p=0,g=l?function(e){return i(e,h[p][1])>0}:function(e){return i(e,h[p][1])>=0},m=u?function(e){return o(e,h[p][0])>0}:function(e){return o(e,h[p][0])>=0};function y(e){return!g(e)&&!m(e)}var v=g,b=new this.Collection(this,function(){return ln(h[0][0],h[h.length-1][1],!u,!l)});return b._ondirectionchange=function(e){"next"===e?(v=g,f=i):(v=m,f=o),h.sort(d)},b._addAlgorithm(function(e,t,r){for(var o=e.key;v(o);)if(++p===h.length)return t(r),!1;return!!y(o)||(0===n._cmp(o,h[p][1])||0===n._cmp(o,h[p][0])||t(function(){f===i?e.continue(h[p][0]):e.continue(h[p][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var e=F.apply($,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?rn(this):this.inAnyRange(e.map(function(e){return[e,e+bt]})):nn(this,"startsWithAnyOf() only works with strings")},e}();function fn(e){return $t(hn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=Dt,this._descending=function(e,t){return Dt(t,e)},this._max=function(e,t){return Dt(e,t)>0?e:t},this._min=function(e,t){return Dt(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})}function dn(e){return Xe(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var gn="storagemutated",mn="x-storagemutated-1",yn=zt(null,gn),vn=function(){function e(){}return e.prototype._lock=function(){return w(!Be.global),++this._reculock,1!==this._reculock||Be.global||(Be.lockOwnerFor=this),this},e.prototype._unlock=function(){if(w(!Be.global),0===--this._reculock)for(Be.global||(Be.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&Be.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(w(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(r);case"MissingAPIError":throw new ee.MissingAPI(r.message,r);default:throw new ee.OpenFailed(r)}if(!this.active)throw new ee.TransactionInactive;return w(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Xe(function(n){pn(n),t._reject(e.error)}),e.onabort=Xe(function(n){pn(n),t.active&&t._reject(new ee.Abort(e.error)),t.active=!1,t.on("abort").fire(n)}),e.oncomplete=Xe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&yn.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ee.TransactionInactive);if(this._locked())return new Te(function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},Be])});if(n)return ot(function(){var e=new Te(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new Te(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Te.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return n});else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Te(function(e,r){n.then(function(n){return t._waitingQueue.push(Xe(e.bind(null,n)))},function(e){return t._waitingQueue.push(Xe(r.bind(null,e)))}).finally(function(){t._waitingFor===i&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(c(t,e))return t[e];var n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function bn(e){return $t(vn.prototype,function(t,n,r,i,o){var s=this;"readonly"!==t&&n.forEach(function(e){var t,i=null===(t=r[e])||void 0===t?void 0:t.yProps;i&&(n=n.concat(i.map(function(e){return e.updatesTable})))}),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=zt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Te(function(e,t){s._resolve=e,s._reject=t}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(e){var t=s.active;return s.active=!1,s.on.error.fire(e),s.parent?s.parent._reject(e):t&&s.idbtrans&&s.idbtrans.abort(),mt(e)})})}function wn(e,t,n,r,i,o,s,a){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+xn(t),type:a}}function xn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function kn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:k(n,function(e){return[e.name,e]})}}function _n(e){return 1===e.length?e[0]:e}var An=function(e){try{return e.only([[]]),An=function(){return[[]]},[[]]}catch(e){return An=function(){return bt},bt}};function Cn(e){return null==e?function(){}:"string"==typeof e?Sn(e):function(t){return _(t,e)}}function Sn(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return _(t,e)}}function En(e){return[].slice.call(e)}var Pn=0;function On(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function jn(e,t,n){function r(e,t){var n=En(e.objectStoreNames);return{schema:{name:e.name,tables:n.map(function(e){return t.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=s(t),i=null==t,o={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:Cn(t)},indexes:En(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,a={name:t,compound:s(i),keyPath:i,unique:n,multiEntry:r,extractKey:Cn(i)};return o[On(i)]=a,a}),getIndexByKeyPath:function(e){return o[On(e)]}};return o[":id"]=a.primaryKey,null!=t&&(o[On(t)]=a.primaryKey),a})},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}function o(e){var t=e.name;function n(e){var n=e.trans,r=e.type,o=e.keys,s=e.values,a=e.range;return new Promise(function(e,u){e=Xe(e);var l=n.objectStore(t),c=null==l.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);var f,d=(o||s||{length:1}).length;if(o&&s&&o.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],g=[],m=0,y=function(e){++m,pn(e)};if("deleteRange"===r){if(4===a.type)return e({numFailures:m,failures:g,results:[],lastResult:void 0});3===a.type?p.push(f=l.clear()):p.push(f=l.delete(i(a)))}else{var v=h?c?[s,o]:[s,null]:[o,null],b=v[0],w=v[1];if(h)for(var x=0;x<d;++x)p.push(f=w&&void 0!==w[x]?l[r](b[x],w[x]):l[r](b[x])),f.onerror=y;else for(x=0;x<d;++x)p.push(f=l[r](b[x])),f.onerror=y}var k=function(t){var n=t.target.result;p.forEach(function(e,t){return null!=e.error&&(g[t]=e.error)}),e({numFailures:m,failures:g,results:"delete"===r?o:p.map(function(e){return e.result}),lastResult:n})};f.onerror=function(e){y(e),k(e)},f.onsuccess=k})}function r(e){var n=e.trans,r=e.values,o=e.query,s=e.reverse,a=e.unique;return new Promise(function(e,u){e=Xe(e);var l=o.index,c=o.range,h=n.objectStore(t),f=l.isPrimaryKey?h:h.index(l.name),d=s?a?"prevunique":"prev":a?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(i(c),d):f.openKeyCursor(i(c),d);p.onerror=dn(u),p.onsuccess=Xe(function(t){var r=p.result;if(r){r.___id=++Pn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var s=r.advance.bind(r),a=function(){throw new Error("Cursor not started")},l=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=a,r.fail=Xe(u),r.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},r.start=function(e){var t=new Promise(function(e,t){e=Xe(e),p.onerror=dn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=l,e(t)}}),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Xe(function(e){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=s,n(),t},e(r)}else e(null)},u)})}function o(e){return function(n){return new Promise(function(r,o){r=Xe(r);var s=n.trans,a=n.values,u=n.limit,l=n.query,c=u===1/0?void 0:u,h=l.index,f=l.range,d=s.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),g=i(f);if(0===u)return r({result:[]});if(e){var m=a?p.getAll(g,c):p.getAllKeys(g,c);m.onsuccess=function(e){return r({result:e.target.result})},m.onerror=dn(o)}else{var y=0,v=a||!("openKeyCursor"in p)?p.openCursor(g):p.openKeyCursor(g),b=[];v.onsuccess=function(e){var t=v.result;return t?(b.push(a?t.value:t.primaryKey),++y===u?r({result:b}):void t.continue()):r({result:b})},v.onerror=dn(o)}})}}return{name:t,schema:e,mutate:n,getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=Xe(e);for(var o,s=n.objectStore(t),a=r.length,u=new Array(a),l=0,c=0,h=function(t){var n=t.target;u[n._pos]=n.result,++c===l&&e(u)},f=dn(i),d=0;d<a;++d)null!=r[d]&&((o=s.get(r[d]))._pos=d,o.onsuccess=h,o.onerror=f,++l);0===l&&e(u)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=Xe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=dn(i)})},query:o(l),openCursor:r,count:function(e){var n=e.query,r=e.trans,o=n.index,s=n.range;return new Promise(function(e,n){var a=r.objectStore(t),u=o.isPrimaryKey?a:a.index(o.name),l=i(s),c=l?u.count(l):u.count();c.onsuccess=Xe(function(t){return e(t.target.result)}),c.onerror=dn(n)})}}}var a=r(e,n),u=a.schema,l=a.hasGetAll,c=u.tables.map(function(e){return o(e)}),h={};return c.forEach(function(e){return h[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '".concat(e,"' not found"));return h[e]},MIN_KEY:-1/0,MAX_KEY:An(t),schema:u}}function Dn(e,t){return t.reduce(function(e,t){var r=t.create;return n(n({},e),r(e))},e)}function Bn(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:Dn(jn(t,i,r),e.dbcore)}}function Mn(e,t){var n=t.db,r=Bn(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function In(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=m(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?d(t,n,{get:function(){return this.table(n)},set:function(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function Kn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function Tn(e,t){return e._cfg.version-t._cfg.version}function qn(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=kn("$meta",Gn("")[0],[]),e._storeNames.push("$meta"));var s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);var a=s._reject.bind(s),u=Be.transless||Be;ot(function(){if(Be.trans=s,Be.transless=u,0!==t)return Mn(e,n),Rn(e,s,t).then(function(t){return zn(e,t,s,n)}).catch(a);o(i).forEach(function(e){Fn(n,e,i[e].primKey,i[e].indexes)}),Mn(e,n),Te.follow(function(){return e.on.populate.fire(s)}).catch(a)})}function Ln(e,t){Nn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Vn(e,e.idbdb,t);Yn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){de&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),Wn(n,t)})},i=0,o=$n(n,e._dbSchema).change;i<o.length;i++){var s=r(o[i]);if("object"==typeof s)return s.value}}function Rn(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(e){return null!=e?e:n}):Te.resolve(n)}function zn(e,t,n,r){var i=[],s=e._versions,a=e._dbSchema=Vn(e,e.idbdb,r),u=s.filter(function(e){return e._cfg.version>=t});if(0===u.length)return Te.resolve();function l(){return i.length?Te.resolve(i.shift()(n.idbtrans)).then(l):Te.resolve()}return u.forEach(function(s){i.push(function(){var i=a,u=s._cfg.dbschema;Yn(e,i,r),Yn(e,u,r),a=e._dbSchema=u;var l=$n(i,u);l.add.forEach(function(e){Fn(r,e[0],e[1].primKey,e[1].indexes)}),l.change.forEach(function(e){if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach(function(e){return Wn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Wn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var c=s._cfg.contentUpgrade;if(c&&s._cfg.version>t){Mn(e,r),n._memoizedTables={};var h=S(u);l.del.forEach(function(e){h[e]=i[e]}),Kn(e,[e.Transaction.prototype]),In(e,[e.Transaction.prototype],o(h),h),n.schema=h;var f,d=N(c);d&&st();var p=Te.follow(function(){if((f=c(n))&&d){var e=at.bind(null,null);f.then(e,e)}});return f&&"function"==typeof f.then?Te.resolve(f):p.then(function(){return f})}}),i.push(function(t){Un(s._cfg.dbschema,t),Kn(e,[e.Transaction.prototype]),In(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===s._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(s._cfg.version,"version"))})}),l().then(function(){Nn(a,r)})}function $n(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)s.recreate=!0,r.change.push(s);else{var a=i.idxByName,u=o.idxByName,l=void 0;for(l in a)u[l]||s.del.push(l);for(l in u){var c=a[l],h=u[l];c?c.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function Fn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Wn(i,e)}),i}function Nn(e,t){o(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(de&&console.debug("Dexie: Creating missing table",n),Fn(t,n,e[n].primKey,e[n].indexes))})}function Un(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return null==e[n]&&t.db.deleteObjectStore(n)})}function Wn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Vn(e,t,n){var r={};return v(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=t.keyPath,o=wn(xn(i),i||"",!0,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),s=[],a=0;a<t.indexNames.length;++a){var u=t.index(t.indexNames[a]);i=u.keyPath;var l=wn(u.name,i,!!u.unique,!!u.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(l)}r[e]=kn(e,o,s)}),r}function Hn(e,t,n){e.verno=t.version/10;var r=e._dbSchema=Vn(e,t,n);e._storeNames=v(t.objectStoreNames,0),In(e,[e._allTables],o(r),r)}function Qn(e,t){var n=$n(Vn(e,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some(function(e){return e.add.length||e.change.length}))}function Yn(e,t,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var s=r[o],a=n.objectStore(s);e._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var l=a.indexNames[u],c=a.index(l).keyPath,h="string"==typeof c?c:"["+v(c).join("+")+"]";if(t[s]){var f=t[s].idxByName[h];f&&(f.name=l,delete t[s].idxByName[h],t[s].idxByName[l]=f)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Gn(e){return e.split(",").map(function(e,t){var n,r=e.split(":"),i=null===(n=r[1])||void 0===n?void 0:n.trim(),o=(e=r[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return wn(o,a||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),s(a),0===t,i)})}var Jn,Xn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return kn(e,t,n)},e.prototype._parseIndexSyntax=function(e){return Gn(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;o(e).forEach(function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),o=i.shift();if(!o)throw new ee.Schema("Invalid schema for table "+r+": "+e[r]);if(o.unique=!0,o.multi)throw new ee.Schema("Primary key cannot be multiEntry*");i.forEach(function(e){if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")});var s=n._createTableSchema(r,o,i);t[r]=s}})},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach(function(e){a(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),t._dbSchema=i,Kn(t,[t._allTables,t,t.Transaction.prototype]),In(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],o(i),i),t._storeNames=o(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||ie,e),this},e}();function Zn(e){return $t(Xn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function er(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ti(At,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function tr(e){return e&&"function"==typeof e.databases}function nr(e){var t=e.indexedDB,n=e.IDBKeyRange;return tr(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==At})}):er(t,n).toCollection().primaryKeys()}function rr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).put({name:t}).catch(ie)}function ir(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).delete(t).catch(ie)}function or(e){return ot(function(){return Be.letThrough=!0,e()})}function sr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function ar(e){return!("from"in e)}var ur=function(e,t){if(!this){var n=new ur;return e&&"d"in e&&a(n,e),n}a(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function lr(e,t,n){var r=Dt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(ar(e))return a(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Dt(n,e.from)<0)return i?lr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},dr(e);if(Dt(t,e.to)>0)return o?lr(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},dr(e);Dt(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Dt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var s=!e.r;i&&!e.l&&cr(e,i),o&&s&&cr(e,o)}}function cr(e,t){function n(e,t){var r=t.from,i=t.to,o=t.l,s=t.r;lr(e,r,i),o&&n(e,o),s&&n(e,s)}ar(t)||n(e,t)}function hr(e,t){var n=fr(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=fr(e),s=o.next(i.from),a=s.value;!r.done&&!s.done;){if(Dt(a.from,i.to)<=0&&Dt(a.to,i.from)>=0)return!0;Dt(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function fr(e){var t=ar(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Dt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Dt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function dr(e){var t,r,i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var s="r"===o?"l":"r",a=n({},e),u=e[o];e.from=u.from,e.to=u.to,e[o]=u[o],a[o]=u[s],e[s]=a,a.d=pr(a)}e.d=pr(e)}function pr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function gr(e,t){return o(t).forEach(function(n){e[n]?cr(e[n],t[n]):e[n]=D(t[n])}),e}function mr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&hr(t[n],e[n])})}h(ur.prototype,((Jn={add:function(e){return cr(this,e),this},addKey:function(e){return lr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return lr(t,e,e)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&Dt(t.from,e)<=0&&Dt(t.to,e)>=0}})[L]=function(){return fr(this)},Jn));var yr={},vr={},br=!1;function wr(e,t){gr(vr,e),br||(br=!0,setTimeout(function(){br=!1;var e=vr;vr={},xr(e,!1)},0))}function xr(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(yr);r<i.length;r++)kr(a=i[r],e,n,t);else for(var o in e){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var a,u=s[1],l=s[2];(a=yr["idb://".concat(u,"/").concat(l)])&&kr(a,e,n,t)}}n.forEach(function(e){return e()})}function kr(e,t,n,r){for(var i=[],o=0,s=Object.entries(e.queries.query);o<s.length;o++){for(var a=s[o],u=a[0],l=[],c=0,h=a[1];c<h.length;c++){var f=h[c];mr(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&l.push(f)}r&&i.push([u,l])}if(r)for(var d=0,p=i;d<p.length;d++){var g=p[d];u=g[0],l=g[1],e.queries.query[u]=l}}function _r(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?mt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}var a=t.dbReadyResolve,u=null,l=!1,c=function(){return new Te(function(r,a){if(s(),!n)throw new ee.MissingAPI;var h=e.name,f=t.autoSchema||!i?n.open(h):n.open(h,i);if(!f)throw new ee.MissingAPI;f.onerror=dn(a),f.onblocked=Xe(e._fireOnBlocked),f.onupgradeneeded=Xe(function(r){if(u=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=pn,u.abort(),f.result.close();var i=n.deleteDatabase(h);i.onsuccess=i.onerror=Xe(function(){a(new ee.NoSuchDatabase("Database ".concat(h," doesnt exist")))})}else{u.onerror=dn(a);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;l=s<1,e.idbdb=f.result,o&&Ln(e,u),qn(e,s/10,u,a)}},a),f.onsuccess=Xe(function(){u=null;var n=e.idbdb=f.result,s=v(n.objectStoreNames);if(s.length>0)try{var a=n.transaction(_n(s),"readonly");if(t.autoSchema)Hn(e,n,a);else if(Yn(e,e._dbSchema,a),!Qn(e,a)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),n.close(),i=n.version+1,o=!0,r(c());Mn(e,a)}catch(e){}_t.push(e),n.onversionchange=Xe(function(n){t.vcFired=!0,e.on("versionchange").fire(n)}),n.onclose=Xe(function(){e.close({disableAutoOpen:!1})}),l&&rr(e._deps,h),r()},a)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c();break;case"VersionError":if(i>0)return i=0,c()}return Te.reject(e)})};return Te.race([r,("undefined"==typeof navigator?Te.resolve():sr()).then(c)]).then(function(){return s(),t.onReadyBeingFired=[],Te.resolve(or(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(fe,ie);return t.onReadyBeingFired=[],Te.resolve(or(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{u&&u.abort()}catch(e){}return r===t.openCanceller&&e._close(),mt(n)}).finally(function(){t.openComplete=!0,a()}).then(function(){if(l){var t={};e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new ur(-1/0,[[[]]]))}),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new ur(-1/0,[[[]]])}),yn(gn).fire(t),xr(t,!0)}return e})}function Ar(e){var t=function(t){return e.next(t)},n=function(t){return e.throw(t)},r=o(t),i=o(n);function o(e){return function(t){var n=e(t),o=n.value;return n.done?o:o&&"function"==typeof o.then?o.then(r,i):s(o)?Promise.all(o).then(r,i):r(o)}}return o(t)()}function Cr(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,P(i),n]}function Sr(e,t,n,r,i){return Te.resolve().then(function(){var o=Be.transless||Be,s=e._createTransaction(t,n,e._dbSchema,r);s.explicit=!0;var a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===J.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return Sr(e,t,n,null,i)})):mt(r)}var u,l=N(i);l&&st();var c=Te.follow(function(){if(u=i.call(s,s))if(l){var e=at.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Ar(u))},a);return(u&&"function"==typeof u.then?Te.resolve(u).then(function(e){return s.active?e:mt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return u})).then(function(e){return r&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),mt(e)})})}function Er(e,t,n){for(var r=s(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Pr(e){return n(n({},e),{table:function(t){var r=e.table(t),i=r.schema,o={},s=[];function a(e,t,r){var i=On(e),u=o[i]=o[i]||[],l=null==e?0:"string"==typeof e?1:e.length,c=t>0,h=n(n({},r),{name:c?"".concat(i,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:c,keyTail:t,keyLength:l,extractKey:Cn(e),unique:!c&&r.unique});return u.push(h),h.isPrimaryKey||s.push(h),l>1&&a(2===l?e[0]:e.slice(0,l-1),t+1,r),u.sort(function(e,t){return e.keyTail-t.keyTail}),h}var u=a(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var l=0,c=i.indexes;l<c.length;l++){var h=c[l];a(h.keyPath,0,h)}function f(e){var t=o[On(e)];return t&&t[0]}function d(t,n){return{type:1===t.type?2:t.type,lower:Er(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Er(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function p(e){var t=e.query.index;return t.isVirtual?n(n({},e),{query:{index:t.lowLevelIndex,range:d(e.query.range,t.keyTail)}}):e}var g=n(n({},r),{schema:n(n({},i),{primaryKey:u,indexes:s,getIndexByKeyPath:f}),count:function(e){return r.count(p(e))},query:function(e){return r.query(p(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,o=n.isVirtual,s=n.keyLength;if(!o)return r.openCursor(t);function a(n){function r(r){null!=r?n.continue(Er(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}var o=Object.create(n,{continue:{value:r},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Er(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:function(){return n.value}}});return o}return r.openCursor(p(t)).then(function(e){return e&&a(e)})}});return g}})}var Or={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Pr};function jr(e,t,n,r){return n=n||{},r=r||"",o(e).forEach(function(i){if(c(t,i)){var o=e[i],s=t[i];if("object"==typeof o&&"object"==typeof s&&o&&s){var a=q(o);a!==q(s)?n[r+i]=t[i]:"Object"===a?jr(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}else n[r+i]=void 0}),o(t).forEach(function(i){c(e,i)||(n[r+i]=t[i])}),n}function Dr(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Br={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return n(n({},e),{table:function(t){var i=e.table(t),o=i.schema.primaryKey,s=n(n({},i),{mutate:function(e){var s=Be.trans,a=s.table(t).hook,u=a.deleting,l=a.creating,h=a.updating;switch(e.type){case"add":if(l.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"put":if(l.fire===ie&&h.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"delete":if(u.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"deleteRange":if(u.fire===ie)break;return s._promise("readwrite",function(){return d(e)},!0)}return i.mutate(e);function f(e){var t=Be.trans,s=e.keys||Dr(o,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?n(n({},e),{keys:s}):n({},e)).type&&(e.values=r([],e.values,!0)),e.keys&&(e.keys=r([],e.keys,!0)),Mr(i,e,s).then(function(n){var r=s.map(function(r,i){var s=n[i],a={onerror:null,onsuccess:null};if("delete"===e.type)u.fire.call(a,r,s,t);else if("add"===e.type||void 0===s){var f=l.fire.call(a,r,e.values[i],t);null==r&&null!=f&&(r=f,e.keys[i]=r,o.outbound||A(e.values[i],o.keyPath,r))}else{var d=jr(s,e.values[i]),p=h.fire.call(a,d,r,s,t);if(p){var g=e.values[i];Object.keys(p).forEach(function(e){c(g,e)?g[e]=p[e]:A(g,e,p[e])})}}return a});return i.mutate(e).then(function(t){for(var i=t.failures,o=t.results,a=t.numFailures,u=t.lastResult,l=0;l<s.length;++l){var c=o?o[l]:s[l],h=r[l];null==c?h.onerror&&h.onerror(i[l]):h.onsuccess&&h.onsuccess("put"===e.type&&n[l]?e.values[l]:c)}return{failures:i,results:o,numFailures:a,lastResult:u}}).catch(function(e){return r.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}function d(e){return p(e.trans,e.range,1e4)}function p(e,t,r){return i.query({trans:e,values:!1,query:{index:o,range:t},limit:r}).then(function(i){var o=i.result;return f({type:"delete",keys:o,trans:e}).then(function(i){return i.numFailures>0?Promise.reject(i.failures[0]):o.length<r?{failures:[],numFailures:0,lastResult:void 0}:p(e,n(n({},t),{lower:o[o.length-1],lowerOpen:!0}),r)})})}}});return s}})}};function Mr(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function Ir(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Dt(t.keys[i],e[o])&&(r.push(n?I(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var Kr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return n(n({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Ir(e.keys,e.trans._cache,"clone"===e.cache);return t?Te.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?I(t):t},t})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function Tr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function qr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Lr={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new ur(e.MIN_KEY,e.MAX_KEY);return n(n({},e),{transaction:function(t,n,r){if(Be.subscr&&"readonly"!==n)throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Be.querier));return e.transaction(t,n,r)},table:function(i){var a=e.table(i),u=a.schema,l=u.primaryKey,c=u.indexes,h=l.extractKey,f=l.outbound,d=l.autoIncrement&&c.filter(function(e){return e.compound&&e.keyPath.includes(l.keyPath)}),p=n(n({},a),{mutate:function(n){var o,c,h=n.trans,f=n.mutatedParts||(n.mutatedParts={}),p=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return f[n]||(f[n]=new ur)},g=p(""),m=p(":dels"),y=n.type,v="deleteRange"===n.type?[n.range]:"delete"===n.type?[n.keys]:n.values.length<50?[Dr(l,n).filter(function(e){return e}),n.values]:[],b=v[0],w=v[1],x=n.trans._cache;if(s(b)){g.addKeys(b);var k="delete"===y||b.length===w.length?Ir(b,x):null;k||m.addKeys(b),(k||w)&&Rr(p,u,k,w)}else if(b){var _={from:null!==(o=b.lower)&&void 0!==o?o:e.MIN_KEY,to:null!==(c=b.upper)&&void 0!==c?c:e.MAX_KEY};m.add(_),g.add(_)}else g.add(r),m.add(r),u.indexes.forEach(function(e){return p(e.name).add(r)});return a.mutate(n).then(function(e){return!b||"add"!==n.type&&"put"!==n.type||(g.addKeys(e.results),d&&d.forEach(function(t){for(var r=n.values.map(function(e){return t.extractKey(e)}),i=t.keyPath.findIndex(function(e){return e===l.keyPath}),o=0,s=e.results.length;o<s;++o)r[o][i]=e.results[o];p(t.name).addKeys(r)})),h.mutatedParts=gr(h.mutatedParts||{},f),e})}}),g=function(t){var n,r,i=t.query,o=i.index,s=i.range;return[o,new ur(null!==(n=s.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=s.upper)&&void 0!==r?r:e.MAX_KEY)]},m={get:function(e){return[l,new ur(e.key)]},getMany:function(e){return[l,(new ur).addKeys(e.keys)]},count:g,query:g,openCursor:g};return o(m).forEach(function(e){p[e]=function(o){var s=Be.subscr,u=!!s,l=Tr(Be,a)&&qr(e,o)?o.obsSet={}:s;if(u){var c=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return l[n]||(l[n]=new ur)},d=c(""),p=c(":dels"),g=m[e](o),y=g[0],v=g[1];if("query"===e&&y.isPrimaryKey&&!o.values?p.add(v):c(y.name||"").add(v),!y.isPrimaryKey){if("count"!==e){var b="query"===e&&f&&o.values&&a.query(n(n({},o),{values:!1}));return a[e].apply(this,arguments).then(function(t){if("query"===e){if(f&&o.values)return b.then(function(e){var n=e.result;return d.addKeys(n),t});var n=o.values?t.result.map(h):t.result;o.values?d.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,i=o.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return i&&d.addKey(r.primaryKey),r.value}}})}return t})}p.add(r)}}return a[e].apply(this,arguments)}}),p}})}};function Rr(e,t,n,r){function i(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var a=function(e){return t.multiEntry&&s(e)?e.forEach(function(e){return i.addKey(e)}):i.addKey(e)};(n||r).forEach(function(e,t){var i=n&&o(n[t]),s=r&&o(r[t]);0!==Dt(i,s)&&(null!=i&&a(i),null!=s&&a(s))})}t.indexes.forEach(i)}function zr(e,t,r){if(0===r.numFailures)return t;if("deleteRange"===t.type)return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(r.numFailures===i)return null;var o=n({},t);return s(o.keys)&&(o.keys=o.keys.filter(function(e,t){return!(t in r.failures)})),"values"in o&&s(o.values)&&(o.values=o.values.filter(function(e,t){return!(t in r.failures)})),o}function $r(e,t){return void 0===t.lower||(t.lowerOpen?Dt(e,t.lower)>0:Dt(e,t.lower)>=0)}function Fr(e,t){return void 0===t.upper||(t.upperOpen?Dt(e,t.upper)<0:Dt(e,t.upper)<=0)}function Nr(e,t){return $r(e,t)&&Fr(e,t)}function Ur(e,t,n,r,i,o){if(!n||0===n.length)return e;var a=t.query.index,u=a.multiEntry,l=t.query.range,c=r.schema.primaryKey.extractKey,h=a.extractKey,f=(a.lowLevelIndex||a).extractKey,d=n.reduce(function(e,n){var r=e,i=[];if("add"===n.type||"put"===n.type)for(var o=new ur,a=n.values.length-1;a>=0;--a){var f=n.values[a],d=c(f);if(!o.hasKey(d)){var p=h(f);(u&&s(p)?p.some(function(e){return Nr(e,l)}):Nr(p,l))&&(o.addKey(d),i.push(f))}}switch(n.type){case"add":var g=(new ur).addKeys(t.values?e.map(function(e){return c(e)}):e);r=e.concat(t.values?i.filter(function(e){var t=c(e);return!g.hasKey(t)&&(g.addKey(t),!0)}):i.map(function(e){return c(e)}).filter(function(e){return!g.hasKey(e)&&(g.addKey(e),!0)}));break;case"put":var m=(new ur).addKeys(n.values.map(function(e){return c(e)}));r=e.filter(function(e){return!m.hasKey(t.values?c(e):e)}).concat(t.values?i:i.map(function(e){return c(e)}));break;case"delete":var y=(new ur).addKeys(n.keys);r=e.filter(function(e){return!y.hasKey(t.values?c(e):e)});break;case"deleteRange":var v=n.range;r=e.filter(function(e){return!Nr(c(e),v)})}return r},e);return d===e?e:(d.sort(function(e,t){return Dt(f(e),f(t))||Dt(c(e),c(t))}),t.limit&&t.limit<1/0&&(d.length>t.limit?d.length=t.limit:e.length===t.limit&&d.length<t.limit&&(i.dirty=!0)),o?Object.freeze(d):d)}function Wr(e,t){return 0===Dt(e.lower,t.lower)&&0===Dt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Vr(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var i=Dt(e,t);if(0===i){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function Hr(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var i=Dt(e,t);if(0===i){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Qr(e,t){return Vr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Hr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Yr(e,t,n,r){var i=yr["idb://".concat(e,"/").concat(t)];if(!i)return[];var o=i.queries[n];if(!o)return[null,!1,i,null];var s=o[(r.query?r.query.index.name:null)||""];if(!s)return[null,!1,i,null];switch(n){case"query":var a=s.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Wr(e.req.query.range,r.query.range)});return a?[a,!0,i,s]:[s.find(function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&Qr(e.req.query.range,r.query.range)}),!1,i,s];case"count":var u=s.find(function(e){return Wr(e.req.query.range,r.query.range)});return[u,!!u,i,s]}}function Gr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){e.subscribers.delete(n),0===e.subscribers.size&&Jr(e,t)})}function Jr(e,t){setTimeout(function(){0===e.subscribers.size&&z(t,e)},3e3)}var Xr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,r=n(n({},e),{transaction:function(n,r,i){var o=e.transaction(n,r,i);if("readwrite"===r){var s=new AbortController,a=s.signal,u=function(i){return function(){if(s.abort(),"readwrite"===r){for(var a=new Set,u=0,l=n;u<l.length;u++){var c=l[u],h=yr["idb://".concat(t,"/").concat(c)];if(h){var f=e.table(c),d=h.optimisticOps.filter(function(e){return e.trans===o});if(o._explicit&&i&&o.mutatedParts)for(var p=0,g=Object.values(h.queries.query);p<g.length;p++)for(var m=0,y=(w=g[p]).slice();m<y.length;m++)mr((_=y[m]).obsSet,o.mutatedParts)&&(z(w,_),_.subscribers.forEach(function(e){return a.add(e)}));else if(d.length>0){h.optimisticOps=h.optimisticOps.filter(function(e){return e.trans!==o});for(var v=0,b=Object.values(h.queries.query);v<b.length;v++)for(var w,x=0,k=(w=b[v]).slice();x<k.length;x++){var _;if(null!=(_=k[x]).res&&o.mutatedParts)if(i&&!_.dirty){var A=Object.isFrozen(_.res),C=Ur(_.res,_.req,d,f,_,A);_.dirty?(z(w,_),_.subscribers.forEach(function(e){return a.add(e)})):C!==_.res&&(_.res=C,_.promise=Te.resolve({result:C}))}else _.dirty&&z(w,_),_.subscribers.forEach(function(e){return a.add(e)})}}}}a.forEach(function(e){return e()})}}};o.addEventListener("abort",u(!1),{signal:a}),o.addEventListener("error",u(!1),{signal:a}),o.addEventListener("complete",u(!0),{signal:a})}return o},table:function(r){var i=e.table(r),o=i.schema.primaryKey,s=n(n({},i),{mutate:function(e){var s=Be.trans;if(o.outbound||"disabled"===s.db._options.cache||s.explicit||"readwrite"!==s.idbtrans.mode)return i.mutate(e);var a=yr["idb://".concat(t,"/").concat(r)];if(!a)return i.mutate(e);var u=i.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Dr(o,e).some(function(e){return null==e}))?(a.optimisticOps.push(e),e.mutatedParts&&wr(e.mutatedParts),u.then(function(t){if(t.numFailures>0){z(a.optimisticOps,e);var n=zr(a,e,t);n&&a.optimisticOps.push(n),e.mutatedParts&&wr(e.mutatedParts)}}),u.catch(function(){z(a.optimisticOps,e),e.mutatedParts&&wr(e.mutatedParts)})):u.then(function(t){var r=n(n({},e),{values:e.values.map(function(e,r){var i;if(t.failures[r])return e;var s=(null===(i=o.keyPath)||void 0===i?void 0:i.includes("."))?I(e):n({},e);return A(s,o.keyPath,t.results[r]),s})}),i=zr(a,r,t);a.optimisticOps.push(i),queueMicrotask(function(){return e.mutatedParts&&wr(e.mutatedParts)})}),u},query:function(e){var n;if(!Tr(Be,i)||!qr("query",e))return i.query(e);var o="immutable"===(null===(n=Be.trans)||void 0===n?void 0:n.db._options.cache),s=Be,a=s.requery,u=s.signal,l=Yr(t,r,"query",e),c=l[0],h=l[1],f=l[2],d=l[3];if(c&&h)c.obsSet=e.obsSet;else{var p=i.query(e).then(function(e){var t=e.result;if(c&&(c.res=t),o){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=I(t);return e}).catch(function(e){return d&&c&&z(d,c),Promise.reject(e)});c={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},d?d.push(c):(d=[c],f||(f=yr["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),f.queries.query[e.query.index.name||""]=d)}return Gr(c,d,a,u),c.promise.then(function(t){return{result:Ur(t.result,e,null==f?void 0:f.optimisticOps,i,c,o)}})}});return s}});return r}};function Zr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var ei,ti=function(){function e(t,r){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=r=n({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var s=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};a.dbReadyPromise=new Te(function(e){a.dbReadyResolve=e}),a.openCanceller=new Te(function(e,t){a.cancelOpen=t}),this._state=a,this.name=t,this.on=zt(this,"populate","blocked","versionchange","close",{ready:[fe,ie]}),this.once=function(e,t){var n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];i.on(e).unsubscribe(n),t.apply(i,r)};return i.on(e,n)},this.on.ready.subscribe=b(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||Te.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t(function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)})}})}}),this.Collection=Zt(this),this.Table=Ft(this),this.Transaction=bn(this),this.Version=Zn(this),this.WhereClause=fn(this),this.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=An(r.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),_t.filter(function(e){return e.name===i.name&&e!==i&&!e._state.vcFired}).map(function(t){return t.on("versionchange").fire(e)})},this.use(Kr),this.use(Xr),this.use(Lr),this.use(Or),this.use(Br);var u=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return Zr(i.table(e),u)};var r=Reflect.get(e,t,n);return r instanceof Rt?Zr(r,u):"tables"===t?r.map(function(e){return Zr(e,u)}):"_createTransaction"===t?function(){return Zr(r.apply(this,arguments),u)}:r}});this.vip=u,s.forEach(function(e){return e(i)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Tn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Be.letThrough||this._vip)?e():new Te(function(e,n){if(t._state.openComplete)return n(new ee.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new ee.DatabaseClosed);t.open().catch(ie)}t._state.dbReadyPromise.then(e,n)}).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort(function(e,t){return e.level-t.level}),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},e.prototype.open=function(){var e=this;return dt(De,function(){return _r(e)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=_t.indexOf(this);if(t>=0&&_t.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Te(function(t){e.dbReadyResolve=t}),e.openCanceller=new Te(function(t,n){e.cancelOpen=n}))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new ee.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new ee.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new Te(function(i,o){var s=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Xe(function(){ir(t._deps,t.name),i()}),n.onerror=dn(o),n.onblocked=t._fireOnBlocked};if(n)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return o(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Cr.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=Be.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,s,a=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map(function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}),"r"==e||e===Ct)o=Ct;else{if("rw"!=e&&e!=St)throw new ee.InvalidArgument("Invalid transaction mode: "+e);o=St}if(i){if(i.mode===Ct&&o===St){if(!a)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!a)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");i=null}}),a&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):mt(e)}var u=Sr.bind(null,this,o,s,i,n);return i?i._promise(o,u,"lock"):Be.trans?dt(Be.transless,function(){return r._whenReady(u)}):this._whenReady(u)},e.prototype.table=function(e){if(!c(this._allTables,e))throw new ee.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),ni="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ri=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[ni]=function(){return this},e}();try{ei={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(e){ei={indexedDB:null,IDBKeyRange:null}}function ii(e){var t,n=!1,r=new ri(function(r){var i=N(e);function o(t){var n=We();try{i&&st();var r=ot(e,t);return i&&(r=r.finally(at)),r}finally{n&&Ve()}}var s,a=!1,u={},l={},c={get closed(){return a},unsubscribe:function(){a||(a=!0,s&&s.abort(),h&&yn.storagemutated.unsubscribe(p))}};r.start&&r.start(c);var h=!1,f=function(){return gt(g)};function d(){return mr(l,u)}var p=function(e){gr(u,e),d()&&f()},g=function(){if(!a&&ei.indexedDB){u={};var i={};s&&s.abort(),s=new AbortController;var c={subscr:i,signal:s.signal,requery:f,querier:e,trans:null},d=o(c);Promise.resolve(d).then(function(e){n=!0,t=e,a||c.signal.aborted||(u={},B(l=i)||h||(yn(gn,p),h=!0),gt(function(){return!a&&r.next&&r.next(e)}))},function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||gt(function(){a||r.error&&r.error(e)})})}};return setTimeout(f,0),c});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var oi=ti;function si(e){var t=ui;try{ui=!0,yn.storagemutated.fire(e),xr(e,!0)}finally{ui=t}}h(oi,n(n({},re),{delete:function(e){return new oi(e,{addons:[]}).delete()},exists:function(e){return new oi(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return nr(oi.dependencies).then(e)}catch(e){return mt(new ee.MissingAPI)}},defineClass:function(){function e(e){a(this,e)}return e},ignoreTransaction:function(e){return Be.trans?dt(Be.transless,e):e()},vip:or,async:function(e){return function(){try{var t=Ar(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Te.resolve(t)}catch(e){return mt(e)}}},spawn:function(e,t,n){try{var r=Ar(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Te.resolve(r)}catch(e){return mt(e)}},currentTransaction:{get:function(){return Be.trans||null}},waitFor:function(e,t){var n=Te.resolve("function"==typeof e?oi.ignoreTransaction(e):e).timeout(t||6e4);return Be.trans?Be.trans.waitFor(n):n},Promise:Te,debug:{get:function(){return de},set:function(e){pe(e)}},derive:p,extend:a,props:h,override:b,Events:zt,on:yn,liveQuery:ii,extendObservabilitySet:gr,getByKeyPath:_,setByKeyPath:A,delByKeyPath:C,shallowClone:S,deepClone:I,getObjectDiff:jr,cmp:Dt,asap:x,minKey:wt,addons:[],connections:_t,errnames:J,dependencies:ei,cache:yr,semVer:vt,version:vt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),oi.maxKey=An(oi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(yn(gn,function(e){var t;ui||(t=new CustomEvent(mn,{detail:e}),ui=!0,dispatchEvent(t),ui=!1)}),addEventListener(mn,function(e){var t=e.detail;ui||si(t)}));var ai,ui=!1,li=function(){};function ci(e){return new qt({add:e})}function hi(e){return new qt({remove:e})}function fi(e,t){return new qt({replacePrefix:[e,t]})}return"undefined"!=typeof BroadcastChannel&&((li=function(){(ai=new BroadcastChannel(mn)).onmessage=function(e){return e.data&&si(e.data)}})(),"function"==typeof ai.unref&&ai.unref(),yn(gn,function(e){ui||ai.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!ti.disableBfCache&&e.persisted){de&&console.debug("Dexie: handling persisted pagehide"),null==ai||ai.close();for(var t=0,n=_t;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ti.disableBfCache&&e.persisted&&(de&&console.debug("Dexie: handling persisted pageshow"),li(),si({all:new ur(-1/0,[[]])}))})),Te.rejectionMapper=ne,pe(de),n(ti,Object.freeze({__proto__:null,Dexie:ti,liveQuery:ii,Entity:jt,cmp:Dt,PropModification:qt,replacePrefix:fi,add:ci,remove:hi,default:ti,RangeSet:ur,mergeRanges:cr,rangesOverlap:hr}),{default:ti}),ti}();var ne=ee(te.exports);const re=Symbol.for("Dexie"),ie=globalThis[re]||(globalThis[re]=ne);if(ne.semVer!==ie.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ne.semVer} and ${ie.semVer}`);const oe=new ie("BookmarkInsightsDB");async function se(){try{return await oe.bookmarks.toArray()}catch(e){return console.error("Error getting bookmarks:",e),[]}}async function ae(e,t,n=null){try{return await oe.cache.put({key:e,value:t,timestamp:Date.now(),ttl:n}),!0}catch(e){return console.error("Error setting cache:",e),!1}}oe.version(1).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}),oe.version(2).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}).upgrade(e=>{console.log("Upgrading database to version 2 - adding rawMetadata support")}),oe.version(3).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 3 - adding similarities and computedMetrics tables")}),oe.version(4).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId, platform, creator, contentType",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 4 - adding platformData indexes")}),oe.version(5).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId, platform, creator, contentType, publishedDate",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 5 - adding deep metadata analysis fields")});const ue=3e5,le=864e5;async function ce(e,t,n){try{const r=await oe.computedMetrics.get(e);if(r&&r.validUntil>Date.now())return console.log(`Cache hit for metric: ${e}`),r.data;console.log(`Cache miss for metric: ${e}, computing...`);const i=await t();return await oe.computedMetrics.put({key:e,data:i,computedAt:Date.now(),validUntil:Date.now()+n}),i}catch(n){return console.error(`Error getting cached metric ${e}:`,n),t()}}async function he(){return ce("quickStats",async()=>{const e=await se(),t=await async function(){return ce("duplicates",async()=>{const e=await se(),t={};return e.forEach(e=>{const n=e.url.toLowerCase().replace(/\/$/,"");t[n]||(t[n]=[]),t[n].push(e)}),Object.values(t).filter(e=>e.length>1)},le)}(),n=await async function(){try{const e=await se(),t=["Bookmarks Bar","Other Bookmarks","Mobile Bookmarks",""];return e.filter(e=>{const n=e.folderPath||"";return t.includes(n)||!n.includes("/")})}catch(e){return console.error("Error finding uncategorized bookmarks:",e),[]}}(),r=await async function(){try{const e=await se(),t=["http://","https://","chrome://","chrome-extension://","file://","javascript:","data:","about:","mailto:","tel:","ftp://","sftp://","ssh://"];return e.filter(e=>{const n=e.url||"";return!t.some(e=>n.startsWith(e))||""===n.trim()})}catch(e){return console.error("Error finding malformed URLs:",e),[]}}(),i=Date.now(),o=e.filter(e=>e.lastChecked).length,s=e.filter(e=>!1===e.isAlive).length,a=new Set(e.map(e=>e.domain).filter(e=>e)).size;return{total:e.length,enriched:o,pending:e.length-o,enrichedPercentage:e.length>0?Math.round(o/e.length*100):0,duplicateGroups:t.length,uncategorized:n.length,malformed:r.length,deadLinks:s,uniqueDomains:a,addedThisWeek:e.filter(e=>i-e.dateAdded<6048e5).length,addedThisMonth:e.filter(e=>i-e.dateAdded<2592e6).length,oldestBookmark:e.reduce((e,t)=>t.dateAdded<e?t.dateAdded:e,Date.now()),newestBookmark:e.reduce((e,t)=>t.dateAdded>e?t.dateAdded:e,0)}},ue)}const fe=(()=>{const{subscribe:e,set:t,update:n}=J({total:0,enriched:0,pending:0,deadLinks:0,duplicates:0,uniqueDomains:0,addedThisWeek:0,addedThisMonth:0,lastUpdated:null,loading:!0});let r=null;return{subscribe:e,async refresh(){try{const e=await se(),n=Date.now(),r=6048e5,i=2592e6,o=e.length,s=e.filter(e=>e.lastChecked).length,a=e.filter(e=>!1===e.isAlive).length,u=new Set(e.map(e=>e.domain).filter(e=>e)).size,l=e.filter(e=>n-e.dateAdded<r).length,c=e.filter(e=>n-e.dateAdded<i).length,h=await ce("quickDuplicateCount",async()=>{const t=new Map;return e.forEach(e=>{const n=e.url.toLowerCase().replace(/\/$/,"");t.has(n)||t.set(n,0),t.set(n,t.get(n)+1)}),Array.from(t.values()).filter(e=>e>1).length},ue);t({total:o,enriched:s,pending:o-s,deadLinks:a,duplicates:h,uniqueDomains:u,addedThisWeek:l,addedThisMonth:c,lastUpdated:Date.now(),loading:!1})}catch(e){console.error("Error refreshing stats:",e),n(e=>({...e,loading:!1}))}},startAutoRefresh(e=3e4){if(this.refresh(),!r){r=setInterval(()=>{"undefined"!=typeof document&&"visible"===document.visibilityState&&this.refresh()},e),console.log("Stats auto-refresh started (visibility-aware)")}},stopAutoRefresh(){r&&(clearInterval(r),r=null,console.log("Stats auto-refresh stopped"))}}})();function de(e,t,n){const r=e.slice();return r[13]=t[n],r}function pe(e,t,n){const r=e.slice();return r[16]=t[n],r}function ge(e,t,n){const r=e.slice();return r[19]=t[n],r}function me(e,t,n){const r=e.slice();return r[19]=t[n],r}function ye(t){let n,r,i;return{c(){n=d("button"),n.innerHTML='<svg class="h-5 w-5 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',b(n,"class","absolute inset-y-0 right-0 pr-3 flex items-center"),b(n,"type","button"),b(n,"title","Clear search (Esc)")},m(e,o){c(e,n,o),r||(i=v(n,"click",t[7]),r=!0)},p:e,d(e){e&&h(n),r=!1,i()}}}function ve(e){let t,n,r,i,o=R(e[4].positive),s=[];for(let t=0;t<o.length;t+=1)s[t]=be(me(e,o,t));let a=R(e[4].negative),u=[];for(let t=0;t<a.length;t+=1)u[t]=we(ge(e,a,t));let p=R(e[4].phrases),g=[];for(let t=0;t<p.length;t+=1)g[t]=xe(pe(e,p,t));let y=R(e[4].regexPatterns),v=[];for(let t=0;t<y.length;t+=1)v[t]=ke(de(e,y,t));return{c(){t=d("div");for(let e=0;e<s.length;e+=1)s[e].c();n=m();for(let e=0;e<u.length;e+=1)u[e].c();r=m();for(let e=0;e<g.length;e+=1)g[e].c();i=m();for(let e=0;e<v.length;e+=1)v[e].c();b(t,"class","flex flex-wrap gap-1.5 mt-2")},m(e,o){c(e,t,o);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(t,null);l(t,n);for(let e=0;e<u.length;e+=1)u[e]&&u[e].m(t,null);l(t,r);for(let e=0;e<g.length;e+=1)g[e]&&g[e].m(t,null);l(t,i);for(let e=0;e<v.length;e+=1)v[e]&&v[e].m(t,null)},p(e,l){if(16&l){let r;for(o=R(e[4].positive),r=0;r<o.length;r+=1){const i=me(e,o,r);s[r]?s[r].p(i,l):(s[r]=be(i),s[r].c(),s[r].m(t,n))}for(;r<s.length;r+=1)s[r].d(1);s.length=o.length}if(16&l){let n;for(a=R(e[4].negative),n=0;n<a.length;n+=1){const i=ge(e,a,n);u[n]?u[n].p(i,l):(u[n]=we(i),u[n].c(),u[n].m(t,r))}for(;n<u.length;n+=1)u[n].d(1);u.length=a.length}if(16&l){let n;for(p=R(e[4].phrases),n=0;n<p.length;n+=1){const r=pe(e,p,n);g[n]?g[n].p(r,l):(g[n]=xe(r),g[n].c(),g[n].m(t,i))}for(;n<g.length;n+=1)g[n].d(1);g.length=p.length}if(16&l){let n;for(y=R(e[4].regexPatterns),n=0;n<y.length;n+=1){const r=de(e,y,n);v[n]?v[n].p(r,l):(v[n]=ke(r),v[n].c(),v[n].m(t,null))}for(;n<v.length;n+=1)v[n].d(1);v.length=y.length}},d(e){e&&h(t),f(s,e),f(u,e),f(g,e),f(v,e)}}}function be(e){let t,n,r,i,o,s=e[19]+"";return{c(){t=d("span"),n=p("svg"),r=p("path"),i=m(),o=g(s),b(r,"fill-rule","evenodd"),b(r,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"),b(r,"clip-rule","evenodd"),b(n,"class","w-3 h-3 mr-1"),b(n,"fill","currentColor"),b(n,"viewBox","0 0 20 20"),b(t,"class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300")},m(e,s){c(e,t,s),l(t,n),l(n,r),l(t,i),l(t,o)},p(e,t){16&t&&s!==(s=e[19]+"")&&w(o,s)},d(e){e&&h(t)}}}function we(e){let t,n,r,i,o,s=e[19]+"";return{c(){t=d("span"),n=p("svg"),r=p("path"),i=m(),o=g(s),b(r,"fill-rule","evenodd"),b(r,"d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"),b(r,"clip-rule","evenodd"),b(n,"class","w-3 h-3 mr-1"),b(n,"fill","currentColor"),b(n,"viewBox","0 0 20 20"),b(t,"class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300")},m(e,s){c(e,t,s),l(t,n),l(n,r),l(t,i),l(t,o)},p(e,t){16&t&&s!==(s=e[19]+"")&&w(o,s)},d(e){e&&h(t)}}}function xe(e){let t,n,r,i,o,s,a=e[16]+"";return{c(){t=d("span"),n=p("svg"),r=p("path"),i=g('\n          "'),o=g(a),s=g('"'),b(r,"fill-rule","evenodd"),b(r,"d","M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z"),b(r,"clip-rule","evenodd"),b(n,"class","w-3 h-3 mr-1"),b(n,"fill","currentColor"),b(n,"viewBox","0 0 20 20"),b(t,"class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-300")},m(e,a){c(e,t,a),l(t,n),l(n,r),l(t,i),l(t,o),l(t,s)},p(e,t){16&t&&a!==(a=e[16]+"")&&w(o,a)},d(e){e&&h(t)}}}function ke(e){let t,n,r,i,o,s,a=e[13]+"";return{c(){t=d("span"),n=p("svg"),r=p("path"),i=m(),o=g(a),s=m(),b(r,"stroke-linecap","round"),b(r,"stroke-linejoin","round"),b(r,"stroke-width","2"),b(r,"d","M10 20l4-16m4 4l-4 4 4 4M6 16l-4-4 4-4"),b(n,"class","w-3 h-3 mr-1"),b(n,"fill","none"),b(n,"stroke","currentColor"),b(n,"viewBox","0 0 20 20"),b(t,"class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-300")},m(e,a){c(e,t,a),l(t,n),l(n,r),l(t,i),l(t,o),l(t,s)},p(e,t){16&t&&a!==(a=e[13]+"")&&w(o,a)},d(e){e&&h(t)}}}function _e(e){let t;return{c(){t=d("div"),t.innerHTML='<h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2"><svg class="w-4 h-4 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>\n        Search Syntax</h4> <div class="space-y-2 text-sm"><div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300 rounded text-xs whitespace-nowrap">+term</code> <span class="text-gray-600 dark:text-gray-400">Must include this term</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300 rounded text-xs whitespace-nowrap">-term</code> <span class="text-gray-600 dark:text-gray-400">Must NOT include this term</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-300 rounded text-xs whitespace-nowrap">&quot;exact phrase&quot;</code> <span class="text-gray-600 dark:text-gray-400">Match exact phrase</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs whitespace-nowrap">word</code> <span class="text-gray-600 dark:text-gray-400">Regular search term</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-300 rounded text-xs whitespace-nowrap">/regex/</code> <span class="text-gray-600">Regular expression pattern</span></div></div> <div class="mt-4 pt-3 border-t border-gray-100"><h5 class="font-medium text-gray-800 mb-2 flex items-center gap-2 text-sm"><svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>\n          Special Filters</h5> <div class="space-y-2 text-sm"><div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-indigo-100 text-indigo-800 rounded text-xs whitespace-nowrap">category:tech</code> <span class="text-gray-600">ðŸ“ Filter by category</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-indigo-100 text-indigo-800 rounded text-xs whitespace-nowrap">domain:github.com</code> <span class="text-gray-600">ðŸŒ Filter by domain</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-indigo-100 text-indigo-800 rounded text-xs whitespace-nowrap">folder:&quot;Work/Projects&quot;</code> <span class="text-gray-600">ðŸ“‚ Filter by folder path</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-amber-100 text-amber-800 rounded text-xs whitespace-nowrap">accessed:yes</code> <span class="text-gray-600">ðŸ‘† Has been accessed (yes/no)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-amber-100 text-amber-800 rounded text-xs whitespace-nowrap">stale:yes</code> <span class="text-gray-600">â° Old &amp; never accessed</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-teal-100 text-teal-800 rounded text-xs whitespace-nowrap">enriched:yes</code> <span class="text-gray-600">âœ¨ Has metadata (yes/no)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-red-100 text-red-700 rounded text-xs whitespace-nowrap">dead:yes</code> <span class="text-gray-600">ðŸ’€ Dead links (yes/no)</span></div></div></div> <div class="mt-4 pt-3 border-t border-gray-100"><h5 class="font-medium text-gray-800 mb-2 flex items-center gap-2 text-sm"><span class="text-lg">ðŸ“±</span>\n          Platform Filters</h5> <div class="space-y-2 text-sm"><div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">platform:youtube</code> <span class="text-gray-600">ðŸ“º Filter by platform (youtube, github, medium, etc.)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">channel:@mkbhd</code> <span class="text-gray-600">ðŸ“º YouTube channel (with or without @)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">repo:facebook/react</code> <span class="text-gray-600">ðŸ’» GitHub repository (owner/repo)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">author:username</code> <span class="text-gray-600">âœï¸ Blog/article author</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">type:video</code> <span class="text-gray-600">ðŸ“ Content type (video, issue, article, repo, pr)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">hasimage:yes</code> <span class="text-gray-600">ðŸ–¼ï¸ Has thumbnail image (yes/no)</span></div> <div class="flex items-start gap-3"><code class="px-1.5 py-0.5 bg-pink-100 text-pink-800 rounded text-xs whitespace-nowrap">playlist:PLxxx</code> <span class="text-gray-600">ðŸŽµ YouTube playlist ID</span></div></div></div> <div class="mt-4 pt-3 border-t border-gray-100"><p class="text-xs text-gray-500"><strong>Example:</strong> <code class="bg-gray-100 px-1 rounded">javascript +tutorial -video &quot;best practices&quot;</code></p> <p class="text-xs text-gray-500 mt-1"><strong>With filters:</strong> <code class="bg-gray-100 px-1 rounded">domain:github.com category:development enriched:yes</code></p> <p class="text-xs text-gray-500 mt-1"><strong>Platform:</strong> <code class="bg-gray-100 px-1 rounded">platform:youtube channel:@fireship type:video</code></p> <p class="text-xs text-gray-500 mt-1"><strong>Regex:</strong> <code class="bg-gray-100 px-1 rounded">/react.*hooks?/</code></p></div>',b(t,"class","absolute z-20 w-full mt-2 p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-[70vh] overflow-y-auto")},m(e,n){c(e,t,n)},d(e){e&&h(t)}}}function Ae(t){let n,i,o,s,a,u,f,p,g,y,w,k,_,A=t[0]&&ye(t),C=t[0]&&(t[4].positive.length>0||t[4].negative.length>0||t[4].phrases.length>0||t[4].regexPatterns.length>0)&&ve(t),S=t[3]&&_e();return{c(){n=d("div"),i=d("div"),o=d("div"),s=d("div"),s.innerHTML='<svg class="h-5 w-5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>',a=m(),u=d("input"),f=m(),A&&A.c(),p=m(),g=d("button"),g.innerHTML='<svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',y=m(),C&&C.c(),w=m(),S&&S.c(),b(s,"class","absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"),b(u,"type","text"),b(u,"placeholder",t[1]),b(u,"class","block w-full pl-10 pr-10 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg leading-5 bg-white dark:bg-gray-800 placeholder-gray-400 dark:placeholder-gray-500 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"),b(u,"autocomplete","off"),b(u,"spellcheck","false"),b(o,"class","relative flex-1"),b(g,"class","p-2.5 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg border border-gray-300 dark:border-gray-600 transition-colors"),b(g,"type","button"),b(g,"title","Search help"),b(i,"class","flex items-center gap-2"),b(n,"class","relative search-container")},m(e,r){c(e,n,r),l(n,i),l(i,o),l(o,s),l(o,a),l(o,u),t[9](u),x(u,t[0]),l(o,f),A&&A.m(o,null),l(i,p),l(i,g),l(n,y),C&&C.m(n,null),l(n,w),S&&S.m(n,null),k||(_=[v(u,"input",t[10]),v(u,"input",t[5]),v(u,"focus",Ce),v(u,"keydown",t[6]),v(g,"click",t[8])],k=!0)},p(e,[t]){2&t&&b(u,"placeholder",e[1]),1&t&&u.value!==e[0]&&x(u,e[0]),e[0]?A?A.p(e,t):(A=ye(e),A.c(),A.m(o,null)):A&&(A.d(1),A=null),e[0]&&(e[4].positive.length>0||e[4].negative.length>0||e[4].phrases.length>0||e[4].regexPatterns.length>0)?C?C.p(e,t):(C=ve(e),C.c(),C.m(n,w)):C&&(C.d(1),C=null),e[3]?S||(S=_e(),S.c(),S.m(n,null)):S&&(S.d(1),S=null)},i:e,o:e,d(e){e&&h(n),t[9](null),A&&A.d(),C&&C.d(),S&&S.d(),k=!1,r(_)}}}function Ce(){}function Se(e,t,n){let r;const i=C();let o,s,{value:a=""}=t,{placeholder:u='Search: use +term (must include), -term (exclude), "exact phrase"'}=t,l=!1;function c(){n(0,a=""),i("search",{query:""}),s?.focus()}return A(()=>{}),e.$$set=e=>{"value"in e&&n(0,a=e.value),"placeholder"in e&&n(1,u=e.placeholder)},e.$$.update=()=>{1&e.$$.dirty&&n(4,r=function(e){if(!e)return{positive:[],negative:[],phrases:[],regular:[],regexPatterns:[]};const t=[],n=[],r=[],i=[],o=[];(e.match(/\/([^\/]+)\/([gimsuvy]*)?/g)||[]).forEach(e=>o.push(e));let s=e.replace(/\/[^\/]+\/[gimsuvy]*/g,"").trim();return(s.match(/"([^"]+)"/g)||[]).forEach(e=>r.push(e.slice(1,-1))),s=s.replace(/"[^"]+"/g,"").trim(),s.split(/\s+/).filter(e=>e.length>0).forEach(e=>{e.startsWith("+")&&e.length>1?t.push(e.slice(1)):e.startsWith("-")&&e.length>1?n.push(e.slice(1)):i.push(e)}),{positive:t,negative:n,phrases:r,regular:i,regexPatterns:o}}(a))},[a,u,s,l,r,function(e){n(0,a=e.target.value),clearTimeout(o),o=setTimeout(()=>{i("search",{query:a})},200)},function(e){"Escape"===e.key?c():"Enter"===e.key&&(clearTimeout(o),i("search",{query:a}))},c,function(){n(3,l=!l)},function(e){E[e?"unshift":"push"](()=>{s=e,n(2,s)})},function(){a=this.value,n(0,a)}]}X(fe,e=>0===e.total?0:Math.round(e.enriched/e.total*100)),X(fe,e=>e.pending);class Ee extends W{constructor(e){super(),U(this,e,Se,Ae,o,{value:0,placeholder:1})}}
/**!
 * FlexSearch.js v0.8.212 (Bundle/Module)
 * Author and Copyright: Thomas Wilkerling
 * Licence: Apache-2.0
 * Hosted by Nextapps GmbH
 * https://github.com/nextapps-de/flexsearch
 */var Pe;function Oe(e,t,n){const r=typeof n,i=typeof e;if("undefined"!==r){if("undefined"!==i){if(n){if("function"===i&&r===i)return function(t){return e(n(t))};if((t=e.constructor)===n.constructor){if(t===Array)return n.concat(e);if(t===Map){var o=new Map(n);for(var s of e)o.set(s[0],s[1]);return o}if(t===Set){for(o of(s=new Set(n),e.values()))s.add(o);return s}}}return e}return n}return"undefined"===i?t:e}function je(e,t){return void 0===e?t:e}function De(){return Object.create(null)}function Be(e){return"string"==typeof e}function Me(e){return"object"==typeof e}function Ie(e,t){if(Be(t))e=e[t];else for(let n=0;e&&n<t.length;n++)e=e[t[n]];return e}const Ke=/[^\p{L}\p{N}]+/u,Te=/(\d{3})/g,qe=/(\D)(\d{3})/g,Le=/(\d{3})(\D)/g,Re=/[\u0300-\u036f]/g;function ze(e={}){if(!this||this.constructor!==ze)return new ze(...arguments);if(arguments.length)for(e=0;e<arguments.length;e++)this.assign(arguments[e]);else this.assign(e)}function $e(e){e.F=null,e.B.clear(),e.D.clear()}function Fe(e,t,n){n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):n=e),n&&(e=n.query||e,t=n.limit||t);let r=""+(t||0);n&&(r+=(n.offset||0)+!!n.context+!!n.suggest+(!1!==n.resolve)+(n.resolution||this.resolution)+(n.boost||0)),e=(""+e).toLowerCase(),this.cache||(this.cache=new Ne);let i=this.cache.get(e+r);if(!i){const o=n&&n.cache;o&&(n.cache=!1),i=this.search(e,t,n),o&&(n.cache=o),this.cache.set(e+r,i)}return i}function Ne(e){this.limit=e&&!0!==e?e:1e3,this.cache=new Map,this.h=""}(Pe=ze.prototype).assign=function(e){this.normalize=Oe(e.normalize,!0,this.normalize);let t,n=e.include,r=n||e.exclude||e.split;if(r||""===r){if("object"==typeof r&&r.constructor!==RegExp){let e="";t=!n,n||(e+="\\p{Z}"),r.letter&&(e+="\\p{L}"),r.number&&(e+="\\p{N}",t=!!n),r.symbol&&(e+="\\p{S}"),r.punctuation&&(e+="\\p{P}"),r.control&&(e+="\\p{C}"),(r=r.char)&&(e+="object"==typeof r?r.join(""):r);try{this.split=new RegExp("["+(n?"^":"")+e+"]+","u")}catch(e){this.split=/\s+/}}else this.split=r,t=!1===r||"a1a".split(r).length<2;this.numeric=Oe(e.numeric,t)}else{try{this.split=Oe(this.split,Ke)}catch(e){this.split=/\s+/}this.numeric=Oe(e.numeric,Oe(this.numeric,!0))}if(this.prepare=Oe(e.prepare,null,this.prepare),this.finalize=Oe(e.finalize,null,this.finalize),r=e.filter,this.filter="function"==typeof r?r:Oe(r&&new Set(r),null,this.filter),this.dedupe=Oe(e.dedupe,!0,this.dedupe),this.matcher=Oe((r=e.matcher)&&new Map(r),null,this.matcher),this.mapper=Oe((r=e.mapper)&&new Map(r),null,this.mapper),this.stemmer=Oe((r=e.stemmer)&&new Map(r),null,this.stemmer),this.replacer=Oe(e.replacer,null,this.replacer),this.minlength=Oe(e.minlength,1,this.minlength),this.maxlength=Oe(e.maxlength,1024,this.maxlength),this.rtl=Oe(e.rtl,!1,this.rtl),(this.cache=r=Oe(e.cache,!0,this.cache))&&(this.F=null,this.L="number"==typeof r?r:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const e of this.matcher.keys())this.h+=(this.h?"|":"")+e;if(this.stemmer)for(const e of this.stemmer.keys())this.A+=(this.A?"|":"")+e;return this},Pe.addStemmer=function(e,t){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(e,t),this.A+=(this.A?"|":"")+e,this.K=null,this.cache&&$e(this),this},Pe.addFilter=function(e){return"function"==typeof e?this.filter=e:(this.filter||(this.filter=new Set),this.filter.add(e)),this.cache&&$e(this),this},Pe.addMapper=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length>1?this.addMatcher(e,t):(this.mapper||(this.mapper=new Map),this.mapper.set(e,t),this.cache&&$e(this),this)},Pe.addMatcher=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length<2&&(this.dedupe||this.mapper)?this.addMapper(e,t):(this.matcher||(this.matcher=new Map),this.matcher.set(e,t),this.h+=(this.h?"|":"")+e,this.J=null,this.cache&&$e(this),this)},Pe.addReplacer=function(e,t){return"string"==typeof e?this.addMatcher(e,t):(this.replacer||(this.replacer=[]),this.replacer.push(e,t),this.cache&&$e(this),this)},Pe.encode=function(e,t){if(this.cache&&e.length<=this.H)if(this.F){if(this.B.has(e))return this.B.get(e)}else this.F=setTimeout($e,50,this);this.normalize&&(e="function"==typeof this.normalize?this.normalize(e):Re?e.normalize("NFKD").replace(Re,"").toLowerCase():e.toLowerCase()),this.prepare&&(e=this.prepare(e)),this.numeric&&e.length>3&&(e=e.replace(qe,"$1 $2").replace(Le,"$1 $2").replace(Te,"$1 "));const n=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let r,i,o=[],s=De(),a=this.split||""===this.split?e.split(this.split):[e];for(let e,l,c=0;c<a.length;c++)if((e=l=a[c])&&!(e.length<this.minlength||e.length>this.maxlength)){if(t){if(s[e])continue;s[e]=1}else{if(r===e)continue;r=e}if(n)o.push(e);else if(!this.filter||("function"==typeof this.filter?this.filter(e):!this.filter.has(e))){if(this.cache&&e.length<=this.I)if(this.F){var u=this.D.get(e);if(u||""===u){u&&o.push(u);continue}}else this.F=setTimeout($e,50,this);if(this.stemmer){let t;for(this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));t!==e&&e.length>2;)t=e,e=e.replace(this.K,e=>this.stemmer.get(e))}if(e&&(this.mapper||this.dedupe&&e.length>1)){u="";for(let t,n,r=0,i="";r<e.length;r++)t=e.charAt(r),t===i&&this.dedupe||((n=this.mapper&&this.mapper.get(t))||""===n?n===i&&this.dedupe||!(i=n)||(u+=n):u+=i=t);e=u}if(this.matcher&&e.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),e=e.replace(this.J,e=>this.matcher.get(e))),e&&this.replacer)for(u=0;e&&u<this.replacer.length;u+=2)e=e.replace(this.replacer[u],this.replacer[u+1]);if(this.cache&&l.length<=this.I&&(this.D.set(l,e),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),e){if(e!==l)if(t){if(s[e])continue;s[e]=1}else{if(i===e)continue;i=e}o.push(e)}}}return this.finalize&&(o=this.finalize(o)||o),this.cache&&e.length<=this.H&&(this.B.set(e,o),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),o},Ne.prototype.set=function(e,t){this.cache.set(this.h=e,t),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)},Ne.prototype.get=function(e){const t=this.cache.get(e);return t&&this.h!==e&&(this.cache.delete(e),this.cache.set(this.h=e,t)),t},Ne.prototype.remove=function(e){for(const t of this.cache){const n=t[0];t[1].includes(e)&&this.cache.delete(n)}},Ne.prototype.clear=function(){this.cache.clear(),this.h=""};const Ue={normalize:!1,numeric:!1,dedupe:!1},We={},Ve=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),He=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),Qe=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],Ye={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,"ÃŸ":2,d:3,t:3,l:4,m:5,n:5,r:6};var Ge={Exact:Ue,Default:We,Normalize:We,LatinBalance:{mapper:Ve},LatinAdvanced:{mapper:Ve,matcher:He,replacer:Qe},LatinExtra:{mapper:Ve,replacer:Qe.concat([/(?!^)[aeo]/g,""]),matcher:He},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(e){for(let n=0;n<e.length;n++){var t=e[n];let r=t.charAt(0),i=Ye[r];for(let e,n=1;n<t.length&&(e=t.charAt(n),"h"===e||"w"===e||!(e=Ye[e])||e===i||(r+=e,i=e,4!==r.length));n++);e[n]=r}}},CJK:{split:""},LatinExact:Ue,LatinDefault:We,LatinSimple:We};function Je(e,t,n,r){let i=[];for(let o,s=0;s<e.index.length;s++)if(o=e.index[s],t>=o.length)t-=o.length;else{const s=(t=o[r?"splice":"slice"](t,n)).length;if(s&&(i=i.length?i.concat(t):t,n-=s,r&&(e.length-=s),!n))break;t=0}return i}function Xe(e){if(!this||this.constructor!==Xe)return new Xe(e);this.index=e?[e]:[],this.length=e?e.length:0;const t=this;return new Proxy([],{get:(e,n)=>"length"===n?t.length:"push"===n?function(e){t.index[t.index.length-1].push(e),t.length++}:"pop"===n?function(){if(t.length)return t.length--,t.index[t.index.length-1].pop()}:"indexOf"===n?function(e){let n=0;for(let r,i,o=0;o<t.index.length;o++){if(r=t.index[o],i=r.indexOf(e),i>=0)return n+i;n+=r.length}return-1}:"includes"===n?function(e){for(let n=0;n<t.index.length;n++)if(t.index[n].includes(e))return!0;return!1}:"slice"===n?function(e,n){return Je(t,e||0,n||t.length,!1)}:"splice"===n?function(e,n){return Je(t,e||0,n||t.length,!0)}:"constructor"===n?Array:"symbol"!=typeof n?(e=t.index[n/2**31|0])&&e[n]:void 0,set:(e,n,r)=>(e=n/2**31|0,(t.index[e]||(t.index[e]=[]))[n]=r,t.length++,!0)})}function Ze(e=8){if(!this||this.constructor!==Ze)return new Ze(e);this.index=De(),this.h=[],this.size=0,e>32?(this.B=nt,this.A=BigInt(e)):(this.B=tt,this.A=e)}function et(e=8){if(!this||this.constructor!==et)return new et(e);this.index=De(),this.h=[],this.size=0,e>32?(this.B=nt,this.A=BigInt(e)):(this.B=tt,this.A=e)}function tt(e){let t=2**this.A-1;if("number"==typeof e)return e&t;let n=0,r=this.A+1;for(let i=0;i<e.length;i++)n=(n*r^e.charCodeAt(i))&t;return 32===this.A?n+2**31:n}function nt(e){let t=BigInt(2)**this.A-BigInt(1);var n=typeof e;if("bigint"===n)return e&t;if("number"===n)return BigInt(e)&t;n=BigInt(0);let r=this.A+BigInt(1);for(let i=0;i<e.length;i++)n=(n*r^BigInt(e.charCodeAt(i)))&t;return n}let rt,it,ot,st,at;async function ut(e){var t=(e=e.data).task;const n=e.id;let r=e.args;if("init"===t)it=e.options||{},(t=e.factory)?(Function("return "+t)()(self),rt=new self.FlexSearch.Index(it),delete self.FlexSearch):rt=new Xt(it),postMessage({id:n});else{let i;"export"===t&&(r[1]?(r[0]=it.export,r[2]=0,r[3]=1):r=null),"import"===t?r[0]&&(e=await it.import.call(rt,r[0]),rt.import(r[0],e)):((i=r&&rt[t].apply(rt,r))&&i.then&&(i=await i),i&&i.await&&(i=await i.await),"search"===t&&i.result&&(i=i.result)),postMessage("search"===t?{id:n,msg:i}:{id:n})}}function lt(e){ht.call(e,"add"),ht.call(e,"append"),ht.call(e,"search"),ht.call(e,"update"),ht.call(e,"remove"),ht.call(e,"searchCache")}function ct(){ot=at=0}function ht(e){this[e+"Async"]=function(){const t=arguments;var n=t[t.length-1];let r;if("function"==typeof n&&(r=n,delete t[t.length-1]),ot?at||(at=Date.now()-st>=this.priority*this.priority*3):(ot=setTimeout(ct,0),st=Date.now()),at){const n=this;return new Promise(r=>{setTimeout(function(){r(n[e+"Async"].apply(n,t))},0)})}const i=this[e].apply(this,t);return n=i.then?i:new Promise(e=>e(i)),r&&n.then(r),n}}Xe.prototype.clear=function(){this.index.length=0},Xe.prototype.push=function(){},Ze.prototype.get=function(e){const t=this.index[this.B(e)];return t&&t.get(e)},Ze.prototype.set=function(e,t){var n=this.B(e);let r=this.index[n];r?(n=r.size,r.set(e,t),(n-=r.size)&&this.size++):(this.index[n]=r=new Map([[e,t]]),this.h.push(r),this.size++)},et.prototype.add=function(e){var t=this.B(e);let n=this.index[t];n?(t=n.size,n.add(e),(t-=n.size)&&this.size++):(this.index[t]=n=new Set([e]),this.h.push(n),this.size++)},(Pe=Ze.prototype).has=et.prototype.has=function(e){const t=this.index[this.B(e)];return t&&t.has(e)},Pe.delete=et.prototype.delete=function(e){const t=this.index[this.B(e)];t&&t.delete(e)&&this.size--},Pe.clear=et.prototype.clear=function(){this.index=De(),this.h=[],this.size=0},Pe.values=et.prototype.values=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].values())yield t},Pe.keys=et.prototype.keys=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].keys())yield t},Pe.entries=et.prototype.entries=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].entries())yield t};let ft=0;function dt(e={},t){function n(n){function s(e){const t=(e=e.data||e).id,n=t&&o.h[t];n&&(n(e.msg),delete o.h[t])}if(this.worker=n,this.h=De(),this.worker)return i?this.worker.on("message",s):this.worker.onmessage=s,e.config?new Promise(function(t){ft>1e9&&(ft=0),o.h[++ft]=function(){t(o)},o.worker.postMessage({id:ft,task:"init",factory:r,options:e})}):(this.priority=e.priority||4,this.encoder=t||null,this.worker.postMessage({task:"init",factory:r,options:e}),this)}if(!this||this.constructor!==dt)return new dt(e);let r="undefined"!=typeof self?self._factory:"undefined"!=typeof window?window._factory:null;r&&(r=r.toString());const i="undefined"==typeof window,o=this,s=function(e,t,n){return t?"undefined"!=typeof module?new(require("worker_threads").Worker)(__dirname+"/worker/node.js"):Promise.resolve().then(function(){return Qn}).then(function(e){return new e.Worker(import.meta.dirname+"/node/node.mjs")}):e?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+ut.toString()],{type:"text/javascript"}))):new window.Worker("string"==typeof n?n:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}(r,i,e.worker);return s.then?s.then(function(e){return n.call(o,e)}):n.call(this,s)}function pt(e){dt.prototype[e]=function(){const t=this,n=[].slice.call(arguments);var r=n[n.length-1];let i;return"function"==typeof r&&(i=r,n.pop()),r=new Promise(function(r){"export"===e&&"function"==typeof n[0]&&(n[0]=null),ft>1e9&&(ft=0),t.h[++ft]=r,t.worker.postMessage({task:e,id:ft,args:n})}),i?(r.then(i),this):r}}function gt(e,t,n,r,i,o){if(e=e[i],r===n.length-1)t[i]=o||e;else if(e)if(e.constructor===Array)for(t=t[i]=Array(e.length),i=0;i<e.length;i++)gt(e,t,n,r,i);else t=t[i]||(t[i]=De()),i=n[++r],gt(e,t,n,r,i)}function mt(e,t,n,r,i,o,s,a){if(e=e[s])if(r===t.length-1){if(e.constructor===Array){if(n[r]){for(t=0;t<e.length;t++)i.add(o,e[t],!0,!0);return}e=e.join(" ")}i.add(o,e,a,!0)}else if(e.constructor===Array)for(s=0;s<e.length;s++)mt(e,t,n,r,i,o,s,a);else s=t[++r],mt(e,t,n,r,i,o,s,a)}function yt(e,t,n,r){if(!e.length)return e;if(1===e.length)return e=e[0],e=n||e.length>t?e.slice(n,n+t):e,r?Bt.call(this,e):e;let i=[];for(let o,s,a=0;a<e.length;a++)if((o=e[a])&&(s=o.length)){if(n){if(n>=s){n-=s;continue}o=o.slice(n,n+t),s=o.length,n=0}if(s>t&&(o=o.slice(0,t),s=t),!i.length&&s>=t)return r?Bt.call(this,o):o;if(i.push(o),!(t-=s))break}return i=i.length>1?[].concat.apply([],i):i[0],r?Bt.call(this,i):i}function vt(e,t,n,r){var i=r[0];if(i[0]&&i[0].query)return e[t].apply(e,i);if(!("and"!==t&&"not"!==t||e.result.length||e.await||i.suggest))return r.length>1&&(i=r[r.length-1]),(r=i.resolve)?e.await||e.result:e;let o,s,a,u,l,c=[],h=0,f=0;for(t=0;t<r.length;t++)if(i=r[t]){var d=void 0;if(i.constructor===Ct)d=i.await||i.result;else if(i.then||i.constructor===Array)d=i;else{h=i.limit||0,f=i.offset||0,a=i.suggest,s=i.resolve,o=((u=i.highlight||e.highlight)||i.enrich)&&s,d=i.queue;let n=i.async||d,r=i.index,p=i.query;if(r?e.index||(e.index=r):r=e.index,p||i.tag){const o=i.field||i.pluck;if(o&&(!p||e.query&&!u||(e.query=p,e.field=o,e.highlight=u),r=r.index.get(o)),d&&(l||e.await)){let o;l=1;const s=e.C.length,a=new Promise(function(e){o=e});(function(t,r){a.h=function(){r.index=null,r.resolve=!1;let i=n?t.searchAsync(r):t.search(r);return i.then?i.then(function(t){return e.C[s]=t=t.result||t,o(t),t}):(i=i.result||i,o(i),i)}})(r,Object.assign({},i)),e.C.push(a),c[t]=a;continue}i.resolve=!1,i.index=null,d=n?r.searchAsync(i):r.search(i),i.resolve=s,i.index=r}else if(i.and)d=bt(i,"and",r);else if(i.or)d=bt(i,"or",r);else if(i.not)d=bt(i,"not",r);else{if(!i.xor)continue;d=bt(i,"xor",r)}}d.await?(l=1,d=d.await):d.then?(l=1,d=d.then(function(e){return e.result||e})):d=d.result||d,c[t]=d}if(l&&!e.await&&(e.await=new Promise(function(t){e.return=t})),l){const t=Promise.all(c).then(function(r){for(let i=0;i<e.C.length;i++)if(e.C[i]===t){e.C[i]=function(){return n.call(e,r,h,f,o,s,a,u)};break}St(e)});e.C.push(t)}else{if(!e.await)return n.call(e,c,h,f,o,s,a,u);e.C.push(function(){return n.call(e,c,h,f,o,s,a,u)})}return s?e.await||e.result:e}function bt(e,t,n){const r=(e=e[t])[0]||e;return r.index||(r.index=n),n=new Ct(r),e.length>1&&(n=n[t].apply(n,e.slice(1))),n}function wt(e,t,n,r,i,o,s){return e.length&&(this.result.length&&e.push(this.result),e.length<2?this.result=e[0]:(this.result=Pt(e,t,n,!1,this.h),n=0)),i&&(this.await=null),i?this.resolve(t,n,r,s):this}function xt(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;let a;if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{let r=0;for(let t,n,i=0;i<e.length;i++)if((t=e[i])&&(n=t.length))r<n&&(r=n);else if(!o){r=0;break}r?(this.result=Et(e,r,t,n,o,this.h,i),a=!0):this.result=[]}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function kt(e,t,n,r,i,o,s){if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{e:{o=n;var a=this.h;const r=[],s=De();let u=0;for(let t,n=0;n<e.length;n++)if(t=e[n]){u<t.length&&(u=t.length);for(let e,n=0;n<t.length;n++)if(e=t[n])for(let t,n=0;n<e.length;n++)t=e[n],s[t]=s[t]?2:1}for(let n,l=0,c=0;l<u;l++)for(let u,h=0;h<e.length;h++)if((u=e[h])&&(n=u[l]))for(let u,f=0;f<n.length;f++)if(u=n[f],1===s[u])if(o)o--;else if(i){if(r.push(u),r.length===t){e=r;break e}}else{const n=l+(h?a:0);if(r[n]||(r[n]=[]),r[n].push(u),++c===t){e=r;break e}}e=r}this.result=e,a=!0}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function _t(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;if(e.length&&this.result.length){e:{o=n;var a=[];e=new Set(e.flat().flat());for(let n,r=0,s=0;r<this.result.length;r++)if(n=this.result[r])for(let u,l=0;l<n.length;l++)if(u=n[l],!e.has(u))if(o)o--;else if(i){if(a.push(u),a.length===t){e=a;break e}}else if(a[r]||(a[r]=[]),a[r].push(u),++s===t){e=a;break e}e=a}this.result=e,a=!0}return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function At(e,t,n,r,i){let o,s,a;"string"==typeof i?(o=i,i=""):o=i.template,s=o.indexOf("$1"),a=o.substring(s+2),s=o.substring(0,s);let u=i&&i.boundary,l=!i||!1!==i.clip,c=i&&i.merge&&a&&s&&new RegExp(a+" "+s,"g");var h=0;if("object"==typeof(i=i&&i.ellipsis)){var f=i.template;h=f.length-2,i=i.pattern}let d,p;"string"!=typeof i&&(i=!1===i?"":"..."),h&&(i=f.replace("$1",i)),f=i.length-h,"object"==typeof u&&(d=u.before,0===d&&(d=-1),p=u.after,0===p&&(p=-1),u=u.total||9e5),h=new Map;for(let M,I,K,T=0;T<t.length;T++){let q;if(r)q=t,K=r;else{var g=t[T];if(K=g.field,!K)continue;q=g.result}I=n.get(K),M=I.encoder,"string"!=typeof(g=h.get(M))&&(g=M.encode(e),h.set(M,g));for(let e=0;e<q.length;e++){var m=q[e].doc;if(!m)continue;if(!(m=Ie(m,K)))continue;var y=m.trim().split(/\s+/);if(!y.length)continue;m="";var v=[];let t=[];for(var b=-1,w=-1,x=0,k=0;k<y.length;k++){var _=y[k],A=M.encode(_);let e;if((A=A.length>1?A.join(" "):A[0])&&_){for(var C=_.length,S=(M.split?_.replace(M.split,""):_).length-A.length,E="",P=0,O=0;O<g.length;O++){var j=g[O];if(j){var D=j.length;D+=S<0?0:S,P&&D<=P||(j=A.indexOf(j))>-1&&(E=(j?_.substring(0,j):"")+s+_.substring(j,j+D)+a+(j+D<C?_.substring(j+D):""),P=D,e=!0)}}E&&(u&&(b<0&&(b=m.length+(m?1:0)),w=m.length+(m?1:0)+E.length,x+=C,t.push(v.length),v.push({match:E})),m+=(m?" ":"")+E)}if(e){if(u&&x>=u)break}else m+=(m?" ":"")+(_=y[k]),u&&v.push({text:_})}if(x=t.length*(o.length-2),d||p||u&&m.length-x>u)if(k=w-b,d>0&&(k+=d),p>0&&(k+=p),k<=(x=u+x-2*f))y=d?b-(d>0?d:0):b-((x-k)/2|0),v=p?w+(p>0?p:0):y+x,l||(y>0&&" "!==m.charAt(y)&&" "!==m.charAt(y-1)&&((y=m.indexOf(" ",y))<0&&(y=0)),v<m.length&&" "!==m.charAt(v-1)&&" "!==m.charAt(v)&&((v=m.lastIndexOf(" ",v))<w?v=w:++v)),m=(y?i:"")+m.substring(y,v)+(v<m.length?i:"");else{for(w=[],b={},x={},k={},_={},A={},E=S=C=0,O=P=1;;){var B=void 0;for(let e,n=0;n<t.length;n++){if(e=t[n],E)if(S!==E){if(k[n+1])continue;if(e+=E,b[e]){C-=f,x[n+1]=1,k[n+1]=1;continue}if(e>=v.length-1){if(e>=v.length){k[n+1]=1,e>=y.length&&(x[n+1]=1);continue}C-=f}if(m=v[e].text,D=p&&A[n]){if(!(D>0)){k[n+1]=1;continue}if(m.length>D){if(k[n+1]=1,!l)continue;m=m.substring(0,D)}(D-=m.length)||(D=-1),A[n]=D}if(C+m.length+1<=u)m=" "+m,w[n]+=m;else{if(!l){k[n+1]=1;continue}(B=u-C-1)>0&&(m=" "+m.substring(0,B),w[n]+=m),k[n+1]=1}}else{if(k[n])continue;if(e-=S,b[e]){C-=f,k[n]=1,x[n]=1;continue}if(e<=0){if(e<0){k[n]=1,x[n]=1;continue}C-=f}if(m=v[e].text,D=d&&_[n]){if(!(D>0)){k[n]=1;continue}if(m.length>D){if(k[n]=1,!l)continue;m=m.substring(m.length-D)}(D-=m.length)||(D=-1),_[n]=D}if(C+m.length+1<=u)m+=" ",w[n]=m+w[n];else{if(!l){k[n]=1;continue}(B=m.length+1-(u-C))>=0&&B<m.length&&(m=m.substring(B)+" ",w[n]=m+w[n]),k[n]=1}}else{let t;if(m=v[e].match,d&&(_[n]=d),p&&(A[n]=p),n&&C++,e?!n&&f&&(C+=f):(x[n]=1,k[n]=1),e>=y.length-1||e<v.length-1&&v[e+1].match?t=1:f&&(C+=f),C-=o.length-2,n&&!(C+m.length<=u)){B=P=O=x[n]=0;break}w[n]=m,t&&(x[n+1]=1,k[n+1]=1)}C+=m.length,B=b[e]=1}if(B)S===E?E++:S++;else{if(S===E?P=0:O=0,!P&&!O)break;P?E=++S:E++}}m="";for(let e,t=0;t<w.length;t++)e=(x[t]?t?" ":"":(t&&!i?" ":"")+i)+w[t],m+=e;i&&!x[w.length]&&(m+=i)}c&&(m=m.replace(c," ")),q[e].highlight=m}if(r)break}return t}function Ct(e,t){if(!this||this.constructor!==Ct)return new Ct(e,t);let n,r,i,o,s,a,u=0;if(e&&e.index){const n=e;if(t=n.index,u=n.boost||0,r=n.query){i=n.field||n.pluck,o=n.highlight;const r=n.resolve;e=n.async||n.queue,n.resolve=!1,n.index=null,e=e?t.searchAsync(n):t.search(n),n.resolve=r,n.index=t,e=e.result||e}else e=[]}if(e&&e.then){const t=this;n=[e=e.then(function(e){t.C[0]=t.result=e.result||e,St(t)})],e=[],s=new Promise(function(e){a=e})}this.index=t||null,this.result=e||[],this.h=u,this.C=n||[],this.await=s||null,this.return=a||null,this.highlight=o||null,this.query=r||"",this.field=i||""}function St(e,t){let n=e.result;var r=e.await;e.await=null;for(let t,i=0;i<e.C.length;i++)if(t=e.C[i])if("function"==typeof t)n=t(),e.C[i]=n=n.result||n,i--;else if(t.h)n=t.h(),e.C[i]=n=n.result||n,i--;else if(t.then)return e.await=r;return r=e.return,e.C=[],e.return=null,t||r(n),n}function Et(e,t,n,r,i,o,s){const a=e.length;let u,l,c=[];u=De();for(let h,f,d,p,g=0;g<t;g++)for(let t=0;t<a;t++)if(d=e[t],g<d.length&&(h=d[g]))for(let e=0;e<h.length;e++){if(f=h[e],(l=u[f])?u[f]++:(l=0,u[f]=1),p=c[l]||(c[l]=[]),!s){let e=g+(t||!i?0:o||0);p=p[e]||(p[e]=[])}if(p.push(f),s&&n&&l===a-1&&p.length-r===n)return r?p.slice(r):p}if(e=c.length)if(i)c=c.length>1?Pt(c,n,r,s,o):(c=c[0])&&n&&c.length>n||r?c.slice(r,n+r):c;else{if(e<a)return[];if(c=c[e-1],n||r)if(s)(c.length>n||r)&&(c=c.slice(r,n+r));else{i=[];for(let e,t=0;t<c.length;t++)if(e=c[t])if(r&&e.length>r)r-=e.length;else if((n&&e.length>n||r)&&(e=e.slice(r,n+r),n-=e.length,r&&(r-=e.length)),i.push(e),!n)break;c=i}}return c}function Pt(e,t,n,r,i){const o=[],s=De();let a;var u=e.length;let l;if(r){for(i=u-1;i>=0;i--)if(l=(r=e[i])&&r.length)for(u=0;u<l;u++)if(a=r[u],!s[a])if(s[a]=1,n)n--;else if(o.push(a),o.length===t)return o}else for(let c,h=u-1,f=0;h>=0;h--){c=e[h];for(let e=0;e<c.length;e++)if(l=(r=c[e])&&r.length)for(let c=0;c<l;c++)if(a=r[c],!s[a])if(s[a]=1,n)n--;else{let n=(e+(h<u-1&&i||0))/(h+1)|0;if((o[n]||(o[n]=[])).push(a),++f===t)return o}}return o}function Ot(e,t,n,r,i){const o=De(),s=[];for(let e,n=0;n<t.length;n++){e=t[n];for(let t=0;t<e.length;t++)o[e[t]]=1}if(i){for(let t,i=0;i<e.length;i++)if(t=e[i],o[t])if(r)r--;else if(s.push(t),o[t]=0,n&&0===--n)break}else for(let n,r,i=0;i<e.result.length;i++)for(n=e.result[i],t=0;t<n.length;t++)r=n[t],o[r]&&((s[i]||(s[i]=[])).push(r),o[r]=0);return s}function jt(e){const t=[],n=De(),r=De();for(let i,o,s,a,u,l,c,h=0;h<e.length;h++){i=e[h],o=i.field,s=i.result;for(let e=0;e<s.length;e++)u=s[e],"object"!=typeof u?u={id:a=u}:a=u.id,(l=n[a])?l.push(o):(u.field=n[a]=[o],t.push(u)),(c=u.highlight)&&(l=r[a],l||(r[a]=l={},u.highlight=l),l[o]=c)}return t}function Dt(e,t,n,r,i){return(e=this.tag.get(e))&&(e=e.get(t))?((t=e.length-r)>0&&((n&&t>n||r)&&(e=e.slice(r,r+n)),i&&(e=Bt.call(this,e))),e):[]}function Bt(e){if(!this||!this.store)return e;if(this.db)return this.index.get(this.field[0]).db.enrich(e);const t=Array(e.length);for(let n,r=0;r<e.length;r++)n=e[r],t[r]={id:n,doc:this.store.get(n)};return t}function Mt(e){if(!this||this.constructor!==Mt)return new Mt(e);const t=e.document||e.doc||e;let n,r;if(this.B=[],this.field=[],this.D=[],this.key=(n=t.key||t.id)&&Kt(n,this.D)||"id",(r=e.keystore||0)&&(this.keystore=r),this.fastupdate=!!e.fastupdate,this.reg=!this.fastupdate||e.worker||e.db?r?new et(r):new Set:r?new Ze(r):new Map,this.h=(n=t.store||null)&&n&&!0!==n&&[],this.store=n?r?new Ze(r):new Map:null,this.cache=(n=e.cache||null)&&new Ne(n),e.cache=!1,this.worker=e.worker||!1,this.priority=e.priority||4,this.index=It.call(this,e,t),this.tag=null,(n=t.tag)&&("string"==typeof n&&(n=[n]),n.length)){this.tag=new Map,this.A=[],this.F=[];for(let e,t,r=0;r<n.length;r++){if(e=n[r],t=e.field||e,!t)throw Error("The tag field from the document descriptor is undefined.");e.custom?this.A[r]=e.custom:(this.A[r]=Kt(t,this.D),e.filter&&("string"==typeof this.A[r]&&(this.A[r]=new String(this.A[r])),this.A[r].G=e.filter)),this.F[r]=t,this.tag.set(t,new Map)}}if(this.worker){this.fastupdate=!1,e=[];for(const t of this.index.values())t.then&&e.push(t);if(e.length){const t=this;return Promise.all(e).then(function(e){let n=0;for(const r of t.index.entries()){const i=r[0];let o=r[1];o.then&&(o=e[n],t.index.set(i,o),n++)}return t})}}else e.db&&(this.fastupdate=!1,this.mount(e.db))}function It(e,t){const n=new Map;let r=t.index||t.field||t;Be(r)&&(r=[r]);for(let t,o,s=0;s<r.length;s++){if(t=r[s],Be(t)||(o=t,t=t.field),o=Me(o)?Object.assign({},e,o):e,this.worker){var i=void 0;i=new dt(o,i=(i=o.encoder)&&i.encode?i:new ze("string"==typeof i?Ge[i]:i||{})),n.set(t,i)}this.worker||n.set(t,new Xt(o,this.reg)),o.custom?this.B[s]=o.custom:(this.B[s]=Kt(t,this.D),o.filter&&("string"==typeof this.B[s]&&(this.B[s]=new String(this.B[s])),this.B[s].G=o.filter)),this.field[s]=t}if(this.h){Be(e=t.store)&&(e=[e]);for(let t,n,r=0;r<e.length;r++)t=e[r],n=t.field||t,t.custom?(this.h[r]=t.custom,t.custom.O=n):(this.h[r]=Kt(n,this.D),t.filter&&("string"==typeof this.h[r]&&(this.h[r]=new String(this.h[r])),this.h[r].G=t.filter))}return n}function Kt(e,t){const n=e.split(":");let r=0;for(let i=0;i<n.length;i++)"]"===(e=n[i])[e.length-1]&&(e=e.substring(0,e.length-2))&&(t[r]=!0),e&&(n[r++]=e);return r<n.length&&(n.length=r),r>1?n:n[0]}function Tt(e,t=0){let n=[],r=[];t&&(t=25e4/t*5e3|0);for(const i of e.entries())r.push(i),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function qt(e,t){t||(t=new Map);for(let n,r=0;r<e.length;r++)n=e[r],t.set(n[0],n[1]);return t}function Lt(e,t=0){let n=[],r=[];t&&(t=25e4/t*1e3|0);for(const i of e.entries())r.push([i[0],Tt(i[1])[0]||[]]),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function Rt(e,t){t||(t=new Map);for(let n,r,i=0;i<e.length;i++)n=e[i],r=t.get(n[0]),t.set(n[0],qt(n[1],r));return t}function zt(e){let t=[],n=[];for(const r of e.keys())n.push(r),25e4===n.length&&(t.push(n),n=[]);return n.length&&t.push(n),t}function $t(e,t){t||(t=new Set);for(let n=0;n<e.length;n++)t.add(e[n]);return t}function Ft(e,t,n,r,i,o,s=0){const a=r&&r.constructor===Array;var u=a?r.shift():r;if(!u)return this.export(e,t,i,o+1);if((u=e((t?t+".":"")+(s+1)+"."+n,JSON.stringify(u)))&&u.then){const l=this;return u.then(function(){return Ft.call(l,e,t,n,a?r:null,i,o,s+1)})}return Ft.call(this,e,t,n,a?r:null,i,o,s+1)}function Nt(e,t){let n="";for(const r of e.entries()){e=r[0];const i=r[1];let o="";for(let e,n=0;n<i.length;n++){e=i[n]||[""];let r="";for(let n=0;n<e.length;n++)r+=(r?",":"")+("string"===t?'"'+e[n]+'"':e[n]);r="["+r+"]",o+=(o?",":"")+r}o='["'+e+'",['+o+"]]",n+=(n?",":"")+o}return n}function Ut(e,t){let n=0;var r=void 0===t;if(e.constructor===Array){for(let i,o,s,a=0;a<e.length;a++)if((i=e[a])&&i.length){if(r)return 1;if(o=i.indexOf(t),o>=0){if(i.length>1)return i.splice(o,1),1;if(delete e[a],n)return 1;s=1}else{if(s)return 1;n++}}}else for(let i of e.entries())r=i[0],Ut(i[1],t)?n++:e.delete(r);return n}pt("add"),pt("append"),pt("search"),pt("update"),pt("remove"),pt("clear"),pt("export"),pt("import"),dt.prototype.searchCache=Fe,lt(dt.prototype),Mt.prototype.add=function(e,t,n){if(Me(e)&&(e=Ie(t=e,this.key)),t&&(e||0===e)){if(!n&&this.reg.has(e))return this.update(e,t);for(let o,s=0;s<this.field.length;s++){o=this.B[s];var r=this.index.get(this.field[s]);if("function"==typeof o){var i=o(t);i&&r.add(e,i,n,!0)}else(!(i=o.G)||i(t))&&(o.constructor===String?o=[""+o]:Be(o)&&(o=[o]),mt(t,o,this.D,0,r,e,o[0],n))}if(this.tag)for(r=0;r<this.A.length;r++){var o=this.A[r];i=this.tag.get(this.F[r]);let a=De();if("function"==typeof o){if(!(o=o(t)))continue}else{var s=o.G;if(s&&!s(t))continue;o.constructor===String&&(o=""+o),o=Ie(t,o)}if(i&&o){Be(o)&&(o=[o]);for(let t,r,u=0;u<o.length;u++)if(t=o[u],!a[t]&&(a[t]=1,(s=i.get(t))?r=s:i.set(t,r=[]),!n||!r.includes(e))){if(r.length===2**31-1){if(s=new Xe(r),this.fastupdate)for(let e of this.reg.values())e.includes(r)&&(e[e.indexOf(r)]=s);i.set(t,r=s)}r.push(e),this.fastupdate&&((s=this.reg.get(e))?s.push(r):this.reg.set(e,[r]))}}}if(this.store&&(!n||!this.store.has(e))){let r;if(this.h){r=De();for(let e,i=0;i<this.h.length;i++){if(e=this.h[i],(n=e.G)&&!n(t))continue;let o;if("function"==typeof e){if(o=e(t),!o)continue;e=[e.O]}else if(Be(e)||e.constructor===String){r[e]=t[e];continue}gt(t,r,e,0,e[0],o)}}this.store.set(e,r||t)}this.worker&&(this.fastupdate||this.reg.add(e))}return this},Ct.prototype.or=function(){return vt(this,"or",wt,arguments)},Ct.prototype.and=function(){return vt(this,"and",xt,arguments)},Ct.prototype.xor=function(){return vt(this,"xor",kt,arguments)},Ct.prototype.not=function(){return vt(this,"not",_t,arguments)},(Pe=Ct.prototype).limit=function(e){if(this.await){const t=this;this.C.push(function(){return t.limit(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)if(n=this.result[r]){if(!(n.length<=e)){t[r]=n.slice(0,e);break}if(t[r]=n,!(e-=n.length))break}this.result=t}return this},Pe.offset=function(e){if(this.await){const t=this;this.C.push(function(){return t.offset(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)(n=this.result[r])&&(n.length<=e?e-=n.length:(t[r]=n.slice(e),e=0));this.result=t}return this},Pe.boost=function(e){if(this.await){const t=this;this.C.push(function(){return t.boost(e).result})}else this.h+=e;return this},Pe.resolve=function(e,t,n,r,i){let o=this.await?St(this,!0):this.result;if(o.then){const s=this;return o.then(function(){return s.resolve(e,t,n,r,i)})}return o.length&&("object"==typeof e?(r=e.highlight||this.highlight,n=!!r||e.enrich,t=e.offset,e=e.limit):(r=r||this.highlight,n=!!r||n),o=i?n?Bt.call(this.index,o):o:yt.call(this.index,o,e||100,t,n)),this.finalize(o,r)},Pe.finalize=function(e,t){if(e.then){const n=this;return e.then(function(e){return n.finalize(e,t)})}t&&e.length&&this.query&&(e=At(this.query,e,this.index.index,this.field,t));const n=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",n&&n(e),e},Mt.prototype.search=function(e,t,n,r){n||(!t&&Me(e)?(n=e,e=""):Me(t)&&(n=t,t=0));let i=[];var o=[];let s,a,u,l,c,h,f,d,p=0,g=!0;if(n){n.constructor===Array&&(n={index:n}),e=n.query||e,s=n.pluck,a=n.merge,l=n.boost,h=s||n.field||(h=n.index)&&(h.index?null:h);var m=this.tag&&n.tag;u=n.suggest,g=!1!==n.resolve,c=n.cache,f=g&&this.store&&n.highlight;var y=!!f||g&&this.store&&n.enrich;t=n.limit||t;var v=n.offset||0;if(t||(t=g?100:0),m&&(!this.db||!r)){m.constructor!==Array&&(m=[m]);var b=[];for(let e,t=0;t<m.length;t++)if(e=m[t],e.field&&e.tag){var w=e.tag;if(w.constructor===Array)for(var x=0;x<w.length;x++)b.push(e.field,w[x]);else b.push(e.field,w)}else{w=Object.keys(e);for(let t,n,r=0;r<w.length;r++)if(t=w[r],n=e[t],n.constructor===Array)for(x=0;x<n.length;x++)b.push(t,n[x]);else b.push(t,n)}if(m=b,!e){if(o=[],b.length)for(m=0;m<b.length;m+=2){if(this.db){if(!(r=this.index.get(b[m])))continue;o.push(r=r.db.tag(b[m+1],t,v,y))}else r=Dt.call(this,b[m],b[m+1],t,v,y);i.push(g?{field:b[m],tag:b[m+1],result:r}:[r])}if(o.length){const e=this;return Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)g?i[e].result=t[e]:i[e]=t[e];return g?i:new Ct(i.length>1?Et(i,1,0,0,u,l):i[0],e)})}return g?i:new Ct(i.length>1?Et(i,1,0,0,u,l):i[0],this)}}g||s||!(h=h||this.field)||(Be(h)?s=h:(h.constructor===Array&&1===h.length&&(h=h[0]),s=h.field||h.index)),h&&h.constructor!==Array&&(h=[h])}h||(h=this.field),b=(this.worker||this.db)&&!r&&[];for(let s,a,l,_=0;_<h.length;_++){if(a=h[_],this.db&&this.tag&&!this.B[_])continue;let A;if(Be(a)||(A=a,a=A.field,e=A.query||e,t=je(A.limit,t),v=je(A.offset,v),u=je(A.suggest,u),f=g&&this.store&&je(A.highlight,f),y=!!f||g&&this.store&&je(A.enrich,y),c=je(A.cache,c)),r)s=r[_];else{x=(w=A||n||{}).enrich;var k=this.index.get(a);if(m&&(this.db&&(w.tag=m,w.field=h,d=k.db.support_tag_search),!d&&x&&(w.enrich=!1),d||(w.limit=0,w.offset=0)),s=c?k.searchCache(e,m&&!d?0:t,w):k.search(e,m&&!d?0:t,w),m&&!d&&(w.limit=t,w.offset=v),x&&(w.enrich=x),b){b[_]=s;continue}}if(l=(s=s.result||s)&&s.length,m&&l){if(w=[],x=0,this.db&&r){if(!d)for(k=h.length;k<r.length;k++){let e=r[k];if(e&&e.length)x++,w.push(e);else if(!u)return g?i:new Ct(i,this)}}else for(let e,t,n=0;n<m.length;n+=2){if(e=this.tag.get(m[n]),!e){if(u)continue;return g?i:new Ct(i,this)}if(t=(e=e&&e.get(m[n+1]))&&e.length)x++,w.push(e);else if(!u)return g?i:new Ct(i,this)}if(x){if(s=Ot(s,w,t,v,g),l=s.length,!l&&!u)return g?s:new Ct(s,this);x--}}if(l)o[p]=a,i.push(s),p++;else if(1===h.length)return g?i:new Ct(i,this)}if(b){if(this.db&&m&&m.length&&!d)for(y=0;y<m.length;y+=2){if(!(o=this.index.get(m[y]))){if(u)continue;return g?i:new Ct(i,this)}b.push(o.db.tag(m[y+1],t,v,!1))}const r=this;return Promise.all(b).then(function(i){return n&&(n.resolve=g),i.length&&(i=r.search(e,t,n,i)),i})}if(!p)return g?i:new Ct(i,this);if(s&&(!y||!this.store))return i=i[0],g?i:new Ct(i,this);for(b=[],v=0;v<o.length;v++){if(m=i[v],y&&m.length&&void 0===m[0].doc&&(this.db?b.push(m=this.index.get(this.field[0]).db.enrich(m)):m=Bt.call(this,m)),s)return g?f?At(e,m,this.index,s,f):m:new Ct(m,this);i[v]={field:o[v],result:m}}if(y&&this.db&&b.length){const t=this;return Promise.all(b).then(function(n){for(let e=0;e<n.length;e++)i[e].result=n[e];return f&&(i=At(e,i,t.index,s,f)),a?jt(i):i})}return f&&(i=At(e,i,this.index,s,f)),a?jt(i):i},(Pe=Mt.prototype).mount=function(e){let t=this.field;if(this.tag)for(let e,r=0;r<this.F.length;r++){e=this.F[r];var n=void 0;this.index.set(e,n=new Xt({},this.reg)),t===this.field&&(t=t.slice(0)),t.push(e),n.tag=this.tag.get(e)}n=[];const r={db:e.db,type:e.type,fastupdate:e.fastupdate};for(let i,o,s=0;s<t.length;s++){r.field=o=t[s],i=this.index.get(o);const a=new e.constructor(e.id,r);a.id=e.id,n[s]=a.mount(i),i.document=!0,s?i.bypass=!0:i.store=this.store}const i=this;return this.db=Promise.all(n).then(function(){i.db=!0})},Pe.commit=async function(){const e=[];for(const t of this.index.values())e.push(t.commit());await Promise.all(e),this.reg.clear()},Pe.destroy=function(){const e=[];for(const t of this.index.values())e.push(t.destroy());return Promise.all(e)},Pe.append=function(e,t){return this.add(e,t,!0)},Pe.update=function(e,t){return this.remove(e).add(e,t)},Pe.remove=function(e){for(var t of(Me(e)&&(e=Ie(e,this.key)),this.index.values()))t.remove(e,!0);if(this.reg.has(e)){if(this.tag&&!this.fastupdate)for(let n of this.tag.values())for(let r of n){t=r[0];const i=r[1],o=i.indexOf(e);o>-1&&(i.length>1?i.splice(o,1):n.delete(t))}this.store&&this.store.delete(e),this.reg.delete(e)}return this.cache&&this.cache.remove(e),this},Pe.clear=function(){const e=[];for(const t of this.index.values()){const n=t.clear();n.then&&e.push(n)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),e.length?Promise.all(e):this},Pe.contain=function(e){return this.db?this.index.get(this.field[0]).db.has(e):this.reg.has(e)},Pe.cleanup=function(){for(const e of this.index.values())e.cleanup();return this},Pe.get=function(e){return this.db?this.index.get(this.field[0]).db.enrich(e).then(function(e){return e[0]&&e[0].doc||null}):this.store.get(e)||null},Pe.set=function(e,t){return"object"==typeof e&&(e=Ie(t=e,this.key)),this.store.set(e,t),this},Pe.searchCache=Fe,Pe.export=function(e,t,n=0,r=0){if(n<this.field.length){const i=this.field[n];if((t=this.index.get(i).export(e,i,n,r=1))&&t.then){const r=this;return t.then(function(){return r.export(e,i,n+1)})}return this.export(e,i,n+1)}let i,o;switch(r){case 0:i="reg",o=zt(this.reg),t=null;break;case 1:i="tag",o=this.tag&&Lt(this.tag,this.reg.size),t=null;break;case 2:i="doc",o=this.store&&Tt(this.store),t=null;break;default:return}return Ft.call(this,e,t,i,o||null,n,r)},Pe.import=function(e,t){var n=e.split(".");"json"===n[n.length-1]&&n.pop();const r=n.length>2?n[0]:"";if(n=n.length>2?n[2]:n[1],this.worker&&r)return this.index.get(r).import(e);if(t){if("string"==typeof t&&(t=JSON.parse(t)),r)return this.index.get(r).import(n,t);switch(n){case"reg":this.fastupdate=!1,this.reg=$t(t,this.reg);for(let e,t=0;t<this.field.length;t++)e=this.index.get(this.field[t]),e.fastupdate=!1,e.reg=this.reg;if(this.worker){t=[];for(const n of this.index.values())t.push(n.import(e));return Promise.all(t)}break;case"tag":this.tag=Rt(t,this.tag);break;case"doc":this.store=qt(t,this.store)}}},lt(Mt.prototype),Xt.prototype.remove=function(e,t){const n=this.reg.size&&(this.fastupdate?this.reg.get(e):this.reg.has(e));if(n){if(this.fastupdate){for(let t,r,i=0;i<n.length;i++)if((t=n[i])&&(r=t.length))if(t[r-1]===e)t.pop();else{const n=t.indexOf(e);n>=0&&t.splice(n,1)}}else Ut(this.map,e),this.depth&&Ut(this.ctx,e);t||this.reg.delete(e)}return this.db&&(this.commit_task.push({del:e}),this.M&&Zt(this)),this.cache&&this.cache.remove(e),this};const Wt={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};function Vt(e,t,n,r,i,o,s){let a,u;if(!(a=t[n])||s&&!a[s]){if(s?((t=a||(t[n]=De()))[s]=1,u=e.ctx,(a=u.get(s))?u=a:u.set(s,u=e.keystore?new Ze(e.keystore):new Map)):(u=e.map,t[n]=1),(a=u.get(n))?u=a:u.set(n,u=a=[]),o)for(let n,o=0;o<a.length;o++)if((n=a[o])&&n.includes(i)){if(o<=r)return;n.splice(n.indexOf(i),1),e.fastupdate&&(t=e.reg.get(i))&&t.splice(t.indexOf(n),1);break}if(u=u[r]||(u[r]=[]),u.push(i),u.length===2**31-1){if(t=new Xe(u),e.fastupdate)for(let n of e.reg.values())n.includes(u)&&(n[n.indexOf(u)]=t);a[r]=u=t}e.fastupdate&&((r=e.reg.get(i))?r.push(u):e.reg.set(i,[u]))}}function Ht(e,t,n,r,i){return n&&e>1?t+(r||0)<=e?n+(i||0):(e-1)/(t+(r||0))*(n+(i||0))+1|0:0}function Qt(e,t,n,r,i,o,s){let a=e.length,u=e;if(a>1)u=Et(e,t,n,r,i,o,s);else if(1===a)return s?yt.call(null,e[0],n,r):new Ct(e[0],this);return s?u:new Ct(u,this)}function Yt(e,t,n,r,i,o,s){return e=Jt(this,e,t,n,r,i,o,s),this.db?e.then(function(e){return i?e||[]:new Ct(e,this)}):e&&e.length?i?yt.call(this,e,n,r):new Ct(e,this):i?[]:new Ct([],this)}function Gt(e,t,n,r){let i=[];if(e&&e.length){if(e.length<=r)return void t.push(e);for(let t,n=0;n<r;n++)(t=e[n])&&(i[n]=t);if(i.length)return void t.push(i)}if(!n)return i}function Jt(e,t,n,r,i,o,s,a){let u;return n&&(u=e.bidirectional&&t>n)&&(u=n,n=t,t=u),e.db?e.db.get(t,n,r,i,o,s,a):e=n?(e=e.ctx.get(n))&&e.get(t):e.map.get(t)}function Xt(e,t){if(!this||this.constructor!==Xt)return new Xt(e);if(e){var n=Be(e)?e:e.preset;n&&(e=Object.assign({},Wt[n],e))}else e={};const r=!0===(n=e.context)?{depth:1}:n||{},i=Be(e.encoder)?Ge[e.encoder]:e.encode||e.encoder||{};this.encoder=i.encode?i:"object"==typeof i?new ze(i):{encode:i},this.resolution=e.resolution||9,this.tokenize=n=(n=e.tokenize)&&"default"!==n&&"exact"!==n&&n||"strict",this.depth="strict"===n&&r.depth||0,this.bidirectional=!1!==r.bidirectional,this.fastupdate=!!e.fastupdate,this.score=e.score||null,(n=e.keystore||0)&&(this.keystore=n),this.map=n?new Ze(n):new Map,this.ctx=n?new Ze(n):new Map,this.reg=t||(this.fastupdate?n?new Ze(n):new Map:n?new et(n):new Set),this.N=r.resolution||3,this.rtl=i.rtl||e.rtl||!1,this.cache=(n=e.cache||null)&&new Ne(n),this.resolve=!1!==e.resolve,(n=e.db)&&(this.db=this.mount(n)),this.M=!1!==e.commit,this.commit_task=[],this.commit_timer=null,this.priority=e.priority||4}function Zt(e){e.commit_timer||(e.commit_timer=setTimeout(function(){e.commit_timer=null,e.db.commit(e)},1))}Xt.prototype.add=function(e,t,n,r){if(t&&(e||0===e)){if(!r&&!n&&this.reg.has(e))return this.update(e,t);r=this.depth;const l=(t=this.encoder.encode(t,!r)).length;if(l){const c=De(),h=De(),f=this.resolution;for(let d=0;d<l;d++){let p=t[this.rtl?l-1-d:d];var i=p.length;if(i&&(r||!h[p])){var o=this.score?this.score(t,p,d,null,0):Ht(f,l,d),s="";switch(this.tokenize){case"tolerant":if(Vt(this,h,p,o,e,n),i>2){for(let t,r,a,u,l=1;l<i-1;l++)t=p.charAt(l),r=p.charAt(l+1),a=p.substring(0,l)+r,u=p.substring(l+2),Vt(this,h,s=a+t+u,o,e,n),Vt(this,h,s=a+u,o,e,n);Vt(this,h,p.substring(0,p.length-1),o,e,n)}break;case"full":if(i>2){for(let r,u=0;u<i;u++)for(o=i;o>u;o--){s=p.substring(u,o),r=this.rtl?i-1-u:u;var a=this.score?this.score(t,p,d,s,r):Ht(f,l,d,i,r);Vt(this,h,s,a,e,n)}break}case"bidirectional":case"reverse":if(i>1){for(a=i-1;a>0;a--){s=p[this.rtl?i-1-a:a]+s;var u=this.score?this.score(t,p,d,s,a):Ht(f,l,d,i,a);Vt(this,h,s,u,e,n)}s=""}case"forward":if(i>1){for(a=0;a<i;a++)Vt(this,h,s+=p[this.rtl?i-1-a:a],o,e,n);break}default:if(Vt(this,h,p,o,e,n),r&&l>1&&d<l-1)for(i=this.N,s=p,o=Math.min(r+1,this.rtl?d+1:l-d),a=1;a<o;a++){p=t[this.rtl?l-1-d-a:d+a];Vt(this,c,(u=this.bidirectional&&p>s)?s:p,this.score?this.score(t,s,d,p,a-1):Ht(i+(l/2>i?0:1),l,d,o-1,a-1),e,n,u?p:s)}}}}this.fastupdate||this.reg.add(e)}}return this.db&&(this.commit_task.push(n?{ins:e}:{del:e}),this.M&&Zt(this)),this},Xt.prototype.search=function(e,t,n){if(n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):(n=e,e="")),n&&n.cache)return n.cache=!1,e=this.searchCache(e,t,n),n.cache=!0,e;let r,i,o,s,a,u,l,c,h=[],f=0;n&&(e=n.query||e,t=n.limit||t,f=n.offset||0,i=n.context,o=n.suggest,c=(s=n.resolve)&&n.enrich,u=n.boost,l=n.resolution,a=this.db&&n.tag),void 0===s&&(s=this.resolve),i=this.depth&&!1!==i;let d=this.encoder.encode(e,!i);if(r=d.length,t=t||(s?100:0),1===r)return Yt.call(this,d[0],"",t,f,s,c,a);if(2===r&&i&&!o)return Yt.call(this,d[1],d[0],t,f,s,c,a);let p,g=De(),m=0;if(i&&(p=d[0],m=1),l||0===l||(l=p?this.N:this.resolution),this.db){if(this.db.search&&!1!==(n=this.db.search(this,d,t,f,o,s,c,a)))return n;const e=this;return async function(){for(let t,n;m<r;m++){if((n=d[m])&&!g[n]){if(g[n]=1,t=await Jt(e,n,p,0,0,!1,!1),t=Gt(t,h,o,l)){h=t;break}p&&(o&&t&&h.length||(p=n))}o&&p&&m===r-1&&!h.length&&(l=e.resolution,p="",m=-1,g=De())}return Qt(h,l,t,f,o,u,s)}()}for(let e,t;m<r;m++){if((t=d[m])&&!g[t]){if(g[t]=1,e=Jt(this,t,p,0,0,!1,!1),e=Gt(e,h,o,l)){h=e;break}p&&(o&&e&&h.length||(p=t))}o&&p&&m===r-1&&!h.length&&(l=this.resolution,p="",m=-1,g=De())}return Qt(h,l,t,f,o,u,s)},(Pe=Xt.prototype).mount=function(e){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),e.mount(this)},Pe.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)},Pe.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()},Pe.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this},Pe.append=function(e,t){return this.add(e,t,!0)},Pe.contain=function(e){return this.db?this.db.has(e):this.reg.has(e)},Pe.update=function(e,t){const n=this,r=this.remove(e);return r&&r.then?r.then(()=>n.add(e,t)):this.add(e,t)},Pe.cleanup=function(){return this.fastupdate?(Ut(this.map),this.depth&&Ut(this.ctx),this):this},Pe.searchCache=Fe,Pe.export=function(e,t,n=0,r=0){let i,o;switch(r){case 0:i="reg",o=zt(this.reg);break;case 1:i="cfg",o=null;break;case 2:i="map",o=Tt(this.map,this.reg.size);break;case 3:i="ctx",o=Lt(this.ctx,this.reg.size);break;default:return}return Ft.call(this,e,t,i,o,n,r)},Pe.import=function(e,t){if(t)switch("string"==typeof t&&(t=JSON.parse(t)),e=e.split("."),"json"===e[e.length-1]&&e.pop(),3===e.length&&e.shift(),e=e.length>1?e[1]:e[0],e){case"reg":this.fastupdate=!1,this.reg=$t(t,this.reg);break;case"map":this.map=qt(t,this.map);break;case"ctx":this.ctx=Rt(t,this.ctx)}},Pe.serialize=function(e=!0){let t="",n="",r="";if(this.reg.size){let e;for(var i of this.reg.keys())e||(e=typeof i),t+=(t?",":"")+("string"===e?'"'+i+'"':i);t="index.reg=new Set(["+t+"]);",n=Nt(this.map,e),n="index.map=new Map(["+n+"]);";for(const t of this.ctx.entries()){i=t[0];let n=Nt(t[1],e);n="new Map(["+n+"])",n='["'+i+'",'+n+"]",r+=(r?",":"")+n}r="index.ctx=new Map(["+r+"]);"}return e?"function inject(index){"+t+n+r+"}":t+n+r},lt(Xt.prototype);const en="undefined"!=typeof window&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),tn=["map","ctx","tag","reg","cfg"],nn=De();function rn(e,t,n){const r=e.value;let i,o=0;for(let e,s=0;s<r.length;s++){if(e=n?r:r[s]){for(let n,o,a=0;a<t.length;a++)if(o=t[a],n=e.indexOf(o),n>=0){if(i=1,!(e.length>1)){r[s]=[];break}e.splice(n,1)}o+=e.length}if(n)break}o?i&&e.update(r):e.delete(),e.continue()}function on(e,t){return new Promise((n,r)=>{e.onsuccess=e.oncomplete=function(){t&&t(this.result),t=null,n(this.result)},e.onerror=e.onblocked=r,e=null})}Pe=function e(t,n={}){if(!this||this.constructor!==e)return new e(t,n);"object"==typeof t&&(n=t,t=t.name),t||console.info("Default storage space was used, because a name was not passed."),this.id="flexsearch"+(t?":"+t.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=n.field?n.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=n.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}.prototype,Pe.mount=function(e){return e.index?e.mount(this):(e.db=this,this.open())},Pe.open=function(){if(this.db)return this.db;let e=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),nn[e.id]||(nn[e.id]=[]),nn[e.id].push(e.field);const t=en.open(e.id,1);return t.onupgradeneeded=function(){const t=e.db=this.result;for(let n,r=0;r<tn.length;r++){n=tn[r];for(let r,i=0;i<nn[e.id].length;i++)r=nn[e.id][i],t.objectStoreNames.contains(n+("reg"!==n&&r?":"+r:""))||t.createObjectStore(n+("reg"!==n&&r?":"+r:""))}},e.db=on(t,function(t){e.db=t,e.db.onversionchange=function(){e.close()}})},Pe.close=function(){this.db&&this.db.close(),this.db=null},Pe.destroy=function(){return on(en.deleteDatabase(this.id))},Pe.clear=function(){const e=[];for(let t,n=0;n<tn.length;n++){t=tn[n];for(let n,r=0;r<nn[this.id].length;r++)n=nn[this.id][r],e.push(t+("reg"!==t&&n?":"+n:""))}const t=this.db.transaction(e,"readwrite");for(let n=0;n<e.length;n++)t.objectStore(e[n]).clear();return on(t)},Pe.get=function(e,t,n=0,r=0,i=!0,o=!1){e=this.db.transaction((t?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((t?"ctx":"map")+(this.field?":"+this.field:"")).get(t?t+":"+e:e);const s=this;return on(e).then(function(e){let t=[];if(!e||!e.length)return t;if(i){if(!n&&!r&&1===e.length)return e[0];for(let i,o=0;o<e.length;o++)if((i=e[o])&&i.length){if(r>=i.length){r-=i.length;continue}const e=n?r+Math.min(i.length-r,n):i.length;for(let n=r;n<e;n++)t.push(i[n]);if(r=0,t.length===n)break}return o?s.enrich(t):t}return e})},Pe.tag=function(e,t=0,n=0,r=!1){e=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(e);const i=this;return on(e).then(function(e){return!e||!e.length||n>=e.length?[]:t||n?(e=e.slice(n,n+t),r?i.enrich(e):e):e})},Pe.enrich=function(e){"object"!=typeof e&&(e=[e]);const t=this.db.transaction("reg","readonly").objectStore("reg"),n=[];for(let r=0;r<e.length;r++)n[r]=on(t.get(e[r]));return Promise.all(n).then(function(t){for(let n=0;n<t.length;n++)t[n]={id:e[n],doc:t[n]?JSON.parse(t[n]):null};return t})},Pe.has=function(e){return on(e=this.db.transaction("reg","readonly").objectStore("reg").getKey(e)).then(function(e){return!!e})},Pe.search=null,Pe.info=function(){},Pe.transaction=function(e,t,n){e+="reg"!==e&&this.field?":"+this.field:"";let r=this.h[e+":"+t];if(r)return n.call(this,r);let i=this.db.transaction(e,t);this.h[e+":"+t]=r=i.objectStore(e);const o=n.call(this,r);return this.h[e+":"+t]=null,on(i).finally(function(){return o})},Pe.commit=async function(e){let t=e.commit_task,n=[];e.commit_task=[];for(let e,r=0;r<t.length;r++)e=t[r],e.del&&n.push(e.del);n.length&&await this.remove(n),e.reg.size&&(await this.transaction("map","readwrite",function(t){for(const n of e.map){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;var i;if(n&&n.length){const e=Math.max(n.length,r.length);for(let t,o,s=0;s<e;s++)if((o=r[s])&&o.length){if((t=n[s])&&t.length)for(i=0;i<o.length;i++)t.push(o[i]);else n[s]=o;i=1}}else n=r,i=1;i&&t.put(n,e)})}}),await this.transaction("ctx","readwrite",function(t){for(const n of e.ctx){const e=n[0],r=n[1];for(const n of r){const r=n[0],i=n[1];i.length&&(t.get(e+":"+r).onsuccess=function(){let n=this.result;var o;if(n&&n.length){const e=Math.max(n.length,i.length);for(let t,r,s=0;s<e;s++)if((r=i[s])&&r.length){if((t=n[s])&&t.length)for(o=0;o<r.length;o++)t.push(r[o]);else n[s]=r;o=1}}else n=i,o=1;o&&t.put(n,e+":"+r)})}}}),e.store?await this.transaction("reg","readwrite",function(t){for(const n of e.store){const e=n[0],r=n[1];t.put("object"==typeof r?JSON.stringify(r):1,e)}}):e.bypass||await this.transaction("reg","readwrite",function(t){for(const n of e.reg.keys())t.put(1,n)}),e.tag&&await this.transaction("tag","readwrite",function(t){for(const n of e.tag){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;n=n&&n.length?n.concat(r):r,t.put(n,e)})}}),e.map.clear(),e.ctx.clear(),e.tag&&e.tag.clear(),e.store&&e.store.clear(),e.document||e.reg.clear())},Pe.remove=function(e){return"object"!=typeof e&&(e=[e]),Promise.all([this.transaction("map","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&rn(t,e)}}),this.transaction("ctx","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&rn(t,e)}}),this.transaction("tag","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&rn(t,e,!0)}}),this.transaction("reg","readwrite",function(t){for(let n=0;n<e.length;n++)t.delete(e[n])})])};const sn=Mt;let an=null,un=!1;async function ln(){return await se()}function cn(e,t){const{positive:n,negative:r,phrases:i,regular:o,regexPatterns:s=[]}=t,a=[e.title||"",e.url||"",e.description||"",e.domain||"",e.category||"",Array.isArray(e.keywords)?e.keywords.join(" "):""].join(" ").toLowerCase(),u=[e.title||"",e.url||"",e.description||"",e.domain||"",e.category||"",Array.isArray(e.keywords)?e.keywords.join(" "):""].join(" ");for(const e of n)if(!a.includes(e))return!1;for(const e of r)if(a.includes(e))return!1;for(const e of i)if(!a.includes(e))return!1;for(const e of s){const t=e.flags.includes("i")?a:u;if(!e.test(t))return!1}if(o.length>0){if(!o.some(e=>a.includes(e)))return!1}return!0}function hn(e,t){const{positive:n,phrases:r,regular:i,regexPatterns:o=[]}=t;let s=0;const a=(e.title||"").toLowerCase(),u=(e.url||"").toLowerCase(),l=(e.domain||"").toLowerCase(),c=(e.description||"").toLowerCase(),h=(e.category||"").toLowerCase(),f=[...n,...r,...i];for(const e of f)a.includes(e)&&(s+=10,a.startsWith(e)&&(s+=5)),l.includes(e)&&(s+=5),h.includes(e)&&(s+=4),c.includes(e)&&(s+=2),u.includes(e)&&(s+=1);for(const t of o)t.test(e.title||"")&&(s+=8),t.test(e.url||"")&&(s+=3),t.test(e.description||"")&&(s+=2);return s}async function fn(){if(un)return an;console.log("Initializing FlexSearch index...");const e=await async function(e){try{const t=await oe.cache.get(e);return t?t.ttl&&Date.now()-t.timestamp>t.ttl?(await oe.cache.delete(e),null):t.value:null}catch(e){return console.error("Error getting cache:",e),null}}("flexsearch_index");if(e&&e.serialized)try{an=new sn({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const t=Object.keys(e.serialized);for(const n of t)await an.import(n,e.serialized[n]);return un=!0,console.log("Loaded FlexSearch index from cache"),an}catch(e){console.error("Error loading cached index:",e)}return await async function(){console.log("Building FlexSearch index..."),an=new sn({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const e=await ln();for(const t of e)await dn(t,!1);un=!0;try{const t={};await an.export((e,n)=>{t[e]=n}),await ae("flexsearch_index",{serialized:t,timestamp:Date.now()}),console.log(`Indexed ${e.length} bookmarks`)}catch(e){console.error("Error caching index:",e)}return an}(),an}async function dn(e,t=!0){an||await fn();const n={id:e.id,title:e.title||"",url:e.url||"",description:e.description||"",keywords:Array.isArray(e.keywords)?e.keywords.join(" "):"",category:e.category||"",domain:e.domain||""};await an.add(n),t&&await async function(){if(!an)return;try{const e={};await an.export((t,n)=>{e[t]=n}),await ae("flexsearch_index",{serialized:e,timestamp:Date.now()})}catch(e){console.error("Error caching index:",e)}}()}async function pn(e,t=null,n={}){!t||t.domains||Array.isArray(t.domains)||(n=t,t=null);const{limit:r=50,offset:i=0,computeStats:o=!1}=n;let s=await ln();if(t){const e=Date.now()-2592e6;s=s.filter(n=>{if(t.domains&&t.domains.length>0){const e=(n.domain||"").toLowerCase();if(!t.domains.some(t=>e.includes(t.toLowerCase())))return!1}if(t.folders&&t.folders.length>0){const e=(n.folderPath||"").toLowerCase();if(!t.folders.some(t=>e.includes(t.toLowerCase())))return!1}if(t.topics&&t.topics.length>0){const e=n.topics||[];if(!t.topics.some(t=>e.some(e=>e.toLowerCase()===t.toLowerCase()||e.toLowerCase().startsWith(t.toLowerCase()+"/"))))return!1}if(t.types&&t.types.length>0){const e=(n.contentType||"").toLowerCase();if(!t.types.some(t=>e===t.toLowerCase()))return!1}if(t.creators&&t.creators.length>0){const e=`${n.platform||"other"}:${n.creator}`;if(!t.creators.some(t=>t.key===e))return!1}if(t.tags&&t.tags.length>0){if(!n.tags||!Array.isArray(n.tags))return!1;if(!t.tags.some(e=>n.tags.includes(e)))return!1}if(t.deadLinks&&!1!==n.isAlive)return!1;if(t.stale){const t=n.dateAdded<e,r=!n.accessCount||0===n.accessCount,i=!1!==n.isAlive;if(!(t&&r&&i))return!1}if(t.dateRange){const{startDate:e,endDate:r}=t.dateRange;if(n.dateAdded<e||n.dateAdded>r)return!1}if(t.readingTimeRange){const{min:e,max:r}=t.readingTimeRange,i=n.readingTime||0;if(null!=e&&i<e)return!1;if(null!=r&&i>r)return!1}if(t.qualityScoreRange){const{min:e,max:r}=t.qualityScoreRange,i=n.qualityScore||0;if(null!=e&&i<e)return!1;if(null!=r&&i>r)return!1}if(null!==t.hasPublishedDate&&void 0!==t.hasPublishedDate){const e=Boolean(n.publishedDate||n.rawMetadata?.publishedDate);if(t.hasPublishedDate!==e)return!1}return!0})}if(!e||!e.trim()){const e=Y(n.sortBy||"date_desc"),t={results:s.sort(e).slice(i,i+r),total:s.length,hasMore:i+r<s.length,parsedQuery:null};return o&&(t.stats=gn(s)),t}const{filters:a,remainingQuery:u}=function(e){if(!e||!e.trim())return{filters:{},remainingQuery:""};const t={};let n=e;const r=n.match(/category:(\S+)/i);r&&(t.category=r[1].toLowerCase(),n=n.replace(r[0],"").trim());const i=n.match(/domain:(\S+)/i);i&&(t.domain=i[1].toLowerCase(),n=n.replace(i[0],"").trim());const o=n.match(/platform:(\S+)/i);o&&(t.platform=o[1].toLowerCase(),n=n.replace(o[0],"").trim());const s=n.match(/channel:(@?\S+)/i);s&&(t.creator=s[1],n=n.replace(s[0],"").trim());const a=n.match(/author:(@?\S+)/i);a&&(t.creator=a[1],n=n.replace(a[0],"").trim());const u=n.match(/repo:(\S+)/i);u&&(t.repo=u[1].toLowerCase(),n=n.replace(u[0],"").trim());const l=n.match(/type:(\S+)/i);l&&(t.contentType=l[1].toLowerCase(),n=n.replace(l[0],"").trim());const c=n.match(/hasimage:(yes|no)/i);c&&(t.hasImage="yes"===c[1].toLowerCase(),n=n.replace(c[0],"").trim());const h=n.match(/playlist:(\S+)/i);h&&(t.playlist=h[1],n=n.replace(h[0],"").trim());const f=n.match(/accessed:(yes|no)/i);f&&(t.accessed="yes"===f[1].toLowerCase(),n=n.replace(f[0],"").trim());const d=n.match(/stale:(yes|no)/i);d&&(t.stale="yes"===d[1].toLowerCase(),n=n.replace(d[0],"").trim());const p=n.match(/enriched:(yes|no)/i);p&&(t.enriched="yes"===p[1].toLowerCase(),n=n.replace(p[0],"").trim());const g=n.match(/dead:(yes|no)/i);g&&(t.dead="yes"===g[1].toLowerCase(),n=n.replace(g[0],"").trim());const m=n.match(/folder:(?:"([^"]+)"|(\S+))/i);return m&&(t.folder=(m[1]||m[2]).toLowerCase(),n=n.replace(m[0],"").trim()),{filters:t,remainingQuery:n}}(e),l=function(e){if(!e||!e.trim())return{positive:[],negative:[],phrases:[],regular:[],regexPatterns:[],hasModifiers:!1};const t=[],n=[],r=[],i=[],o=[],s=/\/([^\/]+)\/([gimsuvy]*)?/g;let a,u=e;for(;null!==(a=s.exec(e));)try{const e=a[1],t=a[2]||"i",n=new RegExp(e,t);o.push(n)}catch(e){console.warn("Invalid regex pattern:",a[0],e.message)}u=u.replace(/\/[^\/]+\/[gimsuvy]*/g,"").trim();const l=/([+-]?)"([^"]+)"/g;for(;null!==(a=l.exec(u));){const e=a[1],i=a[2].toLowerCase();"+"===e?t.push(i):"-"===e?n.push(i):r.push(i)}u=u.replace(/[+-]?"[^"]+"/g,"").trim();const c=u.split(/\s+/).filter(e=>e.length>0);for(const e of c){const r=e.toLowerCase();e.startsWith("+")&&e.length>1?t.push(r.slice(1)):e.startsWith("-")&&e.length>1?n.push(r.slice(1)):i.push(r)}return{positive:t,negative:n,phrases:r,regular:i,regexPatterns:o,hasModifiers:t.length>0||n.length>0||r.length>0||o.length>0}}(u);if(Object.keys(a).length>0&&(s=function(e,t){const n=Date.now()-2592e6;return e.filter(e=>{if(t.category&&(e.category||"uncategorized").toLowerCase()!==t.category)return!1;if(t.domain&&!(e.domain||"").toLowerCase().includes(t.domain))return!1;if(void 0!==t.accessed){const n=e.accessCount&&e.accessCount>0;if(t.accessed!==n)return!1}if(t.stale){const t=e.dateAdded<n,r=!e.accessCount||0===e.accessCount,i=!1!==e.isAlive;if(!(t&&r&&i))return!1}if(void 0!==t.enriched){const n=Boolean(e.description||e.keywords&&e.keywords.length>0||e.contentSnippet);if(t.enriched!==n)return!1}if(void 0!==t.dead){const n=!1===e.isAlive;if(t.dead!==n)return!1}if(t.folder&&!(e.folderPath||"").toLowerCase().includes(t.folder))return!1;if(t.platform&&(e.platform||"other").toLowerCase()!==t.platform)return!1;if(t.creator){const n=(e.creator||"").toLowerCase(),r=t.creator.toLowerCase();if(!n.includes(r)&&!n.includes(r.replace(/^@/,""))&&!`@${n}`.includes(r))return!1}if(t.repo&&!(e.platformData?.extra?.owner&&e.platformData?.extra?.repo?`${e.platformData.extra.owner}/${e.platformData.extra.repo}`.toLowerCase():"").includes(t.repo))return!1;if(t.contentType){const n=(e.contentType||"").toLowerCase();if(!t.contentType.split("|").map(e=>e.trim()).includes(n))return!1}if(void 0!==t.hasImage){const n=Boolean(e.platformData?.extra?.thumbnail||e.rawMetadata?.openGraph?.["og:image"]||e.rawMetadata?.twitterCard?.["twitter:image"]);if(t.hasImage!==n)return!1}return!(t.playlist&&!(e.platformData?.extra?.playlistId||"").includes(t.playlist))})}(s,a)),u.trim()){if(l.regular.length>0)try{const e=await fn(),t=l.regular.join(" "),n=await e.search(t,{limit:1e4,suggest:!0}),r=new Set;Array.isArray(n)&&n.forEach(e=>{e&&Array.isArray(e.result)&&e.result.forEach(e=>r.add(e))}),s=s.filter(e=>r.has(e.id)),s=s.filter(e=>cn(e,l))}catch(e){console.error("FlexSearch failed, falling back to manual search:",e),s=s.filter(e=>cn(e,l))}else s=s.filter(e=>cn(e,l));s=s.map(e=>({...e,_searchScore:hn(e,l)}));const e=Y(n.sortBy||"relevance");s.sort(e)}else{const e=Y(n.sortBy||"date_desc");s.sort(e)}const c=s.length,h={results:s.slice(i,i+r),total:c,hasMore:i+r<c,parsedQuery:l,specialFilters:a};return o&&(h.stats=gn(s)),h}function gn(e){const t=new Map,n=new Map,r=new Map,i=new Map,o=new Map,s=Date.now(),a=864e5,u=7*a,l=14*a,c=90*a,h=180*a,f=new Date,d=f.getFullYear(),p=new Date(d,f.getMonth(),1).getTime(),g=new Date(d,0,1).getTime();let m=0,y=0,v=0,b=0,w=0,x=0,k=0;for(const a of e){if(a.domain){const e=t.get(a.domain)||{count:0,latestDate:0};e.count++,a.dateAdded>e.latestDate&&(e.latestDate=a.dateAdded),t.set(a.domain,e)}if(a.folderPath){const e=n.get(a.folderPath)||0;n.set(a.folderPath,e+1)}const e=a.topics||[];for(const t of e)r.set(t,(r.get(t)||0)+1);if(a.creator){const e=`${a.platform||"other"}:${a.creator}`;i.has(e)||i.set(e,{creator:a.creator,platform:a.platform||"other",count:0}),i.get(e).count++}a.contentType&&o.set(a.contentType,(o.get(a.contentType)||0)+1);const f=a.dateAdded;s-f<u&&m++,s-f<l&&y++,f>=p&&v++,s-f<c&&b++,s-f<h&&w++,f>=g&&x++,f<g&&k++}return{domains:Array.from(t.entries()).map(([e,t])=>({domain:e,count:t.count,latestDate:t.latestDate})).sort((e,t)=>t.count-e.count),folders:Array.from(n.entries()).map(([e,t])=>({folder:e,count:t})).sort((e,t)=>t.count-e.count),topics:Array.from(r.entries()).map(([e,t])=>({topic:e,count:t})).sort((e,t)=>t.count-e.count),creators:Array.from(i.values()).sort((e,t)=>t.count-e.count),contentTypes:Array.from(o.entries()).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count),dateCounts:{week:m,twoWeek:y,month:v,threeMonth:b,sixMonth:w,year:x,older:k}}}function mn(e,t,n){const r=e.slice();return r[42]=t[n].folder,r[39]=t[n].count,r}function yn(e,t,n){const r=e.slice();return r[38]=t[n].domain,r[39]=t[n].count,r}function vn(e,t,n){const r=e.slice();return r[35]=t[n],r}function bn(e,t,n){const r=e.slice();return r[32]=t[n],r}function wn(e){let t,n;return{c(){t=p("svg"),n=p("path"),b(n,"d","M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"),b(t,"class","w-4 h-4"),b(t,"fill","currentColor"),b(t,"viewBox","0 0 20 20")},m(e,r){c(e,t,r),l(t,n)},d(e){e&&h(t)}}}function xn(e){let t,n;return{c(){t=p("svg"),n=p("path"),b(n,"fill-rule","evenodd"),b(n,"d","M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"),b(n,"clip-rule","evenodd"),b(t,"class","w-4 h-4"),b(t,"fill","currentColor"),b(t,"viewBox","0 0 20 20")},m(e,r){c(e,t,r),l(t,n)},d(e){e&&h(t)}}}function kn(e){let t,n,r,i,o,s,a,u,f,p,y,x,k=e[0].length+"";function _(e,t){return"domain"===e[5].type?Cn:"folder"===e[5].type?An:"recent"===e[5].type?_n:void 0}let A=_(e),C=A&&A(e);return{c(){t=d("div"),n=d("div"),r=d("span"),C&&C.c(),i=m(),o=d("span"),s=g("("),a=g(k),u=g(")"),f=m(),p=d("button"),p.textContent="Clear",b(o,"class","text-blue-500 dark:text-blue-400"),b(r,"class","text-xs text-blue-700 dark:text-blue-300"),b(p,"class","text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"),b(n,"class","flex items-center justify-between"),b(t,"class","flex-shrink-0 px-3 py-2 bg-blue-50 dark:bg-blue-900/30 border-b border-blue-100 dark:border-blue-800")},m(h,d){c(h,t,d),l(t,n),l(n,r),C&&C.m(r,null),l(r,i),l(r,o),l(o,s),l(o,a),l(o,u),l(n,f),l(n,p),y||(x=v(p,"click",e[18]),y=!0)},p(e,t){A===(A=_(e))&&C?C.p(e,t):(C&&C.d(1),C=A&&A(e),C&&(C.c(),C.m(r,i))),1&t[0]&&k!==(k=e[0].length+"")&&w(a,k)},d(e){e&&h(t),C&&C.d(),y=!1,x()}}}function _n(e){let t,n,r=e[5].value+"";return{c(){t=g("ðŸ• "),n=g(r)},m(e,r){c(e,t,r),c(e,n,r)},p(e,t){32&t[0]&&r!==(r=e[5].value+"")&&w(n,r)},d(e){e&&(h(t),h(n))}}}function An(e){let t,n,r=e[5].value+"";return{c(){t=g("ðŸ“ "),n=g(r)},m(e,r){c(e,t,r),c(e,n,r)},p(e,t){32&t[0]&&r!==(r=e[5].value+"")&&w(n,r)},d(e){e&&(h(t),h(n))}}}function Cn(e){let t,n,r=e[5].value+"";return{c(){t=g("ðŸŒ "),n=g(r)},m(e,r){c(e,t,r),c(e,n,r)},p(e,t){32&t[0]&&r!==(r=e[5].value+"")&&w(n,r)},d(e){e&&(h(t),h(n))}}}function Sn(e){let t,n,r,i=R(e[9]),o=[];for(let t=0;t<i.length;t+=1)o[t]=Bn(mn(e,i,t));return{c(){t=d("div"),n=d("h3"),n.textContent="Folders",r=m();for(let e=0;e<o.length;e+=1)o[e].c();b(n,"class","text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3"),b(t,"class","p-3 space-y-1")},m(e,i){c(e,t,i),l(t,n),l(t,r);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null)},p(e,n){if(66048&n[0]){let r;for(i=R(e[9]),r=0;r<i.length;r+=1){const s=mn(e,i,r);o[r]?o[r].p(s,n):(o[r]=Bn(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(e){e&&h(t),f(o,e)}}}function En(e){let t,n,r,i=R(e[8]),o=[];for(let t=0;t<i.length;t+=1)o[t]=Mn(yn(e,i,t));return{c(){t=d("div"),n=d("h3"),n.textContent="Top Domains",r=m();for(let e=0;e<o.length;e+=1)o[e].c();b(n,"class","text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3"),b(t,"class","p-3 space-y-1")},m(e,i){c(e,t,i),l(t,n),l(t,r);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null)},p(e,n){if(33024&n[0]){let r;for(i=R(e[8]),r=0;r<i.length;r+=1){const s=yn(e,i,r);o[r]?o[r].p(s,n):(o[r]=Mn(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(e){e&&h(t),f(o,e)}}}function Pn(e){let t,n,r,i=R([{days:1,label:"Today"},{days:7,label:"Last 7 days"},{days:14,label:"Last 2 weeks"},{days:30,label:"Last month"},{days:90,label:"Last 3 months"}]),o=[];for(let t=0;t<5;t+=1)o[t]=In(vn(e,i,t));return{c(){t=d("div"),n=d("h3"),n.textContent="Quick Filters",r=m();for(let e=0;e<5;e+=1)o[e].c();b(n,"class","text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3"),b(t,"class","p-3 space-y-2")},m(e,i){c(e,t,i),l(t,n),l(t,r);for(let e=0;e<5;e+=1)o[e]&&o[e].m(t,null)},p(e,n){if(131072&n[0]){let r;for(i=R([{days:1,label:"Today"},{days:7,label:"Last 7 days"},{days:14,label:"Last 2 weeks"},{days:30,label:"Last month"},{days:90,label:"Last 3 months"}]),r=0;r<5;r+=1){const s=vn(e,i,r);o[r]?o[r].p(s,n):(o[r]=In(s),o[r].c(),o[r].m(t,null))}for(;r<5;r+=1)o[r].d(1)}},d(e){e&&h(t),f(o,e)}}}function On(e){let t;function n(e,t){return 0===e[0].length?Tn:Kn}let r=n(e),i=r(e);return{c(){i.c(),t=y()},m(e,n){i.m(e,n),c(e,t,n)},p(e,o){r===(r=n(e))&&i?i.p(e,o):(i.d(1),i=r(e),i&&(i.c(),i.m(t.parentNode,t)))},d(e){e&&h(t),i.d(e)}}}function jn(e){let t,n,r,i,o,s,a,u;return{c(){t=d("div"),n=d("p"),r=g("Error: "),i=g(e[3]),o=m(),s=d("button"),s.textContent="Retry",b(n,"class","text-sm"),b(s,"class","mt-2 px-3 py-1 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700"),b(t,"class","text-center text-red-600 dark:text-red-400 p-4")},m(h,f){c(h,t,f),l(t,n),l(n,r),l(n,i),l(t,o),l(t,s),a||(u=v(s,"click",e[13]),a=!0)},p(e,t){8&t[0]&&w(i,e[3])},d(e){e&&h(t),a=!1,u()}}}function Dn(t){let n;return{c(){n=d("div"),n.innerHTML='<div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 dark:border-blue-400"></div>',b(n,"class","flex items-center justify-center h-32")},m(e,t){c(e,n,t)},p:e,d(e){e&&h(n)}}}function Bn(e){let t,n,r,i,o,s,a,u,f,y,x,k,_=e[42]+"",A=e[39]+"";function C(){return e[28](e[42])}return{c(){t=d("button"),n=d("span"),r=p("svg"),i=p("path"),o=m(),s=g(_),a=m(),u=d("span"),f=g(A),y=m(),b(i,"d","M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"),b(r,"class","w-4 h-4 text-gray-400 flex-shrink-0"),b(r,"fill","currentColor"),b(r,"viewBox","0 0 20 20"),b(n,"class","truncate flex-1 flex items-center gap-2"),b(u,"class","text-xs text-gray-400 dark:text-gray-500 ml-2"),b(t,"class","w-full px-3 py-2 text-left text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors flex items-center justify-between group")},m(e,h){c(e,t,h),l(t,n),l(n,r),l(r,i),l(n,o),l(n,s),l(t,a),l(t,u),l(u,f),l(t,y),x||(k=v(t,"click",C),x=!0)},p(t,n){e=t,512&n[0]&&_!==(_=e[42]+"")&&w(s,_),512&n[0]&&A!==(A=e[39]+"")&&w(f,A)},d(e){e&&h(t),x=!1,k()}}}function Mn(e){let t,n,r,i,o,s,a,u,f,p=e[38]+"",y=e[39]+"";function x(){return e[27](e[38])}return{c(){t=d("button"),n=d("span"),r=g(p),i=m(),o=d("span"),s=g(y),a=m(),b(n,"class","truncate flex-1"),b(o,"class","text-xs text-gray-400 dark:text-gray-500 ml-2"),b(t,"class","w-full px-3 py-2 text-left text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors flex items-center justify-between group")},m(e,h){c(e,t,h),l(t,n),l(n,r),l(t,i),l(t,o),l(o,s),l(t,a),u||(f=v(t,"click",x),u=!0)},p(t,n){e=t,256&n[0]&&p!==(p=e[38]+"")&&w(r,p),256&n[0]&&y!==(y=e[39]+"")&&w(s,y)},d(e){e&&h(t),u=!1,f()}}}function In(e){let t,n,r,i,o,s,a,u;function f(){return e[26](e[35])}return{c(){t=d("button"),n=d("span"),n.textContent=`${e[35].label}`,r=m(),i=p("svg"),o=p("path"),s=m(),b(o,"stroke-linecap","round"),b(o,"stroke-linejoin","round"),b(o,"stroke-width","2"),b(o,"d","M9 5l7 7-7 7"),b(i,"class","w-4 h-4 text-gray-400"),b(i,"fill","none"),b(i,"stroke","currentColor"),b(i,"viewBox","0 0 24 24"),b(t,"class","w-full px-3 py-2 text-left text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors flex items-center justify-between")},m(e,h){c(e,t,h),l(t,n),l(t,r),l(t,i),l(i,o),l(t,s),a||(u=v(t,"click",f),a=!0)},p(t,n){e=t},d(e){e&&h(t),a=!1,u()}}}function Kn(e){let t,n,i,o=[],s=new Map,a=R(e[11]);const u=e=>e[32].id;for(let t=0;t<a.length;t+=1){let n=bn(e,a,t),r=u(n);s.set(r,o[t]=Ln(r,n))}let l=e[10]&&Rn(e);return{c(){t=d("div");for(let e=0;e<o.length;e+=1)o[e].c();n=m(),l&&l.c(),i=y(),b(t,"class","divide-y divide-gray-100 dark:divide-gray-800")},m(e,r){c(e,t,r);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);c(e,n,r),l&&l.m(e,r),c(e,i,r)},p(e,n){2048&n[0]&&(a=R(e[11]),o=function(e,t,n,i,o,s,a,u,l,c,h,f){let d=e.length,p=s.length,g=d;const m={};for(;g--;)m[e[g].key]=g;const y=[],v=new Map,b=new Map,w=[];for(g=p;g--;){const e=f(o,s,g),r=n(e);let u=a.get(r);u?i&&w.push(()=>u.p(e,t)):(u=c(r,e),u.c()),v.set(r,y[g]=u),r in m&&b.set(r,Math.abs(g-m[r]))}const x=new Set,k=new Set;function _(e){L(e,1),e.m(u,h),a.set(e.key,e),h=e.first,p--}for(;d&&p;){const t=y[p-1],n=e[d-1],r=t.key,i=n.key;t===n?(h=t.first,d--,p--):v.has(i)?!a.has(r)||x.has(r)?_(t):k.has(i)?d--:b.get(r)>b.get(i)?(k.add(r),_(t)):(x.add(i),d--):(l(n,a),d--)}for(;d--;){const t=e[d];v.has(t.key)||l(t,a)}for(;p;)_(y[p-1]);return r(w),y}(o,n,u,1,e,a,s,t,z,Ln,null,bn)),e[10]?l?l.p(e,n):(l=Rn(e),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},d(e){e&&(h(t),h(n),h(i));for(let e=0;e<o.length;e+=1)o[e].d();l&&l.d(e)}}}function Tn(e){let t;function n(e,t){return e[4]?$n:zn}let r=n(e),i=r(e);return{c(){t=d("div"),i.c(),b(t,"class","text-center text-gray-500 dark:text-gray-400 p-4 text-sm")},m(e,n){c(e,t,n),i.m(t,null)},p(e,o){r===(r=n(e))&&i?i.p(e,o):(i.d(1),i=r(e),i&&(i.c(),i.m(t,null)))},d(e){e&&h(t),i.d()}}}function qn(e){let t;return{c(){t=d("span"),t.textContent="Dead link",b(t,"class","text-xs text-red-500 dark:text-red-400")},m(e,n){c(e,t,n)},d(e){e&&h(t)}}}function Ln(e,t){let n,i,o,s,a,f,p,y,x,k,_,A,C,S,E,P,O,j,D,B,M,I=(t[32].title||"Untitled")+"",K=t[32].domain+"",T=V(t[32].dateAdded)+"",q=!1===t[32].isAlive&&qn();function L(...e){return t[24](t[32],...e)}function R(...e){return t[25](t[32],...e)}return{key:e,first:null,c(){n=d("div"),i=d("div"),o=d("img"),a=m(),f=d("div"),p=d("h3"),y=g(I),k=m(),_=d("p"),A=g(K),S=m(),E=d("div"),q&&q.c(),P=m(),O=d("span"),j=g(T),D=m(),u(o.src,s=H(t[32]))||b(o,"src",s),b(o,"alt",""),b(o,"class","w-4 h-4 mt-0.5 flex-shrink-0 rounded"),b(p,"class","text-sm font-medium text-gray-900 dark:text-gray-100 truncate"),b(p,"title",x=t[32].title),b(_,"class","text-xs text-gray-500 dark:text-gray-400 truncate"),b(_,"title",C=t[32].url),b(O,"class","text-xs text-gray-400 dark:text-gray-500"),b(E,"class","flex items-center gap-2 mt-0.5"),b(f,"class","flex-1 min-w-0"),b(i,"class","flex items-start gap-2"),b(n,"class","px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors group"),b(n,"role","button"),b(n,"tabindex","0"),this.first=n},m(e,t){c(e,n,t),l(n,i),l(i,o),l(i,a),l(i,f),l(f,p),l(p,y),l(f,k),l(f,_),l(_,A),l(f,S),l(f,E),q&&q.m(E,null),l(E,P),l(E,O),l(O,j),l(n,D),B||(M=[v(n,"click",L),v(n,"keydown",R)],B=!0)},p(e,n){t=e,2048&n[0]&&!u(o.src,s=H(t[32]))&&b(o,"src",s),2048&n[0]&&I!==(I=(t[32].title||"Untitled")+"")&&w(y,I),2048&n[0]&&x!==(x=t[32].title)&&b(p,"title",x),2048&n[0]&&K!==(K=t[32].domain+"")&&w(A,K),2048&n[0]&&C!==(C=t[32].url)&&b(_,"title",C),!1===t[32].isAlive?q||(q=qn(),q.c(),q.m(E,P)):q&&(q.d(1),q=null),2048&n[0]&&T!==(T=V(t[32].dateAdded)+"")&&w(j,T)},d(e){e&&h(n),q&&q.d(),B=!1,r(M)}}}function Rn(e){let t,n,r,i,o,s,a,u=e[0].length-e[1]+"";return{c(){t=d("div"),n=d("button"),r=g("Load more ("),i=g(u),o=g(" remaining)"),b(n,"class","text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"),b(t,"class","p-3 text-center")},m(u,h){c(u,t,h),l(t,n),l(n,r),l(n,i),l(n,o),s||(a=v(n,"click",e[19]),s=!0)},p(e,t){3&t[0]&&u!==(u=e[0].length-e[1]+"")&&w(i,u)},d(e){e&&h(t),s=!1,a()}}}function zn(t){let n;return{c(){n=g("No bookmarks found")},m(e,t){c(e,n,t)},p:e,d(e){e&&h(n)}}}function $n(e){let t,n,r;return{c(){t=g('No bookmarks found for "'),n=g(e[4]),r=g('"')},m(e,i){c(e,t,i),c(e,n,i),c(e,r,i)},p(e,t){16&t[0]&&w(n,e[4])},d(e){e&&(h(t),h(n),h(r))}}}function Fn(e){let t,n,i,o,s,a,u,f,p,y,w,x,k,_,A,C,S,E,P,O,j,D,B,M,I,K,T,R,z,N,U,W,V,H,Q;function Y(e,t){return e[6]?xn:wn}let G=Y(e),J=G(e);x=new Ee({props:{placeholder:"Search bookmarks...",value:e[4]}}),x.$on("search",e[14]);let X=e[5]&&kn(e);function Z(e,t){return e[2]?Dn:e[3]?jn:"bookmarks"===e[7]?On:"recent"===e[7]?Pn:"domains"===e[7]?En:"folders"===e[7]?Sn:void 0}let ee=Z(e),te=ee&&ee(e);return{c(){var r;t=d("div"),n=d("div"),i=d("div"),o=d("h1"),o.innerHTML='<svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path></svg>\n        Bookmark Insight',s=m(),a=d("div"),u=d("button"),J.c(),p=m(),y=d("button"),y.innerHTML='<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>\n          Dashboard',w=m(),(r=x.$$.fragment)&&r.c(),k=m(),_=d("div"),A=d("button"),C=g("All"),E=m(),P=d("button"),O=g("Recent"),D=m(),B=d("button"),M=g("Domains"),K=m(),T=d("button"),R=g("Folders"),N=m(),X&&X.c(),U=m(),W=d("div"),te&&te.c(),b(o,"class","text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2"),b(u,"class","p-1.5 rounded-md text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"),b(u,"title",f=e[6]?"Switch to light mode":"Switch to dark mode"),b(y,"class","px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors flex items-center gap-1"),b(y,"title","Open full dashboard"),b(a,"class","flex items-center gap-1"),b(i,"class","flex items-center justify-between mb-2"),b(n,"class","flex-shrink-0 p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"),b(A,"class",S="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("bookmarks"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")),b(P,"class",j="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("recent"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")),b(B,"class",I="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("domains"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")),b(T,"class",z="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("folders"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")),b(_,"class","flex-shrink-0 flex border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"),b(W,"class","flex-1 overflow-y-auto svelte-116f20l"),b(t,"class","w-full h-screen overflow-hidden flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors")},m(r,h){c(r,t,h),l(t,n),l(n,i),l(i,o),l(i,s),l(i,a),l(a,u),J.m(u,null),l(a,p),l(a,y),l(n,w),$(x,n,null),l(t,k),l(t,_),l(_,A),l(A,C),l(_,E),l(_,P),l(P,O),l(_,D),l(_,B),l(B,M),l(_,K),l(_,T),l(T,R),l(t,N),X&&X.m(t,null),l(t,U),l(t,W),te&&te.m(W,null),V=!0,H||(Q=[v(u,"click",e[12]),v(y,"click",Un),v(A,"click",e[20]),v(P,"click",e[21]),v(B,"click",e[22]),v(T,"click",e[23])],H=!0)},p(e,n){G!==(G=Y(e))&&(J.d(1),J=G(e),J&&(J.c(),J.m(u,null))),(!V||64&n[0]&&f!==(f=e[6]?"Switch to light mode":"Switch to dark mode"))&&b(u,"title",f);const r={};16&n[0]&&(r.value=e[4]),x.$set(r),(!V||128&n[0]&&S!==(S="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("bookmarks"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")))&&b(A,"class",S),(!V||128&n[0]&&j!==(j="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("recent"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")))&&b(P,"class",j),(!V||128&n[0]&&I!==(I="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("domains"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")))&&b(B,"class",I),(!V||128&n[0]&&z!==(z="flex-1 px-3 py-2 text-xs font-medium transition-colors "+("folders"===e[7]?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300")))&&b(T,"class",z),e[5]?X?X.p(e,n):(X=kn(e),X.c(),X.m(t,U)):X&&(X.d(1),X=null),ee===(ee=Z(e))&&te?te.p(e,n):(te&&te.d(1),te=ee&&ee(e),te&&(te.c(),te.m(W,null)))},i(e){V||(L(x.$$.fragment,e),V=!0)},o(e){!function(e,t,n,r){if(e&&e.o){if(q.has(e))return;q.add(e),(void 0).c.push(()=>{q.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}(x.$$.fragment,e),V=!1},d(e){e&&h(t),J.d(),F(x),X&&X.d(),te&&te.d(),H=!1,r(Q)}}}function Nn(e){e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function Un(){chrome.tabs.create({url:chrome.runtime.getURL("dashboard.html")})}function Wn(e,t){const n=!(e&&(e.shiftKey||e.metaKey||e.ctrlKey));!function(e,t=!0){chrome.tabs.create({url:e,active:t})}(t.url,n)}function Vn(e,t,n){let r,i,o=[],s=!0,a=null,u="",l=null,c=30,h=!1,f="bookmarks",d=[],p=[];async function g(){const e=await se();n(0,o=e.sort((e,t)=>t.dateAdded-e.dateAdded))}async function m(e){try{n(2,s=!0),n(5,l={type:"domain",value:e}),n(4,u=""),n(0,o=await async function(e){try{return await oe.bookmarks.where("domain").equals(e).toArray()}catch(e){return console.error("Error getting bookmarks by domain:",e),[]}}(e))}catch(e){n(3,a=e.message)}finally{n(2,s=!1)}}async function y(e){try{n(2,s=!0),n(5,l={type:"folder",value:e}),n(4,u=""),n(0,o=await async function(e){try{return(await se()).filter(t=>t.folderPath===e)}catch(e){return console.error("Error getting bookmarks by folder:",e),[]}}(e))}catch(e){n(3,a=e.message)}finally{n(2,s=!1)}}async function v(e){try{n(2,s=!0);const t=Date.now(),r=t-24*e*60*60*1e3;n(5,l={type:"recent",value:`Last ${e} days`}),n(4,u=""),n(0,o=await async function(e,t){try{return await oe.bookmarks.where("dateAdded").between(e,t,!0,!0).toArray()}catch(e){return console.error("Error getting bookmarks by date range:",e),[]}}(r,t)),o.sort((e,t)=>t.dateAdded-e.dateAdded)}catch(e){n(3,a=e.message)}finally{n(2,s=!1)}}A(async()=>{const e=await chrome.storage.local.get("darkMode");n(6,h=e.darkMode||!1),Nn(h);try{await g(),await async function(){await he()}(),await async function(){const e=await se(),t={},r={};e.forEach(e=>{e.domain&&(t[e.domain]=(t[e.domain]||0)+1),e.folderPath&&(r[e.folderPath]=(r[e.folderPath]||0)+1)}),n(8,d=Object.entries(t).sort((e,t)=>t[1]-e[1]).slice(0,15).map(([e,t])=>({domain:e,count:t}))),n(9,p=Object.entries(r).sort((e,t)=>t[1]-e[1]).slice(0,15).map(([e,t])=>({folder:e,count:t})))}()}catch(e){n(3,a=e.message)}finally{n(2,s=!1)}});return e.$$.update=()=>{3&e.$$.dirty[0]&&n(11,r=o.slice(0,c)),3&e.$$.dirty[0]&&n(10,i=o.length>c)},[o,c,s,a,u,l,h,f,d,p,i,r,async function(){n(6,h=!h),Nn(h),await chrome.storage.local.set({darkMode:h})},g,async function(e){const t=e.detail.query;n(4,u=t),n(5,l=null);try{if(n(2,s=!0),t){const e=await pn(t);n(0,o=e.results||[])}else await g()}catch(e){n(3,a=e.message)}finally{n(2,s=!1)}},m,y,v,async function(){n(5,l=null),n(4,u=""),n(2,s=!0),await g(),n(2,s=!1)},function(){n(1,c+=30)},()=>n(7,f="bookmarks"),()=>n(7,f="recent"),()=>n(7,f="domains"),()=>n(7,f="folders"),(e,t)=>Wn(t,e),(e,t)=>"Enter"===t.key&&Wn(t,e),e=>v(e.days),e=>m(e),e=>y(e)]}const Hn=new class extends W{constructor(e){super(),U(this,e,Vn,Fn,o,{},null,[-1,-1])}}({target:document.body});var Qn=Object.freeze({__proto__:null,default:{}});export{Hn as default};
