function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s,a;function u(e,t){return e===t||(s||(s=document.createElement("a")),s.href=t,e===s.href)}function c(e,t){e.appendChild(t)}function l(e,t,n){e.insertBefore(t,n||null)}function h(e){e.parentNode&&e.parentNode.removeChild(e)}function f(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function p(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function g(e){return document.createTextNode(e)}function m(){return g(" ")}function y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function v(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function b(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function x(e,t,n){e.classList.toggle(t,!!n)}function k(e){a=e}function _(){if(!a)throw new Error("Function called outside component initialization");return a}function A(e){_().$$.on_mount.push(e)}function O(){const e=_();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}(t,n,{cancelable:r});return i.slice().forEach(t=>{t.call(e,o)}),!o.defaultPrevented}return!0}}const P=[],E=[];let C=[];const S=[],j=Promise.resolve();let D=!1;function B(e){C.push(e)}const K=new Set;let T=0;function M(){if(0!==T)return;const e=a;do{try{for(;T<P.length;){const e=P[T];T++,k(e),I(e.$$)}}catch(e){throw P.length=0,T=0,e}for(k(null),P.length=0,T=0;E.length;)E.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];K.has(t)||(K.add(t),t())}C.length=0}while(P.length);for(;S.length;)S.pop()();D=!1,K.clear(),k(e)}function I(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(B)}}const R=new Set;let q;function $(){q={r:0,c:[],p:q}}function F(){q.r||r(q.c),q=q.p}function N(e,t){e&&e.i&&(R.delete(e),e.i(t))}function z(e,t,n,r){if(e&&e.o){if(R.has(e))return;R.add(e),q.c.push(()=>{R.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function L(e){return void 0!==e?.length?e:Array.from(e)}function U(e,t){z(e,1,1,()=>{t.delete(e.key)})}function V(e){e&&e.c()}function W(e,n,o){const{fragment:s,after_update:a}=e.$$;s&&s.m(n,o),B(()=>{const n=e.$$.on_mount.map(t).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]}),a.forEach(B)}function Y(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];C.forEach(r=>-1===e.indexOf(r)?t.push(r):n.push(r)),n.forEach(e=>e()),C=t}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function H(e,t){-1===e.$$.dirty[0]&&(P.push(e),D||(D=!0,j.then(M)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function G(t,i,o,s,u,c,l=null,f=[-1]){const d=a;k(t);const p=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:i.target||d.$$.root};l&&l(p.root);let g=!1;if(p.ctx=o?o(t,i.props||{},(e,n,...r)=>{const i=r.length?r[0]:n;return p.ctx&&u(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),g&&H(t,e)),n}):[],p.update(),g=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);p.fragment&&p.fragment.l(e),e.forEach(h)}else p.fragment&&p.fragment.c();i.intro&&N(t.$$.fragment),W(t,i.target,i.anchor),M()}k(d)}class J{$$=void 0;$$set=void 0;$destroy(){Y(this,1),this.$destroy=e}$on(t,n){if(!i(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Q(e){return new Date(e).toLocaleDateString()}function X(e){if(e.url.startsWith("http://")||e.url.startsWith("https://")){const t=e.domain.charAt(0).toUpperCase(),n=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899"];return`data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="${n[e.domain.length%n.length]}"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white" font-weight="bold">${t}</text></svg>`}switch(e.domain){case"chrome-internal":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23EA4335"/><circle cx="8" cy="8" r="3" fill="white"/></svg>';case"local-file":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23F59E0B"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">ðŸ“„</text></svg>';case"javascript-bookmarklet":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23F7DF1E"/><text x="8" y="12" font-family="Arial" font-size="8" text-anchor="middle" fill="black" font-weight="bold">JS</text></svg>';case"data-uri":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%2310B981"/><text x="8" y="12" font-family="Arial" font-size="8" text-anchor="middle" fill="white" font-weight="bold">D</text></svg>';case"contact-link":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%238B5CF6"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">@</text></svg>';case"other-protocol":return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%236B7280"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="white">âš¡</text></svg>';default:return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><rect width="16" height="16" fill="%23E5E7EB"/><text x="8" y="12" font-family="Arial" font-size="10" text-anchor="middle" fill="%236B7280">?</text></svg>'}}function Z(e){switch(e.domain){case"chrome-internal":return"Chrome";case"local-file":return"Local File";case"javascript-bookmarklet":return"Bookmarklet";case"data-uri":return"Data URI";case"contact-link":return"Contact";case"other-protocol":return"Other";case"invalid-url":return"Invalid URL";default:return e.domain}}function ee(e){let t,n;return{c(){t=p("svg"),n=p("path"),v(n,"stroke-linecap","round"),v(n,"stroke-linejoin","round"),v(n,"stroke-width","2"),v(n,"d","M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"),v(t,"class","w-4 h-4"),v(t,"fill","none"),v(t,"stroke","currentColor"),v(t,"viewBox","0 0 24 24")},m(e,r){l(e,t,r),c(t,n)},d(e){e&&h(t)}}}function te(e){let t,n;return{c(){t=p("svg"),n=p("path"),v(n,"stroke-linecap","round"),v(n,"stroke-linejoin","round"),v(n,"stroke-width","2"),v(n,"d","M5 13l4 4L19 7"),v(t,"class","w-4 h-4 text-green-500"),v(t,"fill","none"),v(t,"stroke","currentColor"),v(t,"viewBox","0 0 24 24")},m(e,r){l(e,t,r),c(t,n)},d(e){e&&h(t)}}}function ne(e){let t,n,r,i,o=e[0].folderPath+"";return{c(){t=d("p"),n=g("ðŸ“ "),r=g(o),v(t,"class","text-xs text-gray-400 mt-1 truncate"),v(t,"title",i=e[0].folderPath)},m(e,i){l(e,t,i),c(t,n),c(t,r)},p(e,n){1&n&&o!==(o=e[0].folderPath+"")&&b(r,o),1&n&&i!==(i=e[0].folderPath)&&v(t,"title",i)},d(e){e&&h(t)}}}function re(t){let n,i,o,s,a,f,p,w,x,k,_,A,O,P,E,C,S,j,D,B,K,T,M,I,R,q,$=t[0].title+"",F=t[0].url+"",N=Z(t[0])+"",z=Q(t[0].dateAdded)+"";function L(e,t){return e[1]?te:ee}let U=L(t),V=U(t),W=t[0].folderPath&&ne(t);return{c(){n=d("div"),i=d("div"),o=d("img"),a=m(),f=d("div"),p=d("h3"),w=g($),k=m(),_=d("p"),A=g(F),P=m(),E=d("div"),C=d("span"),S=g(N),j=m(),D=d("div"),B=d("button"),V.c(),K=m(),T=d("span"),M=g(z),I=m(),W&&W.c(),u(o.src,s=X(t[0]))||v(o,"src",s),v(o,"alt","Favicon"),v(o,"class","w-4 h-4 mt-1 flex-shrink-0"),v(p,"class","text-sm font-medium text-gray-900 truncate"),v(p,"title",x=t[0].title),v(_,"class","text-xs text-gray-500 truncate mt-1"),v(_,"title",O=t[0].url),v(C,"class","text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded"),v(B,"class","p-1 text-gray-400 hover:text-blue-600 transition-colors"),v(B,"title","Copy URL"),v(T,"class","text-xs text-gray-400"),v(D,"class","flex items-center space-x-2"),v(E,"class","flex items-center justify-between mt-2"),v(f,"class","flex-1 min-w-0"),v(i,"class","flex items-start space-x-3"),v(n,"class","bookmark-card bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer border border-gray-200 svelte-1oo2sed"),v(n,"role","button"),v(n,"tabindex","0")},m(e,r){l(e,n,r),c(n,i),c(i,o),c(i,a),c(i,f),c(f,p),c(p,w),c(f,k),c(f,_),c(_,A),c(f,P),c(f,E),c(E,C),c(C,S),c(E,j),c(E,D),c(D,B),V.m(B,null),c(D,K),c(D,T),c(T,M),c(f,I),W&&W.m(f,null),R||(q=[y(B,"click",t[2]),y(n,"click",t[3]),y(n,"keydown",t[4])],R=!0)},p(e,[t]){1&t&&!u(o.src,s=X(e[0]))&&v(o,"src",s),1&t&&$!==($=e[0].title+"")&&b(w,$),1&t&&x!==(x=e[0].title)&&v(p,"title",x),1&t&&F!==(F=e[0].url+"")&&b(A,F),1&t&&O!==(O=e[0].url)&&v(_,"title",O),1&t&&N!==(N=Z(e[0])+"")&&b(S,N),U!==(U=L(e))&&(V.d(1),V=U(e),V&&(V.c(),V.m(B,null))),1&t&&z!==(z=Q(e[0].dateAdded)+"")&&b(M,z),e[0].folderPath?W?W.p(e,t):(W=ne(e),W.c(),W.m(f,null)):W&&(W.d(1),W=null)},i:e,o:e,d(e){e&&h(n),V.d(),W&&W.d(),R=!1,r(q)}}}function ie(e){chrome.tabs.create({url:e})}function oe(e,t,n){let{bookmark:r}=t;O();let i=!1;return e.$$set=e=>{"bookmark"in e&&n(0,r=e.bookmark)},[r,i,async function(e){e.stopPropagation();const t=await async function(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Failed to copy to clipboard:",e),!1}}(r.url);t&&(n(1,i=!0),setTimeout(()=>n(1,i=!1),2e3))},()=>ie(r.url),e=>"Enter"===e.key&&ie(r.url)]}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class se extends J{constructor(e){super(),G(this,e,oe,re,o,{bookmark:0})}}
/**!
 * FlexSearch.js v0.8.212 (Bundle/Module)
 * Author and Copyright: Thomas Wilkerling
 * Licence: Apache-2.0
 * Hosted by Nextapps GmbH
 * https://github.com/nextapps-de/flexsearch
 */var ae;function ue(e,t,n){const r=typeof n,i=typeof e;if("undefined"!==r){if("undefined"!==i){if(n){if("function"===i&&r===i)return function(t){return e(n(t))};if((t=e.constructor)===n.constructor){if(t===Array)return n.concat(e);if(t===Map){var o=new Map(n);for(var s of e)o.set(s[0],s[1]);return o}if(t===Set){for(o of(s=new Set(n),e.values()))s.add(o);return s}}}return e}return n}return"undefined"===i?t:e}function ce(e,t){return void 0===e?t:e}function le(){return Object.create(null)}function he(e){return"string"==typeof e}function fe(e){return"object"==typeof e}function de(e,t){if(he(t))e=e[t];else for(let n=0;e&&n<t.length;n++)e=e[t[n]];return e}const pe=/[^\p{L}\p{N}]+/u,ge=/(\d{3})/g,me=/(\D)(\d{3})/g,ye=/(\d{3})(\D)/g,ve=/[\u0300-\u036f]/g;function be(e={}){if(!this||this.constructor!==be)return new be(...arguments);if(arguments.length)for(e=0;e<arguments.length;e++)this.assign(arguments[e]);else this.assign(e)}function we(e){e.F=null,e.B.clear(),e.D.clear()}function xe(e,t,n){n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):n=e),n&&(e=n.query||e,t=n.limit||t);let r=""+(t||0);n&&(r+=(n.offset||0)+!!n.context+!!n.suggest+(!1!==n.resolve)+(n.resolution||this.resolution)+(n.boost||0)),e=(""+e).toLowerCase(),this.cache||(this.cache=new ke);let i=this.cache.get(e+r);if(!i){const o=n&&n.cache;o&&(n.cache=!1),i=this.search(e,t,n),o&&(n.cache=o),this.cache.set(e+r,i)}return i}function ke(e){this.limit=e&&!0!==e?e:1e3,this.cache=new Map,this.h=""}(ae=be.prototype).assign=function(e){this.normalize=ue(e.normalize,!0,this.normalize);let t,n=e.include,r=n||e.exclude||e.split;if(r||""===r){if("object"==typeof r&&r.constructor!==RegExp){let e="";t=!n,n||(e+="\\p{Z}"),r.letter&&(e+="\\p{L}"),r.number&&(e+="\\p{N}",t=!!n),r.symbol&&(e+="\\p{S}"),r.punctuation&&(e+="\\p{P}"),r.control&&(e+="\\p{C}"),(r=r.char)&&(e+="object"==typeof r?r.join(""):r);try{this.split=new RegExp("["+(n?"^":"")+e+"]+","u")}catch(e){this.split=/\s+/}}else this.split=r,t=!1===r||"a1a".split(r).length<2;this.numeric=ue(e.numeric,t)}else{try{this.split=ue(this.split,pe)}catch(e){this.split=/\s+/}this.numeric=ue(e.numeric,ue(this.numeric,!0))}if(this.prepare=ue(e.prepare,null,this.prepare),this.finalize=ue(e.finalize,null,this.finalize),r=e.filter,this.filter="function"==typeof r?r:ue(r&&new Set(r),null,this.filter),this.dedupe=ue(e.dedupe,!0,this.dedupe),this.matcher=ue((r=e.matcher)&&new Map(r),null,this.matcher),this.mapper=ue((r=e.mapper)&&new Map(r),null,this.mapper),this.stemmer=ue((r=e.stemmer)&&new Map(r),null,this.stemmer),this.replacer=ue(e.replacer,null,this.replacer),this.minlength=ue(e.minlength,1,this.minlength),this.maxlength=ue(e.maxlength,1024,this.maxlength),this.rtl=ue(e.rtl,!1,this.rtl),(this.cache=r=ue(e.cache,!0,this.cache))&&(this.F=null,this.L="number"==typeof r?r:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const e of this.matcher.keys())this.h+=(this.h?"|":"")+e;if(this.stemmer)for(const e of this.stemmer.keys())this.A+=(this.A?"|":"")+e;return this},ae.addStemmer=function(e,t){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(e,t),this.A+=(this.A?"|":"")+e,this.K=null,this.cache&&we(this),this},ae.addFilter=function(e){return"function"==typeof e?this.filter=e:(this.filter||(this.filter=new Set),this.filter.add(e)),this.cache&&we(this),this},ae.addMapper=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length>1?this.addMatcher(e,t):(this.mapper||(this.mapper=new Map),this.mapper.set(e,t),this.cache&&we(this),this)},ae.addMatcher=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length<2&&(this.dedupe||this.mapper)?this.addMapper(e,t):(this.matcher||(this.matcher=new Map),this.matcher.set(e,t),this.h+=(this.h?"|":"")+e,this.J=null,this.cache&&we(this),this)},ae.addReplacer=function(e,t){return"string"==typeof e?this.addMatcher(e,t):(this.replacer||(this.replacer=[]),this.replacer.push(e,t),this.cache&&we(this),this)},ae.encode=function(e,t){if(this.cache&&e.length<=this.H)if(this.F){if(this.B.has(e))return this.B.get(e)}else this.F=setTimeout(we,50,this);this.normalize&&(e="function"==typeof this.normalize?this.normalize(e):ve?e.normalize("NFKD").replace(ve,"").toLowerCase():e.toLowerCase()),this.prepare&&(e=this.prepare(e)),this.numeric&&e.length>3&&(e=e.replace(me,"$1 $2").replace(ye,"$1 $2").replace(ge,"$1 "));const n=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let r,i,o=[],s=le(),a=this.split||""===this.split?e.split(this.split):[e];for(let e,c,l=0;l<a.length;l++)if((e=c=a[l])&&!(e.length<this.minlength||e.length>this.maxlength)){if(t){if(s[e])continue;s[e]=1}else{if(r===e)continue;r=e}if(n)o.push(e);else if(!this.filter||("function"==typeof this.filter?this.filter(e):!this.filter.has(e))){if(this.cache&&e.length<=this.I)if(this.F){var u=this.D.get(e);if(u||""===u){u&&o.push(u);continue}}else this.F=setTimeout(we,50,this);if(this.stemmer){let t;for(this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));t!==e&&e.length>2;)t=e,e=e.replace(this.K,e=>this.stemmer.get(e))}if(e&&(this.mapper||this.dedupe&&e.length>1)){u="";for(let t,n,r=0,i="";r<e.length;r++)t=e.charAt(r),t===i&&this.dedupe||((n=this.mapper&&this.mapper.get(t))||""===n?n===i&&this.dedupe||!(i=n)||(u+=n):u+=i=t);e=u}if(this.matcher&&e.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),e=e.replace(this.J,e=>this.matcher.get(e))),e&&this.replacer)for(u=0;e&&u<this.replacer.length;u+=2)e=e.replace(this.replacer[u],this.replacer[u+1]);if(this.cache&&c.length<=this.I&&(this.D.set(c,e),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),e){if(e!==c)if(t){if(s[e])continue;s[e]=1}else{if(i===e)continue;i=e}o.push(e)}}}return this.finalize&&(o=this.finalize(o)||o),this.cache&&e.length<=this.H&&(this.B.set(e,o),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),o},ke.prototype.set=function(e,t){this.cache.set(this.h=e,t),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)},ke.prototype.get=function(e){const t=this.cache.get(e);return t&&this.h!==e&&(this.cache.delete(e),this.cache.set(this.h=e,t)),t},ke.prototype.remove=function(e){for(const t of this.cache){const n=t[0];t[1].includes(e)&&this.cache.delete(n)}},ke.prototype.clear=function(){this.cache.clear(),this.h=""};const _e={normalize:!1,numeric:!1,dedupe:!1},Ae={},Oe=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),Pe=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),Ee=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],Ce={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,"ÃŸ":2,d:3,t:3,l:4,m:5,n:5,r:6};var Se={Exact:_e,Default:Ae,Normalize:Ae,LatinBalance:{mapper:Oe},LatinAdvanced:{mapper:Oe,matcher:Pe,replacer:Ee},LatinExtra:{mapper:Oe,replacer:Ee.concat([/(?!^)[aeo]/g,""]),matcher:Pe},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(e){for(let n=0;n<e.length;n++){var t=e[n];let r=t.charAt(0),i=Ce[r];for(let e,n=1;n<t.length&&(e=t.charAt(n),"h"===e||"w"===e||!(e=Ce[e])||e===i||(r+=e,i=e,4!==r.length));n++);e[n]=r}}},CJK:{split:""},LatinExact:_e,LatinDefault:Ae,LatinSimple:Ae};function je(e,t,n,r){let i=[];for(let o,s=0;s<e.index.length;s++)if(o=e.index[s],t>=o.length)t-=o.length;else{const s=(t=o[r?"splice":"slice"](t,n)).length;if(s&&(i=i.length?i.concat(t):t,n-=s,r&&(e.length-=s),!n))break;t=0}return i}function De(e){if(!this||this.constructor!==De)return new De(e);this.index=e?[e]:[],this.length=e?e.length:0;const t=this;return new Proxy([],{get:(e,n)=>"length"===n?t.length:"push"===n?function(e){t.index[t.index.length-1].push(e),t.length++}:"pop"===n?function(){if(t.length)return t.length--,t.index[t.index.length-1].pop()}:"indexOf"===n?function(e){let n=0;for(let r,i,o=0;o<t.index.length;o++){if(r=t.index[o],i=r.indexOf(e),i>=0)return n+i;n+=r.length}return-1}:"includes"===n?function(e){for(let n=0;n<t.index.length;n++)if(t.index[n].includes(e))return!0;return!1}:"slice"===n?function(e,n){return je(t,e||0,n||t.length,!1)}:"splice"===n?function(e,n){return je(t,e||0,n||t.length,!0)}:"constructor"===n?Array:"symbol"!=typeof n?(e=t.index[n/2**31|0])&&e[n]:void 0,set:(e,n,r)=>(e=n/2**31|0,(t.index[e]||(t.index[e]=[]))[n]=r,t.length++,!0)})}function Be(e=8){if(!this||this.constructor!==Be)return new Be(e);this.index=le(),this.h=[],this.size=0,e>32?(this.B=Me,this.A=BigInt(e)):(this.B=Te,this.A=e)}function Ke(e=8){if(!this||this.constructor!==Ke)return new Ke(e);this.index=le(),this.h=[],this.size=0,e>32?(this.B=Me,this.A=BigInt(e)):(this.B=Te,this.A=e)}function Te(e){let t=2**this.A-1;if("number"==typeof e)return e&t;let n=0,r=this.A+1;for(let i=0;i<e.length;i++)n=(n*r^e.charCodeAt(i))&t;return 32===this.A?n+2**31:n}function Me(e){let t=BigInt(2)**this.A-BigInt(1);var n=typeof e;if("bigint"===n)return e&t;if("number"===n)return BigInt(e)&t;n=BigInt(0);let r=this.A+BigInt(1);for(let i=0;i<e.length;i++)n=(n*r^BigInt(e.charCodeAt(i)))&t;return n}let Ie,Re,qe,$e,Fe;async function Ne(e){var t=(e=e.data).task;const n=e.id;let r=e.args;if("init"===t)Re=e.options||{},(t=e.factory)?(Function("return "+t)()(self),Ie=new self.FlexSearch.Index(Re),delete self.FlexSearch):Ie=new Dt(Re),postMessage({id:n});else{let i;"export"===t&&(r[1]?(r[0]=Re.export,r[2]=0,r[3]=1):r=null),"import"===t?r[0]&&(e=await Re.import.call(Ie,r[0]),Ie.import(r[0],e)):((i=r&&Ie[t].apply(Ie,r))&&i.then&&(i=await i),i&&i.await&&(i=await i.await),"search"===t&&i.result&&(i=i.result)),postMessage("search"===t?{id:n,msg:i}:{id:n})}}function ze(e){Ue.call(e,"add"),Ue.call(e,"append"),Ue.call(e,"search"),Ue.call(e,"update"),Ue.call(e,"remove"),Ue.call(e,"searchCache")}function Le(){qe=Fe=0}function Ue(e){this[e+"Async"]=function(){const t=arguments;var n=t[t.length-1];let r;if("function"==typeof n&&(r=n,delete t[t.length-1]),qe?Fe||(Fe=Date.now()-$e>=this.priority*this.priority*3):(qe=setTimeout(Le,0),$e=Date.now()),Fe){const n=this;return new Promise(r=>{setTimeout(function(){r(n[e+"Async"].apply(n,t))},0)})}const i=this[e].apply(this,t);return n=i.then?i:new Promise(e=>e(i)),r&&n.then(r),n}}De.prototype.clear=function(){this.index.length=0},De.prototype.push=function(){},Be.prototype.get=function(e){const t=this.index[this.B(e)];return t&&t.get(e)},Be.prototype.set=function(e,t){var n=this.B(e);let r=this.index[n];r?(n=r.size,r.set(e,t),(n-=r.size)&&this.size++):(this.index[n]=r=new Map([[e,t]]),this.h.push(r),this.size++)},Ke.prototype.add=function(e){var t=this.B(e);let n=this.index[t];n?(t=n.size,n.add(e),(t-=n.size)&&this.size++):(this.index[t]=n=new Set([e]),this.h.push(n),this.size++)},(ae=Be.prototype).has=Ke.prototype.has=function(e){const t=this.index[this.B(e)];return t&&t.has(e)},ae.delete=Ke.prototype.delete=function(e){const t=this.index[this.B(e)];t&&t.delete(e)&&this.size--},ae.clear=Ke.prototype.clear=function(){this.index=le(),this.h=[],this.size=0},ae.values=Ke.prototype.values=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].values())yield t},ae.keys=Ke.prototype.keys=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].keys())yield t},ae.entries=Ke.prototype.entries=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].entries())yield t};let Ve=0;function We(e={},t){function n(n){function s(e){const t=(e=e.data||e).id,n=t&&o.h[t];n&&(n(e.msg),delete o.h[t])}if(this.worker=n,this.h=le(),this.worker)return i?this.worker.on("message",s):this.worker.onmessage=s,e.config?new Promise(function(t){Ve>1e9&&(Ve=0),o.h[++Ve]=function(){t(o)},o.worker.postMessage({id:Ve,task:"init",factory:r,options:e})}):(this.priority=e.priority||4,this.encoder=t||null,this.worker.postMessage({task:"init",factory:r,options:e}),this)}if(!this||this.constructor!==We)return new We(e);let r="undefined"!=typeof self?self._factory:"undefined"!=typeof window?window._factory:null;r&&(r=r.toString());const i="undefined"==typeof window,o=this,s=function(e,t,n){return t?"undefined"!=typeof module?new(require("worker_threads").Worker)(__dirname+"/worker/node.js"):Promise.resolve().then(function(){return Rn}).then(function(e){return new e.Worker(import.meta.dirname+"/node/node.mjs")}):e?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+Ne.toString()],{type:"text/javascript"}))):new window.Worker("string"==typeof n?n:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}(r,i,e.worker);return s.then?s.then(function(e){return n.call(o,e)}):n.call(this,s)}function Ye(e){We.prototype[e]=function(){const t=this,n=[].slice.call(arguments);var r=n[n.length-1];let i;return"function"==typeof r&&(i=r,n.pop()),r=new Promise(function(r){"export"===e&&"function"==typeof n[0]&&(n[0]=null),Ve>1e9&&(Ve=0),t.h[++Ve]=r,t.worker.postMessage({task:e,id:Ve,args:n})}),i?(r.then(i),this):r}}function He(e,t,n,r,i,o){if(e=e[i],r===n.length-1)t[i]=o||e;else if(e)if(e.constructor===Array)for(t=t[i]=Array(e.length),i=0;i<e.length;i++)He(e,t,n,r,i);else t=t[i]||(t[i]=le()),i=n[++r],He(e,t,n,r,i)}function Ge(e,t,n,r,i,o,s,a){if(e=e[s])if(r===t.length-1){if(e.constructor===Array){if(n[r]){for(t=0;t<e.length;t++)i.add(o,e[t],!0,!0);return}e=e.join(" ")}i.add(o,e,a,!0)}else if(e.constructor===Array)for(s=0;s<e.length;s++)Ge(e,t,n,r,i,o,s,a);else s=t[++r],Ge(e,t,n,r,i,o,s,a)}function Je(e,t,n,r){if(!e.length)return e;if(1===e.length)return e=e[0],e=n||e.length>t?e.slice(n,n+t):e,r?ht.call(this,e):e;let i=[];for(let o,s,a=0;a<e.length;a++)if((o=e[a])&&(s=o.length)){if(n){if(n>=s){n-=s;continue}o=o.slice(n,n+t),s=o.length,n=0}if(s>t&&(o=o.slice(0,t),s=t),!i.length&&s>=t)return r?ht.call(this,o):o;if(i.push(o),!(t-=s))break}return i=i.length>1?[].concat.apply([],i):i[0],r?ht.call(this,i):i}function Qe(e,t,n,r){var i=r[0];if(i[0]&&i[0].query)return e[t].apply(e,i);if(!("and"!==t&&"not"!==t||e.result.length||e.await||i.suggest))return r.length>1&&(i=r[r.length-1]),(r=i.resolve)?e.await||e.result:e;let o,s,a,u,c,l=[],h=0,f=0;for(t=0;t<r.length;t++)if(i=r[t]){var d=void 0;if(i.constructor===it)d=i.await||i.result;else if(i.then||i.constructor===Array)d=i;else{h=i.limit||0,f=i.offset||0,a=i.suggest,s=i.resolve,o=((u=i.highlight||e.highlight)||i.enrich)&&s,d=i.queue;let n=i.async||d,r=i.index,p=i.query;if(r?e.index||(e.index=r):r=e.index,p||i.tag){const o=i.field||i.pluck;if(o&&(!p||e.query&&!u||(e.query=p,e.field=o,e.highlight=u),r=r.index.get(o)),d&&(c||e.await)){let o;c=1;const s=e.C.length,a=new Promise(function(e){o=e});(function(t,r){a.h=function(){r.index=null,r.resolve=!1;let i=n?t.searchAsync(r):t.search(r);return i.then?i.then(function(t){return e.C[s]=t=t.result||t,o(t),t}):(i=i.result||i,o(i),i)}})(r,Object.assign({},i)),e.C.push(a),l[t]=a;continue}i.resolve=!1,i.index=null,d=n?r.searchAsync(i):r.search(i),i.resolve=s,i.index=r}else if(i.and)d=Xe(i,"and",r);else if(i.or)d=Xe(i,"or",r);else if(i.not)d=Xe(i,"not",r);else{if(!i.xor)continue;d=Xe(i,"xor",r)}}d.await?(c=1,d=d.await):d.then?(c=1,d=d.then(function(e){return e.result||e})):d=d.result||d,l[t]=d}if(c&&!e.await&&(e.await=new Promise(function(t){e.return=t})),c){const t=Promise.all(l).then(function(r){for(let i=0;i<e.C.length;i++)if(e.C[i]===t){e.C[i]=function(){return n.call(e,r,h,f,o,s,a,u)};break}ot(e)});e.C.push(t)}else{if(!e.await)return n.call(e,l,h,f,o,s,a,u);e.C.push(function(){return n.call(e,l,h,f,o,s,a,u)})}return s?e.await||e.result:e}function Xe(e,t,n){const r=(e=e[t])[0]||e;return r.index||(r.index=n),n=new it(r),e.length>1&&(n=n[t].apply(n,e.slice(1))),n}function Ze(e,t,n,r,i,o,s){return e.length&&(this.result.length&&e.push(this.result),e.length<2?this.result=e[0]:(this.result=at(e,t,n,!1,this.h),n=0)),i&&(this.await=null),i?this.resolve(t,n,r,s):this}function et(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;let a;if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{let r=0;for(let t,n,i=0;i<e.length;i++)if((t=e[i])&&(n=t.length))r<n&&(r=n);else if(!o){r=0;break}r?(this.result=st(e,r,t,n,o,this.h,i),a=!0):this.result=[]}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function tt(e,t,n,r,i,o,s){if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{e:{o=n;var a=this.h;const r=[],s=le();let u=0;for(let t,n=0;n<e.length;n++)if(t=e[n]){u<t.length&&(u=t.length);for(let e,n=0;n<t.length;n++)if(e=t[n])for(let t,n=0;n<e.length;n++)t=e[n],s[t]=s[t]?2:1}for(let n,c=0,l=0;c<u;c++)for(let u,h=0;h<e.length;h++)if((u=e[h])&&(n=u[c]))for(let u,f=0;f<n.length;f++)if(u=n[f],1===s[u])if(o)o--;else if(i){if(r.push(u),r.length===t){e=r;break e}}else{const n=c+(h?a:0);if(r[n]||(r[n]=[]),r[n].push(u),++l===t){e=r;break e}}e=r}this.result=e,a=!0}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function nt(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;if(e.length&&this.result.length){e:{o=n;var a=[];e=new Set(e.flat().flat());for(let n,r=0,s=0;r<this.result.length;r++)if(n=this.result[r])for(let u,c=0;c<n.length;c++)if(u=n[c],!e.has(u))if(o)o--;else if(i){if(a.push(u),a.length===t){e=a;break e}}else if(a[r]||(a[r]=[]),a[r].push(u),++s===t){e=a;break e}e=a}this.result=e,a=!0}return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function rt(e,t,n,r,i){let o,s,a;"string"==typeof i?(o=i,i=""):o=i.template,s=o.indexOf("$1"),a=o.substring(s+2),s=o.substring(0,s);let u=i&&i.boundary,c=!i||!1!==i.clip,l=i&&i.merge&&a&&s&&new RegExp(a+" "+s,"g");var h=0;if("object"==typeof(i=i&&i.ellipsis)){var f=i.template;h=f.length-2,i=i.pattern}let d,p;"string"!=typeof i&&(i=!1===i?"":"..."),h&&(i=f.replace("$1",i)),f=i.length-h,"object"==typeof u&&(d=u.before,0===d&&(d=-1),p=u.after,0===p&&(p=-1),u=u.total||9e5),h=new Map;for(let K,T,M,I=0;I<t.length;I++){let R;if(r)R=t,M=r;else{var g=t[I];if(M=g.field,!M)continue;R=g.result}T=n.get(M),K=T.encoder,"string"!=typeof(g=h.get(K))&&(g=K.encode(e),h.set(K,g));for(let e=0;e<R.length;e++){var m=R[e].doc;if(!m)continue;if(!(m=de(m,M)))continue;var y=m.trim().split(/\s+/);if(!y.length)continue;m="";var v=[];let t=[];for(var b=-1,w=-1,x=0,k=0;k<y.length;k++){var _=y[k],A=K.encode(_);let e;if((A=A.length>1?A.join(" "):A[0])&&_){for(var O=_.length,P=(K.split?_.replace(K.split,""):_).length-A.length,E="",C=0,S=0;S<g.length;S++){var j=g[S];if(j){var D=j.length;D+=P<0?0:P,C&&D<=C||(j=A.indexOf(j))>-1&&(E=(j?_.substring(0,j):"")+s+_.substring(j,j+D)+a+(j+D<O?_.substring(j+D):""),C=D,e=!0)}}E&&(u&&(b<0&&(b=m.length+(m?1:0)),w=m.length+(m?1:0)+E.length,x+=O,t.push(v.length),v.push({match:E})),m+=(m?" ":"")+E)}if(e){if(u&&x>=u)break}else m+=(m?" ":"")+(_=y[k]),u&&v.push({text:_})}if(x=t.length*(o.length-2),d||p||u&&m.length-x>u)if(k=w-b,d>0&&(k+=d),p>0&&(k+=p),k<=(x=u+x-2*f))y=d?b-(d>0?d:0):b-((x-k)/2|0),v=p?w+(p>0?p:0):y+x,c||(y>0&&" "!==m.charAt(y)&&" "!==m.charAt(y-1)&&((y=m.indexOf(" ",y))<0&&(y=0)),v<m.length&&" "!==m.charAt(v-1)&&" "!==m.charAt(v)&&((v=m.lastIndexOf(" ",v))<w?v=w:++v)),m=(y?i:"")+m.substring(y,v)+(v<m.length?i:"");else{for(w=[],b={},x={},k={},_={},A={},E=P=O=0,S=C=1;;){var B=void 0;for(let e,n=0;n<t.length;n++){if(e=t[n],E)if(P!==E){if(k[n+1])continue;if(e+=E,b[e]){O-=f,x[n+1]=1,k[n+1]=1;continue}if(e>=v.length-1){if(e>=v.length){k[n+1]=1,e>=y.length&&(x[n+1]=1);continue}O-=f}if(m=v[e].text,D=p&&A[n]){if(!(D>0)){k[n+1]=1;continue}if(m.length>D){if(k[n+1]=1,!c)continue;m=m.substring(0,D)}(D-=m.length)||(D=-1),A[n]=D}if(O+m.length+1<=u)m=" "+m,w[n]+=m;else{if(!c){k[n+1]=1;continue}(B=u-O-1)>0&&(m=" "+m.substring(0,B),w[n]+=m),k[n+1]=1}}else{if(k[n])continue;if(e-=P,b[e]){O-=f,k[n]=1,x[n]=1;continue}if(e<=0){if(e<0){k[n]=1,x[n]=1;continue}O-=f}if(m=v[e].text,D=d&&_[n]){if(!(D>0)){k[n]=1;continue}if(m.length>D){if(k[n]=1,!c)continue;m=m.substring(m.length-D)}(D-=m.length)||(D=-1),_[n]=D}if(O+m.length+1<=u)m+=" ",w[n]=m+w[n];else{if(!c){k[n]=1;continue}(B=m.length+1-(u-O))>=0&&B<m.length&&(m=m.substring(B)+" ",w[n]=m+w[n]),k[n]=1}}else{let t;if(m=v[e].match,d&&(_[n]=d),p&&(A[n]=p),n&&O++,e?!n&&f&&(O+=f):(x[n]=1,k[n]=1),e>=y.length-1||e<v.length-1&&v[e+1].match?t=1:f&&(O+=f),O-=o.length-2,n&&!(O+m.length<=u)){B=C=S=x[n]=0;break}w[n]=m,t&&(x[n+1]=1,k[n+1]=1)}O+=m.length,B=b[e]=1}if(B)P===E?E++:P++;else{if(P===E?C=0:S=0,!C&&!S)break;C?E=++P:E++}}m="";for(let e,t=0;t<w.length;t++)e=(x[t]?t?" ":"":(t&&!i?" ":"")+i)+w[t],m+=e;i&&!x[w.length]&&(m+=i)}l&&(m=m.replace(l," ")),R[e].highlight=m}if(r)break}return t}function it(e,t){if(!this||this.constructor!==it)return new it(e,t);let n,r,i,o,s,a,u=0;if(e&&e.index){const n=e;if(t=n.index,u=n.boost||0,r=n.query){i=n.field||n.pluck,o=n.highlight;const r=n.resolve;e=n.async||n.queue,n.resolve=!1,n.index=null,e=e?t.searchAsync(n):t.search(n),n.resolve=r,n.index=t,e=e.result||e}else e=[]}if(e&&e.then){const t=this;n=[e=e.then(function(e){t.C[0]=t.result=e.result||e,ot(t)})],e=[],s=new Promise(function(e){a=e})}this.index=t||null,this.result=e||[],this.h=u,this.C=n||[],this.await=s||null,this.return=a||null,this.highlight=o||null,this.query=r||"",this.field=i||""}function ot(e,t){let n=e.result;var r=e.await;e.await=null;for(let t,i=0;i<e.C.length;i++)if(t=e.C[i])if("function"==typeof t)n=t(),e.C[i]=n=n.result||n,i--;else if(t.h)n=t.h(),e.C[i]=n=n.result||n,i--;else if(t.then)return e.await=r;return r=e.return,e.C=[],e.return=null,t||r(n),n}function st(e,t,n,r,i,o,s){const a=e.length;let u,c,l=[];u=le();for(let h,f,d,p,g=0;g<t;g++)for(let t=0;t<a;t++)if(d=e[t],g<d.length&&(h=d[g]))for(let e=0;e<h.length;e++){if(f=h[e],(c=u[f])?u[f]++:(c=0,u[f]=1),p=l[c]||(l[c]=[]),!s){let e=g+(t||!i?0:o||0);p=p[e]||(p[e]=[])}if(p.push(f),s&&n&&c===a-1&&p.length-r===n)return r?p.slice(r):p}if(e=l.length)if(i)l=l.length>1?at(l,n,r,s,o):(l=l[0])&&n&&l.length>n||r?l.slice(r,n+r):l;else{if(e<a)return[];if(l=l[e-1],n||r)if(s)(l.length>n||r)&&(l=l.slice(r,n+r));else{i=[];for(let e,t=0;t<l.length;t++)if(e=l[t])if(r&&e.length>r)r-=e.length;else if((n&&e.length>n||r)&&(e=e.slice(r,n+r),n-=e.length,r&&(r-=e.length)),i.push(e),!n)break;l=i}}return l}function at(e,t,n,r,i){const o=[],s=le();let a;var u=e.length;let c;if(r){for(i=u-1;i>=0;i--)if(c=(r=e[i])&&r.length)for(u=0;u<c;u++)if(a=r[u],!s[a])if(s[a]=1,n)n--;else if(o.push(a),o.length===t)return o}else for(let l,h=u-1,f=0;h>=0;h--){l=e[h];for(let e=0;e<l.length;e++)if(c=(r=l[e])&&r.length)for(let l=0;l<c;l++)if(a=r[l],!s[a])if(s[a]=1,n)n--;else{let n=(e+(h<u-1&&i||0))/(h+1)|0;if((o[n]||(o[n]=[])).push(a),++f===t)return o}}return o}function ut(e,t,n,r,i){const o=le(),s=[];for(let e,n=0;n<t.length;n++){e=t[n];for(let t=0;t<e.length;t++)o[e[t]]=1}if(i){for(let t,i=0;i<e.length;i++)if(t=e[i],o[t])if(r)r--;else if(s.push(t),o[t]=0,n&&0===--n)break}else for(let n,r,i=0;i<e.result.length;i++)for(n=e.result[i],t=0;t<n.length;t++)r=n[t],o[r]&&((s[i]||(s[i]=[])).push(r),o[r]=0);return s}function ct(e){const t=[],n=le(),r=le();for(let i,o,s,a,u,c,l,h=0;h<e.length;h++){i=e[h],o=i.field,s=i.result;for(let e=0;e<s.length;e++)u=s[e],"object"!=typeof u?u={id:a=u}:a=u.id,(c=n[a])?c.push(o):(u.field=n[a]=[o],t.push(u)),(l=u.highlight)&&(c=r[a],c||(r[a]=c={},u.highlight=c),c[o]=l)}return t}function lt(e,t,n,r,i){return(e=this.tag.get(e))&&(e=e.get(t))?((t=e.length-r)>0&&((n&&t>n||r)&&(e=e.slice(r,r+n)),i&&(e=ht.call(this,e))),e):[]}function ht(e){if(!this||!this.store)return e;if(this.db)return this.index.get(this.field[0]).db.enrich(e);const t=Array(e.length);for(let n,r=0;r<e.length;r++)n=e[r],t[r]={id:n,doc:this.store.get(n)};return t}function ft(e){if(!this||this.constructor!==ft)return new ft(e);const t=e.document||e.doc||e;let n,r;if(this.B=[],this.field=[],this.D=[],this.key=(n=t.key||t.id)&&pt(n,this.D)||"id",(r=e.keystore||0)&&(this.keystore=r),this.fastupdate=!!e.fastupdate,this.reg=!this.fastupdate||e.worker||e.db?r?new Ke(r):new Set:r?new Be(r):new Map,this.h=(n=t.store||null)&&n&&!0!==n&&[],this.store=n?r?new Be(r):new Map:null,this.cache=(n=e.cache||null)&&new ke(n),e.cache=!1,this.worker=e.worker||!1,this.priority=e.priority||4,this.index=dt.call(this,e,t),this.tag=null,(n=t.tag)&&("string"==typeof n&&(n=[n]),n.length)){this.tag=new Map,this.A=[],this.F=[];for(let e,t,r=0;r<n.length;r++){if(e=n[r],t=e.field||e,!t)throw Error("The tag field from the document descriptor is undefined.");e.custom?this.A[r]=e.custom:(this.A[r]=pt(t,this.D),e.filter&&("string"==typeof this.A[r]&&(this.A[r]=new String(this.A[r])),this.A[r].G=e.filter)),this.F[r]=t,this.tag.set(t,new Map)}}if(this.worker){this.fastupdate=!1,e=[];for(const t of this.index.values())t.then&&e.push(t);if(e.length){const t=this;return Promise.all(e).then(function(e){let n=0;for(const r of t.index.entries()){const i=r[0];let o=r[1];o.then&&(o=e[n],t.index.set(i,o),n++)}return t})}}else e.db&&(this.fastupdate=!1,this.mount(e.db))}function dt(e,t){const n=new Map;let r=t.index||t.field||t;he(r)&&(r=[r]);for(let t,o,s=0;s<r.length;s++){if(t=r[s],he(t)||(o=t,t=t.field),o=fe(o)?Object.assign({},e,o):e,this.worker){var i=void 0;i=new We(o,i=(i=o.encoder)&&i.encode?i:new be("string"==typeof i?Se[i]:i||{})),n.set(t,i)}this.worker||n.set(t,new Dt(o,this.reg)),o.custom?this.B[s]=o.custom:(this.B[s]=pt(t,this.D),o.filter&&("string"==typeof this.B[s]&&(this.B[s]=new String(this.B[s])),this.B[s].G=o.filter)),this.field[s]=t}if(this.h){he(e=t.store)&&(e=[e]);for(let t,n,r=0;r<e.length;r++)t=e[r],n=t.field||t,t.custom?(this.h[r]=t.custom,t.custom.O=n):(this.h[r]=pt(n,this.D),t.filter&&("string"==typeof this.h[r]&&(this.h[r]=new String(this.h[r])),this.h[r].G=t.filter))}return n}function pt(e,t){const n=e.split(":");let r=0;for(let i=0;i<n.length;i++)"]"===(e=n[i])[e.length-1]&&(e=e.substring(0,e.length-2))&&(t[r]=!0),e&&(n[r++]=e);return r<n.length&&(n.length=r),r>1?n:n[0]}function gt(e,t=0){let n=[],r=[];t&&(t=25e4/t*5e3|0);for(const i of e.entries())r.push(i),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function mt(e,t){t||(t=new Map);for(let n,r=0;r<e.length;r++)n=e[r],t.set(n[0],n[1]);return t}function yt(e,t=0){let n=[],r=[];t&&(t=25e4/t*1e3|0);for(const i of e.entries())r.push([i[0],gt(i[1])[0]||[]]),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function vt(e,t){t||(t=new Map);for(let n,r,i=0;i<e.length;i++)n=e[i],r=t.get(n[0]),t.set(n[0],mt(n[1],r));return t}function bt(e){let t=[],n=[];for(const r of e.keys())n.push(r),25e4===n.length&&(t.push(n),n=[]);return n.length&&t.push(n),t}function wt(e,t){t||(t=new Set);for(let n=0;n<e.length;n++)t.add(e[n]);return t}function xt(e,t,n,r,i,o,s=0){const a=r&&r.constructor===Array;var u=a?r.shift():r;if(!u)return this.export(e,t,i,o+1);if((u=e((t?t+".":"")+(s+1)+"."+n,JSON.stringify(u)))&&u.then){const c=this;return u.then(function(){return xt.call(c,e,t,n,a?r:null,i,o,s+1)})}return xt.call(this,e,t,n,a?r:null,i,o,s+1)}function kt(e,t){let n="";for(const r of e.entries()){e=r[0];const i=r[1];let o="";for(let e,n=0;n<i.length;n++){e=i[n]||[""];let r="";for(let n=0;n<e.length;n++)r+=(r?",":"")+("string"===t?'"'+e[n]+'"':e[n]);r="["+r+"]",o+=(o?",":"")+r}o='["'+e+'",['+o+"]]",n+=(n?",":"")+o}return n}function _t(e,t){let n=0;var r=void 0===t;if(e.constructor===Array){for(let i,o,s,a=0;a<e.length;a++)if((i=e[a])&&i.length){if(r)return 1;if(o=i.indexOf(t),o>=0){if(i.length>1)return i.splice(o,1),1;if(delete e[a],n)return 1;s=1}else{if(s)return 1;n++}}}else for(let i of e.entries())r=i[0],_t(i[1],t)?n++:e.delete(r);return n}Ye("add"),Ye("append"),Ye("search"),Ye("update"),Ye("remove"),Ye("clear"),Ye("export"),Ye("import"),We.prototype.searchCache=xe,ze(We.prototype),ft.prototype.add=function(e,t,n){if(fe(e)&&(e=de(t=e,this.key)),t&&(e||0===e)){if(!n&&this.reg.has(e))return this.update(e,t);for(let o,s=0;s<this.field.length;s++){o=this.B[s];var r=this.index.get(this.field[s]);if("function"==typeof o){var i=o(t);i&&r.add(e,i,n,!0)}else(!(i=o.G)||i(t))&&(o.constructor===String?o=[""+o]:he(o)&&(o=[o]),Ge(t,o,this.D,0,r,e,o[0],n))}if(this.tag)for(r=0;r<this.A.length;r++){var o=this.A[r];i=this.tag.get(this.F[r]);let a=le();if("function"==typeof o){if(!(o=o(t)))continue}else{var s=o.G;if(s&&!s(t))continue;o.constructor===String&&(o=""+o),o=de(t,o)}if(i&&o){he(o)&&(o=[o]);for(let t,r,u=0;u<o.length;u++)if(t=o[u],!a[t]&&(a[t]=1,(s=i.get(t))?r=s:i.set(t,r=[]),!n||!r.includes(e))){if(r.length===2**31-1){if(s=new De(r),this.fastupdate)for(let e of this.reg.values())e.includes(r)&&(e[e.indexOf(r)]=s);i.set(t,r=s)}r.push(e),this.fastupdate&&((s=this.reg.get(e))?s.push(r):this.reg.set(e,[r]))}}}if(this.store&&(!n||!this.store.has(e))){let r;if(this.h){r=le();for(let e,i=0;i<this.h.length;i++){if(e=this.h[i],(n=e.G)&&!n(t))continue;let o;if("function"==typeof e){if(o=e(t),!o)continue;e=[e.O]}else if(he(e)||e.constructor===String){r[e]=t[e];continue}He(t,r,e,0,e[0],o)}}this.store.set(e,r||t)}this.worker&&(this.fastupdate||this.reg.add(e))}return this},it.prototype.or=function(){return Qe(this,"or",Ze,arguments)},it.prototype.and=function(){return Qe(this,"and",et,arguments)},it.prototype.xor=function(){return Qe(this,"xor",tt,arguments)},it.prototype.not=function(){return Qe(this,"not",nt,arguments)},(ae=it.prototype).limit=function(e){if(this.await){const t=this;this.C.push(function(){return t.limit(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)if(n=this.result[r]){if(!(n.length<=e)){t[r]=n.slice(0,e);break}if(t[r]=n,!(e-=n.length))break}this.result=t}return this},ae.offset=function(e){if(this.await){const t=this;this.C.push(function(){return t.offset(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)(n=this.result[r])&&(n.length<=e?e-=n.length:(t[r]=n.slice(e),e=0));this.result=t}return this},ae.boost=function(e){if(this.await){const t=this;this.C.push(function(){return t.boost(e).result})}else this.h+=e;return this},ae.resolve=function(e,t,n,r,i){let o=this.await?ot(this,!0):this.result;if(o.then){const s=this;return o.then(function(){return s.resolve(e,t,n,r,i)})}return o.length&&("object"==typeof e?(r=e.highlight||this.highlight,n=!!r||e.enrich,t=e.offset,e=e.limit):(r=r||this.highlight,n=!!r||n),o=i?n?ht.call(this.index,o):o:Je.call(this.index,o,e||100,t,n)),this.finalize(o,r)},ae.finalize=function(e,t){if(e.then){const n=this;return e.then(function(e){return n.finalize(e,t)})}t&&e.length&&this.query&&(e=rt(this.query,e,this.index.index,this.field,t));const n=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",n&&n(e),e},ft.prototype.search=function(e,t,n,r){n||(!t&&fe(e)?(n=e,e=""):fe(t)&&(n=t,t=0));let i=[];var o=[];let s,a,u,c,l,h,f,d,p=0,g=!0;if(n){n.constructor===Array&&(n={index:n}),e=n.query||e,s=n.pluck,a=n.merge,c=n.boost,h=s||n.field||(h=n.index)&&(h.index?null:h);var m=this.tag&&n.tag;u=n.suggest,g=!1!==n.resolve,l=n.cache,f=g&&this.store&&n.highlight;var y=!!f||g&&this.store&&n.enrich;t=n.limit||t;var v=n.offset||0;if(t||(t=g?100:0),m&&(!this.db||!r)){m.constructor!==Array&&(m=[m]);var b=[];for(let e,t=0;t<m.length;t++)if(e=m[t],e.field&&e.tag){var w=e.tag;if(w.constructor===Array)for(var x=0;x<w.length;x++)b.push(e.field,w[x]);else b.push(e.field,w)}else{w=Object.keys(e);for(let t,n,r=0;r<w.length;r++)if(t=w[r],n=e[t],n.constructor===Array)for(x=0;x<n.length;x++)b.push(t,n[x]);else b.push(t,n)}if(m=b,!e){if(o=[],b.length)for(m=0;m<b.length;m+=2){if(this.db){if(!(r=this.index.get(b[m])))continue;o.push(r=r.db.tag(b[m+1],t,v,y))}else r=lt.call(this,b[m],b[m+1],t,v,y);i.push(g?{field:b[m],tag:b[m+1],result:r}:[r])}if(o.length){const e=this;return Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)g?i[e].result=t[e]:i[e]=t[e];return g?i:new it(i.length>1?st(i,1,0,0,u,c):i[0],e)})}return g?i:new it(i.length>1?st(i,1,0,0,u,c):i[0],this)}}g||s||!(h=h||this.field)||(he(h)?s=h:(h.constructor===Array&&1===h.length&&(h=h[0]),s=h.field||h.index)),h&&h.constructor!==Array&&(h=[h])}h||(h=this.field),b=(this.worker||this.db)&&!r&&[];for(let s,a,c,_=0;_<h.length;_++){if(a=h[_],this.db&&this.tag&&!this.B[_])continue;let A;if(he(a)||(A=a,a=A.field,e=A.query||e,t=ce(A.limit,t),v=ce(A.offset,v),u=ce(A.suggest,u),f=g&&this.store&&ce(A.highlight,f),y=!!f||g&&this.store&&ce(A.enrich,y),l=ce(A.cache,l)),r)s=r[_];else{x=(w=A||n||{}).enrich;var k=this.index.get(a);if(m&&(this.db&&(w.tag=m,w.field=h,d=k.db.support_tag_search),!d&&x&&(w.enrich=!1),d||(w.limit=0,w.offset=0)),s=l?k.searchCache(e,m&&!d?0:t,w):k.search(e,m&&!d?0:t,w),m&&!d&&(w.limit=t,w.offset=v),x&&(w.enrich=x),b){b[_]=s;continue}}if(c=(s=s.result||s)&&s.length,m&&c){if(w=[],x=0,this.db&&r){if(!d)for(k=h.length;k<r.length;k++){let e=r[k];if(e&&e.length)x++,w.push(e);else if(!u)return g?i:new it(i,this)}}else for(let e,t,n=0;n<m.length;n+=2){if(e=this.tag.get(m[n]),!e){if(u)continue;return g?i:new it(i,this)}if(t=(e=e&&e.get(m[n+1]))&&e.length)x++,w.push(e);else if(!u)return g?i:new it(i,this)}if(x){if(s=ut(s,w,t,v,g),c=s.length,!c&&!u)return g?s:new it(s,this);x--}}if(c)o[p]=a,i.push(s),p++;else if(1===h.length)return g?i:new it(i,this)}if(b){if(this.db&&m&&m.length&&!d)for(y=0;y<m.length;y+=2){if(!(o=this.index.get(m[y]))){if(u)continue;return g?i:new it(i,this)}b.push(o.db.tag(m[y+1],t,v,!1))}const r=this;return Promise.all(b).then(function(i){return n&&(n.resolve=g),i.length&&(i=r.search(e,t,n,i)),i})}if(!p)return g?i:new it(i,this);if(s&&(!y||!this.store))return i=i[0],g?i:new it(i,this);for(b=[],v=0;v<o.length;v++){if(m=i[v],y&&m.length&&void 0===m[0].doc&&(this.db?b.push(m=this.index.get(this.field[0]).db.enrich(m)):m=ht.call(this,m)),s)return g?f?rt(e,m,this.index,s,f):m:new it(m,this);i[v]={field:o[v],result:m}}if(y&&this.db&&b.length){const t=this;return Promise.all(b).then(function(n){for(let e=0;e<n.length;e++)i[e].result=n[e];return f&&(i=rt(e,i,t.index,s,f)),a?ct(i):i})}return f&&(i=rt(e,i,this.index,s,f)),a?ct(i):i},(ae=ft.prototype).mount=function(e){let t=this.field;if(this.tag)for(let e,r=0;r<this.F.length;r++){e=this.F[r];var n=void 0;this.index.set(e,n=new Dt({},this.reg)),t===this.field&&(t=t.slice(0)),t.push(e),n.tag=this.tag.get(e)}n=[];const r={db:e.db,type:e.type,fastupdate:e.fastupdate};for(let i,o,s=0;s<t.length;s++){r.field=o=t[s],i=this.index.get(o);const a=new e.constructor(e.id,r);a.id=e.id,n[s]=a.mount(i),i.document=!0,s?i.bypass=!0:i.store=this.store}const i=this;return this.db=Promise.all(n).then(function(){i.db=!0})},ae.commit=async function(){const e=[];for(const t of this.index.values())e.push(t.commit());await Promise.all(e),this.reg.clear()},ae.destroy=function(){const e=[];for(const t of this.index.values())e.push(t.destroy());return Promise.all(e)},ae.append=function(e,t){return this.add(e,t,!0)},ae.update=function(e,t){return this.remove(e).add(e,t)},ae.remove=function(e){for(var t of(fe(e)&&(e=de(e,this.key)),this.index.values()))t.remove(e,!0);if(this.reg.has(e)){if(this.tag&&!this.fastupdate)for(let n of this.tag.values())for(let r of n){t=r[0];const i=r[1],o=i.indexOf(e);o>-1&&(i.length>1?i.splice(o,1):n.delete(t))}this.store&&this.store.delete(e),this.reg.delete(e)}return this.cache&&this.cache.remove(e),this},ae.clear=function(){const e=[];for(const t of this.index.values()){const n=t.clear();n.then&&e.push(n)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),e.length?Promise.all(e):this},ae.contain=function(e){return this.db?this.index.get(this.field[0]).db.has(e):this.reg.has(e)},ae.cleanup=function(){for(const e of this.index.values())e.cleanup();return this},ae.get=function(e){return this.db?this.index.get(this.field[0]).db.enrich(e).then(function(e){return e[0]&&e[0].doc||null}):this.store.get(e)||null},ae.set=function(e,t){return"object"==typeof e&&(e=de(t=e,this.key)),this.store.set(e,t),this},ae.searchCache=xe,ae.export=function(e,t,n=0,r=0){if(n<this.field.length){const i=this.field[n];if((t=this.index.get(i).export(e,i,n,r=1))&&t.then){const r=this;return t.then(function(){return r.export(e,i,n+1)})}return this.export(e,i,n+1)}let i,o;switch(r){case 0:i="reg",o=bt(this.reg),t=null;break;case 1:i="tag",o=this.tag&&yt(this.tag,this.reg.size),t=null;break;case 2:i="doc",o=this.store&&gt(this.store),t=null;break;default:return}return xt.call(this,e,t,i,o||null,n,r)},ae.import=function(e,t){var n=e.split(".");"json"===n[n.length-1]&&n.pop();const r=n.length>2?n[0]:"";if(n=n.length>2?n[2]:n[1],this.worker&&r)return this.index.get(r).import(e);if(t){if("string"==typeof t&&(t=JSON.parse(t)),r)return this.index.get(r).import(n,t);switch(n){case"reg":this.fastupdate=!1,this.reg=wt(t,this.reg);for(let e,t=0;t<this.field.length;t++)e=this.index.get(this.field[t]),e.fastupdate=!1,e.reg=this.reg;if(this.worker){t=[];for(const n of this.index.values())t.push(n.import(e));return Promise.all(t)}break;case"tag":this.tag=vt(t,this.tag);break;case"doc":this.store=mt(t,this.store)}}},ze(ft.prototype),Dt.prototype.remove=function(e,t){const n=this.reg.size&&(this.fastupdate?this.reg.get(e):this.reg.has(e));if(n){if(this.fastupdate){for(let t,r,i=0;i<n.length;i++)if((t=n[i])&&(r=t.length))if(t[r-1]===e)t.pop();else{const n=t.indexOf(e);n>=0&&t.splice(n,1)}}else _t(this.map,e),this.depth&&_t(this.ctx,e);t||this.reg.delete(e)}return this.db&&(this.commit_task.push({del:e}),this.M&&Bt(this)),this.cache&&this.cache.remove(e),this};const At={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};function Ot(e,t,n,r,i,o,s){let a,u;if(!(a=t[n])||s&&!a[s]){if(s?((t=a||(t[n]=le()))[s]=1,u=e.ctx,(a=u.get(s))?u=a:u.set(s,u=e.keystore?new Be(e.keystore):new Map)):(u=e.map,t[n]=1),(a=u.get(n))?u=a:u.set(n,u=a=[]),o)for(let n,o=0;o<a.length;o++)if((n=a[o])&&n.includes(i)){if(o<=r)return;n.splice(n.indexOf(i),1),e.fastupdate&&(t=e.reg.get(i))&&t.splice(t.indexOf(n),1);break}if(u=u[r]||(u[r]=[]),u.push(i),u.length===2**31-1){if(t=new De(u),e.fastupdate)for(let n of e.reg.values())n.includes(u)&&(n[n.indexOf(u)]=t);a[r]=u=t}e.fastupdate&&((r=e.reg.get(i))?r.push(u):e.reg.set(i,[u]))}}function Pt(e,t,n,r,i){return n&&e>1?t+(r||0)<=e?n+(i||0):(e-1)/(t+(r||0))*(n+(i||0))+1|0:0}function Et(e,t,n,r,i,o,s){let a=e.length,u=e;if(a>1)u=st(e,t,n,r,i,o,s);else if(1===a)return s?Je.call(null,e[0],n,r):new it(e[0],this);return s?u:new it(u,this)}function Ct(e,t,n,r,i,o,s){return e=jt(this,e,t,n,r,i,o,s),this.db?e.then(function(e){return i?e||[]:new it(e,this)}):e&&e.length?i?Je.call(this,e,n,r):new it(e,this):i?[]:new it([],this)}function St(e,t,n,r){let i=[];if(e&&e.length){if(e.length<=r)return void t.push(e);for(let t,n=0;n<r;n++)(t=e[n])&&(i[n]=t);if(i.length)return void t.push(i)}if(!n)return i}function jt(e,t,n,r,i,o,s,a){let u;return n&&(u=e.bidirectional&&t>n)&&(u=n,n=t,t=u),e.db?e.db.get(t,n,r,i,o,s,a):e=n?(e=e.ctx.get(n))&&e.get(t):e.map.get(t)}function Dt(e,t){if(!this||this.constructor!==Dt)return new Dt(e);if(e){var n=he(e)?e:e.preset;n&&(e=Object.assign({},At[n],e))}else e={};const r=!0===(n=e.context)?{depth:1}:n||{},i=he(e.encoder)?Se[e.encoder]:e.encode||e.encoder||{};this.encoder=i.encode?i:"object"==typeof i?new be(i):{encode:i},this.resolution=e.resolution||9,this.tokenize=n=(n=e.tokenize)&&"default"!==n&&"exact"!==n&&n||"strict",this.depth="strict"===n&&r.depth||0,this.bidirectional=!1!==r.bidirectional,this.fastupdate=!!e.fastupdate,this.score=e.score||null,(n=e.keystore||0)&&(this.keystore=n),this.map=n?new Be(n):new Map,this.ctx=n?new Be(n):new Map,this.reg=t||(this.fastupdate?n?new Be(n):new Map:n?new Ke(n):new Set),this.N=r.resolution||3,this.rtl=i.rtl||e.rtl||!1,this.cache=(n=e.cache||null)&&new ke(n),this.resolve=!1!==e.resolve,(n=e.db)&&(this.db=this.mount(n)),this.M=!1!==e.commit,this.commit_task=[],this.commit_timer=null,this.priority=e.priority||4}function Bt(e){e.commit_timer||(e.commit_timer=setTimeout(function(){e.commit_timer=null,e.db.commit(e)},1))}Dt.prototype.add=function(e,t,n,r){if(t&&(e||0===e)){if(!r&&!n&&this.reg.has(e))return this.update(e,t);r=this.depth;const c=(t=this.encoder.encode(t,!r)).length;if(c){const l=le(),h=le(),f=this.resolution;for(let d=0;d<c;d++){let p=t[this.rtl?c-1-d:d];var i=p.length;if(i&&(r||!h[p])){var o=this.score?this.score(t,p,d,null,0):Pt(f,c,d),s="";switch(this.tokenize){case"tolerant":if(Ot(this,h,p,o,e,n),i>2){for(let t,r,a,u,c=1;c<i-1;c++)t=p.charAt(c),r=p.charAt(c+1),a=p.substring(0,c)+r,u=p.substring(c+2),Ot(this,h,s=a+t+u,o,e,n),Ot(this,h,s=a+u,o,e,n);Ot(this,h,p.substring(0,p.length-1),o,e,n)}break;case"full":if(i>2){for(let r,u=0;u<i;u++)for(o=i;o>u;o--){s=p.substring(u,o),r=this.rtl?i-1-u:u;var a=this.score?this.score(t,p,d,s,r):Pt(f,c,d,i,r);Ot(this,h,s,a,e,n)}break}case"bidirectional":case"reverse":if(i>1){for(a=i-1;a>0;a--){s=p[this.rtl?i-1-a:a]+s;var u=this.score?this.score(t,p,d,s,a):Pt(f,c,d,i,a);Ot(this,h,s,u,e,n)}s=""}case"forward":if(i>1){for(a=0;a<i;a++)Ot(this,h,s+=p[this.rtl?i-1-a:a],o,e,n);break}default:if(Ot(this,h,p,o,e,n),r&&c>1&&d<c-1)for(i=this.N,s=p,o=Math.min(r+1,this.rtl?d+1:c-d),a=1;a<o;a++){p=t[this.rtl?c-1-d-a:d+a];Ot(this,l,(u=this.bidirectional&&p>s)?s:p,this.score?this.score(t,s,d,p,a-1):Pt(i+(c/2>i?0:1),c,d,o-1,a-1),e,n,u?p:s)}}}}this.fastupdate||this.reg.add(e)}}return this.db&&(this.commit_task.push(n?{ins:e}:{del:e}),this.M&&Bt(this)),this},Dt.prototype.search=function(e,t,n){if(n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):(n=e,e="")),n&&n.cache)return n.cache=!1,e=this.searchCache(e,t,n),n.cache=!0,e;let r,i,o,s,a,u,c,l,h=[],f=0;n&&(e=n.query||e,t=n.limit||t,f=n.offset||0,i=n.context,o=n.suggest,l=(s=n.resolve)&&n.enrich,u=n.boost,c=n.resolution,a=this.db&&n.tag),void 0===s&&(s=this.resolve),i=this.depth&&!1!==i;let d=this.encoder.encode(e,!i);if(r=d.length,t=t||(s?100:0),1===r)return Ct.call(this,d[0],"",t,f,s,l,a);if(2===r&&i&&!o)return Ct.call(this,d[1],d[0],t,f,s,l,a);let p,g=le(),m=0;if(i&&(p=d[0],m=1),c||0===c||(c=p?this.N:this.resolution),this.db){if(this.db.search&&!1!==(n=this.db.search(this,d,t,f,o,s,l,a)))return n;const e=this;return async function(){for(let t,n;m<r;m++){if((n=d[m])&&!g[n]){if(g[n]=1,t=await jt(e,n,p,0,0,!1,!1),t=St(t,h,o,c)){h=t;break}p&&(o&&t&&h.length||(p=n))}o&&p&&m===r-1&&!h.length&&(c=e.resolution,p="",m=-1,g=le())}return Et(h,c,t,f,o,u,s)}()}for(let e,t;m<r;m++){if((t=d[m])&&!g[t]){if(g[t]=1,e=jt(this,t,p,0,0,!1,!1),e=St(e,h,o,c)){h=e;break}p&&(o&&e&&h.length||(p=t))}o&&p&&m===r-1&&!h.length&&(c=this.resolution,p="",m=-1,g=le())}return Et(h,c,t,f,o,u,s)},(ae=Dt.prototype).mount=function(e){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),e.mount(this)},ae.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)},ae.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()},ae.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this},ae.append=function(e,t){return this.add(e,t,!0)},ae.contain=function(e){return this.db?this.db.has(e):this.reg.has(e)},ae.update=function(e,t){const n=this,r=this.remove(e);return r&&r.then?r.then(()=>n.add(e,t)):this.add(e,t)},ae.cleanup=function(){return this.fastupdate?(_t(this.map),this.depth&&_t(this.ctx),this):this},ae.searchCache=xe,ae.export=function(e,t,n=0,r=0){let i,o;switch(r){case 0:i="reg",o=bt(this.reg);break;case 1:i="cfg",o=null;break;case 2:i="map",o=gt(this.map,this.reg.size);break;case 3:i="ctx",o=yt(this.ctx,this.reg.size);break;default:return}return xt.call(this,e,t,i,o,n,r)},ae.import=function(e,t){if(t)switch("string"==typeof t&&(t=JSON.parse(t)),e=e.split("."),"json"===e[e.length-1]&&e.pop(),3===e.length&&e.shift(),e=e.length>1?e[1]:e[0],e){case"reg":this.fastupdate=!1,this.reg=wt(t,this.reg);break;case"map":this.map=mt(t,this.map);break;case"ctx":this.ctx=vt(t,this.ctx)}},ae.serialize=function(e=!0){let t="",n="",r="";if(this.reg.size){let e;for(var i of this.reg.keys())e||(e=typeof i),t+=(t?",":"")+("string"===e?'"'+i+'"':i);t="index.reg=new Set(["+t+"]);",n=kt(this.map,e),n="index.map=new Map(["+n+"]);";for(const t of this.ctx.entries()){i=t[0];let n=kt(t[1],e);n="new Map(["+n+"])",n='["'+i+'",'+n+"]",r+=(r?",":"")+n}r="index.ctx=new Map(["+r+"]);"}return e?"function inject(index){"+t+n+r+"}":t+n+r},ze(Dt.prototype);const Kt="undefined"!=typeof window&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),Tt=["map","ctx","tag","reg","cfg"],Mt=le();function It(e,t,n){const r=e.value;let i,o=0;for(let e,s=0;s<r.length;s++){if(e=n?r:r[s]){for(let n,o,a=0;a<t.length;a++)if(o=t[a],n=e.indexOf(o),n>=0){if(i=1,!(e.length>1)){r[s]=[];break}e.splice(n,1)}o+=e.length}if(n)break}o?i&&e.update(r):e.delete(),e.continue()}function Rt(e,t){return new Promise((n,r)=>{e.onsuccess=e.oncomplete=function(){t&&t(this.result),t=null,n(this.result)},e.onerror=e.onblocked=r,e=null})}ae=function e(t,n={}){if(!this||this.constructor!==e)return new e(t,n);"object"==typeof t&&(n=t,t=t.name),t||console.info("Default storage space was used, because a name was not passed."),this.id="flexsearch"+(t?":"+t.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=n.field?n.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=n.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}.prototype,ae.mount=function(e){return e.index?e.mount(this):(e.db=this,this.open())},ae.open=function(){if(this.db)return this.db;let e=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),Mt[e.id]||(Mt[e.id]=[]),Mt[e.id].push(e.field);const t=Kt.open(e.id,1);return t.onupgradeneeded=function(){const t=e.db=this.result;for(let n,r=0;r<Tt.length;r++){n=Tt[r];for(let r,i=0;i<Mt[e.id].length;i++)r=Mt[e.id][i],t.objectStoreNames.contains(n+("reg"!==n&&r?":"+r:""))||t.createObjectStore(n+("reg"!==n&&r?":"+r:""))}},e.db=Rt(t,function(t){e.db=t,e.db.onversionchange=function(){e.close()}})},ae.close=function(){this.db&&this.db.close(),this.db=null},ae.destroy=function(){return Rt(Kt.deleteDatabase(this.id))},ae.clear=function(){const e=[];for(let t,n=0;n<Tt.length;n++){t=Tt[n];for(let n,r=0;r<Mt[this.id].length;r++)n=Mt[this.id][r],e.push(t+("reg"!==t&&n?":"+n:""))}const t=this.db.transaction(e,"readwrite");for(let n=0;n<e.length;n++)t.objectStore(e[n]).clear();return Rt(t)},ae.get=function(e,t,n=0,r=0,i=!0,o=!1){e=this.db.transaction((t?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((t?"ctx":"map")+(this.field?":"+this.field:"")).get(t?t+":"+e:e);const s=this;return Rt(e).then(function(e){let t=[];if(!e||!e.length)return t;if(i){if(!n&&!r&&1===e.length)return e[0];for(let i,o=0;o<e.length;o++)if((i=e[o])&&i.length){if(r>=i.length){r-=i.length;continue}const e=n?r+Math.min(i.length-r,n):i.length;for(let n=r;n<e;n++)t.push(i[n]);if(r=0,t.length===n)break}return o?s.enrich(t):t}return e})},ae.tag=function(e,t=0,n=0,r=!1){e=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(e);const i=this;return Rt(e).then(function(e){return!e||!e.length||n>=e.length?[]:t||n?(e=e.slice(n,n+t),r?i.enrich(e):e):e})},ae.enrich=function(e){"object"!=typeof e&&(e=[e]);const t=this.db.transaction("reg","readonly").objectStore("reg"),n=[];for(let r=0;r<e.length;r++)n[r]=Rt(t.get(e[r]));return Promise.all(n).then(function(t){for(let n=0;n<t.length;n++)t[n]={id:e[n],doc:t[n]?JSON.parse(t[n]):null};return t})},ae.has=function(e){return Rt(e=this.db.transaction("reg","readonly").objectStore("reg").getKey(e)).then(function(e){return!!e})},ae.search=null,ae.info=function(){},ae.transaction=function(e,t,n){e+="reg"!==e&&this.field?":"+this.field:"";let r=this.h[e+":"+t];if(r)return n.call(this,r);let i=this.db.transaction(e,t);this.h[e+":"+t]=r=i.objectStore(e);const o=n.call(this,r);return this.h[e+":"+t]=null,Rt(i).finally(function(){return o})},ae.commit=async function(e){let t=e.commit_task,n=[];e.commit_task=[];for(let e,r=0;r<t.length;r++)e=t[r],e.del&&n.push(e.del);n.length&&await this.remove(n),e.reg.size&&(await this.transaction("map","readwrite",function(t){for(const n of e.map){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;var i;if(n&&n.length){const e=Math.max(n.length,r.length);for(let t,o,s=0;s<e;s++)if((o=r[s])&&o.length){if((t=n[s])&&t.length)for(i=0;i<o.length;i++)t.push(o[i]);else n[s]=o;i=1}}else n=r,i=1;i&&t.put(n,e)})}}),await this.transaction("ctx","readwrite",function(t){for(const n of e.ctx){const e=n[0],r=n[1];for(const n of r){const r=n[0],i=n[1];i.length&&(t.get(e+":"+r).onsuccess=function(){let n=this.result;var o;if(n&&n.length){const e=Math.max(n.length,i.length);for(let t,r,s=0;s<e;s++)if((r=i[s])&&r.length){if((t=n[s])&&t.length)for(o=0;o<r.length;o++)t.push(r[o]);else n[s]=r;o=1}}else n=i,o=1;o&&t.put(n,e+":"+r)})}}}),e.store?await this.transaction("reg","readwrite",function(t){for(const n of e.store){const e=n[0],r=n[1];t.put("object"==typeof r?JSON.stringify(r):1,e)}}):e.bypass||await this.transaction("reg","readwrite",function(t){for(const n of e.reg.keys())t.put(1,n)}),e.tag&&await this.transaction("tag","readwrite",function(t){for(const n of e.tag){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;n=n&&n.length?n.concat(r):r,t.put(n,e)})}}),e.map.clear(),e.ctx.clear(),e.tag&&e.tag.clear(),e.store&&e.store.clear(),e.document||e.reg.clear())},ae.remove=function(e){return"object"!=typeof e&&(e=[e]),Promise.all([this.transaction("map","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&It(t,e)}}),this.transaction("ctx","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&It(t,e)}}),this.transaction("tag","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&It(t,e,!0)}}),this.transaction("reg","readwrite",function(t){for(let n=0;n<e.length;n++)t.delete(e[n])})])};const qt=ft;var $t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ft(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Nt={exports:{}};Nt.exports=function(){
/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.
	    Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.
	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:$t,o=Object.keys,s=Array.isArray;function a(e,t){return"object"!=typeof t||o(t).forEach(function(n){e[n]=t[n]}),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var u=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function h(e,t){"function"==typeof t&&(t=t(u(e))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(t).forEach(function(n){d(e,n,t[n])})}var f=Object.defineProperty;function d(e,t,n,r){f(e,t,a(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}var g=Object.getOwnPropertyDescriptor;function m(e,t){var n;return g(e,t)||(n=u(e))&&m(n,t)}var y=[].slice;function v(e,t,n){return y.call(e,t,n)}function b(e,t){return t(e)}function w(e){if(!e)throw new Error("Assertion Failed")}function x(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function k(e,t){return e.reduce(function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function _(e,t){if("string"==typeof t&&l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=_(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return null==a?void 0:_(a,t.substr(s+1))}}function A(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){w("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)A(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var a=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?s(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var c=e[a];c&&l(e,a)||(c=e[a]={}),A(c,u,n)}}else void 0===n?s(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function O(e,t){"string"==typeof t?A(e,t,void 0):"length"in t&&[].map.call(t,function(t){A(e,t,void 0)})}function P(e){var t={};for(var n in e)l(e,n)&&(t[n]=e[n]);return t}var E=[].concat;function C(e){return E.apply([],e)}var S="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return i[e]}),j=new Set(S.map(function(e){return i[e]}));function D(e){var t={};for(var n in e)if(l(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||j.has(r.constructor)?r:D(r)}return t}function B(e){for(var t in e)if(l(e,t))return!1;return!0}var K=null;function T(e){K=new WeakMap;var t=M(e);return K=null,t}function M(e){if(!e||"object"!=typeof e)return e;var t=K.get(e);if(t)return t;if(s(e)){t=[],K.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(M(e[n]))}else if(j.has(e.constructor))t=e;else{var i=u(e);for(var o in t=i===Object.prototype?{}:Object.create(i),K.set(e,t),e)l(e,o)&&(t[o]=M(e[o]))}return t}var I={}.toString;function R(e){return I.call(e).slice(8,-1)}var q="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",$="symbol"==typeof q?function(e){var t;return null!=e&&(t=e[q])&&t.apply(e)}:function(){return null};function F(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var N={};function z(e){var t,n,r,i;if(1===arguments.length){if(s(e))return e.slice();if(this===N&&"string"==typeof e)return[e];if(i=$(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var L="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},U=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(U),W={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Y(e,t){this.name=e,this.message=t}function H(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function G(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=H(e,t)}function J(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=H(e,this.failures)}p(Y).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(G).from(Y),p(J).from(Y);var Q=V.reduce(function(e,t){return e[t]=t+"Error",e},{}),X=Y,Z=V.reduce(function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=W[t]||n,this.inner=null)}return p(r).from(X),e[t]=r,e},{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var ee=U.reduce(function(e,t){return e[t+"Error"]=Z[t],e},{});function te(e,t){if(!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ee[e.name])return e;var n=new ee[e.name](t||e.message,e);return"stack"in e&&d(n,"stack",{get:function(){return this.inner.stack}}),n}var ne=V.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Z[t]),e},{});function re(){}function ie(e){return e}function oe(e,t){return null==e||e===ie?t:function(n){return t(e(n))}}function se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ae(e,t){return e===re?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?se(i,this.onerror):i),void 0!==o?o:n}}function ue(e,t){return e===re?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?se(r,this.onerror):r)}}function ce(e,t){return e===re?t:function(n){var r=e.apply(this,arguments);a(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?se(i,this.onsuccess):i),o&&(this.onerror=this.onerror?se(o,this.onerror):o),void 0===r?void 0===s?void 0:s:a(r,s)}}function le(e,t){return e===re?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function he(e,t){return e===re?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}ne.ModifyError=G,ne.DexieError=Y,ne.BulkError=J;var fe="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function de(e,t){fe=e}var pe={},ge=100,me="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,u(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,u(t),e]}(),ye=me[0],ve=me[1],be=me[2],we=ve&&ve.then,xe=ye&&ye.constructor,ke=!!be;function _e(){queueMicrotask(Le)}var Ae=function(e,t){Be.push([e,t]),Pe&&(_e(),Pe=!1)},Oe=!0,Pe=!0,Ee=[],Ce=[],Se=ie,je={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:re,pgp:!1,env:{},finalize:re},De=je,Be=[],Ke=0,Te=[];function Me(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=De;if("function"!=typeof e){if(e!==pe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&$e(this,this._value))}this._state=null,this._value=null,++t.ref,qe(this,e)}var Ie={get:function(){var e=De,t=nt;function n(n,r){var i=this,o=!e.global&&(e!==De||t!==nt),s=o&&!st(),a=new Me(function(t,a){Ne(i,new Re(dt(n,e,o,s),dt(r,e,o,s),t,a,e))});return this._consoleTask&&(a._consoleTask=this._consoleTask),a}return n.prototype=pe,n},set:function(e){d(this,"then",e&&e.prototype===pe?Ie:{get:function(){return e},set:Ie.set})}};function Re(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function qe(e,t){try{t(function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ue();t&&"function"==typeof t.then?qe(e,function(e,n){t instanceof Me?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,Fe(e)),n&&Ve()}},$e.bind(null,e))}catch(t){$e(e,t)}}function $e(e,t){if(Ce.push(t),null===e._state){var n=e._lib&&Ue();t=Se(t),e._state=!1,e._value=t,He(e),Fe(e),n&&Ve()}}function Fe(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ne(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Ke&&(++Ke,Ae(function(){0===--Ke&&We()},[]))}function Ne(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ke,Ae(ze,[n,e,t])}else e._listeners.push(t)}function ze(e,t,n){try{var r,i=t._value;!t._state&&Ce.length&&(Ce=[]),r=fe&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||-1!==Ce.indexOf(i)||Ge(t),n.resolve(r)}catch(e){n.reject(e)}finally{0===--Ke&&We(),--n.psd.ref||n.psd.finalize()}}function Le(){ft(je,function(){Ue()&&Ve()})}function Ue(){var e=Oe;return Oe=!1,Pe=!1,e}function Ve(){var e,t,n;do{for(;Be.length>0;)for(e=Be,Be=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Be.length>0);Oe=!0,Pe=!0}function We(){var e=Ee;Ee=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Te.slice(0),n=t.length;n;)t[--n]()}function Ye(e){function t(){e(),Te.splice(Te.indexOf(t),1)}Te.push(t),++Ke,Ae(function(){0===--Ke&&We()},[])}function He(e){Ee.some(function(t){return t._value===e._value})||Ee.push(e)}function Ge(e){for(var t=Ee.length;t;)if(Ee[--t]._value===e._value)return void Ee.splice(t,1)}function Je(e){return new Me(pe,!1,e)}function Qe(e,t){var n=De;return function(){var r=Ue(),i=De;try{return lt(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{lt(i,!1),r&&Ve()}}}h(Me.prototype,{then:Ie,_then:function(e,t){Ne(this,new Re(null,null,e,t,De))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):Je(e)}):this.then(null,function(e){return e&&e.name===t?n(e):Je(e)})},finally:function(e){return this.then(function(t){return Me.resolve(e()).then(function(){return t})},function(t){return Me.resolve(e()).then(function(){return Je(t)})})},timeout:function(e,t){var n=this;return e<1/0?new Me(function(r,i){var o=setTimeout(function(){return i(new Z.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(Me.prototype,Symbol.toStringTag,"Dexie.Promise"),je.env=ht(),h(Me,{all:function(){var e=z.apply(null,arguments).map(at);return new Me(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(i,o){return Me.resolve(i).then(function(n){e[o]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof Me?e:e&&"function"==typeof e.then?new Me(function(t,n){e.then(t,n)}):new Me(pe,!0,e)},reject:Je,race:function(){var e=z.apply(null,arguments).map(at);return new Me(function(t,n){e.map(function(e){return Me.resolve(e).then(t,n)})})},PSD:{get:function(){return De},set:function(e){return De=e}},totalEchoes:{get:function(){return nt}},newPSD:it,usePSD:ft,scheduler:{get:function(){return Ae},set:function(e){Ae=e}},rejectionMapper:{get:function(){return Se},set:function(e){Se=e}},follow:function(e,t){return new Me(function(n,r){return it(function(t,n){var r=De;r.unhandleds=[],r.onunhandled=n,r.finalize=se(function(){var e=this;Ye(function(){0===e.unhandleds.length?t():n(e.unhandleds[0])})},r.finalize),e()},t,n,r)})}}),xe&&(xe.allSettled&&d(Me,"allSettled",function(){var e=z.apply(null,arguments).map(at);return new Me(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(e,i){return Me.resolve(e).then(function(e){return r[i]={status:"fulfilled",value:e}},function(e){return r[i]={status:"rejected",reason:e}}).then(function(){return--n||t(r)})})})}),xe.any&&"undefined"!=typeof AggregateError&&d(Me,"any",function(){var e=z.apply(null,arguments).map(at);return new Me(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(e,o){return Me.resolve(e).then(function(e){return t(e)},function(e){i[o]=e,--r||n(new AggregateError(i))})})})}),xe.withResolvers&&(Me.withResolvers=xe.withResolvers));var Xe={awaits:0,echoes:0,id:0},Ze=0,et=[],tt=0,nt=0,rt=0;function it(e,t,n,r){var i=De,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++rt,je.env,o.env=ke?{Promise:Me,PromiseProp:{value:Me,configurable:!0,writable:!0},all:Me.all,race:Me.race,allSettled:Me.allSettled,any:Me.any,resolve:Me.resolve,reject:Me.reject}:{},t&&a(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=ft(o,e,n,r);return 0===o.ref&&o.finalize(),s}function ot(){return Xe.id||(Xe.id=++Ze),++Xe.awaits,Xe.echoes+=ge,Xe.id}function st(){return!!Xe.awaits&&(0===--Xe.awaits&&(Xe.id=0),Xe.echoes=Xe.awaits*ge,!0)}function at(e){return Xe.echoes&&e&&e.constructor===xe?(ot(),e.then(function(e){return st(),e},function(e){return st(),gt(e)})):e}function ut(e){++nt,Xe.echoes&&0!==--Xe.echoes||(Xe.echoes=Xe.awaits=Xe.id=0),et.push(De),lt(e,!0)}function ct(){var e=et[et.length-1];et.pop(),lt(e,!1)}function lt(e,t){var n=De;if((t?!Xe.echoes||tt++&&e===De:!tt||--tt&&e===De)||queueMicrotask(t?ut.bind(null,e):ct),e!==De&&(De=e,n===je&&(je.env=ht()),ke)){var r=je.env.Promise,o=e.env;(n.global||e.global)&&(Object.defineProperty(i,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function ht(){var e=i.Promise;return ke?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ft(e,t,n,r,i){var o=De;try{return lt(e,!0),t(n,r,i)}finally{lt(o,!1)}}function dt(e,t,n,r){return"function"!=typeof e?e:function(){var i=De;n&&ot(),lt(t,!0);try{return e.apply(this,arguments)}finally{lt(i,!1),r&&queueMicrotask(st)}}}function pt(e){Promise===xe&&0===Xe.echoes?0===tt?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+we).indexOf("[native code]")&&(ot=st=re);var gt=Me.reject;function mt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||De.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return mt(e,t,n,r)})):gt(i)}return i._promise(t,function(e,t){return it(function(){return De.trans=i,r(e,t,i)})}).then(function(e){if("readwrite"===t)try{i.idbtrans.commit()}catch(e){}return"readonly"===t?e:i._completion.then(function(){return e})})}if(e._state.openComplete)return gt(new Z.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return gt(new Z.DatabaseClosed);e.open().catch(re)}return e._state.dbReadyPromise.then(function(){return mt(e,t,n,r)})}var yt="4.2.1",vt=String.fromCharCode(65535),bt=-1/0,wt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xt="String expected.",kt=[],_t="__dbnames",At="readonly",Ot="readwrite";function Pt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Et={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=T(t))[e],t}}function St(){throw Z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function jt(e,t){try{var n=Kt(e),r=Kt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return Bt(Tt(e),Tt(t));case"Array":return Dt(e,t)}}catch(e){}return NaN}function Dt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var s=jt(e[o],t[o]);if(0!==s)return s}return n===r?0:n<r?-1:1}function Bt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}function Kt(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=R(e);return"ArrayBuffer"===n?"binary":n}function Tt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Mt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){var r=n.updatesTable;return t?e.db.table(r).where("k").anyOf(t).delete():e.db.table(r).clear()})).then(function(){return n})):n}var It=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var t,n=this["@@propmod"];if(void 0!==n.add){var i=n.add;if(s(i))return r(r([],s(e)?e:[],!0),i,!0).sort();if("number"==typeof i)return(Number(e)||0)+i;if("bigint"==typeof i)try{return BigInt(e)+i}catch(e){return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(void 0!==n.remove){var o=n.remove;if(s(o))return s(e)?e.filter(function(e){return!o.includes(e)}).sort():[];if("number"==typeof o)return Number(e)-o;if("bigint"==typeof o)try{return BigInt(e)-o}catch(e){return BigInt(0)-o}throw new TypeError("Invalid subtrahend ".concat(o))}var a=null===(t=n.replacePrefix)||void 0===t?void 0:t[0];return a&&"string"==typeof e&&e.startsWith(a)?n.replacePrefix[1]+e.substring(a.length):e},e}();function Rt(e,t){for(var n=o(t),r=n.length,i=!1,s=0;s<r;++s){var a=n[s],u=t[a],c=_(e,a);u instanceof It?(A(e,a,u.execute(c)),i=!0):c!==u&&(A(e,a,u),i=!0)}return i}var qt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||De.trans,i=this.name,o=fe&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function s(e,n,r){if(!r.schema[i])throw new Z.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var a=Ue();try{var u=r&&r.db._novip===this.db._novip?r===De.trans?r._promise(e,s,n):it(function(){return r._promise(e,s,n)},{trans:r,transless:De.transless||De}):mt(this.db,e,[this.name],s);return o&&(u._consoleTask=o,u=u.catch(function(e){return console.trace(e),gt(e)})),u}finally{a&&Ve()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?gt(new Z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(s(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=o(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return e.keyPath.indexOf(t)>=0})){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==vt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&fe&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function a(e,t){return 0===jt(e,t)}var u=t.reduce(function(t,n){var r=t[0],o=t[1],u=i[n],c=e[n];return[r||u,r||!u?Pt(o,u&&u.multi?function(e){var t=_(e,n);return s(t)&&t.some(function(e){return a(c,e)})}:function(e){return a(c,_(e,n))}):o]},[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,s(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var n=this,r=n.db,i=n.name;this.schema.mappedClass=e,e.prototype instanceof St&&(e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),Object.defineProperty(n.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),n.prototype.table=function(){return i},n}(e));for(var o=new Set,s=e.prototype;s;s=u(s))Object.getOwnPropertyNames(s).forEach(function(e){return o.add(e)});var a=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!o.has(r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){function e(e){a(this,e)}return this.mapToClass(e)},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ct(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]})}).then(function(e){return e.numFailures?Me.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{A(e,o,t)}catch(e){}return t})},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(i){return n.core.get({trans:i,key:e}).then(function(o){var s=null!=o?o:{};return Rt(s,t),r&&A(s,r,e),n.core.mutate({trans:i,type:"put",values:[s],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?Me.reject(e.failures[0]):!!o})})})},e.prototype.update=function(e,t){if("object"!=typeof e||s(e))return this.where(":id").equals(e).modify(t);var n=_(e,this.schema.primKey.keyPath);return void 0===n?gt(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ct(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null})}).then(function(e){return e.numFailures?Me.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{A(e,o,t)}catch(e){}return t})},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(n){return Mt(t,[e],n)}).then(function(e){return e.numFailures?Me.reject(e.failures[0]):void 0})})},e.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Et}).then(function(t){return Mt(e,null,t)})}).then(function(e){return e.numFailures?Me.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=a&&s?e.map(Ct(a)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:c,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=a&&s?e.map(Ct(a)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:c,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),o=[];return this._trans("readwrite",function(s){return n.getMany({trans:s,keys:r,cache:"clone"}).then(function(a){var u=[],c=[];e.forEach(function(e,n){var r=e.key,i=e.changes,s=a[n];if(s){for(var l=0,h=Object.keys(i);l<h.length;l++){var f=h[l],d=i[f];if(f===t.schema.primKey.keyPath){if(0!==jt(d,r))throw new Z.Constraint("Cannot update primary key in bulkUpdate()")}else A(s,f,d)}o.push(n),u.push(r),c.push(s)}});var l=u.length;return n.mutate({trans:s,type:"put",keys:u,values:c,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(0===n)return l;for(var i=0,s=Object.keys(r);i<s.length;i++){var a=s[i],u=o[Number(a)];if(null!=u){var c=r[a];delete r[a],r[u]=c}}throw new J("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(l," operations failed"),r)})})})},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e}).then(function(n){return Mt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new J("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),o)})},e}();function Ft(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(e,r,i){if("object"==typeof e)return u(e);r||(r=le),i||(i=re);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter(function(t){return t!==e}),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function u(e){o(e).forEach(function(t){var n=e[t];if(s(n))a(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new Z.InvalidArgument("Invalid event config");var r=a(t,ie,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){x(function(){e.apply(null,t)})})})}})}}function Nt(e,t){return p(t).from({prototype:e}),t}function zt(e){return Nt(qt.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Ft(null,{creating:[ae,re],reading:[oe,ie],updating:[ce,re],deleting:[ue,re]})})}function Lt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ut(e,t){e.filter=Pt(e.filter,t)}function Vt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Pt(r(),t())}:t,e.justLimit=n&&!r}function Wt(e,t){e.isMatch=Pt(e.isMatch,t)}function Yt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new Z.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Ht(e,t,n){var r=Yt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Gt(e,t,n,r){var i=e.replayFilter?Pt(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(e,n,r){if(!i||i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),l(o,a)||(o[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Jt(Ht(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Jt(Ht(e,r,n),Pt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Jt(e,t,n,r){var i=Qe(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=re},function(t){e.fail(t),n=re})||i(e.value,e,function(e){return n=e}),n()})})}var Qt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,gt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,gt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Pt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Gt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&a(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Gt(t,e,n,t.table.core)})},e.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(Lt(n,!0))return r.count({trans:e,query:{index:Yt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Gt(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function a(e,t){return jt(o(e,i),o(t,i))*s}return this.toArray(function(e){return e.sort(a)}).then(t)},e.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if("next"===n.dir&&Lt(n,!0)&&n.limit>0){var r=n.valueMapper,i=Yt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){var t=e.result;return r?t.map(r):t})}var o=[];return Gt(n,function(e){return o.push(e)},e,n.table.core).then(function(){return o})},e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Lt(t)?Vt(t,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}):Vt(t,function(){var t=e;return function(){return--t<0}})),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},e.prototype.until=function(e,t){return Ut(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Ut(this._ctx,function(t){return e(t.value)}),Wt(this._ctx,e),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Lt(t,!0)&&t.limit>0)return this._read(function(e){var n=Yt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Ut(this._ctx,function(e){var t=e.primaryKey.toString(),r=l(n,t);return n[t]=!0,!r}),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i;i="function"==typeof e?e:function(t){return Rt(t,e)};var s=n.table.core,a=s.schema.primaryKey,u=a.outbound,c=a.extractKey,l=200,h=t.db._options.modifyChunkSize;h&&(l="object"==typeof h?h[s.name]||h["*"]||200:h);var f=[],d=0,p=[],g=function(e,t){var n=t.failures,r=t.numFailures;d+=e-r;for(var i=0,s=o(n);i<s.length;i++){var a=s[i];f.push(n[a])}},m=e===Xt;return t.clone().primaryKeys().then(function(t){var o=Lt(n)&&n.limit===1/0&&("function"!=typeof e||m)&&{index:n.index,range:n.range},a=function(h){var f=Math.min(l,t.length-h),d=t.slice(h,h+f);return(m?Promise.resolve([]):s.getMany({trans:r,keys:d,cache:"immutable"})).then(function(p){var y=[],v=[],b=u?[]:null,w=m?d:[];if(!m)for(var x=0;x<f;++x){var k=p[x],_={value:T(k),primKey:t[h+x]};!1!==i.call(_,_.value,_)&&(null==_.value?w.push(t[h+x]):u||0===jt(c(k),c(_.value))?(v.push(_.value),u&&b.push(t[h+x])):(w.push(t[h+x]),y.push(_.value)))}return Promise.resolve(y.length>0&&s.mutate({trans:r,type:"add",values:y}).then(function(e){for(var t in e.failures)w.splice(parseInt(t),1);g(y.length,e)})).then(function(){return(v.length>0||o&&"object"==typeof e)&&s.mutate({trans:r,type:"put",keys:b,values:v,criteria:o,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:h>0}).then(function(e){return g(v.length,e)})}).then(function(){return(w.length>0||o&&m)&&s.mutate({trans:r,type:"delete",keys:w,criteria:o,isAdditionalChunk:h>0}).then(function(e){return Mt(n.table,w,e)}).then(function(e){return g(w.length,e)})}).then(function(){return t.length>h+f&&a(h+l)})})};return a(0).then(function(){if(f.length>0)throw new G("Error modifying one or more objects",f,d,p);return t.length})})})},e.prototype.delete=function(){var e=this._ctx,t=e.range;return!Lt(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(Xt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(e){var n=e.failures,r=e.numFailures;if(r)throw new G("Could not delete some values",Object.keys(n).map(function(e){return n[e]}),t-r);return t-r})})})},e}(),Xt=function(e,t){return t.value=null};function Zt(e){return Nt(Qt.prototype,function(t,n){this.db=e;var r=Et,i=null;if(n)try{r=n()}catch(e){i=e}var o=t._ctx,s=o.table,a=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:a!==ie?a:null}})}function en(e,t){return e<t?-1:e===t?0:1}function tn(e,t){return e>t?-1:e===t?0:1}function nn(e,t,n){var r=e instanceof hn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function rn(e){return new e.Collection(e,function(){return ln("")}).limit(0)}function on(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function sn(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function an(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),a=-1,u=0;u<s;++u){var c=t[u];if(c!==r[u])return i(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[u],c)<0&&(a=u)}return s<r.length&&"next"===o?e+n.substr(e.length):s<e.length&&"prev"===o?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function un(e,t,n,r){var i,o,s,a,u,c,l,h=n.length;if(!n.every(function(e){return"string"==typeof e}))return nn(e,xt);function f(e){i=on(e),o=sn(e),s="next"===e?en:tn;var t=n.map(function(e){return{lower:o(e),upper:i(e)}}).sort(function(e,t){return s(e.lower,t.lower)});a=t.map(function(e){return e.upper}),u=t.map(function(e){return e.lower}),c=e,l="next"===e?"":r}f("next");var d=new e.Collection(e,function(){return cn(a[0],u[h-1]+r)});d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var f=o(i);if(t(f,u,p))return!0;for(var d=null,g=p;g<h;++g){var m=an(i,f,a[g],u[g],s,c);null===m&&null===d?p=g+1:(null===d||s(d,m)>0)&&(d=m)}return n(null!==d?function(){e.continue(d+l)}:r),!1}),d}function cn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ln(e){return{type:1,lower:e,upper:e}}var hn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?rn(this):new this.Collection(this,function(){return cn(e,t,!n,!r)})}catch(e){return nn(this,wt)}},e.prototype.equals=function(e){return null==e?nn(this,wt):new this.Collection(this,function(){return ln(e)})},e.prototype.above=function(e){return null==e?nn(this,wt):new this.Collection(this,function(){return cn(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return null==e?nn(this,wt):new this.Collection(this,function(){return cn(e,void 0,!1)})},e.prototype.below=function(e){return null==e?nn(this,wt):new this.Collection(this,function(){return cn(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return null==e?nn(this,wt):new this.Collection(this,function(){return cn(void 0,e)})},e.prototype.startsWith=function(e){return"string"!=typeof e?nn(this,xt):this.between(e,e+vt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):un(this,function(e,t){return 0===e.indexOf(t[0])},[e],vt)},e.prototype.equalsIgnoreCase=function(e){return un(this,function(e,t){return e===t[0]},[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=z.apply(N,arguments);return 0===e.length?rn(this):un(this,function(e,t){return-1!==t.indexOf(e)},e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=z.apply(N,arguments);return 0===e.length?rn(this):un(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,vt)},e.prototype.anyOf=function(){var e=this,t=z.apply(N,arguments),n=this._cmp;try{t.sort(n)}catch(e){return nn(this,wt)}if(0===t.length)return rn(this);var r=new this.Collection(this,function(){return cn(t[0],t[t.length-1])});r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,o){for(var s=e.key;n(s,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(s,t[i])||(r(function(){e.continue(t[i])}),!1)}),r},e.prototype.notEqual=function(e){return this.inAnyRange([[bt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=z.apply(N,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return nn(this,wt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[bt,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===e.length)return rn(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0}))return nn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var u=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;function l(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=s(o[0],t[0]),o[1]=a(o[1],t[1]);break}}return n===i&&e.push(t),e}var h,f=i;function d(e,t){return f(e[0],t[0])}try{(h=e.reduce(l,[])).sort(d)}catch(e){return nn(this,wt)}var p=0,g=c?function(e){return i(e,h[p][1])>0}:function(e){return i(e,h[p][1])>=0},m=u?function(e){return o(e,h[p][0])>0}:function(e){return o(e,h[p][0])>=0};function y(e){return!g(e)&&!m(e)}var v=g,b=new this.Collection(this,function(){return cn(h[0][0],h[h.length-1][1],!u,!c)});return b._ondirectionchange=function(e){"next"===e?(v=g,f=i):(v=m,f=o),h.sort(d)},b._addAlgorithm(function(e,t,r){for(var o=e.key;v(o);)if(++p===h.length)return t(r),!1;return!!y(o)||(0===n._cmp(o,h[p][1])||0===n._cmp(o,h[p][0])||t(function(){f===i?e.continue(h[p][0]):e.continue(h[p][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var e=z.apply(N,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?rn(this):this.inAnyRange(e.map(function(e){return[e,e+vt]})):nn(this,"startsWithAnyOf() only works with strings")},e}();function fn(e){return Nt(hn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=jt,this._descending=function(e,t){return jt(t,e)},this._max=function(e,t){return jt(e,t)>0?e:t},this._min=function(e,t){return jt(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new Z.MissingAPI})}function dn(e){return Qe(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var gn="storagemutated",mn="x-storagemutated-1",yn=Ft(null,gn),vn=function(){function e(){}return e.prototype._lock=function(){return w(!De.global),++this._reculock,1!==this._reculock||De.global||(De.lockOwnerFor=this),this},e.prototype._unlock=function(){if(w(!De.global),0===--this._reculock)for(De.global||(De.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(w(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(r);case"MissingAPIError":throw new Z.MissingAPI(r.message,r);default:throw new Z.OpenFailed(r)}if(!this.active)throw new Z.TransactionInactive;return w(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Qe(function(n){pn(n),t._reject(e.error)}),e.onabort=Qe(function(n){pn(n),t.active&&t._reject(new Z.Abort(e.error)),t.active=!1,t.on("abort").fire(n)}),e.oncomplete=Qe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&yn.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return gt(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return gt(new Z.TransactionInactive);if(this._locked())return new Me(function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},De])});if(n)return it(function(){var e=new Me(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new Me(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Me.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return n});else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Me(function(e,r){n.then(function(n){return t._waitingQueue.push(Qe(e.bind(null,n)))},function(e){return t._waitingQueue.push(Qe(r.bind(null,e)))}).finally(function(){t._waitingFor===i&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];var n=this.schema[e];if(!n)throw new Z.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function bn(e){return Nt(vn.prototype,function(t,n,r,i,o){var s=this;"readonly"!==t&&n.forEach(function(e){var t,i=null===(t=r[e])||void 0===t?void 0:t.yProps;i&&(n=n.concat(i.map(function(e){return e.updatesTable})))}),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Ft(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Me(function(e,t){s._resolve=e,s._reject=t}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(e){var t=s.active;return s.active=!1,s.on.error.fire(e),s.parent?s.parent._reject(e):t&&s.idbtrans&&s.idbtrans.abort(),gt(e)})})}function wn(e,t,n,r,i,o,s,a){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+xn(t),type:a}}function xn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function kn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:k(n,function(e){return[e.name,e]})}}function _n(e){return 1===e.length?e[0]:e}var An=function(e){try{return e.only([[]]),An=function(){return[[]]},[[]]}catch(e){return An=function(){return vt},vt}};function On(e){return null==e?function(){}:"string"==typeof e?Pn(e):function(t){return _(t,e)}}function Pn(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return _(t,e)}}function En(e){return[].slice.call(e)}var Cn=0;function Sn(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function jn(e,t,n){function r(e,t){var n=En(e.objectStoreNames);return{schema:{name:e.name,tables:n.map(function(e){return t.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=s(t),i=null==t,o={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:On(t)},indexes:En(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,a={name:t,compound:s(i),keyPath:i,unique:n,multiEntry:r,extractKey:On(i)};return o[Sn(i)]=a,a}),getIndexByKeyPath:function(e){return o[Sn(e)]}};return o[":id"]=a.primaryKey,null!=t&&(o[Sn(t)]=a.primaryKey),a})},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}function o(e){var t=e.name;function n(e){var n=e.trans,r=e.type,o=e.keys,s=e.values,a=e.range;return new Promise(function(e,u){e=Qe(e);var c=n.objectStore(t),l=null==c.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);var f,d=(o||s||{length:1}).length;if(o&&s&&o.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],g=[],m=0,y=function(e){++m,pn(e)};if("deleteRange"===r){if(4===a.type)return e({numFailures:m,failures:g,results:[],lastResult:void 0});3===a.type?p.push(f=c.clear()):p.push(f=c.delete(i(a)))}else{var v=h?l?[s,o]:[s,null]:[o,null],b=v[0],w=v[1];if(h)for(var x=0;x<d;++x)p.push(f=w&&void 0!==w[x]?c[r](b[x],w[x]):c[r](b[x])),f.onerror=y;else for(x=0;x<d;++x)p.push(f=c[r](b[x])),f.onerror=y}var k=function(t){var n=t.target.result;p.forEach(function(e,t){return null!=e.error&&(g[t]=e.error)}),e({numFailures:m,failures:g,results:"delete"===r?o:p.map(function(e){return e.result}),lastResult:n})};f.onerror=function(e){y(e),k(e)},f.onsuccess=k})}function r(e){var n=e.trans,r=e.values,o=e.query,s=e.reverse,a=e.unique;return new Promise(function(e,u){e=Qe(e);var c=o.index,l=o.range,h=n.objectStore(t),f=c.isPrimaryKey?h:h.index(c.name),d=s?a?"prevunique":"prev":a?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(i(l),d):f.openKeyCursor(i(l),d);p.onerror=dn(u),p.onsuccess=Qe(function(t){var r=p.result;if(r){r.___id=++Cn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var s=r.advance.bind(r),a=function(){throw new Error("Cursor not started")},c=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=a,r.fail=Qe(u),r.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},r.start=function(e){var t=new Promise(function(e,t){e=Qe(e),p.onerror=dn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=c,e(t)}}),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Qe(function(e){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=s,n(),t},e(r)}else e(null)},u)})}function o(e){return function(n){return new Promise(function(r,o){r=Qe(r);var s=n.trans,a=n.values,u=n.limit,c=n.query,l=u===1/0?void 0:u,h=c.index,f=c.range,d=s.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),g=i(f);if(0===u)return r({result:[]});if(e){var m=a?p.getAll(g,l):p.getAllKeys(g,l);m.onsuccess=function(e){return r({result:e.target.result})},m.onerror=dn(o)}else{var y=0,v=a||!("openKeyCursor"in p)?p.openCursor(g):p.openKeyCursor(g),b=[];v.onsuccess=function(e){var t=v.result;return t?(b.push(a?t.value:t.primaryKey),++y===u?r({result:b}):void t.continue()):r({result:b})},v.onerror=dn(o)}})}}return{name:t,schema:e,mutate:n,getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=Qe(e);for(var o,s=n.objectStore(t),a=r.length,u=new Array(a),c=0,l=0,h=function(t){var n=t.target;u[n._pos]=n.result,++l===c&&e(u)},f=dn(i),d=0;d<a;++d)null!=r[d]&&((o=s.get(r[d]))._pos=d,o.onsuccess=h,o.onerror=f,++c);0===c&&e(u)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=Qe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=dn(i)})},query:o(c),openCursor:r,count:function(e){var n=e.query,r=e.trans,o=n.index,s=n.range;return new Promise(function(e,n){var a=r.objectStore(t),u=o.isPrimaryKey?a:a.index(o.name),c=i(s),l=c?u.count(c):u.count();l.onsuccess=Qe(function(t){return e(t.target.result)}),l.onerror=dn(n)})}}}var a=r(e,n),u=a.schema,c=a.hasGetAll,l=u.tables.map(function(e){return o(e)}),h={};return l.forEach(function(e){return h[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '".concat(e,"' not found"));return h[e]},MIN_KEY:-1/0,MAX_KEY:An(t),schema:u}}function Dn(e,t){return t.reduce(function(e,t){var r=t.create;return n(n({},e),r(e))},e)}function Bn(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:Dn(jn(t,i,r),e.dbcore)}}function Kn(e,t){var n=t.db,r=Bn(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function Tn(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=m(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?d(t,n,{get:function(){return this.table(n)},set:function(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function Mn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function In(e,t){return e._cfg.version-t._cfg.version}function Rn(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=kn("$meta",Jn("")[0],[]),e._storeNames.push("$meta"));var s=e._createTransaction("readwrite",e._storeNames,i);s.create(n),s._completion.catch(r);var a=s._reject.bind(s),u=De.transless||De;it(function(){if(De.trans=s,De.transless=u,0!==t)return Kn(e,n),$n(e,s,t).then(function(t){return Fn(e,t,s,n)}).catch(a);o(i).forEach(function(e){zn(n,e,i[e].primKey,i[e].indexes)}),Kn(e,n),Me.follow(function(){return e.on.populate.fire(s)}).catch(a)})}function qn(e,t){Ln(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Wn(e,e.idbdb,t);Gn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){fe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),Vn(n,t)})},i=0,o=Nn(n,e._dbSchema).change;i<o.length;i++){var s=r(o[i]);if("object"==typeof s)return s.value}}function $n(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(e){return null!=e?e:n}):Me.resolve(n)}function Fn(e,t,n,r){var i=[],s=e._versions,a=e._dbSchema=Wn(e,e.idbdb,r),u=s.filter(function(e){return e._cfg.version>=t});if(0===u.length)return Me.resolve();function c(){return i.length?Me.resolve(i.shift()(n.idbtrans)).then(c):Me.resolve()}return u.forEach(function(s){i.push(function(){var i=a,u=s._cfg.dbschema;Gn(e,i,r),Gn(e,u,r),a=e._dbSchema=u;var c=Nn(i,u);c.add.forEach(function(e){zn(r,e[0],e[1].primKey,e[1].indexes)}),c.change.forEach(function(e){if(e.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach(function(e){return Vn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Vn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=s._cfg.contentUpgrade;if(l&&s._cfg.version>t){Kn(e,r),n._memoizedTables={};var h=P(u);c.del.forEach(function(e){h[e]=i[e]}),Mn(e,[e.Transaction.prototype]),Tn(e,[e.Transaction.prototype],o(h),h),n.schema=h;var f,d=L(l);d&&ot();var p=Me.follow(function(){if((f=l(n))&&d){var e=st.bind(null,null);f.then(e,e)}});return f&&"function"==typeof f.then?Me.resolve(f):p.then(function(){return f})}}),i.push(function(t){Un(s._cfg.dbschema,t),Mn(e,[e.Transaction.prototype]),Tn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===s._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(s._cfg.version,"version"))})}),c().then(function(){Ln(a,r)})}function Nn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)s.recreate=!0,r.change.push(s);else{var a=i.idxByName,u=o.idxByName,c=void 0;for(c in a)u[c]||s.del.push(c);for(c in u){var l=a[c],h=u[c];l?l.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function zn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Vn(i,e)}),i}function Ln(e,t){o(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(fe&&console.debug("Dexie: Creating missing table",n),zn(t,n,e[n].primKey,e[n].indexes))})}function Un(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return null==e[n]&&t.db.deleteObjectStore(n)})}function Vn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Wn(e,t,n){var r={};return v(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=t.keyPath,o=wn(xn(i),i||"",!0,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),s=[],a=0;a<t.indexNames.length;++a){var u=t.index(t.indexNames[a]);i=u.keyPath;var c=wn(u.name,i,!!u.unique,!!u.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(c)}r[e]=kn(e,o,s)}),r}function Yn(e,t,n){e.verno=t.version/10;var r=e._dbSchema=Wn(e,t,n);e._storeNames=v(t.objectStoreNames,0),Tn(e,[e._allTables],o(r),r)}function Hn(e,t){var n=Nn(Wn(e,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some(function(e){return e.add.length||e.change.length}))}function Gn(e,t,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var s=r[o],a=n.objectStore(s);e._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var c=a.indexNames[u],l=a.index(c).keyPath,h="string"==typeof l?l:"["+v(l).join("+")+"]";if(t[s]){var f=t[s].idxByName[h];f&&(f.name=c,delete t[s].idxByName[h],t[s].idxByName[c]=f)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Jn(e){return e.split(",").map(function(e,t){var n,r=e.split(":"),i=null===(n=r[1])||void 0===n?void 0:n.trim(),o=(e=r[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return wn(o,a||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),s(a),0===t,i)})}var Qn,Xn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return kn(e,t,n)},e.prototype._parseIndexSyntax=function(e){return Jn(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;o(e).forEach(function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),o=i.shift();if(!o)throw new Z.Schema("Invalid schema for table "+r+": "+e[r]);if(o.unique=!0,o.multi)throw new Z.Schema("Primary key cannot be multiEntry*");i.forEach(function(e){if(e.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")});var s=n._createTableSchema(r,o,i);t[r]=s}})},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach(function(e){a(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),t._dbSchema=i,Mn(t,[t._allTables,t,t.Transaction.prototype]),Tn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],o(i),i),t._storeNames=o(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=he(this._cfg.contentUpgrade||re,e),this},e}();function Zn(e){return Nt(Xn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function er(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ti(_t,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function tr(e){return e&&"function"==typeof e.databases}function nr(e){var t=e.indexedDB,n=e.IDBKeyRange;return tr(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==_t})}):er(t,n).toCollection().primaryKeys()}function rr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==_t&&er(n,r).put({name:t}).catch(re)}function ir(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==_t&&er(n,r).delete(t).catch(re)}function or(e){return it(function(){return De.letThrough=!0,e()})}function sr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function ar(e){return!("from"in e)}var ur=function(e,t){if(!this){var n=new ur;return e&&"d"in e&&a(n,e),n}a(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function cr(e,t,n){var r=jt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(ar(e))return a(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(jt(n,e.from)<0)return i?cr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},dr(e);if(jt(t,e.to)>0)return o?cr(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},dr(e);jt(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),jt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var s=!e.r;i&&!e.l&&lr(e,i),o&&s&&lr(e,o)}}function lr(e,t){function n(e,t){var r=t.from,i=t.to,o=t.l,s=t.r;cr(e,r,i),o&&n(e,o),s&&n(e,s)}ar(t)||n(e,t)}function hr(e,t){var n=fr(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=fr(e),s=o.next(i.from),a=s.value;!r.done&&!s.done;){if(jt(a.from,i.to)<=0&&jt(a.to,i.from)>=0)return!0;jt(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function fr(e){var t=ar(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&jt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||jt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function dr(e){var t,r,i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var s="r"===o?"l":"r",a=n({},e),u=e[o];e.from=u.from,e.to=u.to,e[o]=u[o],a[o]=u[s],e[s]=a,a.d=pr(a)}e.d=pr(e)}function pr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function gr(e,t){return o(t).forEach(function(n){e[n]?lr(e[n],t[n]):e[n]=D(t[n])}),e}function mr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&hr(t[n],e[n])})}h(ur.prototype,((Qn={add:function(e){return lr(this,e),this},addKey:function(e){return cr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return cr(t,e,e)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&jt(t.from,e)<=0&&jt(t.to,e)>=0}})[q]=function(){return fr(this)},Qn));var yr={},vr={},br=!1;function wr(e,t){gr(vr,e),br||(br=!0,setTimeout(function(){br=!1;var e=vr;vr={},xr(e,!1)},0))}function xr(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(yr);r<i.length;r++)kr(a=i[r],e,n,t);else for(var o in e){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var a,u=s[1],c=s[2];(a=yr["idb://".concat(u,"/").concat(c)])&&kr(a,e,n,t)}}n.forEach(function(e){return e()})}function kr(e,t,n,r){for(var i=[],o=0,s=Object.entries(e.queries.query);o<s.length;o++){for(var a=s[o],u=a[0],c=[],l=0,h=a[1];l<h.length;l++){var f=h[l];mr(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&c.push(f)}r&&i.push([u,c])}if(r)for(var d=0,p=i;d<p.length;d++){var g=p[d];u=g[0],c=g[1],e.queries.query[u]=c}}function _r(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?gt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new Z.DatabaseClosed("db.open() was cancelled")}var a=t.dbReadyResolve,u=null,c=!1,l=function(){return new Me(function(r,a){if(s(),!n)throw new Z.MissingAPI;var h=e.name,f=t.autoSchema||!i?n.open(h):n.open(h,i);if(!f)throw new Z.MissingAPI;f.onerror=dn(a),f.onblocked=Qe(e._fireOnBlocked),f.onupgradeneeded=Qe(function(r){if(u=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=pn,u.abort(),f.result.close();var i=n.deleteDatabase(h);i.onsuccess=i.onerror=Qe(function(){a(new Z.NoSuchDatabase("Database ".concat(h," doesnt exist")))})}else{u.onerror=dn(a);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;c=s<1,e.idbdb=f.result,o&&qn(e,u),Rn(e,s/10,u,a)}},a),f.onsuccess=Qe(function(){u=null;var n=e.idbdb=f.result,s=v(n.objectStoreNames);if(s.length>0)try{var a=n.transaction(_n(s),"readonly");if(t.autoSchema)Yn(e,n,a);else if(Gn(e,e._dbSchema,a),!Hn(e,a)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),n.close(),i=n.version+1,o=!0,r(l());Kn(e,a)}catch(e){}kt.push(e),n.onversionchange=Qe(function(n){t.vcFired=!0,e.on("versionchange").fire(n)}),n.onclose=Qe(function(){e.close({disableAutoOpen:!1})}),c&&rr(e._deps,h),r()},a)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(i>0)return i=0,l()}return Me.reject(e)})};return Me.race([r,("undefined"==typeof navigator?Me.resolve():sr()).then(l)]).then(function(){return s(),t.onReadyBeingFired=[],Me.resolve(or(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(he,re);return t.onReadyBeingFired=[],Me.resolve(or(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{u&&u.abort()}catch(e){}return r===t.openCanceller&&e._close(),gt(n)}).finally(function(){t.openComplete=!0,a()}).then(function(){if(c){var t={};e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new ur(-1/0,[[[]]]))}),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new ur(-1/0,[[[]]])}),yn(gn).fire(t),xr(t,!0)}return e})}function Ar(e){var t=function(t){return e.next(t)},n=function(t){return e.throw(t)},r=o(t),i=o(n);function o(e){return function(t){var n=e(t),o=n.value;return n.done?o:o&&"function"==typeof o.then?o.then(r,i):s(o)?Promise.all(o).then(r,i):r(o)}}return o(t)()}function Or(e,t,n){var r=arguments.length;if(r<2)throw new Z.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,C(i),n]}function Pr(e,t,n,r,i){return Me.resolve().then(function(){var o=De.transless||De,s=e._createTransaction(t,n,e._dbSchema,r);s.explicit=!0;var a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return Pr(e,t,n,null,i)})):gt(r)}var u,c=L(i);c&&ot();var l=Me.follow(function(){if(u=i.call(s,s))if(c){var e=st.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Ar(u))},a);return(u&&"function"==typeof u.then?Me.resolve(u).then(function(e){return s.active?e:gt(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):l.then(function(){return u})).then(function(e){return r&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),gt(e)})})}function Er(e,t,n){for(var r=s(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Cr(e){return n(n({},e),{table:function(t){var r=e.table(t),i=r.schema,o={},s=[];function a(e,t,r){var i=Sn(e),u=o[i]=o[i]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,h=n(n({},r),{name:l?"".concat(i,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:l,keyTail:t,keyLength:c,extractKey:On(e),unique:!l&&r.unique});return u.push(h),h.isPrimaryKey||s.push(h),c>1&&a(2===c?e[0]:e.slice(0,c-1),t+1,r),u.sort(function(e,t){return e.keyTail-t.keyTail}),h}var u=a(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var c=0,l=i.indexes;c<l.length;c++){var h=l[c];a(h.keyPath,0,h)}function f(e){var t=o[Sn(e)];return t&&t[0]}function d(t,n){return{type:1===t.type?2:t.type,lower:Er(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Er(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function p(e){var t=e.query.index;return t.isVirtual?n(n({},e),{query:{index:t.lowLevelIndex,range:d(e.query.range,t.keyTail)}}):e}var g=n(n({},r),{schema:n(n({},i),{primaryKey:u,indexes:s,getIndexByKeyPath:f}),count:function(e){return r.count(p(e))},query:function(e){return r.query(p(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,o=n.isVirtual,s=n.keyLength;if(!o)return r.openCursor(t);function a(n){function r(r){null!=r?n.continue(Er(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}var o=Object.create(n,{continue:{value:r},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Er(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:function(){return n.value}}});return o}return r.openCursor(p(t)).then(function(e){return e&&a(e)})}});return g}})}var Sr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Cr};function jr(e,t,n,r){return n=n||{},r=r||"",o(e).forEach(function(i){if(l(t,i)){var o=e[i],s=t[i];if("object"==typeof o&&"object"==typeof s&&o&&s){var a=R(o);a!==R(s)?n[r+i]=t[i]:"Object"===a?jr(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}else n[r+i]=void 0}),o(t).forEach(function(i){l(e,i)||(n[r+i]=t[i])}),n}function Dr(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Br={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return n(n({},e),{table:function(t){var i=e.table(t),o=i.schema.primaryKey,s=n(n({},i),{mutate:function(e){var s=De.trans,a=s.table(t).hook,u=a.deleting,c=a.creating,h=a.updating;switch(e.type){case"add":if(c.fire===re)break;return s._promise("readwrite",function(){return f(e)},!0);case"put":if(c.fire===re&&h.fire===re)break;return s._promise("readwrite",function(){return f(e)},!0);case"delete":if(u.fire===re)break;return s._promise("readwrite",function(){return f(e)},!0);case"deleteRange":if(u.fire===re)break;return s._promise("readwrite",function(){return d(e)},!0)}return i.mutate(e);function f(e){var t=De.trans,s=e.keys||Dr(o,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?n(n({},e),{keys:s}):n({},e)).type&&(e.values=r([],e.values,!0)),e.keys&&(e.keys=r([],e.keys,!0)),Kr(i,e,s).then(function(n){var r=s.map(function(r,i){var s=n[i],a={onerror:null,onsuccess:null};if("delete"===e.type)u.fire.call(a,r,s,t);else if("add"===e.type||void 0===s){var f=c.fire.call(a,r,e.values[i],t);null==r&&null!=f&&(r=f,e.keys[i]=r,o.outbound||A(e.values[i],o.keyPath,r))}else{var d=jr(s,e.values[i]),p=h.fire.call(a,d,r,s,t);if(p){var g=e.values[i];Object.keys(p).forEach(function(e){l(g,e)?g[e]=p[e]:A(g,e,p[e])})}}return a});return i.mutate(e).then(function(t){for(var i=t.failures,o=t.results,a=t.numFailures,u=t.lastResult,c=0;c<s.length;++c){var l=o?o[c]:s[c],h=r[c];null==l?h.onerror&&h.onerror(i[c]):h.onsuccess&&h.onsuccess("put"===e.type&&n[c]?e.values[c]:l)}return{failures:i,results:o,numFailures:a,lastResult:u}}).catch(function(e){return r.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}function d(e){return p(e.trans,e.range,1e4)}function p(e,t,r){return i.query({trans:e,values:!1,query:{index:o,range:t},limit:r}).then(function(i){var o=i.result;return f({type:"delete",keys:o,trans:e}).then(function(i){return i.numFailures>0?Promise.reject(i.failures[0]):o.length<r?{failures:[],numFailures:0,lastResult:void 0}:p(e,n(n({},t),{lower:o[o.length-1],lowerOpen:!0}),r)})})}}});return s}})}};function Kr(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function Tr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===jt(t.keys[i],e[o])&&(r.push(n?T(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var Mr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var r=e.table(t);return n(n({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Tr(e.keys,e.trans._cache,"clone"===e.cache);return t?Me.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?T(t):t},t})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function Ir(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function Rr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var qr={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,r=new ur(e.MIN_KEY,e.MAX_KEY);return n(n({},e),{transaction:function(t,n,r){if(De.subscr&&"readonly"!==n)throw new Z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(De.querier));return e.transaction(t,n,r)},table:function(i){var a=e.table(i),u=a.schema,c=u.primaryKey,l=u.indexes,h=c.extractKey,f=c.outbound,d=c.autoIncrement&&l.filter(function(e){return e.compound&&e.keyPath.includes(c.keyPath)}),p=n(n({},a),{mutate:function(n){var o,l,h=n.trans,f=n.mutatedParts||(n.mutatedParts={}),p=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return f[n]||(f[n]=new ur)},g=p(""),m=p(":dels"),y=n.type,v="deleteRange"===n.type?[n.range]:"delete"===n.type?[n.keys]:n.values.length<50?[Dr(c,n).filter(function(e){return e}),n.values]:[],b=v[0],w=v[1],x=n.trans._cache;if(s(b)){g.addKeys(b);var k="delete"===y||b.length===w.length?Tr(b,x):null;k||m.addKeys(b),(k||w)&&$r(p,u,k,w)}else if(b){var _={from:null!==(o=b.lower)&&void 0!==o?o:e.MIN_KEY,to:null!==(l=b.upper)&&void 0!==l?l:e.MAX_KEY};m.add(_),g.add(_)}else g.add(r),m.add(r),u.indexes.forEach(function(e){return p(e.name).add(r)});return a.mutate(n).then(function(e){return!b||"add"!==n.type&&"put"!==n.type||(g.addKeys(e.results),d&&d.forEach(function(t){for(var r=n.values.map(function(e){return t.extractKey(e)}),i=t.keyPath.findIndex(function(e){return e===c.keyPath}),o=0,s=e.results.length;o<s;++o)r[o][i]=e.results[o];p(t.name).addKeys(r)})),h.mutatedParts=gr(h.mutatedParts||{},f),e})}}),g=function(t){var n,r,i=t.query,o=i.index,s=i.range;return[o,new ur(null!==(n=s.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=s.upper)&&void 0!==r?r:e.MAX_KEY)]},m={get:function(e){return[c,new ur(e.key)]},getMany:function(e){return[c,(new ur).addKeys(e.keys)]},count:g,query:g,openCursor:g};return o(m).forEach(function(e){p[e]=function(o){var s=De.subscr,u=!!s,c=Ir(De,a)&&Rr(e,o)?o.obsSet={}:s;if(u){var l=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return c[n]||(c[n]=new ur)},d=l(""),p=l(":dels"),g=m[e](o),y=g[0],v=g[1];if("query"===e&&y.isPrimaryKey&&!o.values?p.add(v):l(y.name||"").add(v),!y.isPrimaryKey){if("count"!==e){var b="query"===e&&f&&o.values&&a.query(n(n({},o),{values:!1}));return a[e].apply(this,arguments).then(function(t){if("query"===e){if(f&&o.values)return b.then(function(e){var n=e.result;return d.addKeys(n),t});var n=o.values?t.result.map(h):t.result;o.values?d.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,i=o.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return i&&d.addKey(r.primaryKey),r.value}}})}return t})}p.add(r)}}return a[e].apply(this,arguments)}}),p}})}};function $r(e,t,n,r){function i(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var a=function(e){return t.multiEntry&&s(e)?e.forEach(function(e){return i.addKey(e)}):i.addKey(e)};(n||r).forEach(function(e,t){var i=n&&o(n[t]),s=r&&o(r[t]);0!==jt(i,s)&&(null!=i&&a(i),null!=s&&a(s))})}t.indexes.forEach(i)}function Fr(e,t,r){if(0===r.numFailures)return t;if("deleteRange"===t.type)return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(r.numFailures===i)return null;var o=n({},t);return s(o.keys)&&(o.keys=o.keys.filter(function(e,t){return!(t in r.failures)})),"values"in o&&s(o.values)&&(o.values=o.values.filter(function(e,t){return!(t in r.failures)})),o}function Nr(e,t){return void 0===t.lower||(t.lowerOpen?jt(e,t.lower)>0:jt(e,t.lower)>=0)}function zr(e,t){return void 0===t.upper||(t.upperOpen?jt(e,t.upper)<0:jt(e,t.upper)<=0)}function Lr(e,t){return Nr(e,t)&&zr(e,t)}function Ur(e,t,n,r,i,o){if(!n||0===n.length)return e;var a=t.query.index,u=a.multiEntry,c=t.query.range,l=r.schema.primaryKey.extractKey,h=a.extractKey,f=(a.lowLevelIndex||a).extractKey,d=n.reduce(function(e,n){var r=e,i=[];if("add"===n.type||"put"===n.type)for(var o=new ur,a=n.values.length-1;a>=0;--a){var f=n.values[a],d=l(f);if(!o.hasKey(d)){var p=h(f);(u&&s(p)?p.some(function(e){return Lr(e,c)}):Lr(p,c))&&(o.addKey(d),i.push(f))}}switch(n.type){case"add":var g=(new ur).addKeys(t.values?e.map(function(e){return l(e)}):e);r=e.concat(t.values?i.filter(function(e){var t=l(e);return!g.hasKey(t)&&(g.addKey(t),!0)}):i.map(function(e){return l(e)}).filter(function(e){return!g.hasKey(e)&&(g.addKey(e),!0)}));break;case"put":var m=(new ur).addKeys(n.values.map(function(e){return l(e)}));r=e.filter(function(e){return!m.hasKey(t.values?l(e):e)}).concat(t.values?i:i.map(function(e){return l(e)}));break;case"delete":var y=(new ur).addKeys(n.keys);r=e.filter(function(e){return!y.hasKey(t.values?l(e):e)});break;case"deleteRange":var v=n.range;r=e.filter(function(e){return!Lr(l(e),v)})}return r},e);return d===e?e:(d.sort(function(e,t){return jt(f(e),f(t))||jt(l(e),l(t))}),t.limit&&t.limit<1/0&&(d.length>t.limit?d.length=t.limit:e.length===t.limit&&d.length<t.limit&&(i.dirty=!0)),o?Object.freeze(d):d)}function Vr(e,t){return 0===jt(e.lower,t.lower)&&0===jt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Wr(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var i=jt(e,t);if(0===i){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function Yr(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var i=jt(e,t);if(0===i){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Hr(e,t){return Wr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Yr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Gr(e,t,n,r){var i=yr["idb://".concat(e,"/").concat(t)];if(!i)return[];var o=i.queries[n];if(!o)return[null,!1,i,null];var s=o[(r.query?r.query.index.name:null)||""];if(!s)return[null,!1,i,null];switch(n){case"query":var a=s.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Vr(e.req.query.range,r.query.range)});return a?[a,!0,i,s]:[s.find(function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&Hr(e.req.query.range,r.query.range)}),!1,i,s];case"count":var u=s.find(function(e){return Vr(e.req.query.range,r.query.range)});return[u,!!u,i,s]}}function Jr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){e.subscribers.delete(n),0===e.subscribers.size&&Qr(e,t)})}function Qr(e,t){setTimeout(function(){0===e.subscribers.size&&F(t,e)},3e3)}var Xr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,r=n(n({},e),{transaction:function(n,r,i){var o=e.transaction(n,r,i);if("readwrite"===r){var s=new AbortController,a=s.signal,u=function(i){return function(){if(s.abort(),"readwrite"===r){for(var a=new Set,u=0,c=n;u<c.length;u++){var l=c[u],h=yr["idb://".concat(t,"/").concat(l)];if(h){var f=e.table(l),d=h.optimisticOps.filter(function(e){return e.trans===o});if(o._explicit&&i&&o.mutatedParts)for(var p=0,g=Object.values(h.queries.query);p<g.length;p++)for(var m=0,y=(w=g[p]).slice();m<y.length;m++)mr((_=y[m]).obsSet,o.mutatedParts)&&(F(w,_),_.subscribers.forEach(function(e){return a.add(e)}));else if(d.length>0){h.optimisticOps=h.optimisticOps.filter(function(e){return e.trans!==o});for(var v=0,b=Object.values(h.queries.query);v<b.length;v++)for(var w,x=0,k=(w=b[v]).slice();x<k.length;x++){var _;if(null!=(_=k[x]).res&&o.mutatedParts)if(i&&!_.dirty){var A=Object.isFrozen(_.res),O=Ur(_.res,_.req,d,f,_,A);_.dirty?(F(w,_),_.subscribers.forEach(function(e){return a.add(e)})):O!==_.res&&(_.res=O,_.promise=Me.resolve({result:O}))}else _.dirty&&F(w,_),_.subscribers.forEach(function(e){return a.add(e)})}}}}a.forEach(function(e){return e()})}}};o.addEventListener("abort",u(!1),{signal:a}),o.addEventListener("error",u(!1),{signal:a}),o.addEventListener("complete",u(!0),{signal:a})}return o},table:function(r){var i=e.table(r),o=i.schema.primaryKey,s=n(n({},i),{mutate:function(e){var s=De.trans;if(o.outbound||"disabled"===s.db._options.cache||s.explicit||"readwrite"!==s.idbtrans.mode)return i.mutate(e);var a=yr["idb://".concat(t,"/").concat(r)];if(!a)return i.mutate(e);var u=i.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Dr(o,e).some(function(e){return null==e}))?(a.optimisticOps.push(e),e.mutatedParts&&wr(e.mutatedParts),u.then(function(t){if(t.numFailures>0){F(a.optimisticOps,e);var n=Fr(a,e,t);n&&a.optimisticOps.push(n),e.mutatedParts&&wr(e.mutatedParts)}}),u.catch(function(){F(a.optimisticOps,e),e.mutatedParts&&wr(e.mutatedParts)})):u.then(function(t){var r=n(n({},e),{values:e.values.map(function(e,r){var i;if(t.failures[r])return e;var s=(null===(i=o.keyPath)||void 0===i?void 0:i.includes("."))?T(e):n({},e);return A(s,o.keyPath,t.results[r]),s})}),i=Fr(a,r,t);a.optimisticOps.push(i),queueMicrotask(function(){return e.mutatedParts&&wr(e.mutatedParts)})}),u},query:function(e){var n;if(!Ir(De,i)||!Rr("query",e))return i.query(e);var o="immutable"===(null===(n=De.trans)||void 0===n?void 0:n.db._options.cache),s=De,a=s.requery,u=s.signal,c=Gr(t,r,"query",e),l=c[0],h=c[1],f=c[2],d=c[3];if(l&&h)l.obsSet=e.obsSet;else{var p=i.query(e).then(function(e){var t=e.result;if(l&&(l.res=t),o){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=T(t);return e}).catch(function(e){return d&&l&&F(d,l),Promise.reject(e)});l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},d?d.push(l):(d=[l],f||(f=yr["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),f.queries.query[e.query.index.name||""]=d)}return Jr(l,d,a,u),l.promise.then(function(t){return{result:Ur(t.result,e,null==f?void 0:f.optimisticOps,i,l,o)}})}});return s}});return r}};function Zr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var ei,ti=function(){function e(t,r){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=r=n({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var s=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};a.dbReadyPromise=new Me(function(e){a.dbReadyResolve=e}),a.openCanceller=new Me(function(e,t){a.cancelOpen=t}),this._state=a,this.name=t,this.on=Ft(this,"populate","blocked","versionchange","close",{ready:[he,re]}),this.once=function(e,t){var n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];i.on(e).unsubscribe(n),t.apply(i,r)};return i.on(e,n)},this.on.ready.subscribe=b(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||Me.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t(function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)})}})}}),this.Collection=Zt(this),this.Table=zt(this),this.Transaction=bn(this),this.Version=Zn(this),this.WhereClause=fn(this),this.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=An(r.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),kt.filter(function(e){return e.name===i.name&&e!==i&&!e._state.vcFired}).map(function(t){return t.on("versionchange").fire(e)})},this.use(Mr),this.use(Xr),this.use(qr),this.use(Sr),this.use(Br);var u=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return Zr(i.table(e),u)};var r=Reflect.get(e,t,n);return r instanceof qt?Zr(r,u):"tables"===t?r.map(function(e){return Zr(e,u)}):"_createTransaction"===t?function(){return Zr(r.apply(this,arguments),u)}:r}});this.vip=u,s.forEach(function(e){return e(i)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(In),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?e():new Me(function(e,n){if(t._state.openComplete)return n(new Z.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new Z.DatabaseClosed);t.open().catch(re)}t._state.dbReadyPromise.then(e,n)}).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort(function(e,t){return e.level-t.level}),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},e.prototype.open=function(){var e=this;return ft(je,function(){return _r(e)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=kt.indexOf(this);if(t>=0&&kt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Me(function(t){e.dbReadyResolve=t}),e.openCanceller=new Me(function(t,n){e.cancelOpen=n}))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new Z.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new Z.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new Me(function(i,o){var s=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Qe(function(){ir(t._deps,t.name),i()}),n.onerror=dn(o),n.onblocked=t._fireOnBlocked};if(n)throw new Z.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return o(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Or.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=De.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,s,a=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map(function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}),"r"==e||e===At)o=At;else{if("rw"!=e&&e!=Ot)throw new Z.InvalidArgument("Invalid transaction mode: "+e);o=Ot}if(i){if(i.mode===At&&o===Ot){if(!a)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!a)throw new Z.SubTransaction("Table "+e+" not included in parent transaction.");i=null}}),a&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):gt(e)}var u=Pr.bind(null,this,o,s,i,n);return i?i._promise(o,u,"lock"):De.trans?ft(De.transless,function(){return r._whenReady(u)}):this._whenReady(u)},e.prototype.table=function(e){if(!l(this._allTables,e))throw new Z.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),ni="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ri=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[ni]=function(){return this},e}();try{ei={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(e){ei={indexedDB:null,IDBKeyRange:null}}function ii(e){var t,n=!1,r=new ri(function(r){var i=L(e);function o(t){var n=Ue();try{i&&ot();var r=it(e,t);return i&&(r=r.finally(st)),r}finally{n&&Ve()}}var s,a=!1,u={},c={},l={get closed(){return a},unsubscribe:function(){a||(a=!0,s&&s.abort(),h&&yn.storagemutated.unsubscribe(p))}};r.start&&r.start(l);var h=!1,f=function(){return pt(g)};function d(){return mr(c,u)}var p=function(e){gr(u,e),d()&&f()},g=function(){if(!a&&ei.indexedDB){u={};var i={};s&&s.abort(),s=new AbortController;var l={subscr:i,signal:s.signal,requery:f,querier:e,trans:null},d=o(l);Promise.resolve(d).then(function(e){n=!0,t=e,a||l.signal.aborted||(u={},B(c=i)||h||(yn(gn,p),h=!0),pt(function(){return!a&&r.next&&r.next(e)}))},function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||pt(function(){a||r.error&&r.error(e)})})}};return setTimeout(f,0),l});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var oi=ti;function si(e){var t=ui;try{ui=!0,yn.storagemutated.fire(e),xr(e,!0)}finally{ui=t}}h(oi,n(n({},ne),{delete:function(e){return new oi(e,{addons:[]}).delete()},exists:function(e){return new oi(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return nr(oi.dependencies).then(e)}catch(e){return gt(new Z.MissingAPI)}},defineClass:function(){function e(e){a(this,e)}return e},ignoreTransaction:function(e){return De.trans?ft(De.transless,e):e()},vip:or,async:function(e){return function(){try{var t=Ar(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Me.resolve(t)}catch(e){return gt(e)}}},spawn:function(e,t,n){try{var r=Ar(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Me.resolve(r)}catch(e){return gt(e)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(e,t){var n=Me.resolve("function"==typeof e?oi.ignoreTransaction(e):e).timeout(t||6e4);return De.trans?De.trans.waitFor(n):n},Promise:Me,debug:{get:function(){return fe},set:function(e){de(e)}},derive:p,extend:a,props:h,override:b,Events:Ft,on:yn,liveQuery:ii,extendObservabilitySet:gr,getByKeyPath:_,setByKeyPath:A,delByKeyPath:O,shallowClone:P,deepClone:T,getObjectDiff:jr,cmp:jt,asap:x,minKey:bt,addons:[],connections:kt,errnames:Q,dependencies:ei,cache:yr,semVer:yt,version:yt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),oi.maxKey=An(oi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(yn(gn,function(e){var t;ui||(t=new CustomEvent(mn,{detail:e}),ui=!0,dispatchEvent(t),ui=!1)}),addEventListener(mn,function(e){var t=e.detail;ui||si(t)}));var ai,ui=!1,ci=function(){};function li(e){return new It({add:e})}function hi(e){return new It({remove:e})}function fi(e,t){return new It({replacePrefix:[e,t]})}return"undefined"!=typeof BroadcastChannel&&((ci=function(){(ai=new BroadcastChannel(mn)).onmessage=function(e){return e.data&&si(e.data)}})(),"function"==typeof ai.unref&&ai.unref(),yn(gn,function(e){ui||ai.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!ti.disableBfCache&&e.persisted){fe&&console.debug("Dexie: handling persisted pagehide"),null==ai||ai.close();for(var t=0,n=kt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ti.disableBfCache&&e.persisted&&(fe&&console.debug("Dexie: handling persisted pageshow"),ci(),si({all:new ur(-1/0,[[]])}))})),Me.rejectionMapper=te,de(fe),n(ti,Object.freeze({__proto__:null,Dexie:ti,liveQuery:ii,Entity:St,cmp:jt,PropModification:It,replacePrefix:fi,add:li,remove:hi,default:ti,RangeSet:ur,mergeRanges:lr,rangesOverlap:hr}),{default:ti}),ti}();var zt=Ft(Nt.exports);const Lt=Symbol.for("Dexie"),Ut=globalThis[Lt]||(globalThis[Lt]=zt);if(zt.semVer!==Ut.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${zt.semVer} and ${Ut.semVer}`);const Vt=new Ut("BookmarkInsightsDB");Vt.version(1).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}),Vt.version(2).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}).upgrade(e=>{console.log("Upgrading database to version 2 - adding rawMetadata support")});let Wt=null,Yt=!1;async function Ht(){if(Yt)return Wt;console.log("Initializing FlexSearch index...");const e=await async function(e){try{const t=await Vt.cache.get(e);return t?t.ttl&&Date.now()-t.timestamp>t.ttl?(await Vt.cache.delete(e),null):t.value:null}catch(e){return console.error("Error getting cache:",e),null}}("flexsearch_index");if(e&&e.serialized)try{return Wt=new qt({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}}),Wt.import(e.serialized),Yt=!0,console.log("Loaded FlexSearch index from cache"),Wt}catch(e){console.error("Error loading cached index:",e)}return await async function(){console.log("Building FlexSearch index..."),Wt=new qt({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const e=await async function(){try{return await Vt.bookmarks.toArray()}catch(e){return console.error("Error getting bookmarks:",e),[]}}();for(const t of e)await Gt(t);Yt=!0;try{const t=await Wt.export();await async function(e,t,n=null){try{return await Vt.cache.put({key:e,value:t,timestamp:Date.now(),ttl:n}),!0}catch(e){return console.error("Error setting cache:",e),!1}}("flexsearch_index",{serialized:t,timestamp:Date.now()}),console.log(`Indexed ${e.length} bookmarks`)}catch(e){console.error("Error caching index:",e)}return Wt}(),Wt}async function Gt(e){Wt||await Ht();const t={id:e.id,title:e.title||"",url:e.url||"",description:e.description||"",keywords:Array.isArray(e.keywords)?e.keywords.join(" "):"",category:e.category||"",domain:e.domain||""};await Wt.add(t)}function Jt(e,t,n){const r=e.slice();return r[19]=t[n],r[21]=n,r}function Qt(t){let n,r,i;return{c(){n=d("button"),n.innerHTML='<svg class="h-5 w-5 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',v(n,"class","absolute inset-y-0 right-0 pr-3 flex items-center"),v(n,"type","button")},m(e,o){l(e,n,o),r||(i=y(n,"click",t[9]),r=!0)},p:e,d(e){e&&h(n),r=!1,i()}}}function Xt(e){let t,n=L(e[2]),r=[];for(let t=0;t<n.length;t+=1)r[t]=Zt(Jt(e,n,t));return{c(){t=d("div");for(let e=0;e<r.length;e+=1)r[e].c();v(t,"class","absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-auto")},m(e,n){l(e,t,n);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,i){if(148&i){let o;for(n=L(e[2]),o=0;o<n.length;o+=1){const s=Jt(e,n,o);r[o]?r[o].p(s,i):(r[o]=Zt(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(e){e&&h(t),f(r,e)}}}function Zt(e){let t,n,r,i,o,s,a,u,f,w,x,k=e[19]+"";function _(){return e[15](e[19])}return{c(){t=d("button"),n=d("div"),r=p("svg"),i=p("path"),o=m(),s=d("span"),a=g(k),u=m(),v(i,"stroke-linecap","round"),v(i,"stroke-linejoin","round"),v(i,"stroke-width","2"),v(i,"d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"),v(r,"class","h-4 w-4 text-gray-400 mr-2"),v(r,"fill","none"),v(r,"stroke","currentColor"),v(r,"viewBox","0 0 24 24"),v(s,"class","text-sm text-gray-700"),v(n,"class","flex items-center"),v(t,"type","button"),v(t,"class",f="w-full text-left px-4 py-2 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none "+(e[4]===e[21]?"bg-blue-50":""))},m(e,h){l(e,t,h),c(t,n),c(n,r),c(r,i),c(n,o),c(n,s),c(s,a),c(t,u),w||(x=y(t,"click",_),w=!0)},p(n,r){e=n,4&r&&k!==(k=e[19]+"")&&b(a,k),16&r&&f!==(f="w-full text-left px-4 py-2 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none "+(e[4]===e[21]?"bg-blue-50":""))&&v(t,"class",f)},d(e){e&&h(t),w=!1,x()}}}function en(t){let n,i,o,s,a,u,f,p,g=t[0]&&Qt(t),b=t[3]&&t[2].length>0&&Xt(t);return{c(){n=d("div"),i=d("div"),i.innerHTML='<svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>',o=m(),s=d("input"),a=m(),g&&g.c(),u=m(),b&&b.c(),v(i,"class","absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"),v(s,"type","text"),v(s,"placeholder",t[1]),v(s,"class","block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"),v(s,"autocomplete","off"),v(n,"class","relative mb-6")},m(e,r){l(e,n,r),c(n,i),c(n,o),c(n,s),t[13](s),w(s,t[0]),c(n,a),g&&g.m(n,null),c(n,u),b&&b.m(n,null),f||(p=[y(s,"input",t[14]),y(s,"input",t[6]),y(s,"keydown",t[8]),y(s,"blur",t[10]),y(s,"focus",t[11])],f=!0)},p(e,[t]){2&t&&v(s,"placeholder",e[1]),1&t&&s.value!==e[0]&&w(s,e[0]),e[0]?g?g.p(e,t):(g=Qt(e),g.c(),g.m(n,u)):g&&(g.d(1),g=null),e[3]&&e[2].length>0?b?b.p(e,t):(b=Xt(e),b.c(),b.m(n,null)):b&&(b.d(1),b=null)},i:e,o:e,d(e){e&&h(n),t[13](null),g&&g.d(),b&&b.d(),f=!1,r(p)}}}function tn(e,t,n){const r=O();let i,o,{value:s=""}=t,{placeholder:a="Search bookmarks by title, URL, category, or keywords..."}=t,{showSuggestions:u=!0}=t,c=[],l=!1,h=-1;function f(e){n(0,s=e),n(2,c=[]),n(3,l=!1),r("search",{query:s}),o?.blur()}return e.$$set=e=>{"value"in e&&n(0,s=e.value),"placeholder"in e&&n(1,a=e.placeholder),"showSuggestions"in e&&n(12,u=e.showSuggestions)},[s,a,c,l,h,o,function(e){n(0,s=e.target.value),n(4,h=-1),u&&s.length>=2?async function(e){try{n(2,c=await async function(e,t=10){if(!e||e.length<2)return[];Wt||await Ht();try{const n=await Wt.search(e,{index:["title","category","domain"],limit:2*t,suggest:!0,enrich:!0}),r=new Set;for(const e of n)if(e&&e.result)for(const t of e.result)t.doc&&(t.doc.title&&r.add(t.doc.title),t.doc.domain&&!t.doc.domain.includes("unknown")&&r.add(t.doc.domain),t.doc.category&&r.add(t.doc.category));return Array.from(r).slice(0,t)}catch(e){return console.error("Error getting suggestions:",e),[]}}(e,8)),n(3,l=c.length>0)}catch(e){console.error("Error getting suggestions:",e),n(2,c=[]),n(3,l=!1)}}(s):(n(2,c=[]),n(3,l=!1)),clearTimeout(i),i=setTimeout(()=>{r("search",{query:s})},300)},f,function(e){if(l&&0!==c.length)switch(e.key){case"ArrowDown":e.preventDefault(),n(4,h=Math.min(h+1,c.length-1));break;case"ArrowUp":e.preventDefault(),n(4,h=Math.max(h-1,-1));break;case"Enter":h>=0&&(e.preventDefault(),f(c[h]));break;case"Escape":n(2,c=[]),n(3,l=!1),n(4,h=-1)}},function(){n(0,s=""),n(2,c=[]),n(3,l=!1),r("search",{query:""})},function(){setTimeout(()=>{n(3,l=!1)},200)},function(){c.length>0&&s.length>=2&&n(3,l=!0)},u,function(e){E[e?"unshift":"push"](()=>{o=e,n(5,o)})},function(){s=this.value,n(0,s)},e=>f(e)]}class nn extends J{constructor(e){super(),G(this,e,tn,en,o,{value:0,placeholder:1,showSuggestions:12})}}let rn=null,on=0;async function sn(){try{if(rn&&Date.now()-on<5e3)return rn;const e=await chrome.storage.local.get(["bookmarks"]);return rn=e.bookmarks||[],on=Date.now(),rn}catch(e){return console.error("Error getting bookmarks:",e),[]}}async function an(){try{const e=await sn(),t={};e.forEach(e=>{t[e.domain]||(t[e.domain]={domain:e.domain,count:0,latestDate:0,oldestDate:1/0});const n=t[e.domain];n.count++,e.dateAdded>n.latestDate&&(n.latestDate=e.dateAdded),e.dateAdded<n.oldestDate&&(n.oldestDate=e.dateAdded)});const n=Object.values(t),r=e.length;return n.forEach(e=>{e.percentage=r>0?Math.round(e.count/r*100):0,e.dateAdded=e.latestDate}),{byRecency:[...n].sort((e,t)=>t.latestDate-e.latestDate),byCount:[...n].sort((e,t)=>t.count-e.count),top10:[...n].sort((e,t)=>t.count-e.count).slice(0,10),totalDomains:n.length,totalBookmarks:r}}catch(e){return console.error("Error getting consolidated domain analytics:",e),{byRecency:[],byCount:[],top10:[],totalDomains:0,totalBookmarks:0}}}function un(e,t,n){const r=e.slice();return r[25]=t[n],r}function cn(e,t,n){const r=e.slice();return r[28]=t[n],r}function ln(e,t,n){const r=e.slice();return r[25]=t[n],r}function hn(e,t,n){const r=e.slice();return r[33]=t[n],r}function fn(e){let t,n,r,i,o,s,a,u,f=e[33]+"";function p(){return e[12](e[33])}return{c(){t=d("div"),n=d("div"),r=g("Domain: "),i=g(f),o=m(),s=d("button"),s.textContent="Ã—",v(n,"class","text-xs text-blue-800"),v(s,"class","text-blue-600 hover:text-blue-800"),v(t,"class","flex items-center justify-between p-2 bg-blue-50 rounded-md")},m(e,h){l(e,t,h),c(t,n),c(n,r),c(n,i),c(t,o),c(t,s),a||(u=y(s,"click",p),a=!0)},p(t,n){e=t,4&n[0]&&f!==(f=e[33]+"")&&b(i,f)},d(e){e&&h(t),a=!1,u()}}}function dn(e){let t,n,r,i,o,s,a,u,f=e[25]+"";function p(){return e[13](e[25])}return{c(){t=d("div"),n=d("div"),r=g("Folder: "),i=g(f),o=m(),s=d("button"),s.textContent="Ã—",v(n,"class","text-xs text-green-800"),v(s,"class","text-green-600 hover:text-green-800"),v(t,"class","flex items-center justify-between p-2 bg-green-50 rounded-md")},m(e,h){l(e,t,h),c(t,n),c(n,r),c(n,i),c(t,o),c(t,s),a||(u=y(s,"click",p),a=!0)},p(t,n){e=t,4&n[0]&&f!==(f=e[25]+"")&&b(i,f)},d(e){e&&h(t),a=!1,u()}}}function pn(e){let t,n,r,i,o,s,a,u="week"===e[2].dateRange.period?"This Week":"month"===e[2].dateRange.period?"This Month":"This Year";return{c(){t=d("div"),n=d("div"),r=g(u),i=m(),o=d("button"),o.textContent="Ã—",v(n,"class","text-xs text-purple-800"),v(o,"class","text-purple-600 hover:text-purple-800"),v(t,"class","flex items-center justify-between p-2 bg-purple-50 rounded-md")},m(u,h){l(u,t,h),c(t,n),c(n,r),c(t,i),c(t,o),s||(a=y(o,"click",e[14]),s=!0)},p(e,t){4&t[0]&&u!==(u="week"===e[2].dateRange.period?"This Week":"month"===e[2].dateRange.period?"This Month":"This Year")&&b(r,u)},d(e){e&&h(t),s=!1,a()}}}function gn(e){let t,n,r=xn(e[28].dateAdded||e[28].latestDate)+"";return{c(){t=d("span"),n=g(r)},m(e,r){l(e,t,r),c(t,n)},p(e,t){8&t[0]&&r!==(r=xn(e[28].dateAdded||e[28].latestDate)+"")&&b(n,r)},d(e){e&&h(t)}}}function mn(e){let t,n,r,i,o,s,a,u,f,p,w,k,_,A=e[28].domain+"",O=e[28].count+"",P=1!==e[28].count?"s":"",E="recency"===e[0]&&gn(e);function C(){return e[20](e[28])}return{c(){t=d("button"),n=d("div"),r=g(A),i=m(),o=d("div"),s=d("span"),a=g(O),u=g(" bookmark"),f=g(P),p=m(),E&&E.c(),v(n,"class","truncate font-medium"),v(o,"class","flex justify-between items-center text-xs text-gray-500 mt-1"),v(t,"class","w-full text-left px-2 py-2 text-sm hover:bg-gray-100 rounded border"),v(t,"title",w=e[28].domain),x(t,"bg-blue-50",e[2].domains.includes(e[28].domain)),x(t,"text-blue-700",e[2].domains.includes(e[28].domain)),x(t,"border-blue-200",e[2].domains.includes(e[28].domain)),x(t,"text-gray-600",!e[2].domains.includes(e[28].domain)),x(t,"border-transparent",!e[2].domains.includes(e[28].domain))},m(e,h){l(e,t,h),c(t,n),c(n,r),c(t,i),c(t,o),c(o,s),c(s,a),c(s,u),c(s,f),c(o,p),E&&E.m(o,null),k||(_=y(t,"click",C),k=!0)},p(n,i){e=n,8&i[0]&&A!==(A=e[28].domain+"")&&b(r,A),8&i[0]&&O!==(O=e[28].count+"")&&b(a,O),8&i[0]&&P!==(P=1!==e[28].count?"s":"")&&b(f,P),"recency"===e[0]?E?E.p(e,i):(E=gn(e),E.c(),E.m(o,null)):E&&(E.d(1),E=null),8&i[0]&&w!==(w=e[28].domain)&&v(t,"title",w),12&i[0]&&x(t,"bg-blue-50",e[2].domains.includes(e[28].domain)),12&i[0]&&x(t,"text-blue-700",e[2].domains.includes(e[28].domain)),12&i[0]&&x(t,"border-blue-200",e[2].domains.includes(e[28].domain)),12&i[0]&&x(t,"text-gray-600",!e[2].domains.includes(e[28].domain)),12&i[0]&&x(t,"border-transparent",!e[2].domains.includes(e[28].domain))},d(e){e&&h(t),E&&E.d(),k=!1,_()}}}function yn(e){let t,n,r,i,o=e[3].length-30+"";return{c(){t=d("div"),n=g("... and "),r=g(o),i=g(" more"),v(t,"class","text-xs text-gray-400 px-2 py-1")},m(e,o){l(e,t,o),c(t,n),c(t,r),c(t,i)},p(e,t){8&t[0]&&o!==(o=e[3].length-30+"")&&b(r,o)},d(e){e&&h(t)}}}function vn(e){let t,n,r,i,o,s,a,u=e[25]+"";function f(){return e[21](e[25])}return{c(){t=d("button"),n=d("span"),r=g("ðŸ“ "),i=g(u),v(n,"class","truncate"),v(t,"class","w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded border"),v(t,"title",o=e[25]),x(t,"bg-green-50",e[2].folders.includes(e[25])),x(t,"text-green-700",e[2].folders.includes(e[25])),x(t,"border-green-200",e[2].folders.includes(e[25])),x(t,"text-gray-600",!e[2].folders.includes(e[25])),x(t,"border-transparent",!e[2].folders.includes(e[25]))},m(e,o){l(e,t,o),c(t,n),c(n,r),c(n,i),s||(a=y(t,"click",f),s=!0)},p(n,r){e=n,2&r[0]&&u!==(u=e[25]+"")&&b(i,u),2&r[0]&&o!==(o=e[25])&&v(t,"title",o),6&r[0]&&x(t,"bg-green-50",e[2].folders.includes(e[25])),6&r[0]&&x(t,"text-green-700",e[2].folders.includes(e[25])),6&r[0]&&x(t,"border-green-200",e[2].folders.includes(e[25])),6&r[0]&&x(t,"text-gray-600",!e[2].folders.includes(e[25])),6&r[0]&&x(t,"border-transparent",!e[2].folders.includes(e[25]))},d(e){e&&h(t),s=!1,a()}}}function bn(e){let t,n,r,i,o=e[1].length-15+"";return{c(){t=d("div"),n=g("... and "),r=g(o),i=g(" more"),v(t,"class","text-xs text-gray-400 px-2 py-1")},m(e,o){l(e,t,o),c(t,n),c(t,r),c(t,i)},p(e,t){2&t[0]&&o!==(o=e[1].length-15+"")&&b(r,o)},d(e){e&&h(t)}}}function wn(t){let n,i,o,s,a,u,p,w,k,_,A,O,P,E,C,S,j,D,B,K,T,M,I,R,q,$,F,N,z,U,V,W,Y,H,G,J,Q,X,Z,ee,te,ne,re=t[8](),ie=t[8](),oe=t[3].length+"",se=t[1].length+"",ae=re&&function(t){let n,r,i;return{c(){n=d("button"),n.textContent="Clear All",v(n,"class","text-xs text-blue-600 hover:text-blue-800")},m(e,o){l(e,n,o),r||(i=y(n,"click",t[6]),r=!0)},p:e,d(e){e&&h(n),r=!1,i()}}}(t),ue=ie&&function(e){let t,n,r,i=L(e[2].domains),o=[];for(let t=0;t<i.length;t+=1)o[t]=fn(hn(e,i,t));let s=L(e[2].folders),a=[];for(let t=0;t<s.length;t+=1)a[t]=dn(ln(e,s,t));let u=e[2].dateRange&&pn(e);return{c(){t=d("div");for(let e=0;e<o.length;e+=1)o[e].c();n=m();for(let e=0;e<a.length;e+=1)a[e].c();r=m(),u&&u.c(),v(t,"class","mb-4 space-y-2")},m(e,i){l(e,t,i);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);c(t,n);for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(t,null);c(t,r),u&&u.m(t,null)},p(e,c){if(20&c[0]){let r;for(i=L(e[2].domains),r=0;r<i.length;r+=1){const s=hn(e,i,r);o[r]?o[r].p(s,c):(o[r]=fn(s),o[r].c(),o[r].m(t,n))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}if(36&c[0]){let n;for(s=L(e[2].folders),n=0;n<s.length;n+=1){const i=ln(e,s,n);a[n]?a[n].p(i,c):(a[n]=dn(i),a[n].c(),a[n].m(t,r))}for(;n<a.length;n+=1)a[n].d(1);a.length=s.length}e[2].dateRange?u?u.p(e,c):(u=pn(e),u.c(),u.m(t,null)):u&&(u.d(1),u=null)},d(e){e&&h(t),f(o,e),f(a,e),u&&u.d()}}}(t),ce=L(t[3].slice(0,30)),le=[];for(let e=0;e<ce.length;e+=1)le[e]=mn(cn(t,ce,e));let he=t[3].length>30&&yn(t),fe=L(t[1].slice(0,15)),de=[];for(let e=0;e<fe.length;e+=1)de[e]=vn(un(t,fe,e));let pe=t[1].length>15&&bn(t);return{c(){n=d("div"),i=d("div"),o=d("div"),s=d("h3"),s.textContent="Filters",a=m(),ae&&ae.c(),u=m(),ue&&ue.c(),p=m(),w=d("div"),k=d("h4"),k.textContent="Date Added",_=m(),A=d("div"),O=d("button"),O.textContent="This Week",P=m(),E=d("button"),E.textContent="This Month",C=m(),S=d("button"),S.textContent="This Year",j=m(),D=d("div"),B=d("div"),K=d("h4"),T=g("Domains ("),M=g(oe),I=g(")"),R=m(),q=d("div"),$=d("button"),$.textContent="Recent",F=m(),N=d("button"),N.textContent="Count",z=m(),U=d("div");for(let e=0;e<le.length;e+=1)le[e].c();V=m(),he&&he.c(),W=m(),Y=d("div"),H=d("h4"),G=g("Folders ("),J=g(se),Q=g(")"),X=m(),Z=d("div");for(let e=0;e<de.length;e+=1)de[e].c();ee=m(),pe&&pe.c(),v(s,"class","text-sm font-medium text-gray-900"),v(o,"class","flex items-center justify-between mb-3"),v(i,"class","mb-6"),v(k,"class","text-xs font-medium text-gray-700 uppercase tracking-wide mb-2"),v(O,"class","w-full text-left px-2 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded"),x(O,"bg-blue-50","week"===t[2].dateRange?.period),x(O,"text-blue-700","week"===t[2].dateRange?.period),v(E,"class","w-full text-left px-2 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded"),x(E,"bg-blue-50","month"===t[2].dateRange?.period),x(E,"text-blue-700","month"===t[2].dateRange?.period),v(S,"class","w-full text-left px-2 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded"),x(S,"bg-blue-50","year"===t[2].dateRange?.period),x(S,"text-blue-700","year"===t[2].dateRange?.period),v(A,"class","space-y-1"),v(w,"class","mb-6"),v(K,"class","text-xs font-medium text-gray-700 uppercase tracking-wide"),v($,"class","text-xs px-2 py-1 rounded"),v($,"title","Sort by most recent bookmark"),x($,"bg-blue-100","recency"===t[0]),x($,"text-blue-700","recency"===t[0]),x($,"text-gray-500","recency"!==t[0]),v(N,"class","text-xs px-2 py-1 rounded"),v(N,"title","Sort by bookmark count"),x(N,"bg-blue-100","count"===t[0]),x(N,"text-blue-700","count"===t[0]),x(N,"text-gray-500","count"!==t[0]),v(q,"class","flex space-x-1"),v(B,"class","flex items-center justify-between mb-2"),v(U,"class","space-y-1 max-h-64 overflow-y-auto"),v(D,"class","mb-6"),v(H,"class","text-xs font-medium text-gray-700 uppercase tracking-wide mb-2"),v(Z,"class","space-y-1 max-h-48 overflow-y-auto"),v(Y,"class","mb-6"),v(n,"class","w-64 bg-gray-50 border-r border-gray-200 p-4 overflow-y-auto flex-shrink-0")},m(e,r){l(e,n,r),c(n,i),c(i,o),c(o,s),c(o,a),ae&&ae.m(o,null),c(i,u),ue&&ue.m(i,null),c(n,p),c(n,w),c(w,k),c(w,_),c(w,A),c(A,O),c(A,P),c(A,E),c(A,C),c(A,S),c(n,j),c(n,D),c(D,B),c(B,K),c(K,T),c(K,M),c(K,I),c(B,R),c(B,q),c(q,$),c(q,F),c(q,N),c(D,z),c(D,U);for(let e=0;e<le.length;e+=1)le[e]&&le[e].m(U,null);c(U,V),he&&he.m(U,null),c(n,W),c(n,Y),c(Y,H),c(H,G),c(H,J),c(H,Q),c(Y,X),c(Y,Z);for(let e=0;e<de.length;e+=1)de[e]&&de[e].m(Z,null);c(Z,ee),pe&&pe.m(Z,null),te||(ne=[y(O,"click",t[15]),y(E,"click",t[16]),y(S,"click",t[17]),y($,"click",t[18]),y(N,"click",t[19])],te=!0)},p(e,t){if(re&&ae.p(e,t),ie&&ue.p(e,t),4&t[0]&&x(O,"bg-blue-50","week"===e[2].dateRange?.period),4&t[0]&&x(O,"text-blue-700","week"===e[2].dateRange?.period),4&t[0]&&x(E,"bg-blue-50","month"===e[2].dateRange?.period),4&t[0]&&x(E,"text-blue-700","month"===e[2].dateRange?.period),4&t[0]&&x(S,"bg-blue-50","year"===e[2].dateRange?.period),4&t[0]&&x(S,"text-blue-700","year"===e[2].dateRange?.period),8&t[0]&&oe!==(oe=e[3].length+"")&&b(M,oe),1&t[0]&&x($,"bg-blue-100","recency"===e[0]),1&t[0]&&x($,"text-blue-700","recency"===e[0]),1&t[0]&&x($,"text-gray-500","recency"!==e[0]),1&t[0]&&x(N,"bg-blue-100","count"===e[0]),1&t[0]&&x(N,"text-blue-700","count"===e[0]),1&t[0]&&x(N,"text-gray-500","count"!==e[0]),29&t[0]){let n;for(ce=L(e[3].slice(0,30)),n=0;n<ce.length;n+=1){const r=cn(e,ce,n);le[n]?le[n].p(r,t):(le[n]=mn(r),le[n].c(),le[n].m(U,V))}for(;n<le.length;n+=1)le[n].d(1);le.length=ce.length}if(e[3].length>30?he?he.p(e,t):(he=yn(e),he.c(),he.m(U,null)):he&&(he.d(1),he=null),2&t[0]&&se!==(se=e[1].length+"")&&b(J,se),38&t[0]){let n;for(fe=L(e[1].slice(0,15)),n=0;n<fe.length;n+=1){const r=un(e,fe,n);de[n]?de[n].p(r,t):(de[n]=vn(r),de[n].c(),de[n].m(Z,ee))}for(;n<de.length;n+=1)de[n].d(1);de.length=fe.length}e[1].length>15?pe?pe.p(e,t):(pe=bn(e),pe.c(),pe.m(Z,null)):pe&&(pe.d(1),pe=null)},i:e,o:e,d(e){e&&h(n),ae&&ae.d(),ue&&ue.d(),f(le,e),he&&he.d(),f(de,e),pe&&pe.d(),te=!1,r(ne)}}}function xn(e){const t=Date.now()-e,n=Math.floor(t/864e5);return 0===n?"Today":1===n?"1 day ago":n<7?`${n} days ago`:n<30?`${Math.floor(n/7)} weeks ago`:n<365?`${Math.floor(n/30)} months ago`:`${Math.floor(n/365)} years ago`}function kn(e,t,n){let r;const i=O();let o=[],s=[],a=[],u={domains:[],folders:[],dateRange:null},c="recency";function l(e){u.domains.includes(e)?n(2,u.domains=u.domains.filter(t=>t!==e),u):n(2,u.domains=[...u.domains,e],u),f()}function h(e){u.folders.includes(e)?n(2,u.folders=u.folders.filter(t=>t!==e),u):n(2,u.folders=[...u.folders,e],u),f()}function f(){i("filter",u)}function d(e){const t=new Date;let r;switch(e){case"week":r=new Date(t.getTime()-6048e5);break;case"month":r=new Date(t.getFullYear(),t.getMonth(),1);break;case"year":r=new Date(t.getFullYear(),0,1)}!function(e,t,r){n(2,u.dateRange={startDate:e,endDate:t,period:r},u),f()}(r.getTime(),t.getTime(),e)}A(async()=>{try{await async function(){n(10,o=await async function(){return(await an()).byRecency}()),n(11,s=await async function(){return(await an()).byCount}())}(),n(1,a=await async function(){try{const e=await sn();return[...new Set(e.map(e=>e.folderPath).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique folders:",e),[]}}())}catch(e){console.error("Error loading filters:",e)}});return e.$$.update=()=>{3073&e.$$.dirty[0]&&n(3,r="recency"===c?o:s)},[c,a,u,r,l,h,function(){n(2,u={domains:[],folders:[],dateRange:null}),f()},f,function(){return u.domains.length>0||u.folders.length>0||null!==u.dateRange},d,o,s,e=>l(e),e=>h(e),()=>{n(2,u.dateRange=null,u),f()},()=>d("week"),()=>d("month"),()=>d("year"),()=>n(0,c="recency"),()=>n(0,c="count"),e=>l(e.domain),e=>h(e)]}class _n extends J{constructor(e){super(),G(this,e,kn,wn,o,{},null,[-1,-1])}}function An(e,t,n){const r=e.slice();return r[9]=t[n],r}function On(t){let n,r;return n=new _n({}),n.$on("filter",t[7]),{c(){V(n.$$.fragment)},m(e,t){W(n,e,t),r=!0},p:e,i(e){r||(N(n.$$.fragment,e),r=!0)},o(e){z(n.$$.fragment,e),r=!1},d(e){Y(n,e)}}}function Pn(e){let t,n,i=[],o=new Map,s=L(e[0]);const a=e=>e[9].id;for(let t=0;t<s.length;t+=1){let n=An(e,s,t),r=a(n);o.set(r,i[t]=jn(r,n))}return{c(){t=d("div");for(let e=0;e<i.length;e+=1)i[e].c();v(t,"class","space-y-3")},m(e,r){l(e,t,r);for(let e=0;e<i.length;e+=1)i[e]&&i[e].m(t,null);n=!0},p(e,n){1&n&&(s=L(e[0]),$(),i=function(e,t,n,i,o,s,a,u,c,l,h,f){let d=e.length,p=s.length,g=d;const m={};for(;g--;)m[e[g].key]=g;const y=[],v=new Map,b=new Map,w=[];for(g=p;g--;){const e=f(o,s,g),r=n(e);let u=a.get(r);u?i&&w.push(()=>u.p(e,t)):(u=l(r,e),u.c()),v.set(r,y[g]=u),r in m&&b.set(r,Math.abs(g-m[r]))}const x=new Set,k=new Set;function _(e){N(e,1),e.m(u,h),a.set(e.key,e),h=e.first,p--}for(;d&&p;){const t=y[p-1],n=e[d-1],r=t.key,i=n.key;t===n?(h=t.first,d--,p--):v.has(i)?!a.has(r)||x.has(r)?_(t):k.has(i)?d--:b.get(r)>b.get(i)?(k.add(r),_(t)):(x.add(i),d--):(c(n,a),d--)}for(;d--;){const t=e[d];v.has(t.key)||c(t,a)}for(;p;)_(y[p-1]);return r(w),y}(i,n,a,1,e,s,o,t,U,jn,null,An),F())},i(e){if(!n){for(let e=0;e<s.length;e+=1)N(i[e]);n=!0}},o(e){for(let e=0;e<i.length;e+=1)z(i[e]);n=!1},d(e){e&&h(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function En(t){let n;function r(e,t){return e[3]?Bn:Dn}let i=r(t),o=i(t);return{c(){n=d("div"),o.c(),v(n,"class","text-center text-gray-500 p-4")},m(e,t){l(e,n,t),o.m(n,null)},p(e,t){i===(i=r(e))&&o?o.p(e,t):(o.d(1),o=i(e),o&&(o.c(),o.m(n,null)))},i:e,o:e,d(e){e&&h(n),o.d()}}}function Cn(t){let n,r,i,o,s,a,u,f;return{c(){n=d("div"),r=d("p"),i=g("Error: "),o=g(t[2]),s=m(),a=d("button"),a.textContent="Retry",v(a,"class","mt-2 px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700"),v(n,"class","text-center text-red-600 p-4")},m(e,h){l(e,n,h),c(n,r),c(r,i),c(r,o),c(n,s),c(n,a),u||(f=y(a,"click",t[5]),u=!0)},p(e,t){4&t&&b(o,e[2])},i:e,o:e,d(e){e&&h(n),u=!1,f()}}}function Sn(t){let n;return{c(){n=d("div"),n.innerHTML='<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>',v(n,"class","flex items-center justify-center h-32")},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&h(n)}}}function jn(e,t){let n,r,i;return r=new se({props:{bookmark:t[9]}}),{key:e,first:null,c(){n=g(""),V(r.$$.fragment),this.first=n},m(e,t){l(e,n,t),W(r,e,t),i=!0},p(e,n){t=e;const i={};1&n&&(i.bookmark=t[9]),r.$set(i)},i(e){i||(N(r.$$.fragment,e),i=!0)},o(e){z(r.$$.fragment,e),i=!1},d(e){e&&h(n),Y(r,e)}}}function Dn(t){let n;return{c(){n=d("p"),n.textContent="No bookmarks found"},m(e,t){l(e,n,t)},p:e,d(e){e&&h(n)}}}function Bn(e){let t,n,r,i;return{c(){t=d("p"),n=g('No bookmarks found for "'),r=g(e[3]),i=g('"')},m(e,o){l(e,t,o),c(t,n),c(t,r),c(t,i)},p(e,t){8&t&&b(r,e[3])},d(e){e&&h(t)}}}function Kn(e){let t,n,i,o,s,a,u,f,p,w,x,k,_,A,O,P,E,C,S,j,D,B,K,T,M,I=e[0].length+"",R=1!==e[0].length?"s":"";x=new nn({}),x.$on("search",e[6]);let q=e[4]&&On(e);const L=[Sn,Cn,En,Pn],U=[];function H(e,t){return e[1]?0:e[2]?1:0===e[0].length?2:3}return D=H(e),B=U[D]=L[D](e),{c(){t=d("div"),n=d("div"),i=d("div"),o=d("h1"),o.textContent="Bookmark Insight",s=m(),a=d("div"),u=d("button"),u.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"></path></svg>',f=m(),p=d("button"),p.textContent="Dashboard",w=m(),V(x.$$.fragment),k=m(),_=d("div"),A=g(I),O=g(" bookmark"),P=g(R),E=m(),C=d("div"),q&&q.c(),S=m(),j=d("div"),B.c(),v(o,"class","text-lg font-semibold text-gray-900"),v(u,"class","p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100"),v(u,"title","Toggle Filters"),v(p,"class","px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700"),v(a,"class","flex space-x-2"),v(i,"class","flex items-center justify-between mb-3"),v(_,"class","text-xs text-gray-500"),v(n,"class","p-4 border-b border-gray-200 bg-gray-50"),v(j,"class","flex-1 overflow-y-auto p-4"),v(C,"class","flex flex-1 overflow-hidden"),v(t,"class","w-96 h-96 bg-white flex flex-col")},m(r,h){l(r,t,h),c(t,n),c(n,i),c(i,o),c(i,s),c(i,a),c(a,u),c(a,f),c(a,p),c(n,w),W(x,n,null),c(n,k),c(n,_),c(_,A),c(_,O),c(_,P),c(t,E),c(t,C),q&&q.m(C,null),c(C,S),c(C,j),U[D].m(j,null),K=!0,T||(M=[y(u,"click",e[8]),y(p,"click",Tn)],T=!0)},p(e,[t]){(!K||1&t)&&I!==(I=e[0].length+"")&&b(A,I),(!K||1&t)&&R!==(R=1!==e[0].length?"s":"")&&b(P,R),e[4]?q?(q.p(e,t),16&t&&N(q,1)):(q=On(e),q.c(),N(q,1),q.m(C,S)):q&&($(),z(q,1,1,()=>{q=null}),F());let n=D;D=H(e),D===n?U[D].p(e,t):($(),z(U[n],1,1,()=>{U[n]=null}),F(),B=U[D],B?B.p(e,t):(B=U[D]=L[D](e),B.c()),N(B,1),B.m(j,null))},i(e){K||(N(x.$$.fragment,e),N(q),N(B),K=!0)},o(e){z(x.$$.fragment,e),z(q),z(B),K=!1},d(e){e&&h(t),Y(x),q&&q.d(),U[D].d(),T=!1,r(M)}}}function Tn(){chrome.tabs.create({url:chrome.runtime.getURL("dashboard.html")}),window.close()}function Mn(e,t,n){let r=[],i=!0,o=null,s="",a=!1;async function u(){n(0,r=await sn())}return A(async()=>{try{await u()}catch(e){n(2,o=e.message)}finally{n(1,i=!1)}}),[r,i,o,s,a,u,async function(e){const t=e.detail.query;n(3,s=t);try{n(1,i=!0),n(0,r=await async function(e){try{const t=await sn();if(!e.trim())return t.sort((e,t)=>t.dateAdded-e.dateAdded);const n=e.toLowerCase();return t.filter(e=>e.title.toLowerCase().includes(n)||e.url.toLowerCase().includes(n)||e.domain.toLowerCase().includes(n)).sort((e,t)=>t.dateAdded-e.dateAdded)}catch(e){return console.error("Search error:",e),[]}}(t))}catch(e){n(2,o=e.message)}finally{n(1,i=!1)}},async function(e){const{type:t,value:s}=e.detail;try{switch(n(1,i=!0),t){case"clear":n(0,r=await sn());break;case"domain":n(0,r=await async function(e){try{return(await sn()).filter(t=>t.domain===e)}catch(e){return console.error("Error getting bookmarks by domain:",e),[]}}(s));break;case"folder":n(0,r=await async function(e){try{return(await sn()).filter(t=>t.folderPath===e)}catch(e){return console.error("Error getting bookmarks by folder:",e),[]}}(s));break;case"date":n(0,r=await async function(e,t){try{return(await sn()).filter(n=>n.dateAdded>=e&&n.dateAdded<=t)}catch(e){return console.error("Error getting bookmarks by date range:",e),[]}}(s.startDate,s.endDate))}}catch(e){n(2,o=e.message)}finally{n(1,i=!1)}},function(){n(4,a=!a)}]}const In=new class extends J{constructor(e){super(),G(this,e,Mn,Kn,o,{})}}({target:document.body});var Rn=Object.freeze({__proto__:null,default:{}});export{In as default};
//# sourceMappingURL=popup.js.map
