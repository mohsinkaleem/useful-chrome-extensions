var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n={exports:{}};n.exports=function(){
/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.
	    Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.
	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */
var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:e,a=Object.keys,s=Array.isArray;function c(e,t){return"object"!=typeof t||a(t).forEach(function(n){e[n]=t[n]}),e}"undefined"==typeof Promise||o.Promise||(o.Promise=Promise);var u=Object.getPrototypeOf,l={}.hasOwnProperty;function h(e,t){return l.call(e,t)}function f(e,t){"function"==typeof t&&(t=t(u(e))),("undefined"==typeof Reflect?a:Reflect.ownKeys)(t).forEach(function(n){p(e,n,t[n])})}var d=Object.defineProperty;function p(e,t,n,r){d(e,t,c(n&&h(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function m(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,"constructor",e),{extend:f.bind(null,e.prototype)}}}}var g=Object.getOwnPropertyDescriptor;function y(e,t){var n;return g(e,t)||(n=u(e))&&y(n,t)}var v=[].slice;function b(e,t,n){return v.call(e,t,n)}function w(e,t){return t(e)}function k(e){if(!e)throw new Error("Assertion Failed")}function x(e){o.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){return e.reduce(function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function A(e,t){if("string"==typeof t&&h(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=A(e,t[r]);n.push(o)}return n}var a=t.indexOf(".");if(-1!==a){var s=e[t.substr(0,a)];return null==s?void 0:A(s,t.substr(a+1))}}function E(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){k("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)E(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var a=t.substr(0,o),c=t.substr(o+1);if(""===c)void 0===n?s(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var u=e[a];u&&h(e,a)||(u=e[a]={}),E(u,c,n)}}else void 0===n?s(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function S(e,t){"string"==typeof t?E(e,t,void 0):"length"in t&&[].map.call(t,function(t){E(e,t,void 0)})}function C(e){var t={};for(var n in e)h(e,n)&&(t[n]=e[n]);return t}var P=[].concat;function O(e){return P.apply([],e)}var B="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(O([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return o[e]}),D=new Set(B.map(function(e){return o[e]}));function I(e){var t={};for(var n in e)if(h(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||D.has(r.constructor)?r:I(r)}return t}function j(e){for(var t in e)if(h(e,t))return!1;return!0}var T=null;function M(e){T=new WeakMap;var t=q(e);return T=null,t}function q(e){if(!e||"object"!=typeof e)return e;var t=T.get(e);if(t)return t;if(s(e)){t=[],T.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(q(e[n]))}else if(D.has(e.constructor))t=e;else{var i=u(e);for(var o in t=i===Object.prototype?{}:Object.create(i),T.set(e,t),e)h(e,o)&&(t[o]=q(e[o]))}return t}var K={}.toString;function R(e){return K.call(e).slice(8,-1)}var L="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",z="symbol"==typeof L?function(e){var t;return null!=e&&(t=e[L])&&t.apply(e)}:function(){return null};function F(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var N={};function $(e){var t,n,r,i;if(1===arguments.length){if(s(e))return e.slice();if(this===N&&"string"==typeof e)return[e];if(i=z(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var U="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Q=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function V(e,t){this.name=e,this.message=t}function H(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function Y(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=H(e,t)}function J(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=H(e,this.failures)}m(V).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(Y).from(V),m(J).from(V);var X=Q.reduce(function(e,t){return e[t]=t+"Error",e},{}),Z=V,ee=Q.reduce(function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=G[t]||n,this.inner=null)}return m(r).from(Z),e[t]=r,e},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=W.reduce(function(e,t){return e[t+"Error"]=ee[t],e},{});function ne(e,t){if(!e||e instanceof V||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&p(n,"stack",{get:function(){return this.inner.stack}}),n}var re=Q.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e},{});function ie(){}function oe(e){return e}function ae(e,t){return null==e||e===oe?t:function(n){return t(e(n))}}function se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?se(i,this.onerror):i),void 0!==o?o:n}}function ue(e,t){return e===ie?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?se(r,this.onerror):r)}}function le(e,t){return e===ie?t:function(n){var r=e.apply(this,arguments);c(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?se(i,this.onsuccess):i),o&&(this.onerror=this.onerror?se(o,this.onerror):o),void 0===r?void 0===a?void 0:a:c(r,a)}}function he(e,t){return e===ie?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}re.ModifyError=Y,re.DexieError=V,re.BulkError=J;var de="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pe(e,t){de=e}var me={},ge=100,ye="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,u(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,u(t),e]}(),ve=ye[0],be=ye[1],we=ye[2],ke=be&&be.then,xe=ve&&ve.constructor,_e=!!we;function Ae(){queueMicrotask(Ue)}var Ee=function(e,t){je.push([e,t]),Ce&&(Ae(),Ce=!1)},Se=!0,Ce=!0,Pe=[],Oe=[],Be=oe,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ie,pgp:!1,env:{},finalize:ie},Ie=De,je=[],Te=0,Me=[];function qe(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Ie;if("function"!=typeof e){if(e!==me)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ze(this,this._value))}this._state=null,this._value=null,++t.ref,Le(this,e)}var Ke={get:function(){var e=Ie,t=rt;function n(n,r){var i=this,o=!e.global&&(e!==Ie||t!==rt),a=o&&!st(),s=new qe(function(t,s){Ne(i,new Re(pt(n,e,o,a),pt(r,e,o,a),t,s,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=me,n},set:function(e){p(this,"then",e&&e.prototype===me?Ke:{get:function(){return e},set:Ke.set})}};function Re(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Le(e,t){try{t(function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&We();t&&"function"==typeof t.then?Le(e,function(e,n){t instanceof qe?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,Fe(e)),n&&Qe()}},ze.bind(null,e))}catch(t){ze(e,t)}}function ze(e,t){if(Oe.push(t),null===e._state){var n=e._lib&&We();t=Be(t),e._state=!1,e._value=t,He(e),Fe(e),n&&Qe()}}function Fe(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ne(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Te&&(++Te,Ee(function(){0===--Te&&Ge()},[]))}function Ne(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Te,Ee($e,[n,e,t])}else e._listeners.push(t)}function $e(e,t,n){try{var r,i=t._value;!t._state&&Oe.length&&(Oe=[]),r=de&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||-1!==Oe.indexOf(i)||Ye(t),n.resolve(r)}catch(e){n.reject(e)}finally{0===--Te&&Ge(),--n.psd.ref||n.psd.finalize()}}function Ue(){dt(De,function(){We()&&Qe()})}function We(){var e=Se;return Se=!1,Ce=!1,e}function Qe(){var e,t,n;do{for(;je.length>0;)for(e=je,je=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(je.length>0);Se=!0,Ce=!0}function Ge(){var e=Pe;Pe=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Me.slice(0),n=t.length;n;)t[--n]()}function Ve(e){function t(){e(),Me.splice(Me.indexOf(t),1)}Me.push(t),++Te,Ee(function(){0===--Te&&Ge()},[])}function He(e){Pe.some(function(t){return t._value===e._value})||Pe.push(e)}function Ye(e){for(var t=Pe.length;t;)if(Pe[--t]._value===e._value)return void Pe.splice(t,1)}function Je(e){return new qe(me,!1,e)}function Xe(e,t){var n=Ie;return function(){var r=We(),i=Ie;try{return ht(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ht(i,!1),r&&Qe()}}}f(qe.prototype,{then:Ke,_then:function(e,t){Ne(this,new Re(null,null,e,t,Ie))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):Je(e)}):this.then(null,function(e){return e&&e.name===t?n(e):Je(e)})},finally:function(e){return this.then(function(t){return qe.resolve(e()).then(function(){return t})},function(t){return qe.resolve(e()).then(function(){return Je(t)})})},timeout:function(e,t){var n=this;return e<1/0?new qe(function(r,i){var o=setTimeout(function(){return i(new ee.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(qe.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=ft(),f(qe,{all:function(){var e=$.apply(null,arguments).map(ct);return new qe(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(i,o){return qe.resolve(i).then(function(n){e[o]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof qe?e:e&&"function"==typeof e.then?new qe(function(t,n){e.then(t,n)}):new qe(me,!0,e)},reject:Je,race:function(){var e=$.apply(null,arguments).map(ct);return new qe(function(t,n){e.map(function(e){return qe.resolve(e).then(t,n)})})},PSD:{get:function(){return Ie},set:function(e){return Ie=e}},totalEchoes:{get:function(){return rt}},newPSD:ot,usePSD:dt,scheduler:{get:function(){return Ee},set:function(e){Ee=e}},rejectionMapper:{get:function(){return Be},set:function(e){Be=e}},follow:function(e,t){return new qe(function(n,r){return ot(function(t,n){var r=Ie;r.unhandleds=[],r.onunhandled=n,r.finalize=se(function(){var e=this;Ve(function(){0===e.unhandleds.length?t():n(e.unhandleds[0])})},r.finalize),e()},t,n,r)})}}),xe&&(xe.allSettled&&p(qe,"allSettled",function(){var e=$.apply(null,arguments).map(ct);return new qe(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(e,i){return qe.resolve(e).then(function(e){return r[i]={status:"fulfilled",value:e}},function(e){return r[i]={status:"rejected",reason:e}}).then(function(){return--n||t(r)})})})}),xe.any&&"undefined"!=typeof AggregateError&&p(qe,"any",function(){var e=$.apply(null,arguments).map(ct);return new qe(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(e,o){return qe.resolve(e).then(function(e){return t(e)},function(e){i[o]=e,--r||n(new AggregateError(i))})})})}),xe.withResolvers&&(qe.withResolvers=xe.withResolvers));var Ze={awaits:0,echoes:0,id:0},et=0,tt=[],nt=0,rt=0,it=0;function ot(e,t,n,r){var i=Ie,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++it,De.env,o.env=_e?{Promise:qe,PromiseProp:{value:qe,configurable:!0,writable:!0},all:qe.all,race:qe.race,allSettled:qe.allSettled,any:qe.any,resolve:qe.resolve,reject:qe.reject}:{},t&&c(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=dt(o,e,n,r);return 0===o.ref&&o.finalize(),a}function at(){return Ze.id||(Ze.id=++et),++Ze.awaits,Ze.echoes+=ge,Ze.id}function st(){return!!Ze.awaits&&(0===--Ze.awaits&&(Ze.id=0),Ze.echoes=Ze.awaits*ge,!0)}function ct(e){return Ze.echoes&&e&&e.constructor===xe?(at(),e.then(function(e){return st(),e},function(e){return st(),gt(e)})):e}function ut(e){++rt,Ze.echoes&&0!==--Ze.echoes||(Ze.echoes=Ze.awaits=Ze.id=0),tt.push(Ie),ht(e,!0)}function lt(){var e=tt[tt.length-1];tt.pop(),ht(e,!1)}function ht(e,t){var n=Ie;if((t?!Ze.echoes||nt++&&e===Ie:!nt||--nt&&e===Ie)||queueMicrotask(t?ut.bind(null,e):lt),e!==Ie&&(Ie=e,n===De&&(De.env=ft()),_e)){var r=De.env.Promise,i=e.env;(n.global||e.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ft(){var e=o.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function dt(e,t,n,r,i){var o=Ie;try{return ht(e,!0),t(n,r,i)}finally{ht(o,!1)}}function pt(e,t,n,r){return"function"!=typeof e?e:function(){var i=Ie;n&&at(),ht(t,!0);try{return e.apply(this,arguments)}finally{ht(i,!1),r&&queueMicrotask(st)}}}function mt(e){Promise===xe&&0===Ze.echoes?0===nt?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+ke).indexOf("[native code]")&&(at=st=ie);var gt=qe.reject;function yt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ie.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return yt(e,t,n,r)})):gt(i)}return i._promise(t,function(e,t){return ot(function(){return Ie.trans=i,r(e,t,i)})}).then(function(e){if("readwrite"===t)try{i.idbtrans.commit()}catch(e){}return"readonly"===t?e:i._completion.then(function(){return e})})}if(e._state.openComplete)return gt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return gt(new ee.DatabaseClosed);e.open().catch(ie)}return e._state.dbReadyPromise.then(function(){return yt(e,t,n,r)})}var vt="4.2.1",bt=String.fromCharCode(65535),wt=-1/0,kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xt="String expected.",_t=[],At="__dbnames",Et="readonly",St="readwrite";function Ct(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Pt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ot(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=M(t))[e],t}}function Bt(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Dt(e,t){try{var n=Tt(e),r=Tt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return jt(Mt(e),Mt(t));case"Array":return It(e,t)}}catch(e){}return NaN}function It(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var a=Dt(e[o],t[o]);if(0!==a)return a}return n===r?0:n<r?-1:1}function jt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}function Tt(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=R(e);return"ArrayBuffer"===n?"binary":n}function Mt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function qt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){var r=n.updatesTable;return t?e.db.table(r).where("k").anyOf(t).delete():e.db.table(r).clear()})).then(function(){return n})):n}var Kt=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var t,n=this["@@propmod"];if(void 0!==n.add){var r=n.add;if(s(r))return i(i([],s(e)?e:[],!0),r,!0).sort();if("number"==typeof r)return(Number(e)||0)+r;if("bigint"==typeof r)try{return BigInt(e)+r}catch(e){return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(void 0!==n.remove){var o=n.remove;if(s(o))return s(e)?e.filter(function(e){return!o.includes(e)}).sort():[];if("number"==typeof o)return Number(e)-o;if("bigint"==typeof o)try{return BigInt(e)-o}catch(e){return BigInt(0)-o}throw new TypeError("Invalid subtrahend ".concat(o))}var a=null===(t=n.replacePrefix)||void 0===t?void 0:t[0];return a&&"string"==typeof e&&e.startsWith(a)?n.replacePrefix[1]+e.substring(a.length):e},e}();function Rt(e,t){for(var n=a(t),r=n.length,i=!1,o=0;o<r;++o){var s=n[o],c=t[s],u=A(e,s);c instanceof Kt?(E(e,s,c.execute(u)),i=!0):u!==c&&(E(e,s,c),i=!0)}return i}var Lt=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||Ie.trans,i=this.name,o=de&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function a(e,n,r){if(!r.schema[i])throw new ee.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var s=We();try{var c=r&&r.db._novip===this.db._novip?r===Ie.trans?r._promise(e,a,n):ot(function(){return r._promise(e,a,n)},{trans:r,transless:Ie.transless||Ie}):yt(this.db,e,[this.name],a);return o&&(c._consoleTask=o,c=c.catch(function(e){return console.trace(e),gt(e)})),c}finally{s&&Qe()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?gt(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(s(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=a(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return e.keyPath.indexOf(t)>=0})){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==bt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&de&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function o(e,t){return 0===Dt(e,t)}var c=t.reduce(function(t,n){var r=t[0],a=t[1],c=i[n],u=e[n];return[r||c,r||!c?Ct(a,c&&c.multi?function(e){var t=A(e,n);return s(t)&&t.some(function(e){return o(u,e)})}:function(e){return o(u,A(e,n))}):a]},[null,null]),u=c[0],l=c[1];return u?this.where(u.name).equals(e[u.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,s(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var t=this,r=t.db,i=t.name;this.schema.mappedClass=e,e.prototype instanceof Bt&&(e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),t.prototype.table=function(){return i},t}(e));for(var o=new Set,a=e.prototype;a;a=u(a))Object.getOwnPropertyNames(a).forEach(function(e){return o.add(e)});var s=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!o.has(r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=s,this.hook("reading",s),e},e.prototype.defineClass=function(){function e(e){c(this,e)}return this.mapToClass(e)},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=Ot(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[a]})}).then(function(e){return e.numFailures?qe.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{E(e,o,t)}catch(e){}return t})},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(i){return n.core.get({trans:i,key:e}).then(function(o){var a=null!=o?o:{};return Rt(a,t),r&&E(a,r,e),n.core.mutate({trans:i,type:"put",values:[a],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?qe.reject(e.failures[0]):!!o})})})},e.prototype.update=function(e,t){if("object"!=typeof e||s(e))return this.where(":id").equals(e).modify(t);var n=A(e,this.schema.primKey.keyPath);return void 0===n?gt(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=Ot(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=t?[t]:null})}).then(function(e){return e.numFailures?qe.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{E(e,o,t)}catch(e){}return t})},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(n){return qt(t,[e],n)}).then(function(e){return e.numFailures?qe.reject(e.failures[0]):void 0})})},e.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Pt}).then(function(t){return qt(e,null,t)})}).then(function(e){return e.numFailures?qe.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&i)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,u=s&&a?e.map(Ot(s)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:u,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,a=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(c," operations failed"),a)})})},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&i)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,u=s&&a?e.map(Ot(s)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:u,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,a=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(c," operations failed"),a)})})},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),o=[];return this._trans("readwrite",function(a){return n.getMany({trans:a,keys:r,cache:"clone"}).then(function(s){var c=[],u=[];e.forEach(function(e,n){var r=e.key,i=e.changes,a=s[n];if(a){for(var l=0,h=Object.keys(i);l<h.length;l++){var f=h[l],d=i[f];if(f===t.schema.primKey.keyPath){if(0!==Dt(d,r))throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else E(a,f,d)}o.push(n),c.push(r),u.push(a)}});var l=c.length;return n.mutate({trans:a,type:"put",keys:c,values:u,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(0===n)return l;for(var i=0,a=Object.keys(r);i<a.length;i++){var s=a[i],c=o[Number(s)];if(null!=c){var u=r[s];delete r[s],r[c]=u}}throw new J("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(l," operations failed"),r)})})})},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e}).then(function(n){return qt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new J("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),o)})},e}();function zt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(e,r,i){if("object"==typeof e)return c(e);r||(r=he),i||(i=ie);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter(function(t){return t!==e}),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function c(e){a(e).forEach(function(t){var n=e[t];if(s(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ee.InvalidArgument("Invalid event config");var r=o(t,oe,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){x(function(){e.apply(null,t)})})})}})}}function Ft(e,t){return m(t).from({prototype:e}),t}function Nt(e){return Ft(Lt.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:zt(null,{creating:[ce,ie],reading:[ae,oe],updating:[le,ie],deleting:[ue,ie]})})}function $t(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ut(e,t){e.filter=Ct(e.filter,t)}function Wt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ct(r(),t())}:t,e.justLimit=n&&!r}function Qt(e,t){e.isMatch=Ct(e.isMatch,t)}function Gt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Vt(e,t,n){var r=Gt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ht(e,t,n,r){var i=e.replayFilter?Ct(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},a=function(e,n,r){if(!i||i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})){var a=n.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),h(o,s)||(o[s]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(a,n),Yt(Vt(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return Yt(Vt(e,r,n),Ct(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Yt(e,t,n,r){var i=Xe(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=ie},function(t){e.fail(t),n=ie})||i(e.value,e,function(e){return n=e}),n()})})}var Jt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,gt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,gt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ct(t.algorithm,e)},e.prototype._iterate=function(e,t){return Ht(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&c(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Ht(t,e,n,t.table.core)})},e.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if($t(n,!0))return r.count({trans:e,query:{index:Gt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Ht(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var a="next"===this._ctx.dir?1:-1;function s(e,t){return Dt(o(e,i),o(t,i))*a}return this.toArray(function(e){return e.sort(s)}).then(t)},e.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if("next"===n.dir&&$t(n,!0)&&n.limit>0){var r=n.valueMapper,i=Gt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){var t=e.result;return r?t.map(r):t})}var o=[];return Ht(n,function(e){return o.push(e)},e,n.table.core).then(function(){return o})},e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,$t(t)?Wt(t,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}):Wt(t,function(){var t=e;return function(){return--t<0}})),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},e.prototype.until=function(e,t){return Ut(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Ut(this._ctx,function(t){return e(t.value)}),Qt(this._ctx,e),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&$t(t,!0)&&t.limit>0)return this._read(function(e){var n=Gt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Ut(this._ctx,function(e){var t=e.primaryKey.toString(),r=h(n,t);return n[t]=!0,!r}),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i;i="function"==typeof e?e:function(t){return Rt(t,e)};var o=n.table.core,s=o.schema.primaryKey,c=s.outbound,u=s.extractKey,l=200,h=t.db._options.modifyChunkSize;h&&(l="object"==typeof h?h[o.name]||h["*"]||200:h);var f=[],d=0,p=[],m=function(e,t){var n=t.failures,r=t.numFailures;d+=e-r;for(var i=0,o=a(n);i<o.length;i++){var s=o[i];f.push(n[s])}},g=e===Xt;return t.clone().primaryKeys().then(function(t){var a=$t(n)&&n.limit===1/0&&("function"!=typeof e||g)&&{index:n.index,range:n.range},s=function(h){var f=Math.min(l,t.length-h),d=t.slice(h,h+f);return(g?Promise.resolve([]):o.getMany({trans:r,keys:d,cache:"immutable"})).then(function(p){var y=[],v=[],b=c?[]:null,w=g?d:[];if(!g)for(var k=0;k<f;++k){var x=p[k],_={value:M(x),primKey:t[h+k]};!1!==i.call(_,_.value,_)&&(null==_.value?w.push(t[h+k]):c||0===Dt(u(x),u(_.value))?(v.push(_.value),c&&b.push(t[h+k])):(w.push(t[h+k]),y.push(_.value)))}return Promise.resolve(y.length>0&&o.mutate({trans:r,type:"add",values:y}).then(function(e){for(var t in e.failures)w.splice(parseInt(t),1);m(y.length,e)})).then(function(){return(v.length>0||a&&"object"==typeof e)&&o.mutate({trans:r,type:"put",keys:b,values:v,criteria:a,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:h>0}).then(function(e){return m(v.length,e)})}).then(function(){return(w.length>0||a&&g)&&o.mutate({trans:r,type:"delete",keys:w,criteria:a,isAdditionalChunk:h>0}).then(function(e){return qt(n.table,w,e)}).then(function(e){return m(w.length,e)})}).then(function(){return t.length>h+f&&s(h+l)})})};return s(0).then(function(){if(f.length>0)throw new Y("Error modifying one or more objects",f,d,p);return t.length})})})},e.prototype.delete=function(){var e=this._ctx,t=e.range;return!$t(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(Xt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(e){var n=e.failures,r=e.numFailures;if(r)throw new Y("Could not delete some values",Object.keys(n).map(function(e){return n[e]}),t-r);return t-r})})})},e}(),Xt=function(e,t){return t.value=null};function Zt(e){return Ft(Jt.prototype,function(t,n){this.db=e;var r=Pt,i=null;if(n)try{r=n()}catch(e){i=e}var o=t._ctx,a=o.table,s=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:s!==oe?s:null}})}function en(e,t){return e<t?-1:e===t?0:1}function tn(e,t){return e>t?-1:e===t?0:1}function nn(e,t,n){var r=e instanceof hn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function rn(e){return new e.Collection(e,function(){return ln("")}).limit(0)}function on(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function an(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function sn(e,t,n,r,i,o){for(var a=Math.min(e.length,r.length),s=-1,c=0;c<a;++c){var u=t[c];if(u!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],u)<0&&(s=c)}return a<r.length&&"next"===o?e+n.substr(e.length):a<e.length&&"prev"===o?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function cn(e,t,n,r){var i,o,a,s,c,u,l,h=n.length;if(!n.every(function(e){return"string"==typeof e}))return nn(e,xt);function f(e){i=on(e),o=an(e),a="next"===e?en:tn;var t=n.map(function(e){return{lower:o(e),upper:i(e)}}).sort(function(e,t){return a(e.lower,t.lower)});s=t.map(function(e){return e.upper}),c=t.map(function(e){return e.lower}),u=e,l="next"===e?"":r}f("next");var d=new e.Collection(e,function(){return un(s[0],c[h-1]+r)});d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var f=o(i);if(t(f,c,p))return!0;for(var d=null,m=p;m<h;++m){var g=sn(i,f,s[m],c[m],a,u);null===g&&null===d?p=m+1:(null===d||a(d,g)>0)&&(d=g)}return n(null!==d?function(){e.continue(d+l)}:r),!1}),d}function un(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ln(e){return{type:1,lower:e,upper:e}}var hn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?rn(this):new this.Collection(this,function(){return un(e,t,!n,!r)})}catch(e){return nn(this,kt)}},e.prototype.equals=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return ln(e)})},e.prototype.above=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return un(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return un(e,void 0,!1)})},e.prototype.below=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return un(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return un(void 0,e)})},e.prototype.startsWith=function(e){return"string"!=typeof e?nn(this,xt):this.between(e,e+bt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):cn(this,function(e,t){return 0===e.indexOf(t[0])},[e],bt)},e.prototype.equalsIgnoreCase=function(e){return cn(this,function(e,t){return e===t[0]},[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=$.apply(N,arguments);return 0===e.length?rn(this):cn(this,function(e,t){return-1!==t.indexOf(e)},e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=$.apply(N,arguments);return 0===e.length?rn(this):cn(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,bt)},e.prototype.anyOf=function(){var e=this,t=$.apply(N,arguments),n=this._cmp;try{t.sort(n)}catch(e){return nn(this,kt)}if(0===t.length)return rn(this);var r=new this.Collection(this,function(){return un(t[0],t[t.length-1])});r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,o){for(var a=e.key;n(a,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(a,t[i])||(r(function(){e.continue(t[i])}),!1)}),r},e.prototype.notEqual=function(e){return this.inAnyRange([[wt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=$.apply(N,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return nn(this,kt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[wt,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,s=this._max;if(0===e.length)return rn(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0}))return nn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var c=!t||!1!==t.includeLowers,u=t&&!0===t.includeUppers;function l(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=a(o[0],t[0]),o[1]=s(o[1],t[1]);break}}return n===i&&e.push(t),e}var h,f=i;function d(e,t){return f(e[0],t[0])}try{(h=e.reduce(l,[])).sort(d)}catch(e){return nn(this,kt)}var p=0,m=u?function(e){return i(e,h[p][1])>0}:function(e){return i(e,h[p][1])>=0},g=c?function(e){return o(e,h[p][0])>0}:function(e){return o(e,h[p][0])>=0};function y(e){return!m(e)&&!g(e)}var v=m,b=new this.Collection(this,function(){return un(h[0][0],h[h.length-1][1],!c,!u)});return b._ondirectionchange=function(e){"next"===e?(v=m,f=i):(v=g,f=o),h.sort(d)},b._addAlgorithm(function(e,t,r){for(var o=e.key;v(o);)if(++p===h.length)return t(r),!1;return!!y(o)||(0===n._cmp(o,h[p][1])||0===n._cmp(o,h[p][0])||t(function(){f===i?e.continue(h[p][0]):e.continue(h[p][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var e=$.apply(N,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?rn(this):this.inAnyRange(e.map(function(e){return[e,e+bt]})):nn(this,"startsWithAnyOf() only works with strings")},e}();function fn(e){return Ft(hn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=Dt,this._descending=function(e,t){return Dt(t,e)},this._max=function(e,t){return Dt(e,t)>0?e:t},this._min=function(e,t){return Dt(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})}function dn(e){return Xe(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var mn="storagemutated",gn="x-storagemutated-1",yn=zt(null,mn),vn=function(){function e(){}return e.prototype._lock=function(){return k(!Ie.global),++this._reculock,1!==this._reculock||Ie.global||(Ie.lockOwnerFor=this),this},e.prototype._unlock=function(){if(k(!Ie.global),0===--this._reculock)for(Ie.global||(Ie.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&Ie.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(k(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(r);case"MissingAPIError":throw new ee.MissingAPI(r.message,r);default:throw new ee.OpenFailed(r)}if(!this.active)throw new ee.TransactionInactive;return k(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Xe(function(n){pn(n),t._reject(e.error)}),e.onabort=Xe(function(n){pn(n),t.active&&t._reject(new ee.Abort(e.error)),t.active=!1,t.on("abort").fire(n)}),e.oncomplete=Xe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&yn.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return gt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return gt(new ee.TransactionInactive);if(this._locked())return new qe(function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},Ie])});if(n)return ot(function(){var e=new qe(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new qe(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=qe.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return n});else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new qe(function(e,r){n.then(function(n){return t._waitingQueue.push(Xe(e.bind(null,n)))},function(e){return t._waitingQueue.push(Xe(r.bind(null,e)))}).finally(function(){t._waitingFor===i&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(h(t,e))return t[e];var n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function bn(e){return Ft(vn.prototype,function(t,n,r,i,o){var a=this;"readonly"!==t&&n.forEach(function(e){var t,i=null===(t=r[e])||void 0===t?void 0:t.yProps;i&&(n=n.concat(i.map(function(e){return e.updatesTable})))}),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=zt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new qe(function(e,t){a._resolve=e,a._reject=t}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),gt(e)})})}function wn(e,t,n,r,i,o,a,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+kn(t),type:s}}function kn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function xn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:_(n,function(e){return[e.name,e]})}}function _n(e){return 1===e.length?e[0]:e}var An=function(e){try{return e.only([[]]),An=function(){return[[]]},[[]]}catch(e){return An=function(){return bt},bt}};function En(e){return null==e?function(){}:"string"==typeof e?Sn(e):function(t){return A(t,e)}}function Sn(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return A(t,e)}}function Cn(e){return[].slice.call(e)}var Pn=0;function On(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function Bn(e,t,n){function r(e,t){var n=Cn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map(function(e){return t.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=s(t),i=null==t,o={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:En(t)},indexes:Cn(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,a={name:t,compound:s(i),keyPath:i,unique:n,multiEntry:r,extractKey:En(i)};return o[On(i)]=a,a}),getIndexByKeyPath:function(e){return o[On(e)]}};return o[":id"]=a.primaryKey,null!=t&&(o[On(t)]=a.primaryKey),a})},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}function o(e){var t=e.name;function n(e){var n=e.trans,r=e.type,o=e.keys,a=e.values,s=e.range;return new Promise(function(e,c){e=Xe(e);var u=n.objectStore(t),l=null==u.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);var f,d=(o||a||{length:1}).length;if(o&&a&&o.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],m=[],g=0,y=function(e){++g,pn(e)};if("deleteRange"===r){if(4===s.type)return e({numFailures:g,failures:m,results:[],lastResult:void 0});3===s.type?p.push(f=u.clear()):p.push(f=u.delete(i(s)))}else{var v=h?l?[a,o]:[a,null]:[o,null],b=v[0],w=v[1];if(h)for(var k=0;k<d;++k)p.push(f=w&&void 0!==w[k]?u[r](b[k],w[k]):u[r](b[k])),f.onerror=y;else for(k=0;k<d;++k)p.push(f=u[r](b[k])),f.onerror=y}var x=function(t){var n=t.target.result;p.forEach(function(e,t){return null!=e.error&&(m[t]=e.error)}),e({numFailures:g,failures:m,results:"delete"===r?o:p.map(function(e){return e.result}),lastResult:n})};f.onerror=function(e){y(e),x(e)},f.onsuccess=x})}function r(e){var n=e.trans,r=e.values,o=e.query,a=e.reverse,s=e.unique;return new Promise(function(e,c){e=Xe(e);var u=o.index,l=o.range,h=n.objectStore(t),f=u.isPrimaryKey?h:h.index(u.name),d=a?s?"prevunique":"prev":s?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(i(l),d):f.openKeyCursor(i(l),d);p.onerror=dn(c),p.onsuccess=Xe(function(t){var r=p.result;if(r){r.___id=++Pn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var a=r.advance.bind(r),s=function(){throw new Error("Cursor not started")},u=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=s,r.fail=Xe(c),r.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},r.start=function(e){var t=new Promise(function(e,t){e=Xe(e),p.onerror=dn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=u,e(t)}}),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Xe(function(e){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=a,n(),t},e(r)}else e(null)},c)})}function o(e){return function(n){return new Promise(function(r,o){r=Xe(r);var a=n.trans,s=n.values,c=n.limit,u=n.query,l=c===1/0?void 0:c,h=u.index,f=u.range,d=a.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),m=i(f);if(0===c)return r({result:[]});if(e){var g=s?p.getAll(m,l):p.getAllKeys(m,l);g.onsuccess=function(e){return r({result:e.target.result})},g.onerror=dn(o)}else{var y=0,v=s||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),b=[];v.onsuccess=function(e){var t=v.result;return t?(b.push(s?t.value:t.primaryKey),++y===c?r({result:b}):void t.continue()):r({result:b})},v.onerror=dn(o)}})}}return{name:t,schema:e,mutate:n,getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=Xe(e);for(var o,a=n.objectStore(t),s=r.length,c=new Array(s),u=0,l=0,h=function(t){var n=t.target;c[n._pos]=n.result,++l===u&&e(c)},f=dn(i),d=0;d<s;++d)null!=r[d]&&((o=a.get(r[d]))._pos=d,o.onsuccess=h,o.onerror=f,++u);0===u&&e(c)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=Xe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=dn(i)})},query:o(u),openCursor:r,count:function(e){var n=e.query,r=e.trans,o=n.index,a=n.range;return new Promise(function(e,n){var s=r.objectStore(t),c=o.isPrimaryKey?s:s.index(o.name),u=i(a),l=u?c.count(u):c.count();l.onsuccess=Xe(function(t){return e(t.target.result)}),l.onerror=dn(n)})}}}var a=r(e,n),c=a.schema,u=a.hasGetAll,l=c.tables.map(function(e){return o(e)}),h={};return l.forEach(function(e){return h[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '".concat(e,"' not found"));return h[e]},MIN_KEY:-1/0,MAX_KEY:An(t),schema:c}}function Dn(e,t){return t.reduce(function(e,t){var n=t.create;return r(r({},e),n(e))},e)}function In(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:Dn(Bn(t,i,r),e.dbcore)}}function jn(e,t){var n=t.db,r=In(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function Tn(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=y(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?p(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function Mn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function qn(e,t){return e._cfg.version-t._cfg.version}function Kn(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=xn("$meta",Yn("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),c=Ie.transless||Ie;ot(function(){if(Ie.trans=o,Ie.transless=c,0!==t)return jn(e,n),Ln(e,o,t).then(function(t){return zn(e,t,o,n)}).catch(s);a(i).forEach(function(e){Nn(n,e,i[e].primKey,i[e].indexes)}),jn(e,n),qe.follow(function(){return e.on.populate.fire(o)}).catch(s)})}function Rn(e,t){$n(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Qn(e,e.idbdb,t);Hn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){de&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),Wn(n,t)})},i=0,o=Fn(n,e._dbSchema).change;i<o.length;i++){var a=r(o[i]);if("object"==typeof a)return a.value}}function Ln(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(e){return null!=e?e:n}):qe.resolve(n)}function zn(e,t,n,r){var i=[],o=e._versions,s=e._dbSchema=Qn(e,e.idbdb,r),c=o.filter(function(e){return e._cfg.version>=t});if(0===c.length)return qe.resolve();function u(){return i.length?qe.resolve(i.shift()(n.idbtrans)).then(u):qe.resolve()}return c.forEach(function(o){i.push(function(){var i=s,c=o._cfg.dbschema;Hn(e,i,r),Hn(e,c,r),s=e._dbSchema=c;var u=Fn(i,c);u.add.forEach(function(e){Nn(r,e[0],e[1].primKey,e[1].indexes)}),u.change.forEach(function(e){if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach(function(e){return Wn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Wn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){jn(e,r),n._memoizedTables={};var h=C(c);u.del.forEach(function(e){h[e]=i[e]}),Mn(e,[e.Transaction.prototype]),Tn(e,[e.Transaction.prototype],a(h),h),n.schema=h;var f,d=U(l);d&&at();var p=qe.follow(function(){if((f=l(n))&&d){var e=st.bind(null,null);f.then(e,e)}});return f&&"function"==typeof f.then?qe.resolve(f):p.then(function(){return f})}}),i.push(function(t){Un(o._cfg.dbschema,t),Mn(e,[e.Transaction.prototype]),Tn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===o._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(o._cfg.version,"version"))})}),u().then(function(){$n(s,r)})}function Fn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)a.recreate=!0,r.change.push(a);else{var s=i.idxByName,c=o.idxByName,u=void 0;for(u in s)c[u]||a.del.push(u);for(u in c){var l=s[u],h=c[u];l?l.src!==h.src&&a.change.push(h):a.add.push(h)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,o])}return r}function Nn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Wn(i,e)}),i}function $n(e,t){a(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(de&&console.debug("Dexie: Creating missing table",n),Nn(t,n,e[n].primKey,e[n].indexes))})}function Un(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return null==e[n]&&t.db.deleteObjectStore(n)})}function Wn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Qn(e,t,n){var r={};return b(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=t.keyPath,o=wn(kn(i),i||"",!0,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),a=[],s=0;s<t.indexNames.length;++s){var c=t.index(t.indexNames[s]);i=c.keyPath;var u=wn(c.name,i,!!c.unique,!!c.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(u)}r[e]=xn(e,o,a)}),r}function Gn(e,t,n){e.verno=t.version/10;var r=e._dbSchema=Qn(e,t,n);e._storeNames=b(t.objectStoreNames,0),Tn(e,[e._allTables],a(r),r)}function Vn(e,t){var n=Fn(Qn(e,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some(function(e){return e.add.length||e.change.length}))}function Hn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(var c=0;c<s.indexNames.length;++c){var u=s.indexNames[c],l=s.index(u).keyPath,h="string"==typeof l?l:"["+b(l).join("+")+"]";if(t[a]){var f=t[a].idxByName[h];f&&(f.name=u,delete t[a].idxByName[h],t[a].idxByName[u]=f)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Yn(e){return e.split(",").map(function(e,t){var n,r=e.split(":"),i=null===(n=r[1])||void 0===n?void 0:n.trim(),o=(e=r[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return wn(o,a||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),s(a),0===t,i)})}var Jn,Xn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return xn(e,t,n)},e.prototype._parseIndexSyntax=function(e){return Yn(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;a(e).forEach(function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),o=i.shift();if(!o)throw new ee.Schema("Invalid schema for table "+r+": "+e[r]);if(o.unique=!0,o.multi)throw new ee.Schema("Primary key cannot be multiEntry*");i.forEach(function(e){if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")});var a=n._createTableSchema(r,o,i);t[r]=a}})},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?c(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach(function(e){c(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),t._dbSchema=i,Mn(t,[t._allTables,t,t.Transaction.prototype]),Tn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],a(i),i),t._storeNames=a(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||ie,e),this},e}();function Zn(e){return Ft(Xn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function er(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ti(At,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function tr(e){return e&&"function"==typeof e.databases}function nr(e){var t=e.indexedDB,n=e.IDBKeyRange;return tr(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==At})}):er(t,n).toCollection().primaryKeys()}function rr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).put({name:t}).catch(ie)}function ir(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).delete(t).catch(ie)}function or(e){return ot(function(){return Ie.letThrough=!0,e()})}function ar(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function sr(e){return!("from"in e)}var cr=function(e,t){if(!this){var n=new cr;return e&&"d"in e&&c(n,e),n}c(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function ur(e,t,n){var r=Dt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(sr(e))return c(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Dt(n,e.from)<0)return i?ur(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},dr(e);if(Dt(t,e.to)>0)return o?ur(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},dr(e);Dt(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Dt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var a=!e.r;i&&!e.l&&lr(e,i),o&&a&&lr(e,o)}}function lr(e,t){function n(e,t){var r=t.from,i=t.to,o=t.l,a=t.r;ur(e,r,i),o&&n(e,o),a&&n(e,a)}sr(t)||n(e,t)}function hr(e,t){var n=fr(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=fr(e),a=o.next(i.from),s=a.value;!r.done&&!a.done;){if(Dt(s.from,i.to)<=0&&Dt(s.to,i.from)>=0)return!0;Dt(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function fr(e){var t=sr(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Dt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Dt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function dr(e){var t,n,i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var a="r"===o?"l":"r",s=r({},e),c=e[o];e.from=c.from,e.to=c.to,e[o]=c[o],s[o]=c[a],e[a]=s,s.d=pr(s)}e.d=pr(e)}function pr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function mr(e,t){return a(t).forEach(function(n){e[n]?lr(e[n],t[n]):e[n]=I(t[n])}),e}function gr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&hr(t[n],e[n])})}f(cr.prototype,((Jn={add:function(e){return lr(this,e),this},addKey:function(e){return ur(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return ur(t,e,e)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&Dt(t.from,e)<=0&&Dt(t.to,e)>=0}})[L]=function(){return fr(this)},Jn));var yr={},vr={},br=!1;function wr(e,t){mr(vr,e),br||(br=!0,setTimeout(function(){br=!1;var e=vr;vr={},kr(e,!1)},0))}function kr(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(yr);r<i.length;r++)xr(s=i[r],e,n,t);else for(var o in e){var a=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(a){var s,c=a[1],u=a[2];(s=yr["idb://".concat(c,"/").concat(u)])&&xr(s,e,n,t)}}n.forEach(function(e){return e()})}function xr(e,t,n,r){for(var i=[],o=0,a=Object.entries(e.queries.query);o<a.length;o++){for(var s=a[o],c=s[0],u=[],l=0,h=s[1];l<h.length;l++){var f=h[l];gr(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&u.push(f)}r&&i.push([c,u])}if(r)for(var d=0,p=i;d<p.length;d++){var m=p[d];c=m[0],u=m[1],e.queries.query[c]=u}}function _r(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?gt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function a(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}var s=t.dbReadyResolve,c=null,u=!1,l=function(){return new qe(function(r,s){if(a(),!n)throw new ee.MissingAPI;var h=e.name,f=t.autoSchema||!i?n.open(h):n.open(h,i);if(!f)throw new ee.MissingAPI;f.onerror=dn(s),f.onblocked=Xe(e._fireOnBlocked),f.onupgradeneeded=Xe(function(r){if(c=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=pn,c.abort(),f.result.close();var i=n.deleteDatabase(h);i.onsuccess=i.onerror=Xe(function(){s(new ee.NoSuchDatabase("Database ".concat(h," doesnt exist")))})}else{c.onerror=dn(s);var a=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;u=a<1,e.idbdb=f.result,o&&Rn(e,c),Kn(e,a/10,c,s)}},s),f.onsuccess=Xe(function(){c=null;var n=e.idbdb=f.result,a=b(n.objectStoreNames);if(a.length>0)try{var s=n.transaction(_n(a),"readonly");if(t.autoSchema)Gn(e,n,s);else if(Hn(e,e._dbSchema,s),!Vn(e,s)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),n.close(),i=n.version+1,o=!0,r(l());jn(e,s)}catch(e){}_t.push(e),n.onversionchange=Xe(function(n){t.vcFired=!0,e.on("versionchange").fire(n)}),n.onclose=Xe(function(){e.close({disableAutoOpen:!1})}),u&&rr(e._deps,h),r()},s)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(i>0)return i=0,l()}return qe.reject(e)})};return qe.race([r,("undefined"==typeof navigator?qe.resolve():ar()).then(l)]).then(function(){return a(),t.onReadyBeingFired=[],qe.resolve(or(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(fe,ie);return t.onReadyBeingFired=[],qe.resolve(or(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{c&&c.abort()}catch(e){}return r===t.openCanceller&&e._close(),gt(n)}).finally(function(){t.openComplete=!0,s()}).then(function(){if(u){var t={};e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new cr(-1/0,[[[]]]))}),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new cr(-1/0,[[[]]])}),yn(mn).fire(t),kr(t,!0)}return e})}function Ar(e){var t=function(t){return e.next(t)},n=function(t){return e.throw(t)},r=o(t),i=o(n);function o(e){return function(t){var n=e(t),o=n.value;return n.done?o:o&&"function"==typeof o.then?o.then(r,i):s(o)?Promise.all(o).then(r,i):r(o)}}return o(t)()}function Er(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,O(i),n]}function Sr(e,t,n,r,i){return qe.resolve().then(function(){var o=Ie.transless||Ie,a=e._createTransaction(t,n,e._dbSchema,r);a.explicit=!0;var s={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),a.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return Sr(e,t,n,null,i)})):gt(r)}var c,u=U(i);u&&at();var l=qe.follow(function(){if(c=i.call(a,a))if(u){var e=st.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Ar(c))},s);return(c&&"function"==typeof c.then?qe.resolve(c).then(function(e){return a.active?e:gt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):l.then(function(){return c})).then(function(e){return r&&a._resolve(),a._completion.then(function(){return e})}).catch(function(e){return a._reject(e),gt(e)})})}function Cr(e,t,n){for(var r=s(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Pr(e){return r(r({},e),{table:function(t){var n=e.table(t),i=n.schema,o={},a=[];function s(e,t,n){var i=On(e),c=o[i]=o[i]||[],u=null==e?0:"string"==typeof e?1:e.length,l=t>0,h=r(r({},n),{name:l?"".concat(i,"(virtual-from:").concat(n.name,")"):n.name,lowLevelIndex:n,isVirtual:l,keyTail:t,keyLength:u,extractKey:En(e),unique:!l&&n.unique});return c.push(h),h.isPrimaryKey||a.push(h),u>1&&s(2===u?e[0]:e.slice(0,u-1),t+1,n),c.sort(function(e,t){return e.keyTail-t.keyTail}),h}var c=s(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[c];for(var u=0,l=i.indexes;u<l.length;u++){var h=l[u];s(h.keyPath,0,h)}function f(e){var t=o[On(e)];return t&&t[0]}function d(t,n){return{type:1===t.type?2:t.type,lower:Cr(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Cr(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function p(e){var t=e.query.index;return t.isVirtual?r(r({},e),{query:{index:t.lowLevelIndex,range:d(e.query.range,t.keyTail)}}):e}var m=r(r({},n),{schema:r(r({},i),{primaryKey:c,indexes:a,getIndexByKeyPath:f}),count:function(e){return n.count(p(e))},query:function(e){return n.query(p(e))},openCursor:function(t){var r=t.query.index,i=r.keyTail,o=r.isVirtual,a=r.keyLength;if(!o)return n.openCursor(t);function s(n){function r(r){null!=r?n.continue(Cr(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}var o=Object.create(n,{continue:{value:r},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Cr(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return n.value}}});return o}return n.openCursor(p(t)).then(function(e){return e&&s(e)})}});return m}})}var Or={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Pr};function Br(e,t,n,r){return n=n||{},r=r||"",a(e).forEach(function(i){if(h(t,i)){var o=e[i],a=t[i];if("object"==typeof o&&"object"==typeof a&&o&&a){var s=R(o);s!==R(a)?n[r+i]=t[i]:"Object"===s?Br(o,a,n,r+i+"."):o!==a&&(n[r+i]=t[i])}else o!==a&&(n[r+i]=t[i])}else n[r+i]=void 0}),a(t).forEach(function(i){h(e,i)||(n[r+i]=t[i])}),n}function Dr(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Ir={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return r(r({},e),{table:function(t){var n=e.table(t),o=n.schema.primaryKey,a=r(r({},n),{mutate:function(e){var a=Ie.trans,s=a.table(t).hook,c=s.deleting,u=s.creating,l=s.updating;switch(e.type){case"add":if(u.fire===ie)break;return a._promise("readwrite",function(){return f(e)},!0);case"put":if(u.fire===ie&&l.fire===ie)break;return a._promise("readwrite",function(){return f(e)},!0);case"delete":if(c.fire===ie)break;return a._promise("readwrite",function(){return f(e)},!0);case"deleteRange":if(c.fire===ie)break;return a._promise("readwrite",function(){return d(e)},!0)}return n.mutate(e);function f(e){var t=Ie.trans,a=e.keys||Dr(o,e);if(!a)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?r(r({},e),{keys:a}):r({},e)).type&&(e.values=i([],e.values,!0)),e.keys&&(e.keys=i([],e.keys,!0)),jr(n,e,a).then(function(r){var i=a.map(function(n,i){var a=r[i],s={onerror:null,onsuccess:null};if("delete"===e.type)c.fire.call(s,n,a,t);else if("add"===e.type||void 0===a){var f=u.fire.call(s,n,e.values[i],t);null==n&&null!=f&&(n=f,e.keys[i]=n,o.outbound||E(e.values[i],o.keyPath,n))}else{var d=Br(a,e.values[i]),p=l.fire.call(s,d,n,a,t);if(p){var m=e.values[i];Object.keys(p).forEach(function(e){h(m,e)?m[e]=p[e]:E(m,e,p[e])})}}return s});return n.mutate(e).then(function(t){for(var n=t.failures,o=t.results,s=t.numFailures,c=t.lastResult,u=0;u<a.length;++u){var l=o?o[u]:a[u],h=i[u];null==l?h.onerror&&h.onerror(n[u]):h.onsuccess&&h.onsuccess("put"===e.type&&r[u]?e.values[u]:l)}return{failures:n,results:o,numFailures:s,lastResult:c}}).catch(function(e){return i.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}function d(e){return p(e.trans,e.range,1e4)}function p(e,t,i){return n.query({trans:e,values:!1,query:{index:o,range:t},limit:i}).then(function(n){var o=n.result;return f({type:"delete",keys:o,trans:e}).then(function(n){return n.numFailures>0?Promise.reject(n.failures[0]):o.length<i?{failures:[],numFailures:0,lastResult:void 0}:p(e,r(r({},t),{lower:o[o.length-1],lowerOpen:!0}),i)})})}}});return a}})}};function jr(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function Tr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Dt(t.keys[i],e[o])&&(r.push(n?M(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var Mr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return r(r({},n),{getMany:function(e){if(!e.cache)return n.getMany(e);var t=Tr(e.keys,e.trans._cache,"clone"===e.cache);return t?qe.resolve(t):n.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?M(t):t},t})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),n.mutate(e)}})}}}};function qr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function Kr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Rr={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new cr(e.MIN_KEY,e.MAX_KEY);return r(r({},e),{transaction:function(t,n,r){if(Ie.subscr&&"readonly"!==n)throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ie.querier));return e.transaction(t,n,r)},table:function(i){var o=e.table(i),c=o.schema,u=c.primaryKey,l=c.indexes,h=u.extractKey,f=u.outbound,d=u.autoIncrement&&l.filter(function(e){return e.compound&&e.keyPath.includes(u.keyPath)}),p=r(r({},o),{mutate:function(r){var a,l,h=r.trans,f=r.mutatedParts||(r.mutatedParts={}),p=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return f[n]||(f[n]=new cr)},m=p(""),g=p(":dels"),y=r.type,v="deleteRange"===r.type?[r.range]:"delete"===r.type?[r.keys]:r.values.length<50?[Dr(u,r).filter(function(e){return e}),r.values]:[],b=v[0],w=v[1],k=r.trans._cache;if(s(b)){m.addKeys(b);var x="delete"===y||b.length===w.length?Tr(b,k):null;x||g.addKeys(b),(x||w)&&Lr(p,c,x,w)}else if(b){var _={from:null!==(a=b.lower)&&void 0!==a?a:e.MIN_KEY,to:null!==(l=b.upper)&&void 0!==l?l:e.MAX_KEY};g.add(_),m.add(_)}else m.add(n),g.add(n),c.indexes.forEach(function(e){return p(e.name).add(n)});return o.mutate(r).then(function(e){return!b||"add"!==r.type&&"put"!==r.type||(m.addKeys(e.results),d&&d.forEach(function(t){for(var n=r.values.map(function(e){return t.extractKey(e)}),i=t.keyPath.findIndex(function(e){return e===u.keyPath}),o=0,a=e.results.length;o<a;++o)n[o][i]=e.results[o];p(t.name).addKeys(n)})),h.mutatedParts=mr(h.mutatedParts||{},f),e})}}),m=function(t){var n,r,i=t.query,o=i.index,a=i.range;return[o,new cr(null!==(n=a.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:e.MAX_KEY)]},g={get:function(e){return[u,new cr(e.key)]},getMany:function(e){return[u,(new cr).addKeys(e.keys)]},count:m,query:m,openCursor:m};return a(g).forEach(function(e){p[e]=function(a){var s=Ie.subscr,c=!!s,u=qr(Ie,o)&&Kr(e,a)?a.obsSet={}:s;if(c){var l=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return u[n]||(u[n]=new cr)},d=l(""),p=l(":dels"),m=g[e](a),y=m[0],v=m[1];if("query"===e&&y.isPrimaryKey&&!a.values?p.add(v):l(y.name||"").add(v),!y.isPrimaryKey){if("count"!==e){var b="query"===e&&f&&a.values&&o.query(r(r({},a),{values:!1}));return o[e].apply(this,arguments).then(function(t){if("query"===e){if(f&&a.values)return b.then(function(e){var n=e.result;return d.addKeys(n),t});var n=a.values?t.result.map(h):t.result;a.values?d.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,i=a.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return i&&d.addKey(r.primaryKey),r.value}}})}return t})}p.add(n)}}return o[e].apply(this,arguments)}}),p}})}};function Lr(e,t,n,r){function i(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var a=function(e){return t.multiEntry&&s(e)?e.forEach(function(e){return i.addKey(e)}):i.addKey(e)};(n||r).forEach(function(e,t){var i=n&&o(n[t]),s=r&&o(r[t]);0!==Dt(i,s)&&(null!=i&&a(i),null!=s&&a(s))})}t.indexes.forEach(i)}function zr(e,t,n){if(0===n.numFailures)return t;if("deleteRange"===t.type)return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(n.numFailures===i)return null;var o=r({},t);return s(o.keys)&&(o.keys=o.keys.filter(function(e,t){return!(t in n.failures)})),"values"in o&&s(o.values)&&(o.values=o.values.filter(function(e,t){return!(t in n.failures)})),o}function Fr(e,t){return void 0===t.lower||(t.lowerOpen?Dt(e,t.lower)>0:Dt(e,t.lower)>=0)}function Nr(e,t){return void 0===t.upper||(t.upperOpen?Dt(e,t.upper)<0:Dt(e,t.upper)<=0)}function $r(e,t){return Fr(e,t)&&Nr(e,t)}function Ur(e,t,n,r,i,o){if(!n||0===n.length)return e;var a=t.query.index,c=a.multiEntry,u=t.query.range,l=r.schema.primaryKey.extractKey,h=a.extractKey,f=(a.lowLevelIndex||a).extractKey,d=n.reduce(function(e,n){var r=e,i=[];if("add"===n.type||"put"===n.type)for(var o=new cr,a=n.values.length-1;a>=0;--a){var f=n.values[a],d=l(f);if(!o.hasKey(d)){var p=h(f);(c&&s(p)?p.some(function(e){return $r(e,u)}):$r(p,u))&&(o.addKey(d),i.push(f))}}switch(n.type){case"add":var m=(new cr).addKeys(t.values?e.map(function(e){return l(e)}):e);r=e.concat(t.values?i.filter(function(e){var t=l(e);return!m.hasKey(t)&&(m.addKey(t),!0)}):i.map(function(e){return l(e)}).filter(function(e){return!m.hasKey(e)&&(m.addKey(e),!0)}));break;case"put":var g=(new cr).addKeys(n.values.map(function(e){return l(e)}));r=e.filter(function(e){return!g.hasKey(t.values?l(e):e)}).concat(t.values?i:i.map(function(e){return l(e)}));break;case"delete":var y=(new cr).addKeys(n.keys);r=e.filter(function(e){return!y.hasKey(t.values?l(e):e)});break;case"deleteRange":var v=n.range;r=e.filter(function(e){return!$r(l(e),v)})}return r},e);return d===e?e:(d.sort(function(e,t){return Dt(f(e),f(t))||Dt(l(e),l(t))}),t.limit&&t.limit<1/0&&(d.length>t.limit?d.length=t.limit:e.length===t.limit&&d.length<t.limit&&(i.dirty=!0)),o?Object.freeze(d):d)}function Wr(e,t){return 0===Dt(e.lower,t.lower)&&0===Dt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Qr(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var i=Dt(e,t);if(0===i){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function Gr(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var i=Dt(e,t);if(0===i){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Vr(e,t){return Qr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Gr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Hr(e,t,n,r){var i=yr["idb://".concat(e,"/").concat(t)];if(!i)return[];var o=i.queries[n];if(!o)return[null,!1,i,null];var a=o[(r.query?r.query.index.name:null)||""];if(!a)return[null,!1,i,null];switch(n){case"query":var s=a.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Wr(e.req.query.range,r.query.range)});return s?[s,!0,i,a]:[a.find(function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&Vr(e.req.query.range,r.query.range)}),!1,i,a];case"count":var c=a.find(function(e){return Wr(e.req.query.range,r.query.range)});return[c,!!c,i,a]}}function Yr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){e.subscribers.delete(n),0===e.subscribers.size&&Jr(e,t)})}function Jr(e,t){setTimeout(function(){0===e.subscribers.size&&F(t,e)},3e3)}var Xr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,n=r(r({},e),{transaction:function(n,r,i){var o=e.transaction(n,r,i);if("readwrite"===r){var a=new AbortController,s=a.signal,c=function(i){return function(){if(a.abort(),"readwrite"===r){for(var s=new Set,c=0,u=n;c<u.length;c++){var l=u[c],h=yr["idb://".concat(t,"/").concat(l)];if(h){var f=e.table(l),d=h.optimisticOps.filter(function(e){return e.trans===o});if(o._explicit&&i&&o.mutatedParts)for(var p=0,m=Object.values(h.queries.query);p<m.length;p++)for(var g=0,y=(w=m[p]).slice();g<y.length;g++)gr((_=y[g]).obsSet,o.mutatedParts)&&(F(w,_),_.subscribers.forEach(function(e){return s.add(e)}));else if(d.length>0){h.optimisticOps=h.optimisticOps.filter(function(e){return e.trans!==o});for(var v=0,b=Object.values(h.queries.query);v<b.length;v++)for(var w,k=0,x=(w=b[v]).slice();k<x.length;k++){var _;if(null!=(_=x[k]).res&&o.mutatedParts)if(i&&!_.dirty){var A=Object.isFrozen(_.res),E=Ur(_.res,_.req,d,f,_,A);_.dirty?(F(w,_),_.subscribers.forEach(function(e){return s.add(e)})):E!==_.res&&(_.res=E,_.promise=qe.resolve({result:E}))}else _.dirty&&F(w,_),_.subscribers.forEach(function(e){return s.add(e)})}}}}s.forEach(function(e){return e()})}}};o.addEventListener("abort",c(!1),{signal:s}),o.addEventListener("error",c(!1),{signal:s}),o.addEventListener("complete",c(!0),{signal:s})}return o},table:function(n){var i=e.table(n),o=i.schema.primaryKey,a=r(r({},i),{mutate:function(e){var a=Ie.trans;if(o.outbound||"disabled"===a.db._options.cache||a.explicit||"readwrite"!==a.idbtrans.mode)return i.mutate(e);var s=yr["idb://".concat(t,"/").concat(n)];if(!s)return i.mutate(e);var c=i.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Dr(o,e).some(function(e){return null==e}))?(s.optimisticOps.push(e),e.mutatedParts&&wr(e.mutatedParts),c.then(function(t){if(t.numFailures>0){F(s.optimisticOps,e);var n=zr(s,e,t);n&&s.optimisticOps.push(n),e.mutatedParts&&wr(e.mutatedParts)}}),c.catch(function(){F(s.optimisticOps,e),e.mutatedParts&&wr(e.mutatedParts)})):c.then(function(t){var n=r(r({},e),{values:e.values.map(function(e,n){var i;if(t.failures[n])return e;var a=(null===(i=o.keyPath)||void 0===i?void 0:i.includes("."))?M(e):r({},e);return E(a,o.keyPath,t.results[n]),a})}),i=zr(s,n,t);s.optimisticOps.push(i),queueMicrotask(function(){return e.mutatedParts&&wr(e.mutatedParts)})}),c},query:function(e){var r;if(!qr(Ie,i)||!Kr("query",e))return i.query(e);var o="immutable"===(null===(r=Ie.trans)||void 0===r?void 0:r.db._options.cache),a=Ie,s=a.requery,c=a.signal,u=Hr(t,n,"query",e),l=u[0],h=u[1],f=u[2],d=u[3];if(l&&h)l.obsSet=e.obsSet;else{var p=i.query(e).then(function(e){var t=e.result;if(l&&(l.res=t),o){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=M(t);return e}).catch(function(e){return d&&l&&F(d,l),Promise.reject(e)});l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},d?d.push(l):(d=[l],f||(f=yr["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),f.queries.query[e.query.index.name||""]=d)}return Yr(l,d,s,c),l.promise.then(function(t){return{result:Ur(t.result,e,null==f?void 0:f.optimisticOps,i,l,o)}})}});return a}});return n}};function Zr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var ei,ti=function(){function e(t,n){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=n=r({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};s.dbReadyPromise=new qe(function(e){s.dbReadyResolve=e}),s.openCanceller=new qe(function(e,t){s.cancelOpen=t}),this._state=s,this.name=t,this.on=zt(this,"populate","blocked","versionchange","close",{ready:[fe,ie]}),this.once=function(e,t){var n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];i.on(e).unsubscribe(n),t.apply(i,r)};return i.on(e,n)},this.on.ready.subscribe=w(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||qe.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t(function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)})}})}}),this.Collection=Zt(this),this.Table=Nt(this),this.Transaction=bn(this),this.Version=Zn(this),this.WhereClause=fn(this),this.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=An(n.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),_t.filter(function(e){return e.name===i.name&&e!==i&&!e._state.vcFired}).map(function(t){return t.on("versionchange").fire(e)})},this.use(Mr),this.use(Xr),this.use(Rr),this.use(Or),this.use(Ir);var c=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return Zr(i.table(e),c)};var r=Reflect.get(e,t,n);return r instanceof Lt?Zr(r,c):"tables"===t?r.map(function(e){return Zr(e,c)}):"_createTransaction"===t?function(){return Zr(r.apply(this,arguments),c)}:r}});this.vip=c,a.forEach(function(e){return e(i)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(qn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Ie.letThrough||this._vip)?e():new qe(function(e,n){if(t._state.openComplete)return n(new ee.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new ee.DatabaseClosed);t.open().catch(ie)}t._state.dbReadyPromise.then(e,n)}).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort(function(e,t){return e.level-t.level}),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},e.prototype.open=function(){var e=this;return dt(De,function(){return _r(e)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=_t.indexOf(this);if(t>=0&&_t.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new qe(function(t){e.dbReadyResolve=t}),e.openCanceller=new qe(function(t,n){e.cancelOpen=n}))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new ee.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new ee.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new qe(function(i,o){var a=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Xe(function(){ir(t._deps,t.name),i()}),n.onerror=dn(o),n.onblocked=t._fireOnBlocked};if(n)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return a(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Er.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=Ie.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,a,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=t.map(function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}),"r"==e||e===Et)o=Et;else{if("rw"!=e&&e!=St)throw new ee.InvalidArgument("Invalid transaction mode: "+e);o=St}if(i){if(i.mode===Et&&o===St){if(!s)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!s)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):gt(e)}var c=Sr.bind(null,this,o,a,i,n);return i?i._promise(o,c,"lock"):Ie.trans?dt(Ie.transless,function(){return r._whenReady(c)}):this._whenReady(c)},e.prototype.table=function(e){if(!h(this._allTables,e))throw new ee.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),ni="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ri=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[ni]=function(){return this},e}();try{ei={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch(e){ei={indexedDB:null,IDBKeyRange:null}}function ii(e){var t,n=!1,r=new ri(function(r){var i=U(e);function o(t){var n=We();try{i&&at();var r=ot(e,t);return i&&(r=r.finally(st)),r}finally{n&&Qe()}}var a,s=!1,c={},u={},l={get closed(){return s},unsubscribe:function(){s||(s=!0,a&&a.abort(),h&&yn.storagemutated.unsubscribe(p))}};r.start&&r.start(l);var h=!1,f=function(){return mt(m)};function d(){return gr(u,c)}var p=function(e){mr(c,e),d()&&f()},m=function(){if(!s&&ei.indexedDB){c={};var i={};a&&a.abort(),a=new AbortController;var l={subscr:i,signal:a.signal,requery:f,querier:e,trans:null},d=o(l);Promise.resolve(d).then(function(e){n=!0,t=e,s||l.signal.aborted||(c={},j(u=i)||h||(yn(mn,p),h=!0),mt(function(){return!s&&r.next&&r.next(e)}))},function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||s||mt(function(){s||r.error&&r.error(e)})})}};return setTimeout(f,0),l});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var oi=ti;function ai(e){var t=ci;try{ci=!0,yn.storagemutated.fire(e),kr(e,!0)}finally{ci=t}}f(oi,r(r({},re),{delete:function(e){return new oi(e,{addons:[]}).delete()},exists:function(e){return new oi(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return nr(oi.dependencies).then(e)}catch(e){return gt(new ee.MissingAPI)}},defineClass:function(){function e(e){c(this,e)}return e},ignoreTransaction:function(e){return Ie.trans?dt(Ie.transless,e):e()},vip:or,async:function(e){return function(){try{var t=Ar(e.apply(this,arguments));return t&&"function"==typeof t.then?t:qe.resolve(t)}catch(e){return gt(e)}}},spawn:function(e,t,n){try{var r=Ar(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:qe.resolve(r)}catch(e){return gt(e)}},currentTransaction:{get:function(){return Ie.trans||null}},waitFor:function(e,t){var n=qe.resolve("function"==typeof e?oi.ignoreTransaction(e):e).timeout(t||6e4);return Ie.trans?Ie.trans.waitFor(n):n},Promise:qe,debug:{get:function(){return de},set:function(e){pe(e)}},derive:m,extend:c,props:f,override:w,Events:zt,on:yn,liveQuery:ii,extendObservabilitySet:mr,getByKeyPath:A,setByKeyPath:E,delByKeyPath:S,shallowClone:C,deepClone:M,getObjectDiff:Br,cmp:Dt,asap:x,minKey:wt,addons:[],connections:_t,errnames:X,dependencies:ei,cache:yr,semVer:vt,version:vt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),oi.maxKey=An(oi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(yn(mn,function(e){var t;ci||(t=new CustomEvent(gn,{detail:e}),ci=!0,dispatchEvent(t),ci=!1)}),addEventListener(gn,function(e){var t=e.detail;ci||ai(t)}));var si,ci=!1,ui=function(){};function li(e){return new Kt({add:e})}function hi(e){return new Kt({remove:e})}function fi(e,t){return new Kt({replacePrefix:[e,t]})}return"undefined"!=typeof BroadcastChannel&&((ui=function(){(si=new BroadcastChannel(gn)).onmessage=function(e){return e.data&&ai(e.data)}})(),"function"==typeof si.unref&&si.unref(),yn(mn,function(e){ci||si.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!ti.disableBfCache&&e.persisted){de&&console.debug("Dexie: handling persisted pagehide"),null==si||si.close();for(var t=0,n=_t;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ti.disableBfCache&&e.persisted&&(de&&console.debug("Dexie: handling persisted pageshow"),ui(),ai({all:new cr(-1/0,[[]])}))})),qe.rejectionMapper=ne,pe(de),r(ti,Object.freeze({__proto__:null,Dexie:ti,liveQuery:ii,Entity:Bt,cmp:Dt,PropModification:Kt,replacePrefix:fi,add:li,remove:hi,default:ti,RangeSet:cr,mergeRanges:lr,rangesOverlap:hr}),{default:ti}),ti}();var r=t(n.exports);const i=Symbol.for("Dexie"),o=globalThis[i]||(globalThis[i]=r);if(r.semVer!==o.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${r.semVer} and ${o.semVer}`);function a(e,t=null){if(!e)return null;try{const t=new URL(e),n=t.hostname.toLowerCase();return function(e){return"youtube.com"===e||"www.youtube.com"===e||"m.youtube.com"===e||"youtu.be"===e||"music.youtube.com"===e}(n)?function(e){const t=e.pathname,n=e.searchParams,r=e.hostname,i={platform:"youtube",type:null,creator:null,identifier:null,subtype:null,extra:{}};if("youtu.be"===r){const e=t.slice(1);if(e){i.type="video",i.identifier=e;const t=n.get("t");t&&(i.extra.timestamp=t)}return i}"music.youtube.com"===r&&(i.subtype="music");if("/watch"===t){const e=n.get("v");if(e){i.type="video",i.identifier=e;const t=n.get("list");t&&(i.extra.playlistId=t);const r=n.get("t");r&&(i.extra.timestamp=r)}return i}if(t.startsWith("/shorts/")){const e=t.split("/shorts/")[1]?.split("/")[0];return e&&(i.type="video",i.subtype="short",i.identifier=e),i}if(t.startsWith("/live/")){const e=t.split("/live/")[1]?.split("/")[0];return e&&(i.type="video",i.subtype="live",i.identifier=e),i}if(t.startsWith("/@")){const e=t.slice(2).split("/"),n=e[0];return i.type="channel",i.creator=`@${n}`,i.identifier=n,e[1]&&(i.extra.section=e[1]),i}if(t.startsWith("/channel/")){const e=t.split("/channel/")[1]?.split("/"),n=e?.[0];return n&&(i.type="channel",i.identifier=n,e?.[1]&&(i.extra.section=e[1])),i}if(t.startsWith("/c/")||t.startsWith("/user/")){const e=t.match(/^\/(c|user)\/([^\/]+)/);return e&&(i.type="channel",i.identifier=e[2],i.extra.urlType=e[1]),i}if("/playlist"===t){const e=n.get("list");return e&&(i.type="playlist",i.identifier=e),i}if("/results"===t){const e=n.get("search_query");return e&&(i.type="search",i.extra.query=e),i}return i}(t):function(e){return"github.com"===e||"www.github.com"===e||"gist.github.com"===e}(n)?function(e){const t=e.pathname,n=e.hostname,r={platform:"github",type:null,creator:null,identifier:null,subtype:null,extra:{}};if("gist.github.com"===n){const e=t.slice(1).split("/").filter(Boolean);return e.length>=1&&(r.type="gist",r.creator=e[0],e.length>=2&&(r.identifier=e[1])),r}const i=t.slice(1).split("/").filter(Boolean);if(0===i.length)return r.type="home",r;if(1===i.length){const e=i[0];return["explore","trending","topics","collections","sponsors","marketplace","settings","notifications"].includes(e)?(r.type="special",r.identifier=e):(r.type="profile",r.creator=e,r.identifier=e),r}const o=i[0],a=i[1];if(r.creator=o,r.identifier=a,r.extra.owner=o,r.extra.repo=a,2===i.length)return r.type="repo",r;const s=i[2];if("issues"===s){if(3===i.length)r.type="issues",r.subtype="list";else{const e=i[3];"new"===e?(r.type="issues",r.subtype="new"):/^\d+$/.test(e)&&(r.type="issue",r.extra.number=parseInt(e,10))}return r}if("pull"===s){if(i.length>=4){const e=i[3];/^\d+$/.test(e)&&(r.type="pr",r.extra.number=parseInt(e,10),i.length>=5&&(r.extra.tab=i[4]))}return r}if("pulls"===s)return r.type="pulls",r.subtype="list",r;if("actions"===s)return r.type="actions",i.length>=4&&("runs"===i[3]&&i[4]?(r.subtype="run",r.extra.runId=i[4]):"workflows"===i[3]&&i[4]&&(r.subtype="workflow",r.extra.workflowFile=i[4])),r;if("releases"===s)return r.type="releases",i.length>=4&&("tag"===i[3]?(r.subtype="tag",r.extra.tag=i[4]):"latest"===i[3]&&(r.subtype="latest")),r;if("wiki"===s)return r.type="wiki",i.length>=4&&(r.extra.page=i.slice(3).join("/")),r;if("discussions"===s)return r.type="discussions",i.length>=4&&/^\d+$/.test(i[3])&&(r.subtype="discussion",r.extra.number=parseInt(i[3],10)),r;if("commits"===s||"commit"===s)return"commit"===s&&i.length>=4?(r.type="commit",r.extra.sha=i[3]):(r.type="commits",i.length>=4&&(r.extra.branch=i[3])),r;if("branches"===s)return r.type="branches",r;if("tags"===s)return r.type="tags",r;if("blob"===s||"tree"===s){if(r.type="file",r.subtype=s,i.length>=4&&(r.extra.branch=i[3],i.length>=5&&(r.extra.path=i.slice(4).join("/"),"blob"===s))){const e=i[i.length-1].match(/\.([a-zA-Z0-9]+)$/);e&&(r.extra.extension=e[1].toLowerCase())}return r}if("search"===s)return r.type="search",r.extra.query=e.searchParams.get("q"),r;return r.type="repo",r.extra.subPath=i.slice(2).join("/"),r}(t):function(e){return"medium.com"===e||e.endsWith(".medium.com")}(n)?function(e){const t=e.hostname,n=e.pathname,r={platform:"medium",type:"article",creator:null,identifier:null,subtype:null,extra:{}};if("medium.com"!==t&&t.endsWith(".medium.com")){const e=t.replace(".medium.com","");r.extra.publication=e;const i=n.slice(1).split("/").filter(Boolean);i.length>0&&i[0].startsWith("@")&&(r.creator=i[0]);const o=i[i.length-1];return o&&o.includes("-")&&(r.identifier=o),r}const i=n.slice(1).split("/").filter(Boolean);if(i.length>=1&&i[0].startsWith("@"))return r.creator=i[0],1===i.length?r.type="profile":(r.type="article",r.identifier=i[1]),r;i.length>=1&&(r.extra.publication=i[0],i.length>=2&&(r.identifier=i[i.length-1]));return r}(t):function(e){return"dev.to"===e||"www.dev.to"===e}(n)?function(e){const t=e.pathname,n=t.slice(1).split("/").filter(Boolean),r={platform:"devto",type:"article",creator:null,identifier:null,subtype:null,extra:{}};if(0===n.length)return r.type="home",r;if("t"===n[0]&&n.length>=2)return r.type="tag",r.identifier=n[1],r;if(1===n.length)return r.type="profile",r.creator=n[0],r.identifier=n[0],r;n.length>=2&&(r.type="article",r.creator=n[0],r.identifier=n[1]);return r}(t):function(e){return e.endsWith(".substack.com")}(n)?function(e){const t=e.hostname,n=e.pathname,r=t.replace(".substack.com",""),i=n.slice(1).split("/").filter(Boolean),o={platform:"substack",type:"publication",creator:r,identifier:r,subtype:null,extra:{publication:r}};if(i.length>=2&&"p"===i[0])return o.type="article",o.identifier=i[1],o;if(i.length>=1&&"archive"===i[0])return o.type="archive",o;if(i.length>=1&&"about"===i[0])return o.type="about",o;return o}(t):function(e){return"twitter.com"===e||"www.twitter.com"===e||"x.com"===e||"www.x.com"===e}(n)?function(e){const t=e.pathname,n=t.slice(1).split("/").filter(Boolean),r={platform:"twitter",type:null,creator:null,identifier:null,subtype:null,extra:{}};if(0===n.length)return r.type="home",r;if(["home","explore","search","notifications","messages","settings","i"].includes(n[0]))return r.type="special",r.identifier=n[0],r;if("hashtag"===n[0]&&n.length>=2)return r.type="hashtag",r.identifier=n[1],r;const i=n[0];if(r.creator=`@${i}`,1===n.length)return r.type="profile",r.identifier=i,r;if("status"===n[1]&&n.length>=3)return r.type="tweet",r.identifier=n[2],r;if(["followers","following","likes","lists","moments"].includes(n[1]))return r.type="profile",r.identifier=i,r.extra.section=n[1],r;return r}(t):function(e){return"reddit.com"===e||"www.reddit.com"===e||"old.reddit.com"===e||e.endsWith(".reddit.com")}(n)?function(e){const t=e.pathname,n=t.slice(1).split("/").filter(Boolean),r={platform:"reddit",type:null,creator:null,identifier:null,subtype:null,extra:{}};if(0===n.length)return r.type="home",r;if("r"===n[0]&&n.length>=2){const e=n[1];return r.type="subreddit",r.creator=`r/${e}`,r.identifier=e,n.length>=4&&"comments"===n[2]&&(r.type="post",r.extra.postId=n[3],r.extra.subreddit=e,n.length>=5&&(r.extra.title=n[4])),r}if(("u"===n[0]||"user"===n[0])&&n.length>=2)return r.type="profile",r.creator=`u/${n[1]}`,r.identifier=n[1],n.length>=3&&(r.extra.section=n[2]),r;return r}(t):function(e){return"stackoverflow.com"===e||"www.stackoverflow.com"===e||e.endsWith(".stackexchange.com")}(n)?function(e){const t=e.hostname,n=e.pathname,r=n.slice(1).split("/").filter(Boolean),i={platform:"stackoverflow",type:null,creator:null,identifier:null,subtype:null,extra:{}};t.endsWith(".stackexchange.com")&&(i.extra.site=t.replace(".stackexchange.com",""));if(0===r.length)return i.type="home",i;if("questions"===r[0]&&r.length>=2){const t=r[1];if(/^\d+$/.test(t)){i.type="question",i.identifier=t,i.extra.questionId=parseInt(t,10);const n=e.hash;if(n&&n.startsWith("#")){const e=n.match(/^#(\d+)$/);e&&(i.subtype="answer",i.extra.answerId=parseInt(e[1],10))}}else"tagged"===t&&(i.type="tag",i.identifier=r[2]);return i}if("users"===r[0]&&r.length>=2)return i.type="profile",i.identifier=r[1],r.length>=3&&(i.creator=r[2]),i;if("tags"===r[0])return i.type="tags",r.length>=2&&(i.identifier=r[1]),i;return i}(t):function(e){return"npmjs.com"===e||"www.npmjs.com"===e}(n)?function(e){const t=e.pathname,n=t.slice(1).split("/").filter(Boolean),r={platform:"npm",type:"home",creator:null,identifier:null,subtype:null,extra:{}};if(0===n.length)return r;if("package"===n[0]){r.type="package",n.length>=2&&n[1].startsWith("@")?(r.identifier=`${n[1]}/${n[2]||""}`,r.creator=n[1]):n.length>=2&&(r.identifier=n[1]);const e=n[n.length-1];return["readme","versions","dependencies","dependents","code"].includes(e)&&(r.extra.tab=e),r}if(n[0].startsWith("~"))return r.type="profile",r.creator=n[0].slice(1),r.identifier=n[0].slice(1),r;if("org"===n[0]&&n.length>=2)return r.type="org",r.creator=n[1],r.identifier=n[1],r;if("search"===n[0])return r.type="search",r.extra.query=e.searchParams.get("q"),r;return r}(t):function(e){const t=e.hostname,n=e.pathname,r=n.slice(1).split("/").filter(Boolean),i={platform:"other",type:"page",creator:null,identifier:null,subtype:null,extra:{domain:t.replace(/^www\./,"")}};(n.includes("/blog/")||n.includes("/article/")||n.includes("/post/"))&&(i.type="article",i.identifier=r[r.length-1]);(n.includes("/docs/")||n.includes("/documentation/")||n.includes("/api/"))&&(i.type="documentation",i.identifier=r[r.length-1]);r.length>=1&&(r[0].startsWith("@")||"user"===r[0]||"profile"===r[0])&&(i.type="profile",i.creator=r[0].startsWith("@")?r[0]:r[1]||r[0]);return i}(t)}catch(t){return console.warn("Error parsing URL:",e,t),null}}const s=new o("BookmarkInsightsDB");s.version(1).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}),s.version(2).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}).upgrade(e=>{console.log("Upgrading database to version 2 - adding rawMetadata support")}),s.version(3).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 3 - adding similarities and computedMetrics tables")}),s.version(4).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId, platform, creator, contentType",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 4 - adding platformData indexes")}),s.version(5).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId, platform, creator, contentType, publishedDate",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key",similarities:"++id, bookmark1Id, bookmark2Id, score, [bookmark1Id+bookmark2Id]",computedMetrics:"key"}).upgrade(e=>{console.log("Upgrading database to version 5 - adding deep metadata analysis fields")});const c={enrichmentEnabled:!0,enrichmentSchedule:"manual",enrichmentBatchSize:50,enrichmentConcurrency:5,enrichmentRateLimit:1e3,enrichmentFreshnessDays:30,autoCategorizationEnabled:!0,deadLinkCheckEnabled:!0,privacyMode:!1,trackBrowsingBehavior:!1};async function u(){try{await s.settings.get("app")||await s.settings.put({key:"app",...c})}catch(e){console.error("Error initializing settings:",e)}}async function l(){try{return await s.settings.get("app")||c}catch(e){return console.error("Error getting settings:",e),c}}async function h(){try{const e=await s.settings.get("migration");if(e&&e.completed)return console.log("Migration already completed"),{success:!0,alreadyMigrated:!0};console.log("Starting migration from chrome.storage.local to IndexedDB...");const t=await chrome.storage.local.get(["bookmarks","lastSyncTime"]),n=t.bookmarks||[];if(0===n.length)return console.log("No bookmarks to migrate"),await s.settings.put({key:"migration",completed:!0,timestamp:Date.now(),count:0}),{success:!0,count:0};const r=n.map(e=>({...e,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0,platform:null,creator:null,contentType:null,platformData:null}));return await s.bookmarks.bulkPut(r),await s.settings.put({key:"migration",completed:!0,timestamp:Date.now(),count:r.length,oldSyncTime:t.lastSyncTime}),console.log(`Successfully migrated ${r.length} bookmarks`),{success:!0,count:r.length}}catch(e){return console.error("Migration error:",e),{success:!1,error:e.message}}}async function f(){try{return await s.bookmarks.toArray()}catch(e){return console.error("Error getting bookmarks:",e),[]}}async function d(e){try{return await s.bookmarks.get(e)}catch(e){return console.error("Error getting bookmark:",e),null}}async function p(e){try{return await s.bookmarks.put(e),!0}catch(e){return console.error("Error upserting bookmark:",e),!1}}async function m(e){try{const t=await s.bookmarks.toArray(),n=new Map(t.map(e=>[e.id,e])),r=e.map(e=>{const t=n.get(e.id);return t?{id:e.id,title:e.title,url:e.url,dateAdded:e.dateAdded,parentId:e.parentId,folderPath:e.folderPath,domain:e.domain,description:t.description??null,keywords:t.keywords??[],category:t.category??null,tags:t.tags??[],isAlive:t.isAlive??null,lastChecked:t.lastChecked??null,faviconUrl:t.faviconUrl??null,contentSnippet:t.contentSnippet??null,rawMetadata:t.rawMetadata??null,lastAccessed:t.lastAccessed??null,accessCount:t.accessCount??0,platform:t.platform??null,creator:t.creator??null,contentType:t.contentType??null,platformData:t.platformData??null}:{...e,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,rawMetadata:null,lastAccessed:null,accessCount:0,platform:null,creator:null,contentType:null,platformData:null}});return await s.bookmarks.bulkPut(r),console.log(`Smart merged ${r.length} bookmarks (${e.length-n.size} new, ${n.size} updated)`),!0}catch(e){return console.error("Error smart merging bookmarks:",e),!1}}async function g(e){try{return await s.bookmarks.delete(e),!0}catch(e){return console.error("Error deleting bookmark:",e),!1}}async function y(e,t,n={}){try{return await s.events.add({bookmarkId:e,type:t,timestamp:Date.now(),...n}),!0}catch(e){return console.error("Error logging event:",e),!1}}async function v(e,t,n=null){try{return await s.cache.put({key:e,value:t,timestamp:Date.now(),ttl:n}),!0}catch(e){return console.error("Error setting cache:",e),!1}}async function b(e){try{const t=await s.cache.get(e);return t?t.ttl&&Date.now()-t.timestamp>t.ttl?(await s.cache.delete(e),null):t.value:null}catch(e){return console.error("Error getting cache:",e),null}}async function w(e,t=0){try{return!await s.enrichmentQueue.where("bookmarkId").equals(e).first()&&(await s.enrichmentQueue.add({bookmarkId:e,addedAt:Date.now(),priority:t}),!0)}catch(e){return console.error("Error adding to enrichment queue:",e),!1}}async function k(e=20){try{return await s.enrichmentQueue.orderBy("priority").reverse().limit(e).toArray()}catch(e){return console.error("Error getting enrichment batch:",e),[]}}async function x(e){try{return await s.enrichmentQueue.delete(e),!0}catch(e){return console.error("Error removing from enrichment queue:",e),!1}}async function _(){try{await u();const e=await h();return console.log("Database initialized",e),e}catch(e){return console.error("Error initializing database:",e),{success:!1,error:e.message}}}const A={domainStats:36e5,activityTimeline:216e5,wordFrequency:864e5,ageDistribution:216e5,categoryTrends:864e5,expertiseAreas:864e5,quickStats:3e5,duplicates:864e5,similarities:864e5,insightsSummary:3e5};async function E(e,t,n){try{const r=await s.computedMetrics.get(e);if(r&&r.validUntil>Date.now())return console.log(`Cache hit for metric: ${e}`),r.data;console.log(`Cache miss for metric: ${e}, computing...`);const i=await t();return await s.computedMetrics.put({key:e,data:i,computedAt:Date.now(),validUntil:Date.now()+n}),i}catch(n){return console.error(`Error getting cached metric ${e}:`,n),t()}}async function S(e){const t={add:["domainStats","quickStats","activityTimeline","ageDistribution","insightsSummary"],delete:["domainStats","quickStats","duplicates","similarities","insightsSummary"],update:["quickStats","insightsSummary"],enrich:["categoryTrends","expertiseAreas","insightsSummary","quickStats"],all:Object.keys(A)}[e]||[];try{for(const e of t)await s.computedMetrics.delete(e);console.log(`Invalidated caches for change type: ${e}`,t)}catch(e){console.error("Error invalidating metric caches:",e)}}async function C(){try{return await s.computedMetrics.clear(),console.log("Cleared all metric caches"),!0}catch(e){return console.error("Error clearing metric caches:",e),!1}}async function P(){return E("domainAnalytics",async()=>{const e=await f(),t={};e.forEach(e=>{if(!e.domain)return;t[e.domain]||(t[e.domain]={domain:e.domain,count:0,latestDate:0,oldestDate:1/0,enrichedCount:0});const n=t[e.domain];n.count++,e.lastChecked&&n.enrichedCount++,e.dateAdded>n.latestDate&&(n.latestDate=e.dateAdded),e.dateAdded<n.oldestDate&&(n.oldestDate=e.dateAdded)});const n=Object.values(t),r=e.length;return n.forEach(e=>{e.percentage=r>0?Math.round(e.count/r*100):0,e.dateAdded=e.latestDate}),{byRecency:[...n].sort((e,t)=>t.latestDate-e.latestDate),byCount:[...n].sort((e,t)=>t.count-e.count),top10:[...n].sort((e,t)=>t.count-e.count).slice(0,10),totalDomains:n.length,totalBookmarks:r}},A.domainStats)}async function O(){return E("duplicates",async()=>{const e=await f(),t={};return e.forEach(e=>{const n=e.url.toLowerCase().replace(/\/$/,"");t[n]||(t[n]=[]),t[n].push(e)}),Object.values(t).filter(e=>e.length>1)},A.duplicates)}async function B(){try{const e=await f(),t=["Bookmarks Bar","Other Bookmarks","Mobile Bookmarks",""];return e.filter(e=>{const n=e.folderPath||"";return t.includes(n)||!n.includes("/")})}catch(e){return console.error("Error finding uncategorized bookmarks:",e),[]}}async function D(){try{const e=await f(),t=["http://","https://","chrome://","chrome-extension://","file://","javascript:","data:","about:","mailto:","tel:","ftp://","sftp://","ssh://"];return e.filter(e=>{const n=e.url||"";return!t.some(e=>n.startsWith(e))||""===n.trim()})}catch(e){return console.error("Error finding malformed URLs:",e),[]}}async function I(){try{const e=await s.bookmarks.toArray(),t=await s.settings.toArray(),n=await s.events.orderBy("timestamp").reverse().limit(1e3).toArray(),r=await s.similarities.toArray(),i=e.filter(e=>e.lastChecked).length,o=e.filter(e=>e.category).length;return{version:"2.1",schemaVersion:3,createdAt:(new Date).toISOString(),metadata:{totalBookmarks:e.length,enrichedCount:i,categorizedCount:o,eventsCount:n.length,similaritiesCount:r.length},data:{bookmarks:e,settings:t,events:n,similarities:r}}}catch(e){throw console.error("Error creating backup:",e),e}}async function j(e,t={}){const{restoreBookmarks:n=!0,restoreSettings:r=!0,restoreEvents:i=!1,restoreSimilarities:o=!0,mergeMode:a=!1}=t;try{if(!e||!e.version||!e.data)throw new Error("Invalid backup format");if(!e.data.bookmarks||!Array.isArray(e.data.bookmarks))throw new Error("Backup does not contain valid bookmarks data");const t={bookmarksRestored:0,settingsRestored:0,eventsRestored:0,similaritiesRestored:0,errors:[]};if(n&&e.data.bookmarks.length>0)if(a||await s.bookmarks.clear(),a){const n=await s.bookmarks.toArray(),r=new Map(n.map(e=>[e.id,e]));for(const n of e.data.bookmarks){const e=r.get(n.id);if(e){const r=e.lastChecked||0;(n.lastChecked||0)>r&&(await s.bookmarks.put(n),t.bookmarksRestored++)}else await s.bookmarks.put(n),t.bookmarksRestored++}}else await s.bookmarks.bulkPut(e.data.bookmarks),t.bookmarksRestored=e.data.bookmarks.length;return r&&e.data.settings&&e.data.settings.length>0&&(a||await s.settings.clear(),await s.settings.bulkPut(e.data.settings),t.settingsRestored=e.data.settings.length),i&&e.data.events&&e.data.events.length>0&&(a||await s.events.clear(),await s.events.bulkPut(e.data.events),t.eventsRestored=e.data.events.length),o&&e.data.similarities&&e.data.similarities.length>0&&(a||await s.similarities.clear(),await s.similarities.bulkPut(e.data.similarities),t.similaritiesRestored=e.data.similarities.length),await C(),{success:!0,results:t,backupMetadata:e.metadata}}catch(e){throw console.error("Error restoring from backup:",e),e}}var T=Object.freeze({__proto__:null,CACHE_DURATIONS:A,addToEnrichmentQueue:w,backfillPlatformData:async function(e=null){console.log("Starting platform data backfill...");const t={processed:0,updated:0,errors:0,platforms:{}};try{const n=await s.bookmarks.toArray(),r=n.length;console.log(`Processing ${r} bookmarks for platform data...`);const i=100;for(let o=0;o<n.length;o+=i){const c=n.slice(o,o+i),u=[];for(const e of c){t.processed++;try{if(!e.url)continue;const n=a(e.url);if(!n||!n.platform)continue;e.platform===n.platform&&e.creator===n.creator&&e.contentType===n.type||(u.push({id:e.id,platform:n.platform,creator:n.creator||null,contentType:n.type||null,platformData:n}),t.platforms[n.platform]=(t.platforms[n.platform]||0)+1)}catch(n){t.errors++,console.warn(`Error processing bookmark ${e.id}:`,n.message)}}u.length>0&&(await s.bookmarks.bulkUpdate(u.map(e=>({key:e.id,changes:{platform:e.platform,creator:e.creator,contentType:e.contentType,platformData:e.platformData}}))),t.updated+=u.length),e&&e(t.processed,r)}return console.log("Platform data backfill complete:",t),t}catch(e){throw console.error("Error during platform data backfill:",e),e}},bulkUpsertBookmarks:async function(e){try{return await s.bookmarks.bulkPut(e),!0}catch(e){return console.error("Error bulk upserting bookmarks:",e),!1}},checkDeadLinks:async function(e=null,t=10){try{const n=await f(),r=e?n.filter(t=>e.includes(t.id)):n.filter(e=>e.url.startsWith("http")),i={checked:0,alive:[],dead:[],errors:[],inProgress:!1};for(let e=0;e<Math.min(r.length,t);e++){const t=r[e];i.checked++;try{const e=new AbortController,n=setTimeout(()=>e.abort(),5e3);await fetch(t.url,{method:"HEAD",mode:"no-cors",signal:e.signal}),clearTimeout(n),i.alive.push(t)}catch(e){"AbortError"===e.name?i.errors.push({bookmark:t,reason:"timeout"}):i.dead.push({bookmark:t,reason:e.message})}}return{...i,total:r.length,remaining:Math.max(0,r.length-t)}}catch(e){return console.error("Error checking dead links:",e),{checked:0,alive:[],dead:[],errors:[],total:0,remaining:0}}},clearAllMetricCaches:C,clearCache:async function(e=null){try{if(e){const t=(await s.cache.toArray()).filter(t=>t.key.includes(e)).map(e=>e.key);await s.cache.bulkDelete(t)}else await s.cache.clear();return!0}catch(e){return console.error("Error clearing cache:",e),!1}},clearEnrichmentQueue:async function(){try{return await s.enrichmentQueue.clear(),!0}catch(e){return console.error("Error clearing enrichment queue:",e),!1}},clearSimilarities:async function(){try{return await s.similarities.clear(),!0}catch(e){return console.error("Error clearing similarities:",e),!1}},createAutoBackup:async function(){try{const e=await I();let t=(await chrome.storage.local.get(["autoBackups"])).autoBackups||[];return t.unshift({createdAt:e.createdAt,metadata:e.metadata,data:e.data}),t.length>3&&(t=t.slice(0,3)),await chrome.storage.local.set({autoBackups:t}),console.log("Auto-backup created:",e.metadata),{success:!0,metadata:e.metadata}}catch(e){return console.error("Error creating auto-backup:",e),{success:!1,error:e.message}}},createBackup:I,db:s,deleteBookmark:g,deleteBookmarks:async function(e){try{const t=[];for(const n of e)try{await chrome.bookmarks.remove(n)}catch(e){console.error(`Error deleting bookmark ${n}:`,e),t.push({id:n,error:e.message})}return await s.bookmarks.bulkDelete(e),await S("delete"),{success:e.length-t.length,errors:t}}catch(e){throw console.error("Error deleting bookmarks:",e),e}},downloadBackup:async function(){try{const e=await I(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),r=`bookmark-insights-backup-${(new Date).toISOString().slice(0,10)}.json`,i=document.createElement("a");return i.href=n,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),{success:!0,filename:r,metadata:e.metadata}}catch(e){throw console.error("Error downloading backup:",e),e}},exportBookmarks:async function(){try{const e=await f();return{exportDate:(new Date).toISOString(),version:"2.0",totalBookmarks:e.length,bookmarks:e}}catch(e){throw console.error("Error exporting bookmarks:",e),e}},findDuplicates:O,findMalformedUrls:D,findOrphans:async function(){return B()},findSimilarBookmarks:async function(e=.7,t=100){try{const n=await f(),r=[],i=n.map(e=>({bookmark:e,words:new Set(e.title.toLowerCase().split(/\s+/).filter(e=>e.length>2))})).filter(e=>e.words.size>0);for(let n=0;n<i.length;n++){for(let t=n+1;t<i.length;t++){if(i[n].bookmark.url===i[t].bookmark.url)continue;const o=i[n].words,a=i[t].words,s=[...o].filter(e=>a.has(e)).length,c=2*s/(o.size+a.size);c>=e&&r.push([i[n].bookmark,i[t].bookmark,c])}if(r.length>=2*t)break}return r.sort((e,t)=>t[2]-e[2]).slice(0,t)}catch(e){return console.error("Error finding similar bookmarks:",e),[]}},findUncategorizedBookmarks:B,getActivityTimeline:async function(){try{const e=await s.bookmarks.toArray(),t={};return e.forEach(e=>{const n=new Date(e.dateAdded),r=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;t[r]=(t[r]||0)+1}),Object.entries(t).sort()}catch(e){return console.error("Error getting activity timeline:",e),[]}},getAllBookmarks:f,getBookmark:d,getBookmarkAgeDistribution:async function(){return E("ageDistribution",async()=>{const e=await f(),t=Date.now(),n={"Last 24 hours":0,"Last week":0,"Last month":0,"Last 3 months":0,"Last 6 months":0,"Last year":0,"Over 1 year":0},r=864e5,i=7*r,o=30*r;return e.forEach(e=>{const a=t-e.dateAdded;a<=r?n["Last 24 hours"]++:a<=i?n["Last week"]++:a<=o?n["Last month"]++:a<=3*o?n["Last 3 months"]++:a<=6*o?n["Last 6 months"]++:a<=365*r?n["Last year"]++:n["Over 1 year"]++}),Object.entries(n)},A.ageDistribution)},getBookmarkCreationPatterns:async function(){return E("creationPatterns",async()=>{const e=await f(),t=new Array(24).fill(0),n=new Array(7).fill(0),r=new Array(12).fill(0),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return e.forEach(e=>{const i=new Date(e.dateAdded);t[i.getHours()]++,n[i.getDay()]++,r[i.getMonth()]++}),{hourly:t.map((e,t)=>[`${t}:00`,e]),daily:n.map((e,t)=>[i[t],e]),monthly:r.map((e,t)=>[o[t],e])}},A.ageDistribution)},getBookmarkEvents:async function(e,t=50){try{return await s.events.where("bookmarkId").equals(e).reverse().limit(t).toArray()}catch(e){return console.error("Error getting bookmark events:",e),[]}},getBookmarksByCategory:async function(e){try{return await s.bookmarks.where("category").equals(e).toArray()}catch(e){return console.error("Error getting bookmarks by category:",e),[]}},getBookmarksByDateRange:async function(e,t){try{return await s.bookmarks.where("dateAdded").between(e,t,!0,!0).toArray()}catch(e){return console.error("Error getting bookmarks by date range:",e),[]}},getBookmarksByDomain:async function(e){try{return await s.bookmarks.where("domain").equals(e).toArray()}catch(e){return console.error("Error getting bookmarks by domain:",e),[]}},getBookmarksByFolder:async function(e){try{return(await f()).filter(t=>t.folderPath===e)}catch(e){return console.error("Error getting bookmarks by folder:",e),[]}},getBookmarksPaginated:async function(e=0,t=50,n={}){try{let r=await f();if(n.domains&&n.domains.length>0&&(r=r.filter(e=>n.domains.includes(e.domain))),n.folders&&n.folders.length>0&&(r=r.filter(e=>n.folders.includes(e.folderPath))),n.dateRange&&(r=r.filter(e=>e.dateAdded>=n.dateRange.startDate&&e.dateAdded<=n.dateRange.endDate)),n.searchQuery){const e=n.searchQuery.toLowerCase();r=r.filter(t=>t.title&&t.title.toLowerCase().includes(e)||t.url&&t.url.toLowerCase().includes(e)||t.domain&&t.domain.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}n.platforms&&n.platforms.length>0&&(r=r.filter(e=>n.platforms.includes(e.platform||"other"))),n.creators&&n.creators.length>0&&(r=r.filter(e=>{if(!e.creator)return!1;const t=`${e.platform||"other"}:${e.creator}`;return n.creators.some(e=>e.key===t)})),n.contentTypes&&n.contentTypes.length>0&&(r=r.filter(e=>n.contentTypes.includes(e.contentType))),n.category&&(r=r.filter(e=>e.category===n.category)),void 0!==n.isEnriched&&(r=n.isEnriched?r.filter(e=>e.lastChecked):r.filter(e=>!e.lastChecked));switch(n.sortBy||"date_desc"){case"date_asc":r.sort((e,t)=>e.dateAdded-t.dateAdded);break;case"title_asc":r.sort((e,t)=>(e.title||"").localeCompare(t.title||""));break;case"title_desc":r.sort((e,t)=>(t.title||"").localeCompare(e.title||""));break;case"domain_asc":r.sort((e,t)=>(e.domain||"").localeCompare(t.domain||""));break;case"accessed_desc":r.sort((e,t)=>(t.lastAccessed||0)-(e.lastAccessed||0));break;default:r.sort((e,t)=>t.dateAdded-e.dateAdded)}const i=e*t,o=i+t;return{bookmarks:r.slice(i,o),totalCount:r.length,hasMore:o<r.length,currentPage:e,totalPages:Math.ceil(r.length/t)}}catch(e){return console.error("Error getting paginated bookmarks:",e),{bookmarks:[],totalCount:0,hasMore:!1,currentPage:0,totalPages:0}}},getCache:b,getCachedMetric:E,getConsolidatedDomainAnalytics:P,getDeadLinks:async function(){try{return(await f()).filter(e=>!1===e.isAlive)}catch(e){return console.error("Error getting dead links:",e),[]}},getDomainDistribution:async function(){try{const e=await f(),t={};e.forEach(e=>{t[e.domain]=(t[e.domain]||0)+1});const n=Object.entries(t).sort(([,e],[,t])=>t-e),r=e.length,i=n.slice(0,10),o=n.slice(10).reduce((e,[,t])=>e+t,0),a=i.map(([e,t])=>({domain:e,count:t,percentage:Math.round(t/r*100)}));return o>0&&a.push({domain:"Others",count:o,percentage:Math.round(o/r*100)}),a}catch(e){return console.error("Error getting domain distribution:",e),[]}},getDomainStats:async function(){try{const e=await s.bookmarks.toArray(),t={};return e.forEach(e=>{e.domain&&(t[e.domain]=(t[e.domain]||0)+1)}),Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,10)}catch(e){return console.error("Error getting domain stats:",e),[]}},getDomainsByCount:async function(){return(await P()).byCount},getDomainsByRecency:async function(){return(await P()).byRecency},getEnrichmentQueueSize:async function(){try{return await s.enrichmentQueue.count()}catch(e){return console.error("Error getting queue size:",e),0}},getNextEnrichmentBatch:k,getPlatformDataStats:async function(){try{const e=await s.bookmarks.count(),t=await s.bookmarks.where("platform").notEqual("").count(),n=await s.bookmarks.where("creator").notEqual("").count(),r={};return await s.bookmarks.where("platform").notEqual("").each(e=>{e.platform&&(r[e.platform]=(r[e.platform]||0)+1)}),{total:e,withPlatform:t,withCreator:n,coverage:e>0?Math.round(t/e*100):0,platforms:r}}catch(e){return console.error("Error getting platform stats:",e),{total:0,withPlatform:0,withCreator:0,coverage:0,platforms:{}}}},getQuickStats:async function(){return E("quickStats",async()=>{const e=await f(),t=await O(),n=await B(),r=await D(),i=Date.now(),o=e.filter(e=>e.lastChecked).length,a=e.filter(e=>!1===e.isAlive).length,s=new Set(e.map(e=>e.domain).filter(e=>e)).size;return{total:e.length,enriched:o,pending:e.length-o,enrichedPercentage:e.length>0?Math.round(o/e.length*100):0,duplicateGroups:t.length,uncategorized:n.length,malformed:r.length,deadLinks:a,uniqueDomains:s,addedThisWeek:e.filter(e=>i-e.dateAdded<6048e5).length,addedThisMonth:e.filter(e=>i-e.dateAdded<2592e6).length,oldestBookmark:e.reduce((e,t)=>t.dateAdded<e?t.dateAdded:e,Date.now()),newestBookmark:e.reduce((e,t)=>t.dateAdded>e?t.dateAdded:e,0)}},A.quickStats)},getRecentEvents:async function(e=100){try{return await s.events.orderBy("timestamp").reverse().limit(e).toArray()}catch(e){return console.error("Error getting recent events:",e),[]}},getSettings:l,getStoredSimilarities:async function(e){try{return await s.similarities.where("bookmark1Id").equals(e).toArray()}catch(e){return console.error("Error getting stored similarities:",e),[]}},getTitlePatterns:async function(){try{const e=await f(),t={};return e.forEach(e=>{if(e.title){const n=e.title.toLowerCase();n.includes("how to")&&(t["How-to guides"]=(t["How-to guides"]||0)+1),n.includes("tutorial")&&(t.Tutorials=(t.Tutorials||0)+1),(n.includes("documentation")||n.includes("docs"))&&(t.Documentation=(t.Documentation||0)+1),(n.includes("api")||n.includes("reference"))&&(t["API/Reference"]=(t["API/Reference"]||0)+1),(n.includes("blog")||n.includes("article"))&&(t["Blog/Articles"]=(t["Blog/Articles"]||0)+1),(n.includes("github")||n.includes("repository"))&&(t["Code Repositories"]=(t["Code Repositories"]||0)+1),(n.includes("video")||n.includes("youtube"))&&(t.Videos=(t.Videos||0)+1),(n.includes("tool")||n.includes("app"))&&(t["Tools/Apps"]=(t["Tools/Apps"]||0)+1),n.length>60&&(t["Long titles (60+ chars)"]=(t["Long titles (60+ chars)"]||0)+1),n.split(" ").length<=3&&(t["Short titles (3 words)"]=(t["Short titles (3 words)"]||0)+1)}}),Object.entries(t).sort(([,e],[,t])=>t-e)}catch(e){return console.error("Error getting title patterns:",e),[]}},getTitleWordFrequency:async function(){return E("wordFrequency",async()=>{const e=await f(),t={},n=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","are","was","were","be","been","have","has","had","do","does","did","will","would","could","should","may","might","can","about","from","up","out"]);return e.forEach(e=>{if(e.title){e.title.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2&&!n.has(e)).forEach(e=>{t[e]=(t[e]||0)+1})}}),Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,20)},A.wordFrequency)},getUniqueCategories:async function(){try{const e=await s.bookmarks.toArray();return[...new Set(e.map(e=>e.category).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique categories:",e),[]}},getUniqueDomains:async function(){try{const e=await s.bookmarks.toArray();return[...new Set(e.map(e=>e.domain).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique domains:",e),[]}},getUniqueFolders:async function(){try{const e=await f();return[...new Set(e.map(e=>e.folderPath).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique folders:",e),[]}},getUrlParameterUsage:async function(){try{const e=await f(),t={};let n=0,r=0;e.forEach(e=>{r++;try{const r=new URL(e.url).searchParams;if(r.toString()){n++;for(const[e]of r)t[e]=(t[e]||0)+1}}catch(e){}});return{parameters:Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,15),urlsWithParams:n,totalUrls:r,percentage:r>0?Math.round(n/r*100):0}}catch(e){return console.error("Error getting URL parameter usage:",e),{parameters:[],urlsWithParams:0,totalUrls:0,percentage:0}}},getUrlPatterns:async function(){try{const e=await f(),t={},n={},r={},i={};return e.forEach(e=>{try{const o=new URL(e.url);t[o.protocol]=(t[o.protocol]||0)+1;const a=o.hostname.split(".");if(a.length>1){const e=a[a.length-1];n[e]=(n[e]||0)+1}if(a.length>2){const e=a[0];"www"!==e&&(i[e]=(i[e]||0)+1)}const s=o.pathname.split("/").filter(e=>e.length>0);if(s.length>0){const e=s[0];r[e]=(r[e]||0)+1}}catch(e){}}),{protocols:Object.entries(t).sort(([,e],[,t])=>t-e),topLevelDomains:Object.entries(n).sort(([,e],[,t])=>t-e).slice(0,10),subdomains:Object.entries(i).sort(([,e],[,t])=>t-e).slice(0,10),pathPatterns:Object.entries(r).sort(([,e],[,t])=>t-e).slice(0,15)}}catch(e){return console.error("Error getting URL patterns:",e),{protocols:[],topLevelDomains:[],subdomains:[],pathPatterns:[]}}},initializeDatabase:_,initializeSettings:u,invalidateMetricCaches:S,listAutoBackups:async function(){try{const e=await chrome.storage.local.get(["autoBackups"]);return(e.autoBackups||[]).map((e,t)=>({index:t,createdAt:e.createdAt,metadata:e.metadata}))}catch(e){return console.error("Error listing auto-backups:",e),[]}},logEvent:y,migrateFromChromeStorage:h,removeFromEnrichmentQueue:x,restoreFromAutoBackup:async function(e=0){try{const t=(await chrome.storage.local.get(["autoBackups"])).autoBackups||[];if(e<0||e>=t.length)throw new Error(`Invalid backup index: ${e}. Available: 0-${t.length-1}`);const n={version:"2.1",...t[e]};return await j(n)}catch(e){throw console.error("Error restoring from auto-backup:",e),e}},restoreFromBackup:j,searchBookmarks:async function(e){try{if(!e||!e.trim())return await s.bookmarks.orderBy("dateAdded").reverse().toArray();const t=e.toLowerCase();return(await s.bookmarks.toArray()).filter(e=>e.title.toLowerCase().includes(t)||e.url.toLowerCase().includes(t)||e.domain&&e.domain.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.keywords&&e.keywords.some(e=>e.toLowerCase().includes(t))).sort((e,t)=>t.dateAdded-e.dateAdded)}catch(e){return console.error("Search error:",e),[]}},setCache:v,smartMergeBookmarks:m,storeSimilarities:async function(e,t){try{await s.similarities.where("bookmark1Id").equals(e).delete();const n=t.map(t=>({bookmark1Id:e,bookmark2Id:t.bookmark2Id,score:t.score,computedAt:Date.now()}));return await s.similarities.bulkAdd(n),!0}catch(e){return console.error("Error storing similarities:",e),!1}},updateSettings:async function(e){try{const t=await l();return await s.settings.put({key:"app",...t,...e}),!0}catch(e){return console.error("Error updating settings:",e),!1}},upsertBookmark:p,validateBackup:function(e){const t=[];if(!e)return{valid:!1,issues:["Backup is empty or null"]};if(e.version||t.push("Missing version field"),e.data){if(e.data.bookmarks&&Array.isArray(e.data.bookmarks)||t.push("Missing or invalid bookmarks array"),e.data.bookmarks&&e.data.bookmarks.length>0){const n=e.data.bookmarks[0];n.id&&n.url||t.push("Bookmarks are missing required fields (id, url)")}}else t.push("Missing data field");return{valid:0===t.length,issues:t,metadata:e.metadata||null,version:e.version||"unknown",createdAt:e.createdAt||"unknown"}}});function M(e,t=""){if(!e)return null;if(e["og:video:duration"]){const t=parseInt(e["og:video:duration"],10);return Math.ceil(t/60)}if(e["video:duration"]){const t=parseInt(e["video:duration"],10);return Math.ceil(t/60)}if(e.schemaOrg){const t=Array.isArray(e.schemaOrg)?e.schemaOrg:[e.schemaOrg];for(const e of t)if("VideoObject"===e["@type"]&&e.duration){const t=L(e.duration);if(t)return t}}const n=function(e,t){let n=0;if(e.schemaOrg){const t=Array.isArray(e.schemaOrg)?e.schemaOrg:[e.schemaOrg];for(const e of t)if(e.wordCount)return parseInt(e.wordCount,10)}t&&t.length>100&&(n=t.split(/\s+/).length,n*=5);const r=e.description||e["og:description"]||"";r.length>200&&0===n&&(n=r.length<500?750:r.length<1e3?1500:2500);return n}(e,t);return n>0?Math.ceil(n/225):null}function q(e){if(!e)return null;const t=["article:published_time","datePublished","og:published_time","publication_date","publishedDate","date","og:updated_time","article:modified_time","dateModified","lastmod"];for(const n of t){const t=e[n];if(t){const e=z(t);if(e)return e}}if(e.schemaOrg){const t=Array.isArray(e.schemaOrg)?e.schemaOrg:[e.schemaOrg];for(const e of t){const t=e.datePublished||e.dateCreated||e.dateModified;if(t){const e=z(t);if(e)return e}}}return null}function K(e,t="",n=""){const r=new Set;if(!e)return[];if(e.keywords){("string"==typeof e.keywords?e.keywords.split(",").map(e=>e.trim()):e.keywords).forEach(e=>{e&&e.length>=3&&e.length<=30&&r.add(e.toLowerCase())})}if(e["article:tag"]){(Array.isArray(e["article:tag"])?e["article:tag"]:[e["article:tag"]]).forEach(e=>{e&&e.length>=3&&e.length<=30&&r.add(e.toLowerCase())})}if(e.schemaOrg){const t=Array.isArray(e.schemaOrg)?e.schemaOrg:[e.schemaOrg];for(const e of t)if(e.keywords){("string"==typeof e.keywords?e.keywords.split(",").map(e=>e.trim()):Array.isArray(e.keywords)?e.keywords:[]).forEach(e=>{e&&e.length>=3&&e.length<=30&&r.add(e.toLowerCase())})}}if(e["og:video:tag"]){(Array.isArray(e["og:video:tag"])?e["og:video:tag"]:[e["og:video:tag"]]).forEach(e=>{e&&e.length>=3&&e.length<=30&&r.add(e.toLowerCase())})}e["og:type"]&&r.add(e["og:type"].toLowerCase());return function(e){if(!e)return[];const t=new Set,n=["javascript","typescript","python","java","react","vue","angular","node","express","api","rest","graphql","sql","nosql","mongodb","docker","kubernetes","aws","azure","gcp","cloud","serverless","ml","ai","machine learning","deep learning","neural network","frontend","backend","fullstack","devops","ci/cd","testing","security","performance","optimization","design","architecture"],r=e.toLowerCase();for(const e of n)r.includes(e)&&t.add(e);return Array.from(t).slice(0,10)}(t+" "+n).forEach(e=>r.add(e)),Array.from(r).slice(0,20)}function R(e,t={}){if(!e)return 0;let n=0;if(t.title&&t.title.length>10&&(n+=10,t.title.length>30&&t.title.length<100&&(n+=10)),e.description||e["og:description"]){const t=e.description||e["og:description"];t.length>50&&(n+=10,t.length>150&&t.length<500&&(n+=10))}if((e["og:image"]||e.image||e["twitter:image"])&&(n+=10),e.schemaOrg){n+=10;(Array.isArray(e.schemaOrg)?e.schemaOrg:[e.schemaOrg]).some(e=>["Article","BlogPosting","TechArticle","VideoObject","Course"].includes(e["@type"]))&&(n+=5)}(e["article:author"]||e.author||e["og:author"])&&(n+=10),q(e)&&(n+=10);const r=K(e,t.title,t.description);return r.length>0&&(n+=5,r.length>=5&&(n+=5)),e["og:type"]&&(n+=5),Math.min(n,100)}function L(e){if(!e||"string"!=typeof e)return null;const t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!t)return null;const n=parseInt(t[1]||"0",10),r=parseInt(t[2]||"0",10),i=parseInt(t[3]||"0",10);return 60*n+r+Math.ceil(i/60)}function z(e){if(!e)return null;try{const t=new Date(e);if(!isNaN(t.getTime()))return t.getTime()}catch(e){}return null}const F={"github.com":"code","gitlab.com":"code","bitbucket.org":"code","stackoverflow.com":"code","stackexchange.com":"code","youtube.com":"video","vimeo.com":"video","youtu.be":"video","twitter.com":"social","facebook.com":"social","linkedin.com":"social","instagram.com":"social","reddit.com":"social","medium.com":"blog","dev.to":"blog","hashnode.com":"blog","substack.com":"blog","wikipedia.org":"reference","mdn.mozilla.org":"reference","w3schools.com":"reference","amazon.com":"shopping","ebay.com":"shopping","etsy.com":"shopping"},N={"/docs":"documentation","/documentation":"documentation","/api":"api","/reference":"reference","/tutorial":"tutorial","/guide":"tutorial","/blog":"blog","/article":"blog","/video":"video","/watch":"video"},$={tutorial:"tutorial",guide:"tutorial","how to":"tutorial",documentation:"documentation",docs:"documentation",api:"api",reference:"reference",blog:"blog",article:"blog",news:"news",video:"video",course:"education",learning:"education",tool:"tool",app:"tool",software:"tool"};async function U(e,t={}){const{force:n=!1}=t;try{const t=await d(e);if(!t)return console.log(`Bookmark ${e} not found`),{success:!1,error:"Bookmark not found"};if(!t.url.startsWith("http://")&&!t.url.startsWith("https://"))return console.log(`Skipping non-http bookmark: ${t.url}`),{success:!1,error:"Not an HTTP URL",skipped:!0};if(n)console.log(`Force re-enriching bookmark: ${t.title}`);else{const e=(await l()).enrichmentFreshnessDays||30,n=Date.now()-24*e*60*60*1e3;if(t.lastChecked&&t.lastChecked>n)return console.log(`Skipping recently enriched bookmark: ${t.title} (last checked: ${new Date(t.lastChecked).toLocaleDateString()})`),{success:!0,skipped:!0,alreadyEnriched:!0}}console.log(`Enriching bookmark: ${t.title} (${t.url})`);const r=a(t.url),i=await W(t.url);if(!1===i)return t.isAlive=!1,t.lastChecked=Date.now(),r&&(t.platform=r.platform,t.creator=r.creator,t.contentType=r.type,t.platformData=r),await p(t),await y(e,"enrichment",{isAlive:!1}),{success:!0,isAlive:!1,skipped:!0};const o=await Q(t.url),s=G(t,o),c=function(e,t){if(!e)return null;const n=t?.rawMetadata||{},r={...e};if("youtube"===e.platform){if(n.jsonLd&&Array.isArray(n.jsonLd))for(const e of n.jsonLd){if("VideoObject"===e["@type"]&&e.author){const t=Array.isArray(e.author)?e.author[0]:e.author;t.name&&(r.extra=r.extra||{},r.extra.channelName=t.name,r.creator&&r.creator.startsWith("@")&&(r.extra.channelHandle=r.creator),r.creator=t.name),t.url&&(r.extra.channelUrl=t.url)}if("BreadcrumbList"===e["@type"]&&e.itemListElement){const t=e.itemListElement.find(e=>e.item&&e.item["@id"]&&e.item["@id"].includes("/channel/"));t?.item?.name&&(r.extra=r.extra||{},r.extra.channelName||(r.extra.channelName=t.item.name))}}if(!r.creator&&n.openGraph){const e=n.openGraph["og:site_name"];e&&"YouTube"!==e&&(r.creator=e)}}if("github"===e.platform){if(n.meta?.description){const e=n.meta.description.match(/^([^-]+)\s*-/);if(e){const t=e[1].split(",").map(e=>e.trim()).filter(e=>e.length>0&&e.length<30);t.length>0&&(r.extra=r.extra||{},r.extra.topics=t)}}if(n.openGraph?.["og:image"]){const e=n.openGraph["og:image"].match(/language[=:]([^&]+)/i);e&&(r.extra=r.extra||{},r.extra.language=decodeURIComponent(e[1]))}}if("medium"===e.platform||"devto"===e.platform||"substack"===e.platform){if(!r.creator&&n.openGraph?.["og:article:author"]&&(r.creator=n.openGraph["og:article:author"]),!r.creator&&n.other?.author&&(r.creator=n.other.author),!r.creator&&n.jsonLd&&Array.isArray(n.jsonLd))for(const e of n.jsonLd)if(e.author){const t=Array.isArray(e.author)?e.author[0]:e.author;if("string"==typeof t){r.creator=t;break}if(t.name){r.creator=t.name;break}}n.openGraph?.["og:article:published_time"]&&(r.extra=r.extra||{},r.extra.publishedAt=n.openGraph["og:article:published_time"])}if("twitter"===e.platform&&n.twitterCard?.["twitter:creator"]){const e=n.twitterCard["twitter:creator"];r.creator&&"@"!==r.creator||(r.creator=e)}n.openGraph?.["og:image"]&&(r.extra=r.extra||{},r.extra.thumbnail=n.openGraph["og:image"]);n.openGraph?.["og:type"]&&(r.extra=r.extra||{},r.extra.ogType=n.openGraph["og:type"]);return r}(r,o);return t.description=o.description||t.description,t.keywords=o.keywords||t.keywords,t.category=s||t.category,t.isAlive=i,t.lastChecked=Date.now(),t.faviconUrl=o.faviconUrl||t.faviconUrl,t.contentSnippet=o.snippet||t.contentSnippet,t.rawMetadata=o.rawMetadata||t.rawMetadata,c&&(t.platform=c.platform,t.creator=c.creator,t.contentType=c.type,t.platformData=c),await p(t),await y(e,"enrichment",{success:!0,category:s,platform:c?.platform,hasDescription:!!o.description}),{success:!0,category:s,description:o.description,platform:c?.platform,isAlive:i}}catch(t){console.error(`Error enriching bookmark ${e}:`,t);try{const n=await d(e);n&&(n.lastChecked=Date.now(),n.enrichmentError=t.message,await p(n))}catch(e){console.error("Error updating bookmark after failure:",e)}return await y(e,"enrichment",{success:!1,error:t.message}),{success:!1,error:t.message}}}async function W(e){try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),r=await fetch(e,{method:"HEAD",signal:t.signal,redirect:"follow"});return clearTimeout(n),r.ok||r.status>=300&&r.status<400}catch(t){if("AbortError"===t.name)return console.log(`Timeout checking ${e}`),null;try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3);return await fetch(e,{method:"GET",mode:"no-cors",signal:t.signal}),clearTimeout(n),null}catch(t){return console.log(`Error checking ${e}:`,t.message),!1}}}async function Q(e){try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),r=await fetch(e,{signal:t.signal,redirect:"follow"});if(clearTimeout(n),!r.ok)return{};const i=await r.text(),o={meta:{},openGraph:{},twitterCard:{},jsonLd:[],other:{}},a=i.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gim,"").replace(/<style\b[^>]*>[\s\S]*?<\/style>/gim,"").replace(/<nav\b[^>]*>[\s\S]*?<\/nav>/gim,"").replace(/<header\b[^>]*>[\s\S]*?<\/header>/gim,"").replace(/<footer\b[^>]*>[\s\S]*?<\/footer>/gim,"").replace(/<!--[\s\S]*?-->/g,""),s=/<meta\s+([^>]*?)>/gi;let c;for(;null!==(c=s.exec(i));){const e=c[1],t=e.match(/(?:name|property)=["']([^"']+)["']/i),n=e.match(/content=["']([^"']+)["']/i);if(t&&n){const e=t[1],r=n[1];e.startsWith("og:")?o.openGraph[e]=r:e.startsWith("twitter:")?o.twitterCard[e]=r:o.meta[e]=r}}const u=/<script\s+type=["']application\/ld\+json["']>(.*?)<\/script>/gis;let l;for(;null!==(l=u.exec(i));)try{const e=JSON.parse(l[1]);o.jsonLd.push(e)}catch(e){}const h=i.match(/<title[^>]*>([^<]+)<\/title>/i);h&&(o.other.title=h[1].trim());const f=i.match(/<link\s+rel=["']canonical["']\s+href=["']([^"']+)["']/i)||i.match(/<link\s+href=["']([^"']+)["']\s+rel=["']canonical["']/i);f&&(o.other.canonical=f[1]);const d=i.match(/<html[^>]*\slang=["']([^"']+)["']/i);d&&(o.other.language=d[1]),o.meta.author&&(o.other.author=o.meta.author);const p={description:null,keywords:[],faviconUrl:null,snippet:null,rawMetadata:o};p.description=o.openGraph["og:description"]||o.meta.description||o.twitterCard["twitter:description"]||null,o.meta.keywords&&(p.keywords=o.meta.keywords.split(",").map(e=>e.trim()).filter(e=>e.length>0).slice(0,10));const m=i.match(/<link\s+([^>]*rel=["'](?:icon|shortcut icon)["'][^>]*)>/i);if(m){const t=m[1].match(/href=["']([^"']+)["']/i);if(t)try{p.faviconUrl=new URL(t[1],e).href}catch(e){}}const g=/<p[^>]*>([^<]+)<\/p>/gi;let y;const v=[];for(;null!==(y=g.exec(a));){const e=y[1].replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/\s+/g," ").trim();if(e.length>50&&!e.toLowerCase().includes("cookie")&&!e.toLowerCase().includes("copyright")&&v.push(e),v.length>=3)break}return v.length>0&&(p.snippet=v.join(" ... ").substring(0,300)),p}catch(t){return"AbortError"===t.name?console.log(`Timeout fetching metadata for ${e}`):console.error(`Error fetching metadata for ${e}:`,t),{}}}function G(e,t={}){try{const n=new URL(e.url),r=n.hostname.toLowerCase(),i=n.pathname.toLowerCase(),o=e.title.toLowerCase(),a=(t.description||"").toLowerCase();for(const[e,t]of Object.entries(F))if(r.includes(e))return t;for(const[e,t]of Object.entries(N))if(i.includes(e))return t;const s=`${o} ${a}`;for(const[e,t]of Object.entries($))if(s.includes(e))return t;if(t.keywords&&t.keywords.length>0){const e=t.keywords.join(" ").toLowerCase();for(const[t,n]of Object.entries($))if(e.includes(t))return n}return null}catch(e){return console.error("Error categorizing bookmark:",e),null}}async function V(e=10,t=null,n=3,r={}){const{force:i=!1}=r;try{const r=await l();if(!r.enrichmentEnabled)return console.log("Enrichment is disabled"),{processed:0,success:0,failed:0,skipped:0};const o=n||r.enrichmentConcurrency||3;console.log(`Using concurrency: ${o} parallel requests${i?" (FORCE mode)":""}`);let a=[],s=!0;if(i){const{getAllBookmarks:t}=await Promise.resolve().then(function(){return T}),n=(await t()).filter(e=>e.url&&(e.url.startsWith("http://")||e.url.startsWith("https://"))),r=n.filter(e=>!e.lastChecked),i=n.filter(e=>e.lastChecked).sort((e,t)=>e.lastChecked-t.lastChecked),o=[...r,...i].slice(0,e);a=o.map(e=>({bookmarkId:e.id,queueId:null,directProcess:!0})),s=!1,console.log(`FORCE mode: Selected ${a.length} bookmarks directly (${r.length} unenriched, ${Math.max(0,a.length-r.length)} for re-enrichment)`)}else{const t=await k(e);if(0===t.length){const{getAllBookmarks:t}=await Promise.resolve().then(function(){return T}),n=(await t()).filter(e=>e.url&&(e.url.startsWith("http://")||e.url.startsWith("https://"))&&!e.lastChecked).slice(0,e);if(0===n.length)return console.log("No bookmarks in enrichment queue and no unenriched bookmarks found"),{processed:0,success:0,failed:0,skipped:0};a=n.map(e=>({bookmarkId:e.id,queueId:null,directProcess:!0})),s=!1,console.log(`Queue empty, found ${a.length} unenriched bookmarks to process`)}else a=t.map(e=>({bookmarkId:e.bookmarkId,queueId:e.id,directProcess:!1}))}if(0===a.length)return console.log("No bookmarks to process"),{processed:0,success:0,failed:0,skipped:0};console.log(`Processing ${a.length} bookmarks with ${o} concurrent workers`);let c=0,u=0,h=0,f=0;const d=async(e,n)=>{try{const r=await Promise.resolve().then(function(){return T}).then(t=>t.getBookmark(e.bookmarkId));t&&r&&t({current:n+1,total:a.length,completed:f,bookmarkId:e.bookmarkId,url:r.url,title:r.title,status:"processing"});const o=await U(e.bookmarkId,{force:i});return o.success?o.alreadyEnriched||o.skipped?h++:c++:o.skipped?h++:u++,f++,t&&r&&t({current:n+1,total:a.length,completed:f,bookmarkId:e.bookmarkId,url:r.url,title:r.title,status:o.success?"completed":"failed",result:o}),e.queueId&&s&&await x(e.queueId),{success:!0,result:o}}catch(r){return console.error(`Error processing bookmark ${e.bookmarkId}:`,r),u++,f++,e.queueId&&s&&await x(e.queueId),t&&t({current:n+1,total:a.length,completed:f,bookmarkId:e.bookmarkId,status:"error",error:r.message}),{success:!1,error:r.message}}},p=[];let m=0;const g=async()=>{for(;m<a.length;){const e=m++,t=a[e];await d(t,e),m<a.length&&await H(50)}};for(let e=0;e<Math.min(o,a.length);e++)p.push(g());return await Promise.all(p),console.log(`Processed ${a.length} bookmarks: ${c} success, ${u} failed, ${h} skipped`),{processed:a.length,success:c,failed:u,skipped:h}}catch(e){return console.error("Error processing enrichment batch:",e),{processed:0,success:0,failed:0,skipped:0,error:e.message}}}function H(e){return new Promise(t=>setTimeout(t,e))}async function Y(e){if(!e)return{success:!1,error:"No bookmark provided"};try{const t=function(e){if(!e)return null;const t=e.rawMetadata||{};return{readingTime:M(t,e.contentSnippet),publishedDate:q(t),contentQualityScore:R(t,e),smartTags:K(t,e.title,e.description)}}(e);if(!t)return{success:!1,error:"No metadata to analyze",skipped:!0};if(e.readingTime=t.readingTime,e.publishedDate=t.publishedDate,e.contentQualityScore=t.contentQualityScore,e.smartTags=t.smartTags,e.rawMetadata&&e.platformData){const t=function(e,t){if(!t||!t.schemaOrg||!e)return e;const n=Array.isArray(t.schemaOrg)?t.schemaOrg:[t.schemaOrg];for(const t of n){switch(t["@type"]){case"TechArticle":e.type="tech-article",e.subtype="technical";break;case"BlogPosting":e.type="blog-post",e.subtype="blog";break;case"NewsArticle":e.type="news-article",e.subtype="news";break;case"ScholarlyArticle":e.type="scholarly-article",e.subtype="academic";break;case"VideoObject":"video"!==e.type&&(e.type="video"),e.subtype="video-content";break;case"Course":e.type="course",e.subtype="education";break;case"HowTo":e.type="tutorial",e.subtype="how-to";break;case"FAQPage":e.type="faq",e.subtype="reference";break;case"SoftwareApplication":e.type="software",e.subtype="tool";break;case"APIReference":e.type="api-docs",e.subtype="documentation"}t.author&&!e.creator&&("object"==typeof t.author?e.creator=t.author.name||t.author["@id"]:e.creator=t.author)}return e}(e.platformData,e.rawMetadata);t&&(e.platformData=t,e.contentType=t.type)}return await p(e),console.log(`Re-analyzed bookmark: ${e.title} - Quality: ${t.contentQualityScore}, Reading time: ${t.readingTime||"N/A"} min`),{success:!0,readingTime:t.readingTime,publishedDate:t.publishedDate,contentQualityScore:t.contentQualityScore,smartTagsCount:t.smartTags?.length||0}}catch(t){return console.error(`Error re-analyzing bookmark ${e.id}:`,t),{success:!1,error:t.message}}}var J,X=Object.freeze({__proto__:null,CATEGORY_RULES:F,CONTENT_KEYWORDS:$,PATH_PATTERNS:N,batchReanalyze:async function(e,t=null){if(!e||0===e.length)return{processed:0,success:0,failed:0,skipped:0};console.log(`Starting batch re-analysis of ${e.length} bookmarks...`);let n=0,r=0,i=0,o=0;for(let a=0;a<e.length;a+=50){const s=e.slice(a,a+50);for(let c=0;c<s.length;c++){const u=s[c],l=a+c;try{if(!u.rawMetadata||0===Object.keys(u.rawMetadata).length){i++,o++,t&&t({current:l+1,total:e.length,completed:o,bookmarkId:u.id,title:u.title,status:"skipped",reason:"No metadata to analyze"});continue}const a=await Y(u);a.success?n++:a.skipped?i++:r++,o++,t&&t({current:l+1,total:e.length,completed:o,bookmarkId:u.id,title:u.title,status:a.success?"completed":a.skipped?"skipped":"failed",result:a})}catch(n){console.error(`Error re-analyzing bookmark ${u.id}:`,n),r++,o++,t&&t({current:l+1,total:e.length,completed:o,bookmarkId:u.id,title:u.title,status:"error",error:n.message})}}a+50<e.length&&await H(100)}return console.log(`Re-analysis complete: ${n} analyzed, ${r} failed, ${i} skipped`),{processed:e.length,success:n,failed:r,skipped:i}},categorizeBookmark:G,checkBookmarkAlive:W,enrichBookmark:U,fetchPageMetadata:Q,processEnrichmentBatch:V,reanalyzeBookmark:Y});
/**!
 * FlexSearch.js v0.8.212 (Bundle/Module)
 * Author and Copyright: Thomas Wilkerling
 * Licence: Apache-2.0
 * Hosted by Nextapps GmbH
 * https://github.com/nextapps-de/flexsearch
 */function Z(e,t,n){const r=typeof n,i=typeof e;if("undefined"!==r){if("undefined"!==i){if(n){if("function"===i&&r===i)return function(t){return e(n(t))};if((t=e.constructor)===n.constructor){if(t===Array)return n.concat(e);if(t===Map){var o=new Map(n);for(var a of e)o.set(a[0],a[1]);return o}if(t===Set){for(o of(a=new Set(n),e.values()))a.add(o);return a}}}return e}return n}return"undefined"===i?t:e}function ee(e,t){return void 0===e?t:e}function te(){return Object.create(null)}function ne(e){return"string"==typeof e}function re(e){return"object"==typeof e}function ie(e,t){if(ne(t))e=e[t];else for(let n=0;e&&n<t.length;n++)e=e[t[n]];return e}const oe=/[^\p{L}\p{N}]+/u,ae=/(\d{3})/g,se=/(\D)(\d{3})/g,ce=/(\d{3})(\D)/g,ue=/[\u0300-\u036f]/g;function le(e={}){if(!this||this.constructor!==le)return new le(...arguments);if(arguments.length)for(e=0;e<arguments.length;e++)this.assign(arguments[e]);else this.assign(e)}function he(e){e.F=null,e.B.clear(),e.D.clear()}function fe(e,t,n){n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):n=e),n&&(e=n.query||e,t=n.limit||t);let r=""+(t||0);n&&(r+=(n.offset||0)+!!n.context+!!n.suggest+(!1!==n.resolve)+(n.resolution||this.resolution)+(n.boost||0)),e=(""+e).toLowerCase(),this.cache||(this.cache=new de);let i=this.cache.get(e+r);if(!i){const o=n&&n.cache;o&&(n.cache=!1),i=this.search(e,t,n),o&&(n.cache=o),this.cache.set(e+r,i)}return i}function de(e){this.limit=e&&!0!==e?e:1e3,this.cache=new Map,this.h=""}(J=le.prototype).assign=function(e){this.normalize=Z(e.normalize,!0,this.normalize);let t,n=e.include,r=n||e.exclude||e.split;if(r||""===r){if("object"==typeof r&&r.constructor!==RegExp){let e="";t=!n,n||(e+="\\p{Z}"),r.letter&&(e+="\\p{L}"),r.number&&(e+="\\p{N}",t=!!n),r.symbol&&(e+="\\p{S}"),r.punctuation&&(e+="\\p{P}"),r.control&&(e+="\\p{C}"),(r=r.char)&&(e+="object"==typeof r?r.join(""):r);try{this.split=new RegExp("["+(n?"^":"")+e+"]+","u")}catch(e){this.split=/\s+/}}else this.split=r,t=!1===r||"a1a".split(r).length<2;this.numeric=Z(e.numeric,t)}else{try{this.split=Z(this.split,oe)}catch(e){this.split=/\s+/}this.numeric=Z(e.numeric,Z(this.numeric,!0))}if(this.prepare=Z(e.prepare,null,this.prepare),this.finalize=Z(e.finalize,null,this.finalize),r=e.filter,this.filter="function"==typeof r?r:Z(r&&new Set(r),null,this.filter),this.dedupe=Z(e.dedupe,!0,this.dedupe),this.matcher=Z((r=e.matcher)&&new Map(r),null,this.matcher),this.mapper=Z((r=e.mapper)&&new Map(r),null,this.mapper),this.stemmer=Z((r=e.stemmer)&&new Map(r),null,this.stemmer),this.replacer=Z(e.replacer,null,this.replacer),this.minlength=Z(e.minlength,1,this.minlength),this.maxlength=Z(e.maxlength,1024,this.maxlength),this.rtl=Z(e.rtl,!1,this.rtl),(this.cache=r=Z(e.cache,!0,this.cache))&&(this.F=null,this.L="number"==typeof r?r:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const e of this.matcher.keys())this.h+=(this.h?"|":"")+e;if(this.stemmer)for(const e of this.stemmer.keys())this.A+=(this.A?"|":"")+e;return this},J.addStemmer=function(e,t){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(e,t),this.A+=(this.A?"|":"")+e,this.K=null,this.cache&&he(this),this},J.addFilter=function(e){return"function"==typeof e?this.filter=e:(this.filter||(this.filter=new Set),this.filter.add(e)),this.cache&&he(this),this},J.addMapper=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length>1?this.addMatcher(e,t):(this.mapper||(this.mapper=new Map),this.mapper.set(e,t),this.cache&&he(this),this)},J.addMatcher=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length<2&&(this.dedupe||this.mapper)?this.addMapper(e,t):(this.matcher||(this.matcher=new Map),this.matcher.set(e,t),this.h+=(this.h?"|":"")+e,this.J=null,this.cache&&he(this),this)},J.addReplacer=function(e,t){return"string"==typeof e?this.addMatcher(e,t):(this.replacer||(this.replacer=[]),this.replacer.push(e,t),this.cache&&he(this),this)},J.encode=function(e,t){if(this.cache&&e.length<=this.H)if(this.F){if(this.B.has(e))return this.B.get(e)}else this.F=setTimeout(he,50,this);this.normalize&&(e="function"==typeof this.normalize?this.normalize(e):ue?e.normalize("NFKD").replace(ue,"").toLowerCase():e.toLowerCase()),this.prepare&&(e=this.prepare(e)),this.numeric&&e.length>3&&(e=e.replace(se,"$1 $2").replace(ce,"$1 $2").replace(ae,"$1 "));const n=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let r,i,o=[],a=te(),s=this.split||""===this.split?e.split(this.split):[e];for(let e,u,l=0;l<s.length;l++)if((e=u=s[l])&&!(e.length<this.minlength||e.length>this.maxlength)){if(t){if(a[e])continue;a[e]=1}else{if(r===e)continue;r=e}if(n)o.push(e);else if(!this.filter||("function"==typeof this.filter?this.filter(e):!this.filter.has(e))){if(this.cache&&e.length<=this.I)if(this.F){var c=this.D.get(e);if(c||""===c){c&&o.push(c);continue}}else this.F=setTimeout(he,50,this);if(this.stemmer){let t;for(this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));t!==e&&e.length>2;)t=e,e=e.replace(this.K,e=>this.stemmer.get(e))}if(e&&(this.mapper||this.dedupe&&e.length>1)){c="";for(let t,n,r=0,i="";r<e.length;r++)t=e.charAt(r),t===i&&this.dedupe||((n=this.mapper&&this.mapper.get(t))||""===n?n===i&&this.dedupe||!(i=n)||(c+=n):c+=i=t);e=c}if(this.matcher&&e.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),e=e.replace(this.J,e=>this.matcher.get(e))),e&&this.replacer)for(c=0;e&&c<this.replacer.length;c+=2)e=e.replace(this.replacer[c],this.replacer[c+1]);if(this.cache&&u.length<=this.I&&(this.D.set(u,e),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),e){if(e!==u)if(t){if(a[e])continue;a[e]=1}else{if(i===e)continue;i=e}o.push(e)}}}return this.finalize&&(o=this.finalize(o)||o),this.cache&&e.length<=this.H&&(this.B.set(e,o),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),o},de.prototype.set=function(e,t){this.cache.set(this.h=e,t),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)},de.prototype.get=function(e){const t=this.cache.get(e);return t&&this.h!==e&&(this.cache.delete(e),this.cache.set(this.h=e,t)),t},de.prototype.remove=function(e){for(const t of this.cache){const n=t[0];t[1].includes(e)&&this.cache.delete(n)}},de.prototype.clear=function(){this.cache.clear(),this.h=""};const pe={normalize:!1,numeric:!1,dedupe:!1},me={},ge=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),ye=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),ve=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],be={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,"":2,d:3,t:3,l:4,m:5,n:5,r:6};var we={Exact:pe,Default:me,Normalize:me,LatinBalance:{mapper:ge},LatinAdvanced:{mapper:ge,matcher:ye,replacer:ve},LatinExtra:{mapper:ge,replacer:ve.concat([/(?!^)[aeo]/g,""]),matcher:ye},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(e){for(let n=0;n<e.length;n++){var t=e[n];let r=t.charAt(0),i=be[r];for(let e,n=1;n<t.length&&(e=t.charAt(n),"h"===e||"w"===e||!(e=be[e])||e===i||(r+=e,i=e,4!==r.length));n++);e[n]=r}}},CJK:{split:""},LatinExact:pe,LatinDefault:me,LatinSimple:me};function ke(e,t,n,r){let i=[];for(let o,a=0;a<e.index.length;a++)if(o=e.index[a],t>=o.length)t-=o.length;else{const a=(t=o[r?"splice":"slice"](t,n)).length;if(a&&(i=i.length?i.concat(t):t,n-=a,r&&(e.length-=a),!n))break;t=0}return i}function xe(e){if(!this||this.constructor!==xe)return new xe(e);this.index=e?[e]:[],this.length=e?e.length:0;const t=this;return new Proxy([],{get:(e,n)=>"length"===n?t.length:"push"===n?function(e){t.index[t.index.length-1].push(e),t.length++}:"pop"===n?function(){if(t.length)return t.length--,t.index[t.index.length-1].pop()}:"indexOf"===n?function(e){let n=0;for(let r,i,o=0;o<t.index.length;o++){if(r=t.index[o],i=r.indexOf(e),i>=0)return n+i;n+=r.length}return-1}:"includes"===n?function(e){for(let n=0;n<t.index.length;n++)if(t.index[n].includes(e))return!0;return!1}:"slice"===n?function(e,n){return ke(t,e||0,n||t.length,!1)}:"splice"===n?function(e,n){return ke(t,e||0,n||t.length,!0)}:"constructor"===n?Array:"symbol"!=typeof n?(e=t.index[n/2**31|0])&&e[n]:void 0,set:(e,n,r)=>(e=n/2**31|0,(t.index[e]||(t.index[e]=[]))[n]=r,t.length++,!0)})}function _e(e=8){if(!this||this.constructor!==_e)return new _e(e);this.index=te(),this.h=[],this.size=0,e>32?(this.B=Se,this.A=BigInt(e)):(this.B=Ee,this.A=e)}function Ae(e=8){if(!this||this.constructor!==Ae)return new Ae(e);this.index=te(),this.h=[],this.size=0,e>32?(this.B=Se,this.A=BigInt(e)):(this.B=Ee,this.A=e)}function Ee(e){let t=2**this.A-1;if("number"==typeof e)return e&t;let n=0,r=this.A+1;for(let i=0;i<e.length;i++)n=(n*r^e.charCodeAt(i))&t;return 32===this.A?n+2**31:n}function Se(e){let t=BigInt(2)**this.A-BigInt(1);var n=typeof e;if("bigint"===n)return e&t;if("number"===n)return BigInt(e)&t;n=BigInt(0);let r=this.A+BigInt(1);for(let i=0;i<e.length;i++)n=(n*r^BigInt(e.charCodeAt(i)))&t;return n}let Ce,Pe,Oe,Be,De;async function Ie(e){var t=(e=e.data).task;const n=e.id;let r=e.args;if("init"===t)Pe=e.options||{},(t=e.factory)?(Function("return "+t)()(self),Ce=new self.FlexSearch.Index(Pe),delete self.FlexSearch):Ce=new xt(Pe),postMessage({id:n});else{let i;"export"===t&&(r[1]?(r[0]=Pe.export,r[2]=0,r[3]=1):r=null),"import"===t?r[0]&&(e=await Pe.import.call(Ce,r[0]),Ce.import(r[0],e)):((i=r&&Ce[t].apply(Ce,r))&&i.then&&(i=await i),i&&i.await&&(i=await i.await),"search"===t&&i.result&&(i=i.result)),postMessage("search"===t?{id:n,msg:i}:{id:n})}}function je(e){Me.call(e,"add"),Me.call(e,"append"),Me.call(e,"search"),Me.call(e,"update"),Me.call(e,"remove"),Me.call(e,"searchCache")}function Te(){Oe=De=0}function Me(e){this[e+"Async"]=function(){const t=arguments;var n=t[t.length-1];let r;if("function"==typeof n&&(r=n,delete t[t.length-1]),Oe?De||(De=Date.now()-Be>=this.priority*this.priority*3):(Oe=setTimeout(Te,0),Be=Date.now()),De){const n=this;return new Promise(r=>{setTimeout(function(){r(n[e+"Async"].apply(n,t))},0)})}const i=this[e].apply(this,t);return n=i.then?i:new Promise(e=>e(i)),r&&n.then(r),n}}xe.prototype.clear=function(){this.index.length=0},xe.prototype.push=function(){},_e.prototype.get=function(e){const t=this.index[this.B(e)];return t&&t.get(e)},_e.prototype.set=function(e,t){var n=this.B(e);let r=this.index[n];r?(n=r.size,r.set(e,t),(n-=r.size)&&this.size++):(this.index[n]=r=new Map([[e,t]]),this.h.push(r),this.size++)},Ae.prototype.add=function(e){var t=this.B(e);let n=this.index[t];n?(t=n.size,n.add(e),(t-=n.size)&&this.size++):(this.index[t]=n=new Set([e]),this.h.push(n),this.size++)},(J=_e.prototype).has=Ae.prototype.has=function(e){const t=this.index[this.B(e)];return t&&t.has(e)},J.delete=Ae.prototype.delete=function(e){const t=this.index[this.B(e)];t&&t.delete(e)&&this.size--},J.clear=Ae.prototype.clear=function(){this.index=te(),this.h=[],this.size=0},J.values=Ae.prototype.values=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].values())yield t},J.keys=Ae.prototype.keys=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].keys())yield t},J.entries=Ae.prototype.entries=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].entries())yield t};let qe=0;function Ke(e={},t){function n(n){function a(e){const t=(e=e.data||e).id,n=t&&o.h[t];n&&(n(e.msg),delete o.h[t])}if(this.worker=n,this.h=te(),this.worker)return i?this.worker.on("message",a):this.worker.onmessage=a,e.config?new Promise(function(t){qe>1e9&&(qe=0),o.h[++qe]=function(){t(o)},o.worker.postMessage({id:qe,task:"init",factory:r,options:e})}):(this.priority=e.priority||4,this.encoder=t||null,this.worker.postMessage({task:"init",factory:r,options:e}),this)}if(!this||this.constructor!==Ke)return new Ke(e);let r="undefined"!=typeof self?self._factory:"undefined"!=typeof window?window._factory:null;r&&(r=r.toString());const i="undefined"==typeof window,o=this,a=function(e,t,n){return t?"undefined"!=typeof module?new(require("worker_threads").Worker)(__dirname+"/worker/node.js"):Promise.resolve().then(function(){return Ht}).then(function(e){return new e.Worker(import.meta.dirname+"/node/node.mjs")}):e?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+Ie.toString()],{type:"text/javascript"}))):new window.Worker("string"==typeof n?n:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}(r,i,e.worker);return a.then?a.then(function(e){return n.call(o,e)}):n.call(this,a)}function Re(e){Ke.prototype[e]=function(){const t=this,n=[].slice.call(arguments);var r=n[n.length-1];let i;return"function"==typeof r&&(i=r,n.pop()),r=new Promise(function(r){"export"===e&&"function"==typeof n[0]&&(n[0]=null),qe>1e9&&(qe=0),t.h[++qe]=r,t.worker.postMessage({task:e,id:qe,args:n})}),i?(r.then(i),this):r}}function Le(e,t,n,r,i,o){if(e=e[i],r===n.length-1)t[i]=o||e;else if(e)if(e.constructor===Array)for(t=t[i]=Array(e.length),i=0;i<e.length;i++)Le(e,t,n,r,i);else t=t[i]||(t[i]=te()),i=n[++r],Le(e,t,n,r,i)}function ze(e,t,n,r,i,o,a,s){if(e=e[a])if(r===t.length-1){if(e.constructor===Array){if(n[r]){for(t=0;t<e.length;t++)i.add(o,e[t],!0,!0);return}e=e.join(" ")}i.add(o,e,s,!0)}else if(e.constructor===Array)for(a=0;a<e.length;a++)ze(e,t,n,r,i,o,a,s);else a=t[++r],ze(e,t,n,r,i,o,a,s)}function Fe(e,t,n,r){if(!e.length)return e;if(1===e.length)return e=e[0],e=n||e.length>t?e.slice(n,n+t):e,r?nt.call(this,e):e;let i=[];for(let o,a,s=0;s<e.length;s++)if((o=e[s])&&(a=o.length)){if(n){if(n>=a){n-=a;continue}o=o.slice(n,n+t),a=o.length,n=0}if(a>t&&(o=o.slice(0,t),a=t),!i.length&&a>=t)return r?nt.call(this,o):o;if(i.push(o),!(t-=a))break}return i=i.length>1?[].concat.apply([],i):i[0],r?nt.call(this,i):i}function Ne(e,t,n,r){var i=r[0];if(i[0]&&i[0].query)return e[t].apply(e,i);if(!("and"!==t&&"not"!==t||e.result.length||e.await||i.suggest))return r.length>1&&(i=r[r.length-1]),(r=i.resolve)?e.await||e.result:e;let o,a,s,c,u,l=[],h=0,f=0;for(t=0;t<r.length;t++)if(i=r[t]){var d=void 0;if(i.constructor===He)d=i.await||i.result;else if(i.then||i.constructor===Array)d=i;else{h=i.limit||0,f=i.offset||0,s=i.suggest,a=i.resolve,o=((c=i.highlight||e.highlight)||i.enrich)&&a,d=i.queue;let n=i.async||d,r=i.index,p=i.query;if(r?e.index||(e.index=r):r=e.index,p||i.tag){const o=i.field||i.pluck;if(o&&(!p||e.query&&!c||(e.query=p,e.field=o,e.highlight=c),r=r.index.get(o)),d&&(u||e.await)){let o;u=1;const a=e.C.length,s=new Promise(function(e){o=e});(function(t,r){s.h=function(){r.index=null,r.resolve=!1;let i=n?t.searchAsync(r):t.search(r);return i.then?i.then(function(t){return e.C[a]=t=t.result||t,o(t),t}):(i=i.result||i,o(i),i)}})(r,Object.assign({},i)),e.C.push(s),l[t]=s;continue}i.resolve=!1,i.index=null,d=n?r.searchAsync(i):r.search(i),i.resolve=a,i.index=r}else if(i.and)d=$e(i,"and",r);else if(i.or)d=$e(i,"or",r);else if(i.not)d=$e(i,"not",r);else{if(!i.xor)continue;d=$e(i,"xor",r)}}d.await?(u=1,d=d.await):d.then?(u=1,d=d.then(function(e){return e.result||e})):d=d.result||d,l[t]=d}if(u&&!e.await&&(e.await=new Promise(function(t){e.return=t})),u){const t=Promise.all(l).then(function(r){for(let i=0;i<e.C.length;i++)if(e.C[i]===t){e.C[i]=function(){return n.call(e,r,h,f,o,a,s,c)};break}Ye(e)});e.C.push(t)}else{if(!e.await)return n.call(e,l,h,f,o,a,s,c);e.C.push(function(){return n.call(e,l,h,f,o,a,s,c)})}return a?e.await||e.result:e}function $e(e,t,n){const r=(e=e[t])[0]||e;return r.index||(r.index=n),n=new He(r),e.length>1&&(n=n[t].apply(n,e.slice(1))),n}function Ue(e,t,n,r,i,o,a){return e.length&&(this.result.length&&e.push(this.result),e.length<2?this.result=e[0]:(this.result=Xe(e,t,n,!1,this.h),n=0)),i&&(this.await=null),i?this.resolve(t,n,r,a):this}function We(e,t,n,r,i,o,a){if(!o&&!this.result.length)return i?this.result:this;let s;if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{let r=0;for(let t,n,i=0;i<e.length;i++)if((t=e[i])&&(n=t.length))r<n&&(r=n);else if(!o){r=0;break}r?(this.result=Je(e,r,t,n,o,this.h,i),s=!0):this.result=[]}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,a,s):this}function Qe(e,t,n,r,i,o,a){if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{e:{o=n;var s=this.h;const r=[],a=te();let c=0;for(let t,n=0;n<e.length;n++)if(t=e[n]){c<t.length&&(c=t.length);for(let e,n=0;n<t.length;n++)if(e=t[n])for(let t,n=0;n<e.length;n++)t=e[n],a[t]=a[t]?2:1}for(let n,u=0,l=0;u<c;u++)for(let c,h=0;h<e.length;h++)if((c=e[h])&&(n=c[u]))for(let c,f=0;f<n.length;f++)if(c=n[f],1===a[c])if(o)o--;else if(i){if(r.push(c),r.length===t){e=r;break e}}else{const n=u+(h?s:0);if(r[n]||(r[n]=[]),r[n].push(c),++l===t){e=r;break e}}e=r}this.result=e,s=!0}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,a,s):this}function Ge(e,t,n,r,i,o,a){if(!o&&!this.result.length)return i?this.result:this;if(e.length&&this.result.length){e:{o=n;var s=[];e=new Set(e.flat().flat());for(let n,r=0,a=0;r<this.result.length;r++)if(n=this.result[r])for(let c,u=0;u<n.length;u++)if(c=n[u],!e.has(c))if(o)o--;else if(i){if(s.push(c),s.length===t){e=s;break e}}else if(s[r]||(s[r]=[]),s[r].push(c),++a===t){e=s;break e}e=s}this.result=e,s=!0}return i&&(this.await=null),i?this.resolve(t,n,r,a,s):this}function Ve(e,t,n,r,i){let o,a,s;"string"==typeof i?(o=i,i=""):o=i.template,a=o.indexOf("$1"),s=o.substring(a+2),a=o.substring(0,a);let c=i&&i.boundary,u=!i||!1!==i.clip,l=i&&i.merge&&s&&a&&new RegExp(s+" "+a,"g");var h=0;if("object"==typeof(i=i&&i.ellipsis)){var f=i.template;h=f.length-2,i=i.pattern}let d,p;"string"!=typeof i&&(i=!1===i?"":"..."),h&&(i=f.replace("$1",i)),f=i.length-h,"object"==typeof c&&(d=c.before,0===d&&(d=-1),p=c.after,0===p&&(p=-1),c=c.total||9e5),h=new Map;for(let j,T,M,q=0;q<t.length;q++){let K;if(r)K=t,M=r;else{var m=t[q];if(M=m.field,!M)continue;K=m.result}T=n.get(M),j=T.encoder,"string"!=typeof(m=h.get(j))&&(m=j.encode(e),h.set(j,m));for(let e=0;e<K.length;e++){var g=K[e].doc;if(!g)continue;if(!(g=ie(g,M)))continue;var y=g.trim().split(/\s+/);if(!y.length)continue;g="";var v=[];let t=[];for(var b=-1,w=-1,k=0,x=0;x<y.length;x++){var _=y[x],A=j.encode(_);let e;if((A=A.length>1?A.join(" "):A[0])&&_){for(var E=_.length,S=(j.split?_.replace(j.split,""):_).length-A.length,C="",P=0,O=0;O<m.length;O++){var B=m[O];if(B){var D=B.length;D+=S<0?0:S,P&&D<=P||(B=A.indexOf(B))>-1&&(C=(B?_.substring(0,B):"")+a+_.substring(B,B+D)+s+(B+D<E?_.substring(B+D):""),P=D,e=!0)}}C&&(c&&(b<0&&(b=g.length+(g?1:0)),w=g.length+(g?1:0)+C.length,k+=E,t.push(v.length),v.push({match:C})),g+=(g?" ":"")+C)}if(e){if(c&&k>=c)break}else g+=(g?" ":"")+(_=y[x]),c&&v.push({text:_})}if(k=t.length*(o.length-2),d||p||c&&g.length-k>c)if(x=w-b,d>0&&(x+=d),p>0&&(x+=p),x<=(k=c+k-2*f))y=d?b-(d>0?d:0):b-((k-x)/2|0),v=p?w+(p>0?p:0):y+k,u||(y>0&&" "!==g.charAt(y)&&" "!==g.charAt(y-1)&&((y=g.indexOf(" ",y))<0&&(y=0)),v<g.length&&" "!==g.charAt(v-1)&&" "!==g.charAt(v)&&((v=g.lastIndexOf(" ",v))<w?v=w:++v)),g=(y?i:"")+g.substring(y,v)+(v<g.length?i:"");else{for(w=[],b={},k={},x={},_={},A={},C=S=E=0,O=P=1;;){var I=void 0;for(let e,n=0;n<t.length;n++){if(e=t[n],C)if(S!==C){if(x[n+1])continue;if(e+=C,b[e]){E-=f,k[n+1]=1,x[n+1]=1;continue}if(e>=v.length-1){if(e>=v.length){x[n+1]=1,e>=y.length&&(k[n+1]=1);continue}E-=f}if(g=v[e].text,D=p&&A[n]){if(!(D>0)){x[n+1]=1;continue}if(g.length>D){if(x[n+1]=1,!u)continue;g=g.substring(0,D)}(D-=g.length)||(D=-1),A[n]=D}if(E+g.length+1<=c)g=" "+g,w[n]+=g;else{if(!u){x[n+1]=1;continue}(I=c-E-1)>0&&(g=" "+g.substring(0,I),w[n]+=g),x[n+1]=1}}else{if(x[n])continue;if(e-=S,b[e]){E-=f,x[n]=1,k[n]=1;continue}if(e<=0){if(e<0){x[n]=1,k[n]=1;continue}E-=f}if(g=v[e].text,D=d&&_[n]){if(!(D>0)){x[n]=1;continue}if(g.length>D){if(x[n]=1,!u)continue;g=g.substring(g.length-D)}(D-=g.length)||(D=-1),_[n]=D}if(E+g.length+1<=c)g+=" ",w[n]=g+w[n];else{if(!u){x[n]=1;continue}(I=g.length+1-(c-E))>=0&&I<g.length&&(g=g.substring(I)+" ",w[n]=g+w[n]),x[n]=1}}else{let t;if(g=v[e].match,d&&(_[n]=d),p&&(A[n]=p),n&&E++,e?!n&&f&&(E+=f):(k[n]=1,x[n]=1),e>=y.length-1||e<v.length-1&&v[e+1].match?t=1:f&&(E+=f),E-=o.length-2,n&&!(E+g.length<=c)){I=P=O=k[n]=0;break}w[n]=g,t&&(k[n+1]=1,x[n+1]=1)}E+=g.length,I=b[e]=1}if(I)S===C?C++:S++;else{if(S===C?P=0:O=0,!P&&!O)break;P?C=++S:C++}}g="";for(let e,t=0;t<w.length;t++)e=(k[t]?t?" ":"":(t&&!i?" ":"")+i)+w[t],g+=e;i&&!k[w.length]&&(g+=i)}l&&(g=g.replace(l," ")),K[e].highlight=g}if(r)break}return t}function He(e,t){if(!this||this.constructor!==He)return new He(e,t);let n,r,i,o,a,s,c=0;if(e&&e.index){const n=e;if(t=n.index,c=n.boost||0,r=n.query){i=n.field||n.pluck,o=n.highlight;const r=n.resolve;e=n.async||n.queue,n.resolve=!1,n.index=null,e=e?t.searchAsync(n):t.search(n),n.resolve=r,n.index=t,e=e.result||e}else e=[]}if(e&&e.then){const t=this;n=[e=e.then(function(e){t.C[0]=t.result=e.result||e,Ye(t)})],e=[],a=new Promise(function(e){s=e})}this.index=t||null,this.result=e||[],this.h=c,this.C=n||[],this.await=a||null,this.return=s||null,this.highlight=o||null,this.query=r||"",this.field=i||""}function Ye(e,t){let n=e.result;var r=e.await;e.await=null;for(let t,i=0;i<e.C.length;i++)if(t=e.C[i])if("function"==typeof t)n=t(),e.C[i]=n=n.result||n,i--;else if(t.h)n=t.h(),e.C[i]=n=n.result||n,i--;else if(t.then)return e.await=r;return r=e.return,e.C=[],e.return=null,t||r(n),n}function Je(e,t,n,r,i,o,a){const s=e.length;let c,u,l=[];c=te();for(let h,f,d,p,m=0;m<t;m++)for(let t=0;t<s;t++)if(d=e[t],m<d.length&&(h=d[m]))for(let e=0;e<h.length;e++){if(f=h[e],(u=c[f])?c[f]++:(u=0,c[f]=1),p=l[u]||(l[u]=[]),!a){let e=m+(t||!i?0:o||0);p=p[e]||(p[e]=[])}if(p.push(f),a&&n&&u===s-1&&p.length-r===n)return r?p.slice(r):p}if(e=l.length)if(i)l=l.length>1?Xe(l,n,r,a,o):(l=l[0])&&n&&l.length>n||r?l.slice(r,n+r):l;else{if(e<s)return[];if(l=l[e-1],n||r)if(a)(l.length>n||r)&&(l=l.slice(r,n+r));else{i=[];for(let e,t=0;t<l.length;t++)if(e=l[t])if(r&&e.length>r)r-=e.length;else if((n&&e.length>n||r)&&(e=e.slice(r,n+r),n-=e.length,r&&(r-=e.length)),i.push(e),!n)break;l=i}}return l}function Xe(e,t,n,r,i){const o=[],a=te();let s;var c=e.length;let u;if(r){for(i=c-1;i>=0;i--)if(u=(r=e[i])&&r.length)for(c=0;c<u;c++)if(s=r[c],!a[s])if(a[s]=1,n)n--;else if(o.push(s),o.length===t)return o}else for(let l,h=c-1,f=0;h>=0;h--){l=e[h];for(let e=0;e<l.length;e++)if(u=(r=l[e])&&r.length)for(let l=0;l<u;l++)if(s=r[l],!a[s])if(a[s]=1,n)n--;else{let n=(e+(h<c-1&&i||0))/(h+1)|0;if((o[n]||(o[n]=[])).push(s),++f===t)return o}}return o}function Ze(e,t,n,r,i){const o=te(),a=[];for(let e,n=0;n<t.length;n++){e=t[n];for(let t=0;t<e.length;t++)o[e[t]]=1}if(i){for(let t,i=0;i<e.length;i++)if(t=e[i],o[t])if(r)r--;else if(a.push(t),o[t]=0,n&&0===--n)break}else for(let n,r,i=0;i<e.result.length;i++)for(n=e.result[i],t=0;t<n.length;t++)r=n[t],o[r]&&((a[i]||(a[i]=[])).push(r),o[r]=0);return a}function et(e){const t=[],n=te(),r=te();for(let i,o,a,s,c,u,l,h=0;h<e.length;h++){i=e[h],o=i.field,a=i.result;for(let e=0;e<a.length;e++)c=a[e],"object"!=typeof c?c={id:s=c}:s=c.id,(u=n[s])?u.push(o):(c.field=n[s]=[o],t.push(c)),(l=c.highlight)&&(u=r[s],u||(r[s]=u={},c.highlight=u),u[o]=l)}return t}function tt(e,t,n,r,i){return(e=this.tag.get(e))&&(e=e.get(t))?((t=e.length-r)>0&&((n&&t>n||r)&&(e=e.slice(r,r+n)),i&&(e=nt.call(this,e))),e):[]}function nt(e){if(!this||!this.store)return e;if(this.db)return this.index.get(this.field[0]).db.enrich(e);const t=Array(e.length);for(let n,r=0;r<e.length;r++)n=e[r],t[r]={id:n,doc:this.store.get(n)};return t}function rt(e){if(!this||this.constructor!==rt)return new rt(e);const t=e.document||e.doc||e;let n,r;if(this.B=[],this.field=[],this.D=[],this.key=(n=t.key||t.id)&&ot(n,this.D)||"id",(r=e.keystore||0)&&(this.keystore=r),this.fastupdate=!!e.fastupdate,this.reg=!this.fastupdate||e.worker||e.db?r?new Ae(r):new Set:r?new _e(r):new Map,this.h=(n=t.store||null)&&n&&!0!==n&&[],this.store=n?r?new _e(r):new Map:null,this.cache=(n=e.cache||null)&&new de(n),e.cache=!1,this.worker=e.worker||!1,this.priority=e.priority||4,this.index=it.call(this,e,t),this.tag=null,(n=t.tag)&&("string"==typeof n&&(n=[n]),n.length)){this.tag=new Map,this.A=[],this.F=[];for(let e,t,r=0;r<n.length;r++){if(e=n[r],t=e.field||e,!t)throw Error("The tag field from the document descriptor is undefined.");e.custom?this.A[r]=e.custom:(this.A[r]=ot(t,this.D),e.filter&&("string"==typeof this.A[r]&&(this.A[r]=new String(this.A[r])),this.A[r].G=e.filter)),this.F[r]=t,this.tag.set(t,new Map)}}if(this.worker){this.fastupdate=!1,e=[];for(const t of this.index.values())t.then&&e.push(t);if(e.length){const t=this;return Promise.all(e).then(function(e){let n=0;for(const r of t.index.entries()){const i=r[0];let o=r[1];o.then&&(o=e[n],t.index.set(i,o),n++)}return t})}}else e.db&&(this.fastupdate=!1,this.mount(e.db))}function it(e,t){const n=new Map;let r=t.index||t.field||t;ne(r)&&(r=[r]);for(let t,o,a=0;a<r.length;a++){if(t=r[a],ne(t)||(o=t,t=t.field),o=re(o)?Object.assign({},e,o):e,this.worker){var i=void 0;i=new Ke(o,i=(i=o.encoder)&&i.encode?i:new le("string"==typeof i?we[i]:i||{})),n.set(t,i)}this.worker||n.set(t,new xt(o,this.reg)),o.custom?this.B[a]=o.custom:(this.B[a]=ot(t,this.D),o.filter&&("string"==typeof this.B[a]&&(this.B[a]=new String(this.B[a])),this.B[a].G=o.filter)),this.field[a]=t}if(this.h){ne(e=t.store)&&(e=[e]);for(let t,n,r=0;r<e.length;r++)t=e[r],n=t.field||t,t.custom?(this.h[r]=t.custom,t.custom.O=n):(this.h[r]=ot(n,this.D),t.filter&&("string"==typeof this.h[r]&&(this.h[r]=new String(this.h[r])),this.h[r].G=t.filter))}return n}function ot(e,t){const n=e.split(":");let r=0;for(let i=0;i<n.length;i++)"]"===(e=n[i])[e.length-1]&&(e=e.substring(0,e.length-2))&&(t[r]=!0),e&&(n[r++]=e);return r<n.length&&(n.length=r),r>1?n:n[0]}function at(e,t=0){let n=[],r=[];t&&(t=25e4/t*5e3|0);for(const i of e.entries())r.push(i),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function st(e,t){t||(t=new Map);for(let n,r=0;r<e.length;r++)n=e[r],t.set(n[0],n[1]);return t}function ct(e,t=0){let n=[],r=[];t&&(t=25e4/t*1e3|0);for(const i of e.entries())r.push([i[0],at(i[1])[0]||[]]),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function ut(e,t){t||(t=new Map);for(let n,r,i=0;i<e.length;i++)n=e[i],r=t.get(n[0]),t.set(n[0],st(n[1],r));return t}function lt(e){let t=[],n=[];for(const r of e.keys())n.push(r),25e4===n.length&&(t.push(n),n=[]);return n.length&&t.push(n),t}function ht(e,t){t||(t=new Set);for(let n=0;n<e.length;n++)t.add(e[n]);return t}function ft(e,t,n,r,i,o,a=0){const s=r&&r.constructor===Array;var c=s?r.shift():r;if(!c)return this.export(e,t,i,o+1);if((c=e((t?t+".":"")+(a+1)+"."+n,JSON.stringify(c)))&&c.then){const u=this;return c.then(function(){return ft.call(u,e,t,n,s?r:null,i,o,a+1)})}return ft.call(this,e,t,n,s?r:null,i,o,a+1)}function dt(e,t){let n="";for(const r of e.entries()){e=r[0];const i=r[1];let o="";for(let e,n=0;n<i.length;n++){e=i[n]||[""];let r="";for(let n=0;n<e.length;n++)r+=(r?",":"")+("string"===t?'"'+e[n]+'"':e[n]);r="["+r+"]",o+=(o?",":"")+r}o='["'+e+'",['+o+"]]",n+=(n?",":"")+o}return n}function pt(e,t){let n=0;var r=void 0===t;if(e.constructor===Array){for(let i,o,a,s=0;s<e.length;s++)if((i=e[s])&&i.length){if(r)return 1;if(o=i.indexOf(t),o>=0){if(i.length>1)return i.splice(o,1),1;if(delete e[s],n)return 1;a=1}else{if(a)return 1;n++}}}else for(let i of e.entries())r=i[0],pt(i[1],t)?n++:e.delete(r);return n}Re("add"),Re("append"),Re("search"),Re("update"),Re("remove"),Re("clear"),Re("export"),Re("import"),Ke.prototype.searchCache=fe,je(Ke.prototype),rt.prototype.add=function(e,t,n){if(re(e)&&(e=ie(t=e,this.key)),t&&(e||0===e)){if(!n&&this.reg.has(e))return this.update(e,t);for(let o,a=0;a<this.field.length;a++){o=this.B[a];var r=this.index.get(this.field[a]);if("function"==typeof o){var i=o(t);i&&r.add(e,i,n,!0)}else(!(i=o.G)||i(t))&&(o.constructor===String?o=[""+o]:ne(o)&&(o=[o]),ze(t,o,this.D,0,r,e,o[0],n))}if(this.tag)for(r=0;r<this.A.length;r++){var o=this.A[r];i=this.tag.get(this.F[r]);let s=te();if("function"==typeof o){if(!(o=o(t)))continue}else{var a=o.G;if(a&&!a(t))continue;o.constructor===String&&(o=""+o),o=ie(t,o)}if(i&&o){ne(o)&&(o=[o]);for(let t,r,c=0;c<o.length;c++)if(t=o[c],!s[t]&&(s[t]=1,(a=i.get(t))?r=a:i.set(t,r=[]),!n||!r.includes(e))){if(r.length===2**31-1){if(a=new xe(r),this.fastupdate)for(let e of this.reg.values())e.includes(r)&&(e[e.indexOf(r)]=a);i.set(t,r=a)}r.push(e),this.fastupdate&&((a=this.reg.get(e))?a.push(r):this.reg.set(e,[r]))}}}if(this.store&&(!n||!this.store.has(e))){let r;if(this.h){r=te();for(let e,i=0;i<this.h.length;i++){if(e=this.h[i],(n=e.G)&&!n(t))continue;let o;if("function"==typeof e){if(o=e(t),!o)continue;e=[e.O]}else if(ne(e)||e.constructor===String){r[e]=t[e];continue}Le(t,r,e,0,e[0],o)}}this.store.set(e,r||t)}this.worker&&(this.fastupdate||this.reg.add(e))}return this},He.prototype.or=function(){return Ne(this,"or",Ue,arguments)},He.prototype.and=function(){return Ne(this,"and",We,arguments)},He.prototype.xor=function(){return Ne(this,"xor",Qe,arguments)},He.prototype.not=function(){return Ne(this,"not",Ge,arguments)},(J=He.prototype).limit=function(e){if(this.await){const t=this;this.C.push(function(){return t.limit(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)if(n=this.result[r]){if(!(n.length<=e)){t[r]=n.slice(0,e);break}if(t[r]=n,!(e-=n.length))break}this.result=t}return this},J.offset=function(e){if(this.await){const t=this;this.C.push(function(){return t.offset(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)(n=this.result[r])&&(n.length<=e?e-=n.length:(t[r]=n.slice(e),e=0));this.result=t}return this},J.boost=function(e){if(this.await){const t=this;this.C.push(function(){return t.boost(e).result})}else this.h+=e;return this},J.resolve=function(e,t,n,r,i){let o=this.await?Ye(this,!0):this.result;if(o.then){const a=this;return o.then(function(){return a.resolve(e,t,n,r,i)})}return o.length&&("object"==typeof e?(r=e.highlight||this.highlight,n=!!r||e.enrich,t=e.offset,e=e.limit):(r=r||this.highlight,n=!!r||n),o=i?n?nt.call(this.index,o):o:Fe.call(this.index,o,e||100,t,n)),this.finalize(o,r)},J.finalize=function(e,t){if(e.then){const n=this;return e.then(function(e){return n.finalize(e,t)})}t&&e.length&&this.query&&(e=Ve(this.query,e,this.index.index,this.field,t));const n=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",n&&n(e),e},rt.prototype.search=function(e,t,n,r){n||(!t&&re(e)?(n=e,e=""):re(t)&&(n=t,t=0));let i=[];var o=[];let a,s,c,u,l,h,f,d,p=0,m=!0;if(n){n.constructor===Array&&(n={index:n}),e=n.query||e,a=n.pluck,s=n.merge,u=n.boost,h=a||n.field||(h=n.index)&&(h.index?null:h);var g=this.tag&&n.tag;c=n.suggest,m=!1!==n.resolve,l=n.cache,f=m&&this.store&&n.highlight;var y=!!f||m&&this.store&&n.enrich;t=n.limit||t;var v=n.offset||0;if(t||(t=m?100:0),g&&(!this.db||!r)){g.constructor!==Array&&(g=[g]);var b=[];for(let e,t=0;t<g.length;t++)if(e=g[t],e.field&&e.tag){var w=e.tag;if(w.constructor===Array)for(var k=0;k<w.length;k++)b.push(e.field,w[k]);else b.push(e.field,w)}else{w=Object.keys(e);for(let t,n,r=0;r<w.length;r++)if(t=w[r],n=e[t],n.constructor===Array)for(k=0;k<n.length;k++)b.push(t,n[k]);else b.push(t,n)}if(g=b,!e){if(o=[],b.length)for(g=0;g<b.length;g+=2){if(this.db){if(!(r=this.index.get(b[g])))continue;o.push(r=r.db.tag(b[g+1],t,v,y))}else r=tt.call(this,b[g],b[g+1],t,v,y);i.push(m?{field:b[g],tag:b[g+1],result:r}:[r])}if(o.length){const e=this;return Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)m?i[e].result=t[e]:i[e]=t[e];return m?i:new He(i.length>1?Je(i,1,0,0,c,u):i[0],e)})}return m?i:new He(i.length>1?Je(i,1,0,0,c,u):i[0],this)}}m||a||!(h=h||this.field)||(ne(h)?a=h:(h.constructor===Array&&1===h.length&&(h=h[0]),a=h.field||h.index)),h&&h.constructor!==Array&&(h=[h])}h||(h=this.field),b=(this.worker||this.db)&&!r&&[];for(let a,s,u,_=0;_<h.length;_++){if(s=h[_],this.db&&this.tag&&!this.B[_])continue;let A;if(ne(s)||(A=s,s=A.field,e=A.query||e,t=ee(A.limit,t),v=ee(A.offset,v),c=ee(A.suggest,c),f=m&&this.store&&ee(A.highlight,f),y=!!f||m&&this.store&&ee(A.enrich,y),l=ee(A.cache,l)),r)a=r[_];else{k=(w=A||n||{}).enrich;var x=this.index.get(s);if(g&&(this.db&&(w.tag=g,w.field=h,d=x.db.support_tag_search),!d&&k&&(w.enrich=!1),d||(w.limit=0,w.offset=0)),a=l?x.searchCache(e,g&&!d?0:t,w):x.search(e,g&&!d?0:t,w),g&&!d&&(w.limit=t,w.offset=v),k&&(w.enrich=k),b){b[_]=a;continue}}if(u=(a=a.result||a)&&a.length,g&&u){if(w=[],k=0,this.db&&r){if(!d)for(x=h.length;x<r.length;x++){let e=r[x];if(e&&e.length)k++,w.push(e);else if(!c)return m?i:new He(i,this)}}else for(let e,t,n=0;n<g.length;n+=2){if(e=this.tag.get(g[n]),!e){if(c)continue;return m?i:new He(i,this)}if(t=(e=e&&e.get(g[n+1]))&&e.length)k++,w.push(e);else if(!c)return m?i:new He(i,this)}if(k){if(a=Ze(a,w,t,v,m),u=a.length,!u&&!c)return m?a:new He(a,this);k--}}if(u)o[p]=s,i.push(a),p++;else if(1===h.length)return m?i:new He(i,this)}if(b){if(this.db&&g&&g.length&&!d)for(y=0;y<g.length;y+=2){if(!(o=this.index.get(g[y]))){if(c)continue;return m?i:new He(i,this)}b.push(o.db.tag(g[y+1],t,v,!1))}const r=this;return Promise.all(b).then(function(i){return n&&(n.resolve=m),i.length&&(i=r.search(e,t,n,i)),i})}if(!p)return m?i:new He(i,this);if(a&&(!y||!this.store))return i=i[0],m?i:new He(i,this);for(b=[],v=0;v<o.length;v++){if(g=i[v],y&&g.length&&void 0===g[0].doc&&(this.db?b.push(g=this.index.get(this.field[0]).db.enrich(g)):g=nt.call(this,g)),a)return m?f?Ve(e,g,this.index,a,f):g:new He(g,this);i[v]={field:o[v],result:g}}if(y&&this.db&&b.length){const t=this;return Promise.all(b).then(function(n){for(let e=0;e<n.length;e++)i[e].result=n[e];return f&&(i=Ve(e,i,t.index,a,f)),s?et(i):i})}return f&&(i=Ve(e,i,this.index,a,f)),s?et(i):i},(J=rt.prototype).mount=function(e){let t=this.field;if(this.tag)for(let e,r=0;r<this.F.length;r++){e=this.F[r];var n=void 0;this.index.set(e,n=new xt({},this.reg)),t===this.field&&(t=t.slice(0)),t.push(e),n.tag=this.tag.get(e)}n=[];const r={db:e.db,type:e.type,fastupdate:e.fastupdate};for(let i,o,a=0;a<t.length;a++){r.field=o=t[a],i=this.index.get(o);const s=new e.constructor(e.id,r);s.id=e.id,n[a]=s.mount(i),i.document=!0,a?i.bypass=!0:i.store=this.store}const i=this;return this.db=Promise.all(n).then(function(){i.db=!0})},J.commit=async function(){const e=[];for(const t of this.index.values())e.push(t.commit());await Promise.all(e),this.reg.clear()},J.destroy=function(){const e=[];for(const t of this.index.values())e.push(t.destroy());return Promise.all(e)},J.append=function(e,t){return this.add(e,t,!0)},J.update=function(e,t){return this.remove(e).add(e,t)},J.remove=function(e){for(var t of(re(e)&&(e=ie(e,this.key)),this.index.values()))t.remove(e,!0);if(this.reg.has(e)){if(this.tag&&!this.fastupdate)for(let n of this.tag.values())for(let r of n){t=r[0];const i=r[1],o=i.indexOf(e);o>-1&&(i.length>1?i.splice(o,1):n.delete(t))}this.store&&this.store.delete(e),this.reg.delete(e)}return this.cache&&this.cache.remove(e),this},J.clear=function(){const e=[];for(const t of this.index.values()){const n=t.clear();n.then&&e.push(n)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),e.length?Promise.all(e):this},J.contain=function(e){return this.db?this.index.get(this.field[0]).db.has(e):this.reg.has(e)},J.cleanup=function(){for(const e of this.index.values())e.cleanup();return this},J.get=function(e){return this.db?this.index.get(this.field[0]).db.enrich(e).then(function(e){return e[0]&&e[0].doc||null}):this.store.get(e)||null},J.set=function(e,t){return"object"==typeof e&&(e=ie(t=e,this.key)),this.store.set(e,t),this},J.searchCache=fe,J.export=function(e,t,n=0,r=0){if(n<this.field.length){const i=this.field[n];if((t=this.index.get(i).export(e,i,n,r=1))&&t.then){const r=this;return t.then(function(){return r.export(e,i,n+1)})}return this.export(e,i,n+1)}let i,o;switch(r){case 0:i="reg",o=lt(this.reg),t=null;break;case 1:i="tag",o=this.tag&&ct(this.tag,this.reg.size),t=null;break;case 2:i="doc",o=this.store&&at(this.store),t=null;break;default:return}return ft.call(this,e,t,i,o||null,n,r)},J.import=function(e,t){var n=e.split(".");"json"===n[n.length-1]&&n.pop();const r=n.length>2?n[0]:"";if(n=n.length>2?n[2]:n[1],this.worker&&r)return this.index.get(r).import(e);if(t){if("string"==typeof t&&(t=JSON.parse(t)),r)return this.index.get(r).import(n,t);switch(n){case"reg":this.fastupdate=!1,this.reg=ht(t,this.reg);for(let e,t=0;t<this.field.length;t++)e=this.index.get(this.field[t]),e.fastupdate=!1,e.reg=this.reg;if(this.worker){t=[];for(const n of this.index.values())t.push(n.import(e));return Promise.all(t)}break;case"tag":this.tag=ut(t,this.tag);break;case"doc":this.store=st(t,this.store)}}},je(rt.prototype),xt.prototype.remove=function(e,t){const n=this.reg.size&&(this.fastupdate?this.reg.get(e):this.reg.has(e));if(n){if(this.fastupdate){for(let t,r,i=0;i<n.length;i++)if((t=n[i])&&(r=t.length))if(t[r-1]===e)t.pop();else{const n=t.indexOf(e);n>=0&&t.splice(n,1)}}else pt(this.map,e),this.depth&&pt(this.ctx,e);t||this.reg.delete(e)}return this.db&&(this.commit_task.push({del:e}),this.M&&_t(this)),this.cache&&this.cache.remove(e),this};const mt={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};function gt(e,t,n,r,i,o,a){let s,c;if(!(s=t[n])||a&&!s[a]){if(a?((t=s||(t[n]=te()))[a]=1,c=e.ctx,(s=c.get(a))?c=s:c.set(a,c=e.keystore?new _e(e.keystore):new Map)):(c=e.map,t[n]=1),(s=c.get(n))?c=s:c.set(n,c=s=[]),o)for(let n,o=0;o<s.length;o++)if((n=s[o])&&n.includes(i)){if(o<=r)return;n.splice(n.indexOf(i),1),e.fastupdate&&(t=e.reg.get(i))&&t.splice(t.indexOf(n),1);break}if(c=c[r]||(c[r]=[]),c.push(i),c.length===2**31-1){if(t=new xe(c),e.fastupdate)for(let n of e.reg.values())n.includes(c)&&(n[n.indexOf(c)]=t);s[r]=c=t}e.fastupdate&&((r=e.reg.get(i))?r.push(c):e.reg.set(i,[c]))}}function yt(e,t,n,r,i){return n&&e>1?t+(r||0)<=e?n+(i||0):(e-1)/(t+(r||0))*(n+(i||0))+1|0:0}function vt(e,t,n,r,i,o,a){let s=e.length,c=e;if(s>1)c=Je(e,t,n,r,i,o,a);else if(1===s)return a?Fe.call(null,e[0],n,r):new He(e[0],this);return a?c:new He(c,this)}function bt(e,t,n,r,i,o,a){return e=kt(this,e,t,n,r,i,o,a),this.db?e.then(function(e){return i?e||[]:new He(e,this)}):e&&e.length?i?Fe.call(this,e,n,r):new He(e,this):i?[]:new He([],this)}function wt(e,t,n,r){let i=[];if(e&&e.length){if(e.length<=r)return void t.push(e);for(let t,n=0;n<r;n++)(t=e[n])&&(i[n]=t);if(i.length)return void t.push(i)}if(!n)return i}function kt(e,t,n,r,i,o,a,s){let c;return n&&(c=e.bidirectional&&t>n)&&(c=n,n=t,t=c),e.db?e.db.get(t,n,r,i,o,a,s):e=n?(e=e.ctx.get(n))&&e.get(t):e.map.get(t)}function xt(e,t){if(!this||this.constructor!==xt)return new xt(e);if(e){var n=ne(e)?e:e.preset;n&&(e=Object.assign({},mt[n],e))}else e={};const r=!0===(n=e.context)?{depth:1}:n||{},i=ne(e.encoder)?we[e.encoder]:e.encode||e.encoder||{};this.encoder=i.encode?i:"object"==typeof i?new le(i):{encode:i},this.resolution=e.resolution||9,this.tokenize=n=(n=e.tokenize)&&"default"!==n&&"exact"!==n&&n||"strict",this.depth="strict"===n&&r.depth||0,this.bidirectional=!1!==r.bidirectional,this.fastupdate=!!e.fastupdate,this.score=e.score||null,(n=e.keystore||0)&&(this.keystore=n),this.map=n?new _e(n):new Map,this.ctx=n?new _e(n):new Map,this.reg=t||(this.fastupdate?n?new _e(n):new Map:n?new Ae(n):new Set),this.N=r.resolution||3,this.rtl=i.rtl||e.rtl||!1,this.cache=(n=e.cache||null)&&new de(n),this.resolve=!1!==e.resolve,(n=e.db)&&(this.db=this.mount(n)),this.M=!1!==e.commit,this.commit_task=[],this.commit_timer=null,this.priority=e.priority||4}function _t(e){e.commit_timer||(e.commit_timer=setTimeout(function(){e.commit_timer=null,e.db.commit(e)},1))}xt.prototype.add=function(e,t,n,r){if(t&&(e||0===e)){if(!r&&!n&&this.reg.has(e))return this.update(e,t);r=this.depth;const u=(t=this.encoder.encode(t,!r)).length;if(u){const l=te(),h=te(),f=this.resolution;for(let d=0;d<u;d++){let p=t[this.rtl?u-1-d:d];var i=p.length;if(i&&(r||!h[p])){var o=this.score?this.score(t,p,d,null,0):yt(f,u,d),a="";switch(this.tokenize){case"tolerant":if(gt(this,h,p,o,e,n),i>2){for(let t,r,s,c,u=1;u<i-1;u++)t=p.charAt(u),r=p.charAt(u+1),s=p.substring(0,u)+r,c=p.substring(u+2),gt(this,h,a=s+t+c,o,e,n),gt(this,h,a=s+c,o,e,n);gt(this,h,p.substring(0,p.length-1),o,e,n)}break;case"full":if(i>2){for(let r,c=0;c<i;c++)for(o=i;o>c;o--){a=p.substring(c,o),r=this.rtl?i-1-c:c;var s=this.score?this.score(t,p,d,a,r):yt(f,u,d,i,r);gt(this,h,a,s,e,n)}break}case"bidirectional":case"reverse":if(i>1){for(s=i-1;s>0;s--){a=p[this.rtl?i-1-s:s]+a;var c=this.score?this.score(t,p,d,a,s):yt(f,u,d,i,s);gt(this,h,a,c,e,n)}a=""}case"forward":if(i>1){for(s=0;s<i;s++)gt(this,h,a+=p[this.rtl?i-1-s:s],o,e,n);break}default:if(gt(this,h,p,o,e,n),r&&u>1&&d<u-1)for(i=this.N,a=p,o=Math.min(r+1,this.rtl?d+1:u-d),s=1;s<o;s++){p=t[this.rtl?u-1-d-s:d+s];gt(this,l,(c=this.bidirectional&&p>a)?a:p,this.score?this.score(t,a,d,p,s-1):yt(i+(u/2>i?0:1),u,d,o-1,s-1),e,n,c?p:a)}}}}this.fastupdate||this.reg.add(e)}}return this.db&&(this.commit_task.push(n?{ins:e}:{del:e}),this.M&&_t(this)),this},xt.prototype.search=function(e,t,n){if(n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):(n=e,e="")),n&&n.cache)return n.cache=!1,e=this.searchCache(e,t,n),n.cache=!0,e;let r,i,o,a,s,c,u,l,h=[],f=0;n&&(e=n.query||e,t=n.limit||t,f=n.offset||0,i=n.context,o=n.suggest,l=(a=n.resolve)&&n.enrich,c=n.boost,u=n.resolution,s=this.db&&n.tag),void 0===a&&(a=this.resolve),i=this.depth&&!1!==i;let d=this.encoder.encode(e,!i);if(r=d.length,t=t||(a?100:0),1===r)return bt.call(this,d[0],"",t,f,a,l,s);if(2===r&&i&&!o)return bt.call(this,d[1],d[0],t,f,a,l,s);let p,m=te(),g=0;if(i&&(p=d[0],g=1),u||0===u||(u=p?this.N:this.resolution),this.db){if(this.db.search&&!1!==(n=this.db.search(this,d,t,f,o,a,l,s)))return n;const e=this;return async function(){for(let t,n;g<r;g++){if((n=d[g])&&!m[n]){if(m[n]=1,t=await kt(e,n,p,0,0,!1,!1),t=wt(t,h,o,u)){h=t;break}p&&(o&&t&&h.length||(p=n))}o&&p&&g===r-1&&!h.length&&(u=e.resolution,p="",g=-1,m=te())}return vt(h,u,t,f,o,c,a)}()}for(let e,t;g<r;g++){if((t=d[g])&&!m[t]){if(m[t]=1,e=kt(this,t,p,0,0,!1,!1),e=wt(e,h,o,u)){h=e;break}p&&(o&&e&&h.length||(p=t))}o&&p&&g===r-1&&!h.length&&(u=this.resolution,p="",g=-1,m=te())}return vt(h,u,t,f,o,c,a)},(J=xt.prototype).mount=function(e){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),e.mount(this)},J.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)},J.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()},J.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this},J.append=function(e,t){return this.add(e,t,!0)},J.contain=function(e){return this.db?this.db.has(e):this.reg.has(e)},J.update=function(e,t){const n=this,r=this.remove(e);return r&&r.then?r.then(()=>n.add(e,t)):this.add(e,t)},J.cleanup=function(){return this.fastupdate?(pt(this.map),this.depth&&pt(this.ctx),this):this},J.searchCache=fe,J.export=function(e,t,n=0,r=0){let i,o;switch(r){case 0:i="reg",o=lt(this.reg);break;case 1:i="cfg",o=null;break;case 2:i="map",o=at(this.map,this.reg.size);break;case 3:i="ctx",o=ct(this.ctx,this.reg.size);break;default:return}return ft.call(this,e,t,i,o,n,r)},J.import=function(e,t){if(t)switch("string"==typeof t&&(t=JSON.parse(t)),e=e.split("."),"json"===e[e.length-1]&&e.pop(),3===e.length&&e.shift(),e=e.length>1?e[1]:e[0],e){case"reg":this.fastupdate=!1,this.reg=ht(t,this.reg);break;case"map":this.map=st(t,this.map);break;case"ctx":this.ctx=ut(t,this.ctx)}},J.serialize=function(e=!0){let t="",n="",r="";if(this.reg.size){let e;for(var i of this.reg.keys())e||(e=typeof i),t+=(t?",":"")+("string"===e?'"'+i+'"':i);t="index.reg=new Set(["+t+"]);",n=dt(this.map,e),n="index.map=new Map(["+n+"]);";for(const t of this.ctx.entries()){i=t[0];let n=dt(t[1],e);n="new Map(["+n+"])",n='["'+i+'",'+n+"]",r+=(r?",":"")+n}r="index.ctx=new Map(["+r+"]);"}return e?"function inject(index){"+t+n+r+"}":t+n+r},je(xt.prototype);const At="undefined"!=typeof window&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),Et=["map","ctx","tag","reg","cfg"],St=te();function Ct(e,t,n){const r=e.value;let i,o=0;for(let e,a=0;a<r.length;a++){if(e=n?r:r[a]){for(let n,o,s=0;s<t.length;s++)if(o=t[s],n=e.indexOf(o),n>=0){if(i=1,!(e.length>1)){r[a]=[];break}e.splice(n,1)}o+=e.length}if(n)break}o?i&&e.update(r):e.delete(),e.continue()}function Pt(e,t){return new Promise((n,r)=>{e.onsuccess=e.oncomplete=function(){t&&t(this.result),t=null,n(this.result)},e.onerror=e.onblocked=r,e=null})}J=function e(t,n={}){if(!this||this.constructor!==e)return new e(t,n);"object"==typeof t&&(n=t,t=t.name),t||console.info("Default storage space was used, because a name was not passed."),this.id="flexsearch"+(t?":"+t.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=n.field?n.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=n.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}.prototype,J.mount=function(e){return e.index?e.mount(this):(e.db=this,this.open())},J.open=function(){if(this.db)return this.db;let e=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),St[e.id]||(St[e.id]=[]),St[e.id].push(e.field);const t=At.open(e.id,1);return t.onupgradeneeded=function(){const t=e.db=this.result;for(let n,r=0;r<Et.length;r++){n=Et[r];for(let r,i=0;i<St[e.id].length;i++)r=St[e.id][i],t.objectStoreNames.contains(n+("reg"!==n&&r?":"+r:""))||t.createObjectStore(n+("reg"!==n&&r?":"+r:""))}},e.db=Pt(t,function(t){e.db=t,e.db.onversionchange=function(){e.close()}})},J.close=function(){this.db&&this.db.close(),this.db=null},J.destroy=function(){return Pt(At.deleteDatabase(this.id))},J.clear=function(){const e=[];for(let t,n=0;n<Et.length;n++){t=Et[n];for(let n,r=0;r<St[this.id].length;r++)n=St[this.id][r],e.push(t+("reg"!==t&&n?":"+n:""))}const t=this.db.transaction(e,"readwrite");for(let n=0;n<e.length;n++)t.objectStore(e[n]).clear();return Pt(t)},J.get=function(e,t,n=0,r=0,i=!0,o=!1){e=this.db.transaction((t?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((t?"ctx":"map")+(this.field?":"+this.field:"")).get(t?t+":"+e:e);const a=this;return Pt(e).then(function(e){let t=[];if(!e||!e.length)return t;if(i){if(!n&&!r&&1===e.length)return e[0];for(let i,o=0;o<e.length;o++)if((i=e[o])&&i.length){if(r>=i.length){r-=i.length;continue}const e=n?r+Math.min(i.length-r,n):i.length;for(let n=r;n<e;n++)t.push(i[n]);if(r=0,t.length===n)break}return o?a.enrich(t):t}return e})},J.tag=function(e,t=0,n=0,r=!1){e=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(e);const i=this;return Pt(e).then(function(e){return!e||!e.length||n>=e.length?[]:t||n?(e=e.slice(n,n+t),r?i.enrich(e):e):e})},J.enrich=function(e){"object"!=typeof e&&(e=[e]);const t=this.db.transaction("reg","readonly").objectStore("reg"),n=[];for(let r=0;r<e.length;r++)n[r]=Pt(t.get(e[r]));return Promise.all(n).then(function(t){for(let n=0;n<t.length;n++)t[n]={id:e[n],doc:t[n]?JSON.parse(t[n]):null};return t})},J.has=function(e){return Pt(e=this.db.transaction("reg","readonly").objectStore("reg").getKey(e)).then(function(e){return!!e})},J.search=null,J.info=function(){},J.transaction=function(e,t,n){e+="reg"!==e&&this.field?":"+this.field:"";let r=this.h[e+":"+t];if(r)return n.call(this,r);let i=this.db.transaction(e,t);this.h[e+":"+t]=r=i.objectStore(e);const o=n.call(this,r);return this.h[e+":"+t]=null,Pt(i).finally(function(){return o})},J.commit=async function(e){let t=e.commit_task,n=[];e.commit_task=[];for(let e,r=0;r<t.length;r++)e=t[r],e.del&&n.push(e.del);n.length&&await this.remove(n),e.reg.size&&(await this.transaction("map","readwrite",function(t){for(const n of e.map){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;var i;if(n&&n.length){const e=Math.max(n.length,r.length);for(let t,o,a=0;a<e;a++)if((o=r[a])&&o.length){if((t=n[a])&&t.length)for(i=0;i<o.length;i++)t.push(o[i]);else n[a]=o;i=1}}else n=r,i=1;i&&t.put(n,e)})}}),await this.transaction("ctx","readwrite",function(t){for(const n of e.ctx){const e=n[0],r=n[1];for(const n of r){const r=n[0],i=n[1];i.length&&(t.get(e+":"+r).onsuccess=function(){let n=this.result;var o;if(n&&n.length){const e=Math.max(n.length,i.length);for(let t,r,a=0;a<e;a++)if((r=i[a])&&r.length){if((t=n[a])&&t.length)for(o=0;o<r.length;o++)t.push(r[o]);else n[a]=r;o=1}}else n=i,o=1;o&&t.put(n,e+":"+r)})}}}),e.store?await this.transaction("reg","readwrite",function(t){for(const n of e.store){const e=n[0],r=n[1];t.put("object"==typeof r?JSON.stringify(r):1,e)}}):e.bypass||await this.transaction("reg","readwrite",function(t){for(const n of e.reg.keys())t.put(1,n)}),e.tag&&await this.transaction("tag","readwrite",function(t){for(const n of e.tag){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;n=n&&n.length?n.concat(r):r,t.put(n,e)})}}),e.map.clear(),e.ctx.clear(),e.tag&&e.tag.clear(),e.store&&e.store.clear(),e.document||e.reg.clear())},J.remove=function(e){return"object"!=typeof e&&(e=[e]),Promise.all([this.transaction("map","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&Ct(t,e)}}),this.transaction("ctx","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&Ct(t,e)}}),this.transaction("tag","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&Ct(t,e,!0)}}),this.transaction("reg","readwrite",function(t){for(let n=0;n<e.length;n++)t.delete(e[n])})])};const Ot=rt;let Bt=null,Dt=!1;async function It(){console.log("Building FlexSearch index..."),Bt=new Ot({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const e=await f();for(const t of e)await jt(t);Dt=!0;try{const t={};await Bt.export((e,n)=>{t[e]=n}),await v("flexsearch_index",{serialized:t,timestamp:Date.now()}),console.log(`Indexed ${e.length} bookmarks`)}catch(e){console.error("Error caching index:",e)}return Bt}async function jt(e){Bt||await async function(){if(Dt)return Bt;console.log("Initializing FlexSearch index...");const e=await b("flexsearch_index");if(e&&e.serialized)try{Bt=new Ot({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const t=Object.keys(e.serialized);for(const n of t)await Bt.import(n,e.serialized[n]);return Dt=!0,console.log("Loaded FlexSearch index from cache"),Bt}catch(e){console.error("Error loading cached index:",e)}return await It(),Bt}();const t={id:e.id,title:e.title||"",url:e.url||"",description:e.description||"",keywords:Array.isArray(e.keywords)?e.keywords.join(" "):"",category:e.category||"",domain:e.domain||""};await Bt.add(t)}async function Tt(e){Bt&&await Bt.remove(e)}async function Mt(){try{console.log("Starting bookmark sync...");const e=await chrome.bookmarks.getTree(),t=[];function n(e,r=""){for(const i of e)if(i.url){let e="unknown";try{if(i.url.startsWith("http://")||i.url.startsWith("https://")){e=new URL(i.url).hostname}else e=i.url.startsWith("chrome://")||i.url.startsWith("chrome-extension://")?"chrome-internal":i.url.startsWith("file://")?"local-file":i.url.startsWith("javascript:")?"javascript-bookmarklet":i.url.startsWith("data:")?"data-uri":i.url.startsWith("mailto:")||i.url.startsWith("tel:")?"contact-link":"other-protocol"}catch(t){e="invalid-url"}t.push({id:i.id,title:i.title||"Untitled",url:i.url,domain:e,dateAdded:i.dateAdded||Date.now(),folderPath:r,parentId:i.parentId,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0})}else if(i.children){const e=r?`${r}/${i.title}`:i.title;n(i.children,e)}}n(e),await m(t),await chrome.storage.local.set({bookmarks:t,lastSyncTime:Date.now()}),console.log(`Synced ${t.length} bookmarks`);if((await Promise.resolve().then(function(){return T}).then(e=>e.getSettings())).enrichmentEnabled){const{getAllBookmarks:r,clearEnrichmentQueue:i}=await Promise.resolve().then(function(){return T}),o=await r(),a=new Set(o.filter(e=>e.lastChecked||e.description||e.category).map(e=>e.id));await i();let s=0;for(const c of t)!c.url.startsWith("http://")&&!c.url.startsWith("https://")||a.has(c.id)||(await w(c.id,0),s++);console.log(`Queued ${s} unenriched bookmarks for enrichment`)}}catch(u){console.error("Error syncing bookmarks:",u)}}async function qt(e){try{const t=[];let n=e;for(;n;){const[e]=await chrome.bookmarks.get(n);if(e.title&&t.unshift(e.title),n=e.parentId,t.length>10)break}return t.join("/")}catch(e){return""}}async function Kt(){await chrome.alarms.clear("enrichmentPipeline"),console.log("Enrichment is manual-only - no automatic alarms set")}chrome.runtime.onInstalled.addListener(async e=>{console.log("Extension installed/updated:",e.reason),await _(),"install"===e.reason?(console.log("First install - syncing bookmarks..."),await Mt(),console.log("Building initial search index..."),await It(),await Kt()):"update"===e.reason&&(console.log("Extension updated - syncing bookmarks..."),await Mt(),console.log("Rebuilding search index..."),await It(),await Kt())}),chrome.bookmarks.onCreated.addListener(async(e,t)=>{await async function(e){try{console.log("Bookmark created:",e);const[t]=await chrome.bookmarks.get(e);if(t.url){let n="unknown";try{(t.url.startsWith("http://")||t.url.startsWith("https://"))&&(n=new URL(t.url).hostname)}catch(e){n="invalid-url"}const r=await qt(t.parentId),i={id:t.id,title:t.title||"Untitled",url:t.url,domain:n,dateAdded:t.dateAdded||Date.now(),folderPath:r,parentId:t.parentId,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0};await p(i),await jt(i),await y(e,"create"),await S("add");if((await Promise.resolve().then(function(){return T}).then(e=>e.getSettings())).enrichmentEnabled&&(i.url.startsWith("http://")||i.url.startsWith("https://"))&&await w(e,10),zt){const e=Nt(i.url);Rt.set(e,i.id)}}}catch(e){console.error("Error handling bookmark creation:",e)}}(e)}),chrome.bookmarks.onRemoved.addListener(async(e,t)=>{await async function(e){try{console.log("Bookmark removed:",e),await Tt(e),await g(e),await y(e,"delete"),await S("delete"),zt&&(Lt=!1)}catch(e){console.error("Error handling bookmark removal:",e)}}(e)}),chrome.bookmarks.onChanged.addListener(async(e,t)=>{await async function(e,t){try{console.log("Bookmark changed:",e,t);const[n]=await chrome.bookmarks.get(e);if(n.url){let r="unknown";try{(n.url.startsWith("http://")||n.url.startsWith("https://"))&&(r=new URL(n.url).hostname)}catch(e){r="invalid-url"}const i=await qt(n.parentId),o={...await Promise.resolve().then(function(){return T}).then(t=>t.getBookmark(e))||{},id:n.id,title:void 0!==t.title?t.title:n.title,url:void 0!==t.url?t.url:n.url,domain:r,dateAdded:n.dateAdded||Date.now(),folderPath:i,parentId:n.parentId};if(await async function(e){await Tt(e.id),await jt(e)}(o),await p(o),await y(e,"update",t),t.url){(await Promise.resolve().then(function(){return T}).then(e=>e.getSettings())).enrichmentEnabled&&await w(e,5),zt&&(Lt=!1)}}}catch(e){console.error("Error handling bookmark change:",e)}}(e,t)}),chrome.bookmarks.onMoved.addListener(async(e,t)=>{await async function(e,t){try{console.log("Bookmark moved:",e);const[n]=await chrome.bookmarks.get(e),r=await qt(t.parentId),i=await Promise.resolve().then(function(){return T}).then(t=>t.getBookmark(e));i&&(i.folderPath=r,i.parentId=t.parentId,await p(i),await y(e,"update",{moved:!0}))}catch(e){console.error("Error handling bookmark move:",e)}}(e,t)}),chrome.runtime.onMessage.addListener((e,t,n)=>{if("syncBookmarks"===e.action)return Mt().then(()=>{n({success:!0})}).catch(e=>{n({success:!1,error:e.message})}),!0;if("getEnrichmentStatus"===e.action)return Promise.resolve().then(function(){return T}).then(async e=>{await e.getEnrichmentQueueSize();const t=await e.getSettings(),r=(await e.getAllBookmarks()).filter(e=>e.url&&(e.url.startsWith("http://")||e.url.startsWith("https://"))),i=r.filter(e=>e.lastChecked).length,o=r.length-i;n({success:!0,queueSize:o,totalBookmarks:r.length,enrichedCount:i,pendingCount:o,enabled:t.enrichmentEnabled})}).catch(e=>{n({success:!1,error:e.message})}),!0;if("reEnrichDeadLinks"===e.action)return Promise.resolve().then(function(){return X}).then(async t=>{const{getDeadLinks:r,upsertBookmark:i,getBookmark:o}=await Promise.resolve().then(function(){return T}),a=await r(),s=e.batchSize||a.length,c=e.concurrency||3,u=a.slice(0,s),l={total:u.length,pending:a.length-u.length,success:0,stillDead:0,errors:0},h=e=>{chrome.runtime.sendMessage({action:"reEnrichProgress",progress:e}).catch(()=>{})},f=async(e,n)=>{h({current:n+1,total:u.length,title:e.title,url:e.url,status:"processing"});try{const n=await o(e.id);if(n){n.lastChecked=null,await i(n);const r=await t.enrichBookmark(e.id);!1===r.isAlive?l.stillDead++:r.success?l.success++:l.errors++}}catch(t){console.error(`Error re-enriching ${e.id}:`,t),l.errors++}h({current:n+1,total:u.length,title:e.title,url:e.url,status:"completed",results:{...l}})},d=[];for(let e=0;e<u.length;e+=c)d.push(u.slice(e,e+c).map((t,n)=>({bookmark:t,index:e+n})));for(const e of d)await Promise.all(e.map(({bookmark:e,index:t})=>f(e,t)));n({success:!0,results:l})}).catch(e=>{n({success:!1,error:e.message})}),!0;if("runEnrichment"===e.action){const t=e=>{chrome.runtime.sendMessage({action:"enrichmentProgress",progress:e}).catch(()=>{})};return V(e.batchSize||10,t,e.concurrency||3,{force:e.force||!1}).then(e=>{n({success:!0,result:e})}).catch(e=>{n({success:!1,error:e.message})}),!0}if("enrichSpecificBookmarks"===e.action){const{ids:t}=e;return t&&t.length?(Promise.resolve().then(function(){return X}).then(async e=>{const r=[];for(const n of t)try{const t=await e.enrichBookmark(n,{force:!0});r.push({id:n,...t})}catch(e){r.push({id:n,success:!1,error:e.message})}n({success:!0,results:r})}).catch(e=>{n({success:!1,error:e.message})}),!0):(n({success:!1,error:"No IDs provided"}),!0)}return"updateSettings"===e.action?(Promise.resolve().then(function(){return T}).then(async t=>{await t.updateSettings(e.settings),void 0!==e.settings.trackBrowsingBehavior&&(zt=e.settings.trackBrowsingBehavior,console.log("Behavior tracking "+(zt?"enabled":"disabled")),Vt(zt),zt&&!Lt&&Ft()),n({success:!0})}).catch(e=>{n({success:!1,error:e.message})}),!0):void 0}),chrome.alarms.onAlarm.addListener(async e=>{"enrichmentPipeline"===e.name&&console.log("Alarm triggered but enrichment is manual-only")});let Rt=new Map,Lt=!1,zt=!1;async function Ft(){try{const e=await s.bookmarks.toArray();Rt.clear();for(const t of e)if(t.url){const e=Nt(t.url);Rt.set(e,t.id)}Lt=!0,console.log(`URL cache built with ${Rt.size} entries`)}catch(e){console.error("Error building URL cache:",e)}}function Nt(e){try{const t=new URL(e);let n=t.hostname.replace(/^www\./,"")+t.pathname;return n=n.replace(/\/$/,""),n.toLowerCase()}catch(t){return e.toLowerCase()}}const $t=new Map;async function Ut(e,t){try{const n=$t.get(e);if(n&&Date.now()-n<6e4)return!1;$t.set(e,Date.now());const r=await s.bookmarks.get(e);return r&&await s.bookmarks.update(e,{lastAccessed:Date.now(),accessCount:(r.accessCount||0)+1}),await y(e,"access",{url:t}),console.log(`Recorded access for bookmark: ${e}`),!0}catch(e){return console.error("Error recording bookmark access:",e),!1}}async function Wt(e){Lt||await Ft();const t=Nt(e);if(Rt.has(t))return Rt.get(t);const n=t.split("?")[0];return Rt.has(n)?Rt.get(n):null}const Qt=async(e,t,n)=>{if("complete"===t.status&&n.url){if(!n.url.startsWith("http://")&&!n.url.startsWith("https://"))return;try{const e=await Wt(n.url);e&&await Ut(e,n.url)}catch(e){console.error("Error in tab update handler:",e)}}},Gt=async e=>{try{const t=await chrome.tabs.get(e.tabId);if(!t.url||!t.url.startsWith("http://")&&!t.url.startsWith("https://"))return;const n=await Wt(t.url);n&&await Ut(n,t.url)}catch(e){console.error("Error in tab activation handler:",e)}};function Vt(e){e?(chrome.tabs.onUpdated.hasListener(Qt)||chrome.tabs.onUpdated.addListener(Qt),chrome.tabs.onActivated.hasListener(Gt)||chrome.tabs.onActivated.addListener(Gt)):(chrome.tabs.onUpdated.hasListener(Qt)&&chrome.tabs.onUpdated.removeListener(Qt),chrome.tabs.onActivated.hasListener(Gt)&&chrome.tabs.onActivated.removeListener(Gt))}(async function(){zt=await async function(){try{return!0===(await l()).trackBrowsingBehavior}catch(e){return!1}}(),console.log("Behavior tracking: "+(zt?"enabled":"disabled (default)")),Vt(zt)})().then(()=>{zt&&Ft()}),console.log("Bookmark Insights background service worker loaded");var Ht=Object.freeze({__proto__:null,default:{}});
