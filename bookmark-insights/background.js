var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n={exports:{}};n.exports=function(){
/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation.
	    Permission to use, copy, modify, and/or distribute this software for any
	    purpose with or without fee is hereby granted.
	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	    PERFORMANCE OF THIS SOFTWARE.
	    ***************************************************************************** */
var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:e,s=Object.keys,a=Array.isArray;function u(e,t){return"object"!=typeof t||s(t).forEach(function(n){e[n]=t[n]}),e}"undefined"==typeof Promise||o.Promise||(o.Promise=Promise);var c=Object.getPrototypeOf,l={}.hasOwnProperty;function h(e,t){return l.call(e,t)}function f(e,t){"function"==typeof t&&(t=t(c(e))),("undefined"==typeof Reflect?s:Reflect.ownKeys)(t).forEach(function(n){p(e,n,t[n])})}var d=Object.defineProperty;function p(e,t,n,r){d(e,t,u(n&&h(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function g(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,"constructor",e),{extend:f.bind(null,e.prototype)}}}}var m=Object.getOwnPropertyDescriptor;function y(e,t){var n;return m(e,t)||(n=c(e))&&y(n,t)}var v=[].slice;function b(e,t,n){return v.call(e,t,n)}function w(e,t){return t(e)}function k(e){if(!e)throw new Error("Assertion Failed")}function x(e){o.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){return e.reduce(function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e},{})}function A(e,t){if("string"==typeof t&&h(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=A(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(-1!==s){var a=e[t.substr(0,s)];return null==a?void 0:A(a,t.substr(s+1))}}function E(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){k("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)E(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var s=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?a(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var c=e[s];c&&h(e,s)||(c=e[s]={}),E(c,u,n)}}else void 0===n?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function S(e,t){"string"==typeof t?E(e,t,void 0):"length"in t&&[].map.call(t,function(t){E(e,t,void 0)})}function P(e){var t={};for(var n in e)h(e,n)&&(t[n]=e[n]);return t}var O=[].concat;function C(e){return O.apply([],e)}var j="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return o[e]}),B=new Set(j.map(function(e){return o[e]}));function K(e){var t={};for(var n in e)if(h(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||B.has(r.constructor)?r:K(r)}return t}function I(e){for(var t in e)if(h(e,t))return!1;return!0}var D=null;function q(e){D=new WeakMap;var t=T(e);return D=null,t}function T(e){if(!e||"object"!=typeof e)return e;var t=D.get(e);if(t)return t;if(a(e)){t=[],D.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(T(e[n]))}else if(B.has(e.constructor))t=e;else{var i=c(e);for(var o in t=i===Object.prototype?{}:Object.create(i),D.set(e,t),e)h(e,o)&&(t[o]=T(e[o]))}return t}var M={}.toString;function R(e){return M.call(e).slice(8,-1)}var F="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",z="symbol"==typeof F?function(e){var t;return null!=e&&(t=e[F])&&t.apply(e)}:function(){return null};function N(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var L={};function $(e){var t,n,r,i;if(1===arguments.length){if(a(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(i=z(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var U="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),Q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function G(e,t){this.name=e,this.message=t}function Y(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function H(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Y(e,t)}function J(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=Y(e,this.failures)}g(G).from(Error).extend({toString:function(){return this.name+": "+this.message}}),g(H).from(G),g(J).from(G);var X=V.reduce(function(e,t){return e[t]=t+"Error",e},{}),Z=G,ee=V.reduce(function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=Q[t]||n,this.inner=null)}return g(r).from(Z),e[t]=r,e},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=W.reduce(function(e,t){return e[t+"Error"]=ee[t],e},{});function ne(e,t){if(!e||e instanceof G||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&p(n,"stack",{get:function(){return this.inner.stack}}),n}var re=V.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e},{});function ie(){}function oe(e){return e}function se(e,t){return null==e||e===oe?t:function(n){return t(e(n))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ue(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0!==o?o:n}}function ce(e,t){return e===ie?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ae(r,this.onerror):r)}}function le(e,t){return e===ie?t:function(n){var r=e.apply(this,arguments);u(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ae(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ae(o,this.onerror):o),void 0===r?void 0===s?void 0:s:u(r,s)}}function he(e,t){return e===ie?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===ie?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}re.ModifyError=H,re.DexieError=G,re.BulkError=J;var de="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pe(e,t){de=e}var ge={},me=100,ye="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,c(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]}(),ve=ye[0],be=ye[1],we=ye[2],ke=be&&be.then,xe=ve&&ve.constructor,_e=!!we;function Ae(){queueMicrotask(Ue)}var Ee=function(e,t){Ie.push([e,t]),Pe&&(Ae(),Pe=!1)},Se=!0,Pe=!0,Oe=[],Ce=[],je=oe,Be={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ie,pgp:!1,env:{},finalize:ie},Ke=Be,Ie=[],De=0,qe=[];function Te(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Ke;if("function"!=typeof e){if(e!==ge)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ze(this,this._value))}this._state=null,this._value=null,++t.ref,Fe(this,e)}var Me={get:function(){var e=Ke,t=rt;function n(n,r){var i=this,o=!e.global&&(e!==Ke||t!==rt),s=o&&!at(),a=new Te(function(t,a){Le(i,new Re(pt(n,e,o,s),pt(r,e,o,s),t,a,e))});return this._consoleTask&&(a._consoleTask=this._consoleTask),a}return n.prototype=ge,n},set:function(e){p(this,"then",e&&e.prototype===ge?Me:{get:function(){return e},set:Me.set})}};function Re(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Fe(e,t){try{t(function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&We();t&&"function"==typeof t.then?Fe(e,function(e,n){t instanceof Te?t._then(e,n):t.then(e,n)}):(e._state=!0,e._value=t,Ne(e)),n&&Ve()}},ze.bind(null,e))}catch(t){ze(e,t)}}function ze(e,t){if(Ce.push(t),null===e._state){var n=e._lib&&We();t=je(t),e._state=!1,e._value=t,Ye(e),Ne(e),n&&Ve()}}function Ne(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Le(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===De&&(++De,Ee(function(){0===--De&&Qe()},[]))}function Le(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++De,Ee($e,[n,e,t])}else e._listeners.push(t)}function $e(e,t,n){try{var r,i=t._value;!t._state&&Ce.length&&(Ce=[]),r=de&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||-1!==Ce.indexOf(i)||He(t),n.resolve(r)}catch(e){n.reject(e)}finally{0===--De&&Qe(),--n.psd.ref||n.psd.finalize()}}function Ue(){dt(Be,function(){We()&&Ve()})}function We(){var e=Se;return Se=!1,Pe=!1,e}function Ve(){var e,t,n;do{for(;Ie.length>0;)for(e=Ie,Ie=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Ie.length>0);Se=!0,Pe=!0}function Qe(){var e=Oe;Oe=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=qe.slice(0),n=t.length;n;)t[--n]()}function Ge(e){function t(){e(),qe.splice(qe.indexOf(t),1)}qe.push(t),++De,Ee(function(){0===--De&&Qe()},[])}function Ye(e){Oe.some(function(t){return t._value===e._value})||Oe.push(e)}function He(e){for(var t=Oe.length;t;)if(Oe[--t]._value===e._value)return void Oe.splice(t,1)}function Je(e){return new Te(ge,!1,e)}function Xe(e,t){var n=Ke;return function(){var r=We(),i=Ke;try{return ht(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ht(i,!1),r&&Ve()}}}f(Te.prototype,{then:Me,_then:function(e,t){Le(this,new Re(null,null,e,t,Ke))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,function(e){return e instanceof t?n(e):Je(e)}):this.then(null,function(e){return e&&e.name===t?n(e):Je(e)})},finally:function(e){return this.then(function(t){return Te.resolve(e()).then(function(){return t})},function(t){return Te.resolve(e()).then(function(){return Je(t)})})},timeout:function(e,t){var n=this;return e<1/0?new Te(function(r,i){var o=setTimeout(function(){return i(new ee.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(Te.prototype,Symbol.toStringTag,"Dexie.Promise"),Be.env=ft(),f(Te,{all:function(){var e=$.apply(null,arguments).map(ut);return new Te(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(i,o){return Te.resolve(i).then(function(n){e[o]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof Te?e:e&&"function"==typeof e.then?new Te(function(t,n){e.then(t,n)}):new Te(ge,!0,e)},reject:Je,race:function(){var e=$.apply(null,arguments).map(ut);return new Te(function(t,n){e.map(function(e){return Te.resolve(e).then(t,n)})})},PSD:{get:function(){return Ke},set:function(e){return Ke=e}},totalEchoes:{get:function(){return rt}},newPSD:ot,usePSD:dt,scheduler:{get:function(){return Ee},set:function(e){Ee=e}},rejectionMapper:{get:function(){return je},set:function(e){je=e}},follow:function(e,t){return new Te(function(n,r){return ot(function(t,n){var r=Ke;r.unhandleds=[],r.onunhandled=n,r.finalize=ae(function(){var e=this;Ge(function(){0===e.unhandleds.length?t():n(e.unhandleds[0])})},r.finalize),e()},t,n,r)})}}),xe&&(xe.allSettled&&p(Te,"allSettled",function(){var e=$.apply(null,arguments).map(ut);return new Te(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(e,i){return Te.resolve(e).then(function(e){return r[i]={status:"fulfilled",value:e}},function(e){return r[i]={status:"rejected",reason:e}}).then(function(){return--n||t(r)})})})}),xe.any&&"undefined"!=typeof AggregateError&&p(Te,"any",function(){var e=$.apply(null,arguments).map(ut);return new Te(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(e,o){return Te.resolve(e).then(function(e){return t(e)},function(e){i[o]=e,--r||n(new AggregateError(i))})})})}),xe.withResolvers&&(Te.withResolvers=xe.withResolvers));var Ze={awaits:0,echoes:0,id:0},et=0,tt=[],nt=0,rt=0,it=0;function ot(e,t,n,r){var i=Ke,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++it,Be.env,o.env=_e?{Promise:Te,PromiseProp:{value:Te,configurable:!0,writable:!0},all:Te.all,race:Te.race,allSettled:Te.allSettled,any:Te.any,resolve:Te.resolve,reject:Te.reject}:{},t&&u(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=dt(o,e,n,r);return 0===o.ref&&o.finalize(),s}function st(){return Ze.id||(Ze.id=++et),++Ze.awaits,Ze.echoes+=me,Ze.id}function at(){return!!Ze.awaits&&(0===--Ze.awaits&&(Ze.id=0),Ze.echoes=Ze.awaits*me,!0)}function ut(e){return Ze.echoes&&e&&e.constructor===xe?(st(),e.then(function(e){return at(),e},function(e){return at(),mt(e)})):e}function ct(e){++rt,Ze.echoes&&0!==--Ze.echoes||(Ze.echoes=Ze.awaits=Ze.id=0),tt.push(Ke),ht(e,!0)}function lt(){var e=tt[tt.length-1];tt.pop(),ht(e,!1)}function ht(e,t){var n=Ke;if((t?!Ze.echoes||nt++&&e===Ke:!nt||--nt&&e===Ke)||queueMicrotask(t?ct.bind(null,e):lt),e!==Ke&&(Ke=e,n===Be&&(Be.env=ft()),_e)){var r=Be.env.Promise,i=e.env;(n.global||e.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ft(){var e=o.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function dt(e,t,n,r,i){var o=Ke;try{return ht(e,!0),t(n,r,i)}finally{ht(o,!1)}}function pt(e,t,n,r){return"function"!=typeof e?e:function(){var i=Ke;n&&st(),ht(t,!0);try{return e.apply(this,arguments)}finally{ht(i,!1),r&&queueMicrotask(at)}}}function gt(e){Promise===xe&&0===Ze.echoes?0===nt?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+ke).indexOf("[native code]")&&(st=at=ie);var mt=Te.reject;function yt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ke.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return yt(e,t,n,r)})):mt(i)}return i._promise(t,function(e,t){return ot(function(){return Ke.trans=i,r(e,t,i)})}).then(function(e){if("readwrite"===t)try{i.idbtrans.commit()}catch(e){}return"readonly"===t?e:i._completion.then(function(){return e})})}if(e._state.openComplete)return mt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return mt(new ee.DatabaseClosed);e.open().catch(ie)}return e._state.dbReadyPromise.then(function(){return yt(e,t,n,r)})}var vt="4.2.1",bt=String.fromCharCode(65535),wt=-1/0,kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",xt="String expected.",_t=[],At="__dbnames",Et="readonly",St="readwrite";function Pt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Ot={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=q(t))[e],t}}function jt(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Bt(e,t){try{var n=Dt(e),r=Dt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return It(qt(e),qt(t));case"Array":return Kt(e,t)}}catch(e){}return NaN}function Kt(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var s=Bt(e[o],t[o]);if(0!==s)return s}return n===r?0:n<r?-1:1}function It(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}function Dt(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=R(e);return"ArrayBuffer"===n?"binary":n}function qt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Tt(e,t,n){var r=e.schema.yProps;return r?(t&&n.numFailures>0&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){var r=n.updatesTable;return t?e.db.table(r).where("k").anyOf(t).delete():e.db.table(r).clear()})).then(function(){return n})):n}var Mt=function(){function e(e){this["@@propmod"]=e}return e.prototype.execute=function(e){var t,n=this["@@propmod"];if(void 0!==n.add){var r=n.add;if(a(r))return i(i([],a(e)?e:[],!0),r,!0).sort();if("number"==typeof r)return(Number(e)||0)+r;if("bigint"==typeof r)try{return BigInt(e)+r}catch(e){return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(void 0!==n.remove){var o=n.remove;if(a(o))return a(e)?e.filter(function(e){return!o.includes(e)}).sort():[];if("number"==typeof o)return Number(e)-o;if("bigint"==typeof o)try{return BigInt(e)-o}catch(e){return BigInt(0)-o}throw new TypeError("Invalid subtrahend ".concat(o))}var s=null===(t=n.replacePrefix)||void 0===t?void 0:t[0];return s&&"string"==typeof e&&e.startsWith(s)?n.replacePrefix[1]+e.substring(s.length):e},e}();function Rt(e,t){for(var n=s(t),r=n.length,i=!1,o=0;o<r;++o){var a=n[o],u=t[a],c=A(e,a);u instanceof Mt?(E(e,a,u.execute(c)),i=!0):c!==u&&(E(e,a,u),i=!0)}return i}var Ft=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||Ke.trans,i=this.name,o=de&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function s(e,n,r){if(!r.schema[i])throw new ee.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var a=We();try{var u=r&&r.db._novip===this.db._novip?r===Ke.trans?r._promise(e,s,n):ot(function(){return r._promise(e,s,n)},{trans:r,transless:Ke.transless||Ke}):yt(this.db,e,[this.name],s);return o&&(u._consoleTask=o,u=u.catch(function(e){return console.trace(e),mt(e)})),u}finally{a&&Ve()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?mt(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=s(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return e.keyPath.indexOf(t)>=0})){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==bt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&de&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var i=this.schema.idxByName;function o(e,t){return 0===Bt(e,t)}var u=t.reduce(function(t,n){var r=t[0],s=t[1],u=i[n],c=e[n];return[r||u,r||!u?Pt(s,u&&u.multi?function(e){var t=A(e,n);return a(t)&&t.some(function(e){return o(c,e)})}:function(e){return o(c,A(e,n))}):s]},[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?"[".concat(e.join("+"),"]"):e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var t=this,r=t.db,i=t.name;this.schema.mappedClass=e,e.prototype instanceof jt&&(e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),t.prototype.table=function(){return i},t}(e));for(var o=new Set,s=e.prototype;s;s=c(s))Object.getOwnPropertyNames(s).forEach(function(e){return o.add(e)});var a=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!o.has(r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){function e(e){u(this,e)}return this.mapToClass(e)},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ct(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{E(e,o,t)}catch(e){}return t})},e.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(i){return n.core.get({trans:i,key:e}).then(function(o){var s=null!=o?o:{};return Rt(s,t),r&&E(s,r,e),n.core.mutate({trans:i,type:"put",values:[s],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):!!o})})})},e.prototype.update=function(e,t){if("object"!=typeof e||a(e))return this.where(":id").equals(e).modify(t);var n=A(e,this.schema.primKey.keyPath);return void 0===n?mt(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Ct(o)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult}).then(function(t){if(o)try{E(e,o,t)}catch(e){}return t})},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(n){return Tt(t,[e],n)}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):void 0})})},e.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Ot}).then(function(t){return Tt(e,null,t)})}).then(function(e){return e.numFailures?Te.reject(e.failures[0]):void 0})},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=a&&s?e.map(Ct(a)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:c,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=a&&s?e.map(Ct(a)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:c,wantResults:o}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new J("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(u," operations failed"),s)})})},e.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),o=[];return this._trans("readwrite",function(s){return n.getMany({trans:s,keys:r,cache:"clone"}).then(function(a){var u=[],c=[];e.forEach(function(e,n){var r=e.key,i=e.changes,s=a[n];if(s){for(var l=0,h=Object.keys(i);l<h.length;l++){var f=h[l],d=i[f];if(f===t.schema.primKey.keyPath){if(0!==Bt(d,r))throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else E(s,f,d)}o.push(n),u.push(r),c.push(s)}});var l=u.length;return n.mutate({trans:s,type:"put",keys:u,values:c,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(0===n)return l;for(var i=0,s=Object.keys(r);i<s.length;i++){var a=s[i],u=o[Number(a)];if(null!=u){var c=r[a];delete r[a],r[u]=c}}throw new J("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(l," operations failed"),r)})})})},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e}).then(function(n){return Tt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new J("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),o)})},e}();function zt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(e,r,i){if("object"==typeof e)return u(e);r||(r=he),i||(i=ie);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter(function(t){return t!==e}),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function u(e){s(e).forEach(function(t){var n=e[t];if(a(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ee.InvalidArgument("Invalid event config");var r=o(t,oe,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){x(function(){e.apply(null,t)})})})}})}}function Nt(e,t){return g(t).from({prototype:e}),t}function Lt(e){return Nt(Ft.prototype,function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:zt(null,{creating:[ue,ie],reading:[se,oe],updating:[le,ie],deleting:[ce,ie]})})}function $t(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ut(e,t){e.filter=Pt(e.filter,t)}function Wt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Pt(r(),t())}:t,e.justLimit=n&&!r}function Vt(e,t){e.isMatch=Pt(e.isMatch,t)}function Qt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Gt(e,t,n){var r=Qt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Yt(e,t,n,r){var i=e.replayFilter?Pt(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(e,n,r){if(!i||i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),h(o,a)||(o[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Ht(Gt(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Ht(Gt(e,r,n),Pt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Ht(e,t,n,r){var i=Xe(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=ie},function(t){e.fail(t),n=ie})||i(e.value,e,function(e){return n=e}),n()})})}var Jt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Pt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Yt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&u(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Yt(t,e,n,t.table.core)})},e.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if($t(n,!0))return r.count({trans:e,query:{index:Qt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Yt(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function a(e,t){return Bt(o(e,i),o(t,i))*s}return this.toArray(function(e){return e.sort(a)}).then(t)},e.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if("next"===n.dir&&$t(n,!0)&&n.limit>0){var r=n.valueMapper,i=Qt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){var t=e.result;return r?t.map(r):t})}var o=[];return Yt(n,function(e){return o.push(e)},e,n.table.core).then(function(){return o})},e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,$t(t)?Wt(t,function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n(function(){e.advance(t),t=0}),!1))}}):Wt(t,function(){var t=e;return function(){return--t<0}})),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}},!0),this},e.prototype.until=function(e,t){return Ut(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},e.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Ut(this._ctx,function(t){return e(t.value)}),Vt(this._ctx,e),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&$t(t,!0)&&t.limit>0)return this._read(function(e){var n=Qt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Ut(this._ctx,function(e){var t=e.primaryKey.toString(),r=h(n,t);return n[t]=!0,!r}),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i;i="function"==typeof e?e:function(t){return Rt(t,e)};var o=n.table.core,a=o.schema.primaryKey,u=a.outbound,c=a.extractKey,l=200,h=t.db._options.modifyChunkSize;h&&(l="object"==typeof h?h[o.name]||h["*"]||200:h);var f=[],d=0,p=[],g=function(e,t){var n=t.failures,r=t.numFailures;d+=e-r;for(var i=0,o=s(n);i<o.length;i++){var a=o[i];f.push(n[a])}},m=e===Xt;return t.clone().primaryKeys().then(function(t){var s=$t(n)&&n.limit===1/0&&("function"!=typeof e||m)&&{index:n.index,range:n.range},a=function(h){var f=Math.min(l,t.length-h),d=t.slice(h,h+f);return(m?Promise.resolve([]):o.getMany({trans:r,keys:d,cache:"immutable"})).then(function(p){var y=[],v=[],b=u?[]:null,w=m?d:[];if(!m)for(var k=0;k<f;++k){var x=p[k],_={value:q(x),primKey:t[h+k]};!1!==i.call(_,_.value,_)&&(null==_.value?w.push(t[h+k]):u||0===Bt(c(x),c(_.value))?(v.push(_.value),u&&b.push(t[h+k])):(w.push(t[h+k]),y.push(_.value)))}return Promise.resolve(y.length>0&&o.mutate({trans:r,type:"add",values:y}).then(function(e){for(var t in e.failures)w.splice(parseInt(t),1);g(y.length,e)})).then(function(){return(v.length>0||s&&"object"==typeof e)&&o.mutate({trans:r,type:"put",keys:b,values:v,criteria:s,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:h>0}).then(function(e){return g(v.length,e)})}).then(function(){return(w.length>0||s&&m)&&o.mutate({trans:r,type:"delete",keys:w,criteria:s,isAdditionalChunk:h>0}).then(function(e){return Tt(n.table,w,e)}).then(function(e){return g(w.length,e)})}).then(function(){return t.length>h+f&&a(h+l)})})};return a(0).then(function(){if(f.length>0)throw new H("Error modifying one or more objects",f,d,p);return t.length})})})},e.prototype.delete=function(){var e=this._ctx,t=e.range;return!$t(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(Xt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(e){var n=e.failures,r=e.numFailures;if(r)throw new H("Could not delete some values",Object.keys(n).map(function(e){return n[e]}),t-r);return t-r})})})},e}(),Xt=function(e,t){return t.value=null};function Zt(e){return Nt(Jt.prototype,function(t,n){this.db=e;var r=Ot,i=null;if(n)try{r=n()}catch(e){i=e}var o=t._ctx,s=o.table,a=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:a!==oe?a:null}})}function en(e,t){return e<t?-1:e===t?0:1}function tn(e,t){return e>t?-1:e===t?0:1}function nn(e,t,n){var r=e instanceof hn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function rn(e){return new e.Collection(e,function(){return ln("")}).limit(0)}function on(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function sn(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function an(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),a=-1,u=0;u<s;++u){var c=t[u];if(c!==r[u])return i(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):i(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[u],c)<0&&(a=u)}return s<r.length&&"next"===o?e+n.substr(e.length):s<e.length&&"prev"===o?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function un(e,t,n,r){var i,o,s,a,u,c,l,h=n.length;if(!n.every(function(e){return"string"==typeof e}))return nn(e,xt);function f(e){i=on(e),o=sn(e),s="next"===e?en:tn;var t=n.map(function(e){return{lower:o(e),upper:i(e)}}).sort(function(e,t){return s(e.lower,t.lower)});a=t.map(function(e){return e.upper}),u=t.map(function(e){return e.lower}),c=e,l="next"===e?"":r}f("next");var d=new e.Collection(e,function(){return cn(a[0],u[h-1]+r)});d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm(function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var f=o(i);if(t(f,u,p))return!0;for(var d=null,g=p;g<h;++g){var m=an(i,f,a[g],u[g],s,c);null===m&&null===d?p=g+1:(null===d||s(d,m)>0)&&(d=m)}return n(null!==d?function(){e.continue(d+l)}:r),!1}),d}function cn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ln(e){return{type:1,lower:e,upper:e}}var hn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?rn(this):new this.Collection(this,function(){return cn(e,t,!n,!r)})}catch(e){return nn(this,kt)}},e.prototype.equals=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return ln(e)})},e.prototype.above=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return cn(e,void 0,!0)})},e.prototype.aboveOrEqual=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return cn(e,void 0,!1)})},e.prototype.below=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return cn(void 0,e,!1,!0)})},e.prototype.belowOrEqual=function(e){return null==e?nn(this,kt):new this.Collection(this,function(){return cn(void 0,e)})},e.prototype.startsWith=function(e){return"string"!=typeof e?nn(this,xt):this.between(e,e+bt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):un(this,function(e,t){return 0===e.indexOf(t[0])},[e],bt)},e.prototype.equalsIgnoreCase=function(e){return un(this,function(e,t){return e===t[0]},[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=$.apply(L,arguments);return 0===e.length?rn(this):un(this,function(e,t){return-1!==t.indexOf(e)},e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=$.apply(L,arguments);return 0===e.length?rn(this):un(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,bt)},e.prototype.anyOf=function(){var e=this,t=$.apply(L,arguments),n=this._cmp;try{t.sort(n)}catch(e){return nn(this,kt)}if(0===t.length)return rn(this);var r=new this.Collection(this,function(){return cn(t[0],t[t.length-1])});r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,o){for(var s=e.key;n(s,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(s,t[i])||(r(function(){e.continue(t[i])}),!1)}),r},e.prototype.notEqual=function(e){return this.inAnyRange([[wt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=$.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return nn(this,kt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[wt,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===e.length)return rn(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0}))return nn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var u=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;function l(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=s(o[0],t[0]),o[1]=a(o[1],t[1]);break}}return n===i&&e.push(t),e}var h,f=i;function d(e,t){return f(e[0],t[0])}try{(h=e.reduce(l,[])).sort(d)}catch(e){return nn(this,kt)}var p=0,g=c?function(e){return i(e,h[p][1])>0}:function(e){return i(e,h[p][1])>=0},m=u?function(e){return o(e,h[p][0])>0}:function(e){return o(e,h[p][0])>=0};function y(e){return!g(e)&&!m(e)}var v=g,b=new this.Collection(this,function(){return cn(h[0][0],h[h.length-1][1],!u,!c)});return b._ondirectionchange=function(e){"next"===e?(v=g,f=i):(v=m,f=o),h.sort(d)},b._addAlgorithm(function(e,t,r){for(var o=e.key;v(o);)if(++p===h.length)return t(r),!1;return!!y(o)||(0===n._cmp(o,h[p][1])||0===n._cmp(o,h[p][0])||t(function(){f===i?e.continue(h[p][0]):e.continue(h[p][1])}),!1)}),b},e.prototype.startsWithAnyOf=function(){var e=$.apply(L,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?rn(this):this.inAnyRange(e.map(function(e){return[e,e+bt]})):nn(this,"startsWithAnyOf() only works with strings")},e}();function fn(e){return Nt(hn.prototype,function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=Bt,this._descending=function(e,t){return Bt(t,e)},this._max=function(e,t){return Bt(e,t)>0?e:t},this._min=function(e,t){return Bt(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})}function dn(e){return Xe(function(t){return pn(t),e(t.target.error),!1})}function pn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var gn="storagemutated",mn="x-storagemutated-1",yn=zt(null,gn),vn=function(){function e(){}return e.prototype._lock=function(){return k(!Ke.global),++this._reculock,1!==this._reculock||Ke.global||(Ke.lockOwnerFor=this),this},e.prototype._unlock=function(){if(k(!Ke.global),0===--this._reculock)for(Ke.global||(Ke.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&Ke.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(k(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(r);case"MissingAPIError":throw new ee.MissingAPI(r.message,r);default:throw new ee.OpenFailed(r)}if(!this.active)throw new ee.TransactionInactive;return k(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Xe(function(n){pn(n),t._reject(e.error)}),e.onabort=Xe(function(n){pn(n),t.active&&t._reject(new ee.Abort(e.error)),t.active=!1,t.on("abort").fire(n)}),e.oncomplete=Xe(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&yn.storagemutated.fire(e.mutatedParts)}),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ee.TransactionInactive);if(this._locked())return new Te(function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},Ke])});if(n)return ot(function(){var e=new Te(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new Te(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Te.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(function(){return n});else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Te(function(e,r){n.then(function(n){return t._waitingQueue.push(Xe(e.bind(null,n)))},function(e){return t._waitingQueue.push(Xe(r.bind(null,e)))}).finally(function(){t._waitingFor===i&&(t._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(h(t,e))return t[e];var n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function bn(e){return Nt(vn.prototype,function(t,n,r,i,o){var s=this;"readonly"!==t&&n.forEach(function(e){var t,i=null===(t=r[e])||void 0===t?void 0:t.yProps;i&&(n=n.concat(i.map(function(e){return e.updatesTable})))}),this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=zt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Te(function(e,t){s._resolve=e,s._reject=t}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(e){var t=s.active;return s.active=!1,s.on.error.fire(e),s.parent?s.parent._reject(e):t&&s.idbtrans&&s.idbtrans.abort(),mt(e)})})}function wn(e,t,n,r,i,o,s,a){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+kn(t),type:a}}function kn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function xn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:_(n,function(e){return[e.name,e]})}}function _n(e){return 1===e.length?e[0]:e}var An=function(e){try{return e.only([[]]),An=function(){return[[]]},[[]]}catch(e){return An=function(){return bt},bt}};function En(e){return null==e?function(){}:"string"==typeof e?Sn(e):function(t){return A(t,e)}}function Sn(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return A(t,e)}}function Pn(e){return[].slice.call(e)}var On=0;function Cn(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function jn(e,t,n){function r(e,t){var n=Pn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map(function(e){return t.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=a(t),i=null==t,o={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:En(t)},indexes:Pn(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,s={name:t,compound:a(i),keyPath:i,unique:n,multiEntry:r,extractKey:En(i)};return o[Cn(i)]=s,s}),getIndexByKeyPath:function(e){return o[Cn(e)]}};return o[":id"]=s.primaryKey,null!=t&&(o[Cn(t)]=s.primaryKey),s})},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!o):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!o)}function o(e){var t=e.name;function n(e){var n=e.trans,r=e.type,o=e.keys,s=e.values,a=e.range;return new Promise(function(e,u){e=Xe(e);var c=n.objectStore(t),l=null==c.keyPath,h="put"===r||"add"===r;if(!h&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);var f,d=(o||s||{length:1}).length;if(o&&s&&o.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],g=[],m=0,y=function(e){++m,pn(e)};if("deleteRange"===r){if(4===a.type)return e({numFailures:m,failures:g,results:[],lastResult:void 0});3===a.type?p.push(f=c.clear()):p.push(f=c.delete(i(a)))}else{var v=h?l?[s,o]:[s,null]:[o,null],b=v[0],w=v[1];if(h)for(var k=0;k<d;++k)p.push(f=w&&void 0!==w[k]?c[r](b[k],w[k]):c[r](b[k])),f.onerror=y;else for(k=0;k<d;++k)p.push(f=c[r](b[k])),f.onerror=y}var x=function(t){var n=t.target.result;p.forEach(function(e,t){return null!=e.error&&(g[t]=e.error)}),e({numFailures:m,failures:g,results:"delete"===r?o:p.map(function(e){return e.result}),lastResult:n})};f.onerror=function(e){y(e),x(e)},f.onsuccess=x})}function r(e){var n=e.trans,r=e.values,o=e.query,s=e.reverse,a=e.unique;return new Promise(function(e,u){e=Xe(e);var c=o.index,l=o.range,h=n.objectStore(t),f=c.isPrimaryKey?h:h.index(c.name),d=s?a?"prevunique":"prev":a?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(i(l),d):f.openKeyCursor(i(l),d);p.onerror=dn(u),p.onsuccess=Xe(function(t){var r=p.result;if(r){r.___id=++On,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var s=r.advance.bind(r),a=function(){throw new Error("Cursor not started")},c=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=a,r.fail=Xe(u),r.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},r.start=function(e){var t=new Promise(function(e,t){e=Xe(e),p.onerror=dn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=c,e(t)}}),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Xe(function(e){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=s,n(),t},e(r)}else e(null)},u)})}function o(e){return function(n){return new Promise(function(r,o){r=Xe(r);var s=n.trans,a=n.values,u=n.limit,c=n.query,l=u===1/0?void 0:u,h=c.index,f=c.range,d=s.objectStore(t),p=h.isPrimaryKey?d:d.index(h.name),g=i(f);if(0===u)return r({result:[]});if(e){var m=a?p.getAll(g,l):p.getAllKeys(g,l);m.onsuccess=function(e){return r({result:e.target.result})},m.onerror=dn(o)}else{var y=0,v=a||!("openKeyCursor"in p)?p.openCursor(g):p.openKeyCursor(g),b=[];v.onsuccess=function(e){var t=v.result;return t?(b.push(a?t.value:t.primaryKey),++y===u?r({result:b}):void t.continue()):r({result:b})},v.onerror=dn(o)}})}}return{name:t,schema:e,mutate:n,getMany:function(e){var n=e.trans,r=e.keys;return new Promise(function(e,i){e=Xe(e);for(var o,s=n.objectStore(t),a=r.length,u=new Array(a),c=0,l=0,h=function(t){var n=t.target;u[n._pos]=n.result,++l===c&&e(u)},f=dn(i),d=0;d<a;++d)null!=r[d]&&((o=s.get(r[d]))._pos=d,o.onsuccess=h,o.onerror=f,++c);0===c&&e(u)})},get:function(e){var n=e.trans,r=e.key;return new Promise(function(e,i){e=Xe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=dn(i)})},query:o(c),openCursor:r,count:function(e){var n=e.query,r=e.trans,o=n.index,s=n.range;return new Promise(function(e,n){var a=r.objectStore(t),u=o.isPrimaryKey?a:a.index(o.name),c=i(s),l=c?u.count(c):u.count();l.onsuccess=Xe(function(t){return e(t.target.result)}),l.onerror=dn(n)})}}}var s=r(e,n),u=s.schema,c=s.hasGetAll,l=u.tables.map(function(e){return o(e)}),h={};return l.forEach(function(e){return h[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '".concat(e,"' not found"));return h[e]},MIN_KEY:-1/0,MAX_KEY:An(t),schema:u}}function Bn(e,t){return t.reduce(function(e,t){var n=t.create;return r(r({},e),n(e))},e)}function Kn(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:Bn(jn(t,i,r),e.dbcore)}}function In(e,t){var n=t.db,r=Kn(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function Dn(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=y(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?p(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function qn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function Tn(e,t){return e._cfg.version-t._cfg.version}function Mn(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=xn("$meta",Hn("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var a=o._reject.bind(o),u=Ke.transless||Ke;ot(function(){if(Ke.trans=o,Ke.transless=u,0!==t)return In(e,n),Fn(e,o,t).then(function(t){return zn(e,t,o,n)}).catch(a);s(i).forEach(function(e){Ln(n,e,i[e].primKey,i[e].indexes)}),In(e,n),Te.follow(function(){return e.on.populate.fire(o)}).catch(a)})}function Rn(e,t){$n(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Vn(e,e.idbdb,t);Yn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){de&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),Wn(n,t)})},i=0,o=Nn(n,e._dbSchema).change;i<o.length;i++){var s=r(o[i]);if("object"==typeof s)return s.value}}function Fn(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(e){return null!=e?e:n}):Te.resolve(n)}function zn(e,t,n,r){var i=[],o=e._versions,a=e._dbSchema=Vn(e,e.idbdb,r),u=o.filter(function(e){return e._cfg.version>=t});if(0===u.length)return Te.resolve();function c(){return i.length?Te.resolve(i.shift()(n.idbtrans)).then(c):Te.resolve()}return u.forEach(function(o){i.push(function(){var i=a,u=o._cfg.dbschema;Yn(e,i,r),Yn(e,u,r),a=e._dbSchema=u;var c=Nn(i,u);c.add.forEach(function(e){Ln(r,e[0],e[1].primKey,e[1].indexes)}),c.change.forEach(function(e){if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach(function(e){return Wn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Wn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){In(e,r),n._memoizedTables={};var h=P(u);c.del.forEach(function(e){h[e]=i[e]}),qn(e,[e.Transaction.prototype]),Dn(e,[e.Transaction.prototype],s(h),h),n.schema=h;var f,d=U(l);d&&st();var p=Te.follow(function(){if((f=l(n))&&d){var e=at.bind(null,null);f.then(e,e)}});return f&&"function"==typeof f.then?Te.resolve(f):p.then(function(){return f})}}),i.push(function(t){Un(o._cfg.dbschema,t),qn(e,[e.Transaction.prototype]),Dn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===o._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(o._cfg.version,"version"))})}),c().then(function(){$n(a,r)})}function Nn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto)s.recreate=!0,r.change.push(s);else{var a=i.idxByName,u=o.idxByName,c=void 0;for(c in a)u[c]||s.del.push(c);for(c in u){var l=a[c],h=u[c];l?l.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function Ln(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Wn(i,e)}),i}function $n(e,t){s(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(de&&console.debug("Dexie: Creating missing table",n),Ln(t,n,e[n].primKey,e[n].indexes))})}function Un(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return null==e[n]&&t.db.deleteObjectStore(n)})}function Wn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Vn(e,t,n){var r={};return b(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=t.keyPath,o=wn(kn(i),i||"",!0,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),s=[],a=0;a<t.indexNames.length;++a){var u=t.index(t.indexNames[a]);i=u.keyPath;var c=wn(u.name,i,!!u.unique,!!u.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(c)}r[e]=xn(e,o,s)}),r}function Qn(e,t,n){e.verno=t.version/10;var r=e._dbSchema=Vn(e,t,n);e._storeNames=b(t.objectStoreNames,0),Dn(e,[e._allTables],s(r),r)}function Gn(e,t){var n=Nn(Vn(e,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some(function(e){return e.add.length||e.change.length}))}function Yn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var s=r[i],a=n.objectStore(s);e._hasGetAll="getAll"in a;for(var u=0;u<a.indexNames.length;++u){var c=a.indexNames[u],l=a.index(c).keyPath,h="string"==typeof l?l:"["+b(l).join("+")+"]";if(t[s]){var f=t[s].idxByName[h];f&&(f.name=c,delete t[s].idxByName[h],t[s].idxByName[c]=f)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Hn(e){return e.split(",").map(function(e,t){var n,r=e.split(":"),i=null===(n=r[1])||void 0===n?void 0:n.trim(),o=(e=r[0].trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return wn(o,s||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(s),0===t,i)})}var Jn,Xn=function(){function e(){}return e.prototype._createTableSchema=function(e,t,n){return xn(e,t,n)},e.prototype._parseIndexSyntax=function(e){return Hn(e)},e.prototype._parseStoresSpec=function(e,t){var n=this;s(e).forEach(function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),o=i.shift();if(!o)throw new ee.Schema("Invalid schema for table "+r+": "+e[r]);if(o.unique=!0,o.multi)throw new ee.Schema("Primary key cannot be multiEntry*");i.forEach(function(e){if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")});var s=n._createTableSchema(r,o,i);t[r]=s}})},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach(function(e){u(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)}),t._dbSchema=i,qn(t,[t._allTables,t,t.Transaction.prototype]),Dn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],s(i),i),t._storeNames=s(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||ie,e),this},e}();function Zn(e){return Nt(Xn.prototype,function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function er(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ti(At,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function tr(e){return e&&"function"==typeof e.databases}function nr(e){var t=e.indexedDB,n=e.IDBKeyRange;return tr(t)?Promise.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==At})}):er(t,n).toCollection().primaryKeys()}function rr(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).put({name:t}).catch(ie)}function ir(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!tr(n)&&t!==At&&er(n,r).delete(t).catch(ie)}function or(e){return ot(function(){return Ke.letThrough=!0,e()})}function sr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function ar(e){return!("from"in e)}var ur=function(e,t){if(!this){var n=new ur;return e&&"d"in e&&u(n,e),n}u(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function cr(e,t,n){var r=Bt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(ar(e))return u(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Bt(n,e.from)<0)return i?cr(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},dr(e);if(Bt(t,e.to)>0)return o?cr(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},dr(e);Bt(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Bt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var s=!e.r;i&&!e.l&&lr(e,i),o&&s&&lr(e,o)}}function lr(e,t){function n(e,t){var r=t.from,i=t.to,o=t.l,s=t.r;cr(e,r,i),o&&n(e,o),s&&n(e,s)}ar(t)||n(e,t)}function hr(e,t){var n=fr(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=fr(e),s=o.next(i.from),a=s.value;!r.done&&!s.done;){if(Bt(a.from,i.to)<=0&&Bt(a.to,i.from)>=0)return!0;Bt(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function fr(e){var t=ar(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Bt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Bt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function dr(e){var t,n,i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var s="r"===o?"l":"r",a=r({},e),u=e[o];e.from=u.from,e.to=u.to,e[o]=u[o],a[o]=u[s],e[s]=a,a.d=pr(a)}e.d=pr(e)}function pr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function gr(e,t){return s(t).forEach(function(n){e[n]?lr(e[n],t[n]):e[n]=K(t[n])}),e}function mr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&hr(t[n],e[n])})}f(ur.prototype,((Jn={add:function(e){return lr(this,e),this},addKey:function(e){return cr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return cr(t,e,e)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&Bt(t.from,e)<=0&&Bt(t.to,e)>=0}})[F]=function(){return fr(this)},Jn));var yr={},vr={},br=!1;function wr(e,t){gr(vr,e),br||(br=!0,setTimeout(function(){br=!1;var e=vr;vr={},kr(e,!1)},0))}function kr(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(yr);r<i.length;r++)xr(a=i[r],e,n,t);else for(var o in e){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var a,u=s[1],c=s[2];(a=yr["idb://".concat(u,"/").concat(c)])&&xr(a,e,n,t)}}n.forEach(function(e){return e()})}function xr(e,t,n,r){for(var i=[],o=0,s=Object.entries(e.queries.query);o<s.length;o++){for(var a=s[o],u=a[0],c=[],l=0,h=a[1];l<h.length;l++){var f=h[l];mr(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&c.push(f)}r&&i.push([u,c])}if(r)for(var d=0,p=i;d<p.length;d++){var g=p[d];u=g[0],c=g[1],e.queries.query[u]=c}}function _r(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?mt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}var a=t.dbReadyResolve,u=null,c=!1,l=function(){return new Te(function(r,a){if(s(),!n)throw new ee.MissingAPI;var h=e.name,f=t.autoSchema||!i?n.open(h):n.open(h,i);if(!f)throw new ee.MissingAPI;f.onerror=dn(a),f.onblocked=Xe(e._fireOnBlocked),f.onupgradeneeded=Xe(function(r){if(u=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=pn,u.abort(),f.result.close();var i=n.deleteDatabase(h);i.onsuccess=i.onerror=Xe(function(){a(new ee.NoSuchDatabase("Database ".concat(h," doesnt exist")))})}else{u.onerror=dn(a);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;c=s<1,e.idbdb=f.result,o&&Rn(e,u),Mn(e,s/10,u,a)}},a),f.onsuccess=Xe(function(){u=null;var n=e.idbdb=f.result,s=b(n.objectStoreNames);if(s.length>0)try{var a=n.transaction(_n(s),"readonly");if(t.autoSchema)Qn(e,n,a);else if(Yn(e,e._dbSchema,a),!Gn(e,a)&&!o)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),n.close(),i=n.version+1,o=!0,r(l());In(e,a)}catch(e){}_t.push(e),n.onversionchange=Xe(function(n){t.vcFired=!0,e.on("versionchange").fire(n)}),n.onclose=Xe(function(){e.close({disableAutoOpen:!1})}),c&&rr(e._deps,h),r()},a)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(i>0)return i=0,l()}return Te.reject(e)})};return Te.race([r,("undefined"==typeof navigator?Te.resolve():sr()).then(l)]).then(function(){return s(),t.onReadyBeingFired=[],Te.resolve(or(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(fe,ie);return t.onReadyBeingFired=[],Te.resolve(or(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{u&&u.abort()}catch(e){}return r===t.openCanceller&&e._close(),mt(n)}).finally(function(){t.openComplete=!0,a()}).then(function(){if(c){var t={};e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new ur(-1/0,[[[]]]))}),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new ur(-1/0,[[[]]])}),yn(gn).fire(t),kr(t,!0)}return e})}function Ar(e){var t=function(t){return e.next(t)},n=function(t){return e.throw(t)},r=o(t),i=o(n);function o(e){return function(t){var n=e(t),o=n.value;return n.done?o:o&&"function"==typeof o.then?o.then(r,i):a(o)?Promise.all(o).then(r,i):r(o)}}return o(t)()}function Er(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,C(i),n]}function Sr(e,t,n,r,i){return Te.resolve().then(function(){var o=Ke.transless||Ke,s=e._createTransaction(t,n,e._dbSchema,r);s.explicit=!0;var a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return Sr(e,t,n,null,i)})):mt(r)}var u,c=U(i);c&&st();var l=Te.follow(function(){if(u=i.call(s,s))if(c){var e=at.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Ar(u))},a);return(u&&"function"==typeof u.then?Te.resolve(u).then(function(e){return s.active?e:mt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):l.then(function(){return u})).then(function(e){return r&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),mt(e)})})}function Pr(e,t,n){for(var r=a(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Or(e){return r(r({},e),{table:function(t){var n=e.table(t),i=n.schema,o={},s=[];function a(e,t,n){var i=Cn(e),u=o[i]=o[i]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,h=r(r({},n),{name:l?"".concat(i,"(virtual-from:").concat(n.name,")"):n.name,lowLevelIndex:n,isVirtual:l,keyTail:t,keyLength:c,extractKey:En(e),unique:!l&&n.unique});return u.push(h),h.isPrimaryKey||s.push(h),c>1&&a(2===c?e[0]:e.slice(0,c-1),t+1,n),u.sort(function(e,t){return e.keyTail-t.keyTail}),h}var u=a(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var c=0,l=i.indexes;c<l.length;c++){var h=l[c];a(h.keyPath,0,h)}function f(e){var t=o[Cn(e)];return t&&t[0]}function d(t,n){return{type:1===t.type?2:t.type,lower:Pr(t.lower,t.lowerOpen?e.MAX_KEY:e.MIN_KEY,n),lowerOpen:!0,upper:Pr(t.upper,t.upperOpen?e.MIN_KEY:e.MAX_KEY,n),upperOpen:!0}}function p(e){var t=e.query.index;return t.isVirtual?r(r({},e),{query:{index:t.lowLevelIndex,range:d(e.query.range,t.keyTail)}}):e}var g=r(r({},n),{schema:r(r({},i),{primaryKey:u,indexes:s,getIndexByKeyPath:f}),count:function(e){return n.count(p(e))},query:function(e){return n.query(p(e))},openCursor:function(t){var r=t.query.index,i=r.keyTail,o=r.isVirtual,s=r.keyLength;if(!o)return n.openCursor(t);function a(n){function r(r){null!=r?n.continue(Pr(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}var o=Object.create(n,{continue:{value:r},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Pr(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:function(){return n.value}}});return o}return n.openCursor(p(t)).then(function(e){return e&&a(e)})}});return g}})}var Cr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Or};function jr(e,t,n,r){return n=n||{},r=r||"",s(e).forEach(function(i){if(h(t,i)){var o=e[i],s=t[i];if("object"==typeof o&&"object"==typeof s&&o&&s){var a=R(o);a!==R(s)?n[r+i]=t[i]:"Object"===a?jr(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}else n[r+i]=void 0}),s(t).forEach(function(i){h(e,i)||(n[r+i]=t[i])}),n}function Br(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Kr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return r(r({},e),{table:function(t){var n=e.table(t),o=n.schema.primaryKey,s=r(r({},n),{mutate:function(e){var s=Ke.trans,a=s.table(t).hook,u=a.deleting,c=a.creating,l=a.updating;switch(e.type){case"add":if(c.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"put":if(c.fire===ie&&l.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"delete":if(u.fire===ie)break;return s._promise("readwrite",function(){return f(e)},!0);case"deleteRange":if(u.fire===ie)break;return s._promise("readwrite",function(){return d(e)},!0)}return n.mutate(e);function f(e){var t=Ke.trans,s=e.keys||Br(o,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?r(r({},e),{keys:s}):r({},e)).type&&(e.values=i([],e.values,!0)),e.keys&&(e.keys=i([],e.keys,!0)),Ir(n,e,s).then(function(r){var i=s.map(function(n,i){var s=r[i],a={onerror:null,onsuccess:null};if("delete"===e.type)u.fire.call(a,n,s,t);else if("add"===e.type||void 0===s){var f=c.fire.call(a,n,e.values[i],t);null==n&&null!=f&&(n=f,e.keys[i]=n,o.outbound||E(e.values[i],o.keyPath,n))}else{var d=jr(s,e.values[i]),p=l.fire.call(a,d,n,s,t);if(p){var g=e.values[i];Object.keys(p).forEach(function(e){h(g,e)?g[e]=p[e]:E(g,e,p[e])})}}return a});return n.mutate(e).then(function(t){for(var n=t.failures,o=t.results,a=t.numFailures,u=t.lastResult,c=0;c<s.length;++c){var l=o?o[c]:s[c],h=i[c];null==l?h.onerror&&h.onerror(n[c]):h.onsuccess&&h.onsuccess("put"===e.type&&r[c]?e.values[c]:l)}return{failures:n,results:o,numFailures:a,lastResult:u}}).catch(function(e){return i.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}function d(e){return p(e.trans,e.range,1e4)}function p(e,t,i){return n.query({trans:e,values:!1,query:{index:o,range:t},limit:i}).then(function(n){var o=n.result;return f({type:"delete",keys:o,trans:e}).then(function(n){return n.numFailures>0?Promise.reject(n.failures[0]):o.length<i?{failures:[],numFailures:0,lastResult:void 0}:p(e,r(r({},t),{lower:o[o.length-1],lowerOpen:!0}),i)})})}}});return s}})}};function Ir(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function Dr(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Bt(t.keys[i],e[o])&&(r.push(n?q(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(e){return null}}var qr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return r(r({},n),{getMany:function(e){if(!e.cache)return n.getMany(e);var t=Dr(e.keys,e.trans._cache,"clone"===e.cache);return t?Te.resolve(t):n.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?q(t):t},t})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),n.mutate(e)}})}}}};function Tr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function Mr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Rr={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new ur(e.MIN_KEY,e.MAX_KEY);return r(r({},e),{transaction:function(t,n,r){if(Ke.subscr&&"readonly"!==n)throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ke.querier));return e.transaction(t,n,r)},table:function(i){var o=e.table(i),u=o.schema,c=u.primaryKey,l=u.indexes,h=c.extractKey,f=c.outbound,d=c.autoIncrement&&l.filter(function(e){return e.compound&&e.keyPath.includes(c.keyPath)}),p=r(r({},o),{mutate:function(r){var s,l,h=r.trans,f=r.mutatedParts||(r.mutatedParts={}),p=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return f[n]||(f[n]=new ur)},g=p(""),m=p(":dels"),y=r.type,v="deleteRange"===r.type?[r.range]:"delete"===r.type?[r.keys]:r.values.length<50?[Br(c,r).filter(function(e){return e}),r.values]:[],b=v[0],w=v[1],k=r.trans._cache;if(a(b)){g.addKeys(b);var x="delete"===y||b.length===w.length?Dr(b,k):null;x||m.addKeys(b),(x||w)&&Fr(p,u,x,w)}else if(b){var _={from:null!==(s=b.lower)&&void 0!==s?s:e.MIN_KEY,to:null!==(l=b.upper)&&void 0!==l?l:e.MAX_KEY};m.add(_),g.add(_)}else g.add(n),m.add(n),u.indexes.forEach(function(e){return p(e.name).add(n)});return o.mutate(r).then(function(e){return!b||"add"!==r.type&&"put"!==r.type||(g.addKeys(e.results),d&&d.forEach(function(t){for(var n=r.values.map(function(e){return t.extractKey(e)}),i=t.keyPath.findIndex(function(e){return e===c.keyPath}),o=0,s=e.results.length;o<s;++o)n[o][i]=e.results[o];p(t.name).addKeys(n)})),h.mutatedParts=gr(h.mutatedParts||{},f),e})}}),g=function(t){var n,r,i=t.query,o=i.index,s=i.range;return[o,new ur(null!==(n=s.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=s.upper)&&void 0!==r?r:e.MAX_KEY)]},m={get:function(e){return[c,new ur(e.key)]},getMany:function(e){return[c,(new ur).addKeys(e.keys)]},count:g,query:g,openCursor:g};return s(m).forEach(function(e){p[e]=function(s){var a=Ke.subscr,u=!!a,c=Tr(Ke,o)&&Mr(e,s)?s.obsSet={}:a;if(u){var l=function(e){var n="idb://".concat(t,"/").concat(i,"/").concat(e);return c[n]||(c[n]=new ur)},d=l(""),p=l(":dels"),g=m[e](s),y=g[0],v=g[1];if("query"===e&&y.isPrimaryKey&&!s.values?p.add(v):l(y.name||"").add(v),!y.isPrimaryKey){if("count"!==e){var b="query"===e&&f&&s.values&&o.query(r(r({},s),{values:!1}));return o[e].apply(this,arguments).then(function(t){if("query"===e){if(f&&s.values)return b.then(function(e){var n=e.result;return d.addKeys(n),t});var n=s.values?t.result.map(h):t.result;s.values?d.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,i=s.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return i&&d.addKey(r.primaryKey),r.value}}})}return t})}p.add(n)}}return o[e].apply(this,arguments)}}),p}})}};function Fr(e,t,n,r){function i(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var s=function(e){return t.multiEntry&&a(e)?e.forEach(function(e){return i.addKey(e)}):i.addKey(e)};(n||r).forEach(function(e,t){var i=n&&o(n[t]),a=r&&o(r[t]);0!==Bt(i,a)&&(null!=i&&s(i),null!=a&&s(a))})}t.indexes.forEach(i)}function zr(e,t,n){if(0===n.numFailures)return t;if("deleteRange"===t.type)return null;var i=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(n.numFailures===i)return null;var o=r({},t);return a(o.keys)&&(o.keys=o.keys.filter(function(e,t){return!(t in n.failures)})),"values"in o&&a(o.values)&&(o.values=o.values.filter(function(e,t){return!(t in n.failures)})),o}function Nr(e,t){return void 0===t.lower||(t.lowerOpen?Bt(e,t.lower)>0:Bt(e,t.lower)>=0)}function Lr(e,t){return void 0===t.upper||(t.upperOpen?Bt(e,t.upper)<0:Bt(e,t.upper)<=0)}function $r(e,t){return Nr(e,t)&&Lr(e,t)}function Ur(e,t,n,r,i,o){if(!n||0===n.length)return e;var s=t.query.index,u=s.multiEntry,c=t.query.range,l=r.schema.primaryKey.extractKey,h=s.extractKey,f=(s.lowLevelIndex||s).extractKey,d=n.reduce(function(e,n){var r=e,i=[];if("add"===n.type||"put"===n.type)for(var o=new ur,s=n.values.length-1;s>=0;--s){var f=n.values[s],d=l(f);if(!o.hasKey(d)){var p=h(f);(u&&a(p)?p.some(function(e){return $r(e,c)}):$r(p,c))&&(o.addKey(d),i.push(f))}}switch(n.type){case"add":var g=(new ur).addKeys(t.values?e.map(function(e){return l(e)}):e);r=e.concat(t.values?i.filter(function(e){var t=l(e);return!g.hasKey(t)&&(g.addKey(t),!0)}):i.map(function(e){return l(e)}).filter(function(e){return!g.hasKey(e)&&(g.addKey(e),!0)}));break;case"put":var m=(new ur).addKeys(n.values.map(function(e){return l(e)}));r=e.filter(function(e){return!m.hasKey(t.values?l(e):e)}).concat(t.values?i:i.map(function(e){return l(e)}));break;case"delete":var y=(new ur).addKeys(n.keys);r=e.filter(function(e){return!y.hasKey(t.values?l(e):e)});break;case"deleteRange":var v=n.range;r=e.filter(function(e){return!$r(l(e),v)})}return r},e);return d===e?e:(d.sort(function(e,t){return Bt(f(e),f(t))||Bt(l(e),l(t))}),t.limit&&t.limit<1/0&&(d.length>t.limit?d.length=t.limit:e.length===t.limit&&d.length<t.limit&&(i.dirty=!0)),o?Object.freeze(d):d)}function Wr(e,t){return 0===Bt(e.lower,t.lower)&&0===Bt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Vr(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var i=Bt(e,t);if(0===i){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function Qr(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var i=Bt(e,t);if(0===i){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Gr(e,t){return Vr(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&Qr(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Yr(e,t,n,r){var i=yr["idb://".concat(e,"/").concat(t)];if(!i)return[];var o=i.queries[n];if(!o)return[null,!1,i,null];var s=o[(r.query?r.query.index.name:null)||""];if(!s)return[null,!1,i,null];switch(n){case"query":var a=s.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Wr(e.req.query.range,r.query.range)});return a?[a,!0,i,s]:[s.find(function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&Gr(e.req.query.range,r.query.range)}),!1,i,s];case"count":var u=s.find(function(e){return Wr(e.req.query.range,r.query.range)});return[u,!!u,i,s]}}function Hr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){e.subscribers.delete(n),0===e.subscribers.size&&Jr(e,t)})}function Jr(e,t){setTimeout(function(){0===e.subscribers.size&&N(t,e)},3e3)}var Xr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,n=r(r({},e),{transaction:function(n,r,i){var o=e.transaction(n,r,i);if("readwrite"===r){var s=new AbortController,a=s.signal,u=function(i){return function(){if(s.abort(),"readwrite"===r){for(var a=new Set,u=0,c=n;u<c.length;u++){var l=c[u],h=yr["idb://".concat(t,"/").concat(l)];if(h){var f=e.table(l),d=h.optimisticOps.filter(function(e){return e.trans===o});if(o._explicit&&i&&o.mutatedParts)for(var p=0,g=Object.values(h.queries.query);p<g.length;p++)for(var m=0,y=(w=g[p]).slice();m<y.length;m++)mr((_=y[m]).obsSet,o.mutatedParts)&&(N(w,_),_.subscribers.forEach(function(e){return a.add(e)}));else if(d.length>0){h.optimisticOps=h.optimisticOps.filter(function(e){return e.trans!==o});for(var v=0,b=Object.values(h.queries.query);v<b.length;v++)for(var w,k=0,x=(w=b[v]).slice();k<x.length;k++){var _;if(null!=(_=x[k]).res&&o.mutatedParts)if(i&&!_.dirty){var A=Object.isFrozen(_.res),E=Ur(_.res,_.req,d,f,_,A);_.dirty?(N(w,_),_.subscribers.forEach(function(e){return a.add(e)})):E!==_.res&&(_.res=E,_.promise=Te.resolve({result:E}))}else _.dirty&&N(w,_),_.subscribers.forEach(function(e){return a.add(e)})}}}}a.forEach(function(e){return e()})}}};o.addEventListener("abort",u(!1),{signal:a}),o.addEventListener("error",u(!1),{signal:a}),o.addEventListener("complete",u(!0),{signal:a})}return o},table:function(n){var i=e.table(n),o=i.schema.primaryKey,s=r(r({},i),{mutate:function(e){var s=Ke.trans;if(o.outbound||"disabled"===s.db._options.cache||s.explicit||"readwrite"!==s.idbtrans.mode)return i.mutate(e);var a=yr["idb://".concat(t,"/").concat(n)];if(!a)return i.mutate(e);var u=i.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Br(o,e).some(function(e){return null==e}))?(a.optimisticOps.push(e),e.mutatedParts&&wr(e.mutatedParts),u.then(function(t){if(t.numFailures>0){N(a.optimisticOps,e);var n=zr(a,e,t);n&&a.optimisticOps.push(n),e.mutatedParts&&wr(e.mutatedParts)}}),u.catch(function(){N(a.optimisticOps,e),e.mutatedParts&&wr(e.mutatedParts)})):u.then(function(t){var n=r(r({},e),{values:e.values.map(function(e,n){var i;if(t.failures[n])return e;var s=(null===(i=o.keyPath)||void 0===i?void 0:i.includes("."))?q(e):r({},e);return E(s,o.keyPath,t.results[n]),s})}),i=zr(a,n,t);a.optimisticOps.push(i),queueMicrotask(function(){return e.mutatedParts&&wr(e.mutatedParts)})}),u},query:function(e){var r;if(!Tr(Ke,i)||!Mr("query",e))return i.query(e);var o="immutable"===(null===(r=Ke.trans)||void 0===r?void 0:r.db._options.cache),s=Ke,a=s.requery,u=s.signal,c=Yr(t,n,"query",e),l=c[0],h=c[1],f=c[2],d=c[3];if(l&&h)l.obsSet=e.obsSet;else{var p=i.query(e).then(function(e){var t=e.result;if(l&&(l.res=t),o){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=q(t);return e}).catch(function(e){return d&&l&&N(d,l),Promise.reject(e)});l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},d?d.push(l):(d=[l],f||(f=yr["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),f.queries.query[e.query.index.name||""]=d)}return Hr(l,d,a,u),l.promise.then(function(t){return{result:Ur(t.result,e,null==f?void 0:f.optimisticOps,i,l,o)}})}});return s}});return n}};function Zr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var ei,ti=function(){function e(t,n){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=n=r({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var s=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};a.dbReadyPromise=new Te(function(e){a.dbReadyResolve=e}),a.openCanceller=new Te(function(e,t){a.cancelOpen=t}),this._state=a,this.name=t,this.on=zt(this,"populate","blocked","versionchange","close",{ready:[fe,ie]}),this.once=function(e,t){var n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];i.on(e).unsubscribe(n),t.apply(i,r)};return i.on(e,n)},this.on.ready.subscribe=w(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||Te.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t(function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)})}})}}),this.Collection=Zt(this),this.Table=Lt(this),this.Transaction=bn(this),this.Version=Zn(this),this.WhereClause=fn(this),this.on("versionchange",function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(i.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(i.name,"'. Closing db now to resume the delete request.")),i.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(i.name,"') was blocked")):console.warn("Upgrade '".concat(i.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=An(n.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),_t.filter(function(e){return e.name===i.name&&e!==i&&!e._state.vcFired}).map(function(t){return t.on("versionchange").fire(e)})},this.use(qr),this.use(Xr),this.use(Rr),this.use(Cr),this.use(Kr);var u=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return Zr(i.table(e),u)};var r=Reflect.get(e,t,n);return r instanceof Ft?Zr(r,u):"tables"===t?r.map(function(e){return Zr(e,u)}):"_createTransaction"===t?function(){return Zr(r.apply(this,arguments),u)}:r}});this.vip=u,s.forEach(function(e){return e(i)})}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Tn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Ke.letThrough||this._vip)?e():new Te(function(e,n){if(t._state.openComplete)return n(new ee.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new ee.DatabaseClosed);t.open().catch(ie)}t._state.dbReadyPromise.then(e,n)}).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort(function(e,t){return e.level-t.level}),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},e.prototype.open=function(){var e=this;return dt(Be,function(){return _r(e)})},e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=_t.indexOf(this);if(t>=0&&_t.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Te(function(t){e.dbReadyResolve=t}),e.openCanceller=new Te(function(t,n){e.cancelOpen=n}))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new ee.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new ee.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new Te(function(i,o){var s=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Xe(function(){ir(t._deps,t.name),i()}),n.onerror=dn(o),n.onblocked=t._fireOnBlocked};if(n)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return s(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Er.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=Ke.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,s,a=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map(function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}),"r"==e||e===Et)o=Et;else{if("rw"!=e&&e!=St)throw new ee.InvalidArgument("Invalid transaction mode: "+e);o=St}if(i){if(i.mode===Et&&o===St){if(!a)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!a)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");i=null}}),a&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):mt(e)}var u=Sr.bind(null,this,o,s,i,n);return i?i._promise(o,u,"lock"):Ke.trans?dt(Ke.transless,function(){return r._whenReady(u)}):this._whenReady(u)},e.prototype.table=function(e){if(!h(this._allTables,e))throw new ee.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),ni="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ri=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[ni]=function(){return this},e}();try{ei={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch(e){ei={indexedDB:null,IDBKeyRange:null}}function ii(e){var t,n=!1,r=new ri(function(r){var i=U(e);function o(t){var n=We();try{i&&st();var r=ot(e,t);return i&&(r=r.finally(at)),r}finally{n&&Ve()}}var s,a=!1,u={},c={},l={get closed(){return a},unsubscribe:function(){a||(a=!0,s&&s.abort(),h&&yn.storagemutated.unsubscribe(p))}};r.start&&r.start(l);var h=!1,f=function(){return gt(g)};function d(){return mr(c,u)}var p=function(e){gr(u,e),d()&&f()},g=function(){if(!a&&ei.indexedDB){u={};var i={};s&&s.abort(),s=new AbortController;var l={subscr:i,signal:s.signal,requery:f,querier:e,trans:null},d=o(l);Promise.resolve(d).then(function(e){n=!0,t=e,a||l.signal.aborted||(u={},I(c=i)||h||(yn(gn,p),h=!0),gt(function(){return!a&&r.next&&r.next(e)}))},function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||gt(function(){a||r.error&&r.error(e)})})}};return setTimeout(f,0),l});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var oi=ti;function si(e){var t=ui;try{ui=!0,yn.storagemutated.fire(e),kr(e,!0)}finally{ui=t}}f(oi,r(r({},re),{delete:function(e){return new oi(e,{addons:[]}).delete()},exists:function(e){return new oi(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return nr(oi.dependencies).then(e)}catch(e){return mt(new ee.MissingAPI)}},defineClass:function(){function e(e){u(this,e)}return e},ignoreTransaction:function(e){return Ke.trans?dt(Ke.transless,e):e()},vip:or,async:function(e){return function(){try{var t=Ar(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Te.resolve(t)}catch(e){return mt(e)}}},spawn:function(e,t,n){try{var r=Ar(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Te.resolve(r)}catch(e){return mt(e)}},currentTransaction:{get:function(){return Ke.trans||null}},waitFor:function(e,t){var n=Te.resolve("function"==typeof e?oi.ignoreTransaction(e):e).timeout(t||6e4);return Ke.trans?Ke.trans.waitFor(n):n},Promise:Te,debug:{get:function(){return de},set:function(e){pe(e)}},derive:g,extend:u,props:f,override:w,Events:zt,on:yn,liveQuery:ii,extendObservabilitySet:gr,getByKeyPath:A,setByKeyPath:E,delByKeyPath:S,shallowClone:P,deepClone:q,getObjectDiff:jr,cmp:Bt,asap:x,minKey:wt,addons:[],connections:_t,errnames:X,dependencies:ei,cache:yr,semVer:vt,version:vt.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),oi.maxKey=An(oi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(yn(gn,function(e){var t;ui||(t=new CustomEvent(mn,{detail:e}),ui=!0,dispatchEvent(t),ui=!1)}),addEventListener(mn,function(e){var t=e.detail;ui||si(t)}));var ai,ui=!1,ci=function(){};function li(e){return new Mt({add:e})}function hi(e){return new Mt({remove:e})}function fi(e,t){return new Mt({replacePrefix:[e,t]})}return"undefined"!=typeof BroadcastChannel&&((ci=function(){(ai=new BroadcastChannel(mn)).onmessage=function(e){return e.data&&si(e.data)}})(),"function"==typeof ai.unref&&ai.unref(),yn(gn,function(e){ui||ai.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!ti.disableBfCache&&e.persisted){de&&console.debug("Dexie: handling persisted pagehide"),null==ai||ai.close();for(var t=0,n=_t;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!ti.disableBfCache&&e.persisted&&(de&&console.debug("Dexie: handling persisted pageshow"),ci(),si({all:new ur(-1/0,[[]])}))})),Te.rejectionMapper=ne,pe(de),r(ti,Object.freeze({__proto__:null,Dexie:ti,liveQuery:ii,Entity:jt,cmp:Bt,PropModification:Mt,replacePrefix:fi,add:li,remove:hi,default:ti,RangeSet:ur,mergeRanges:lr,rangesOverlap:hr}),{default:ti}),ti}();var r=t(n.exports);const i=Symbol.for("Dexie"),o=globalThis[i]||(globalThis[i]=r);if(r.semVer!==o.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${r.semVer} and ${o.semVer}`);const s=new o("BookmarkInsightsDB");s.version(1).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}),s.version(2).stores({bookmarks:"id, url, title, domain, category, dateAdded, lastAccessed, lastChecked, isAlive, parentId",enrichmentQueue:"++queueId, bookmarkId, addedAt, priority",events:"++eventId, bookmarkId, type, timestamp",cache:"key",settings:"key"}).upgrade(e=>{console.log("Upgrading database to version 2 - adding rawMetadata support")});const a={enrichmentEnabled:!0,enrichmentSchedule:"manual",enrichmentBatchSize:20,enrichmentConcurrency:3,enrichmentRateLimit:1e3,autoCategorizationEnabled:!0,deadLinkCheckEnabled:!0,privacyMode:!1,trackBrowsingBehavior:!1};async function u(){try{await s.settings.get("app")||await s.settings.put({key:"app",...a})}catch(e){console.error("Error initializing settings:",e)}}async function c(){try{return await s.settings.get("app")||a}catch(e){return console.error("Error getting settings:",e),a}}async function l(){try{const e=await s.settings.get("migration");if(e&&e.completed)return console.log("Migration already completed"),{success:!0,alreadyMigrated:!0};console.log("Starting migration from chrome.storage.local to IndexedDB...");const t=await chrome.storage.local.get(["bookmarks","lastSyncTime"]),n=t.bookmarks||[];if(0===n.length)return console.log("No bookmarks to migrate"),await s.settings.put({key:"migration",completed:!0,timestamp:Date.now(),count:0}),{success:!0,count:0};const r=n.map(e=>({...e,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0}));return await s.bookmarks.bulkPut(r),await s.settings.put({key:"migration",completed:!0,timestamp:Date.now(),count:r.length,oldSyncTime:t.lastSyncTime}),console.log(`Successfully migrated ${r.length} bookmarks`),{success:!0,count:r.length}}catch(e){return console.error("Migration error:",e),{success:!1,error:e.message}}}async function h(){try{return await s.bookmarks.toArray()}catch(e){return console.error("Error getting bookmarks:",e),[]}}async function f(e){try{return await s.bookmarks.get(e)}catch(e){return console.error("Error getting bookmark:",e),null}}async function d(e){try{return await s.bookmarks.put(e),!0}catch(e){return console.error("Error upserting bookmark:",e),!1}}async function p(e){try{return await s.bookmarks.bulkPut(e),!0}catch(e){return console.error("Error bulk upserting bookmarks:",e),!1}}async function g(e){try{return await s.bookmarks.delete(e),!0}catch(e){return console.error("Error deleting bookmark:",e),!1}}async function m(e,t,n={}){try{return await s.events.add({bookmarkId:e,type:t,timestamp:Date.now(),...n}),!0}catch(e){return console.error("Error logging event:",e),!1}}async function y(e,t,n=null){try{return await s.cache.put({key:e,value:t,timestamp:Date.now(),ttl:n}),!0}catch(e){return console.error("Error setting cache:",e),!1}}async function v(e){try{const t=await s.cache.get(e);return t?t.ttl&&Date.now()-t.timestamp>t.ttl?(await s.cache.delete(e),null):t.value:null}catch(e){return console.error("Error getting cache:",e),null}}async function b(e,t=0){try{return!await s.enrichmentQueue.where("bookmarkId").equals(e).first()&&(await s.enrichmentQueue.add({bookmarkId:e,addedAt:Date.now(),priority:t}),!0)}catch(e){return console.error("Error adding to enrichment queue:",e),!1}}async function w(e=20){try{return await s.enrichmentQueue.orderBy("priority").reverse().limit(e).toArray()}catch(e){return console.error("Error getting enrichment batch:",e),[]}}async function k(e){try{return await s.enrichmentQueue.delete(e),!0}catch(e){return console.error("Error removing from enrichment queue:",e),!1}}async function x(){try{await u();const e=await l();return console.log("Database initialized",e),e}catch(e){return console.error("Error initializing database:",e),{success:!1,error:e.message}}}var _=Object.freeze({__proto__:null,addToEnrichmentQueue:b,bulkUpsertBookmarks:p,clearCache:async function(e=null){try{if(e){const t=(await s.cache.toArray()).filter(t=>t.key.includes(e)).map(e=>e.key);await s.cache.bulkDelete(t)}else await s.cache.clear();return!0}catch(e){return console.error("Error clearing cache:",e),!1}},clearEnrichmentQueue:async function(){try{return await s.enrichmentQueue.clear(),!0}catch(e){return console.error("Error clearing enrichment queue:",e),!1}},db:s,deleteBookmark:g,getActivityTimeline:async function(){try{const e=await s.bookmarks.toArray(),t={};return e.forEach(e=>{const n=new Date(e.dateAdded),r=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;t[r]=(t[r]||0)+1}),Object.entries(t).sort()}catch(e){return console.error("Error getting activity timeline:",e),[]}},getAllBookmarks:h,getBookmark:f,getBookmarkEvents:async function(e,t=50){try{return await s.events.where("bookmarkId").equals(e).reverse().limit(t).toArray()}catch(e){return console.error("Error getting bookmark events:",e),[]}},getBookmarksByCategory:async function(e){try{return await s.bookmarks.where("category").equals(e).toArray()}catch(e){return console.error("Error getting bookmarks by category:",e),[]}},getBookmarksByDateRange:async function(e,t){try{return await s.bookmarks.where("dateAdded").between(e,t,!0,!0).toArray()}catch(e){return console.error("Error getting bookmarks by date range:",e),[]}},getBookmarksByDomain:async function(e){try{return await s.bookmarks.where("domain").equals(e).toArray()}catch(e){return console.error("Error getting bookmarks by domain:",e),[]}},getCache:v,getDomainStats:async function(){try{const e=await s.bookmarks.toArray(),t={};return e.forEach(e=>{e.domain&&(t[e.domain]=(t[e.domain]||0)+1)}),Object.entries(t).sort(([,e],[,t])=>t-e).slice(0,10)}catch(e){return console.error("Error getting domain stats:",e),[]}},getEnrichmentQueueSize:async function(){try{return await s.enrichmentQueue.count()}catch(e){return console.error("Error getting queue size:",e),0}},getNextEnrichmentBatch:w,getRecentEvents:async function(e=100){try{return await s.events.orderBy("timestamp").reverse().limit(e).toArray()}catch(e){return console.error("Error getting recent events:",e),[]}},getSettings:c,getUniqueCategories:async function(){try{const e=await s.bookmarks.toArray();return[...new Set(e.map(e=>e.category).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique categories:",e),[]}},getUniqueDomains:async function(){try{const e=await s.bookmarks.toArray();return[...new Set(e.map(e=>e.domain).filter(e=>e))].sort()}catch(e){return console.error("Error getting unique domains:",e),[]}},initializeDatabase:x,initializeSettings:u,logEvent:m,migrateFromChromeStorage:l,removeFromEnrichmentQueue:k,searchBookmarks:async function(e){try{if(!e||!e.trim())return await s.bookmarks.orderBy("dateAdded").reverse().toArray();const t=e.toLowerCase();return(await s.bookmarks.toArray()).filter(e=>e.title.toLowerCase().includes(t)||e.url.toLowerCase().includes(t)||e.domain&&e.domain.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.keywords&&e.keywords.some(e=>e.toLowerCase().includes(t))).sort((e,t)=>t.dateAdded-e.dateAdded)}catch(e){return console.error("Search error:",e),[]}},setCache:y,updateSettings:async function(e){try{const t=await c();return await s.settings.put({key:"app",...t,...e}),!0}catch(e){return console.error("Error updating settings:",e),!1}},upsertBookmark:d});const A={"github.com":"code","gitlab.com":"code","bitbucket.org":"code","stackoverflow.com":"code","stackexchange.com":"code","youtube.com":"video","vimeo.com":"video","youtu.be":"video","twitter.com":"social","facebook.com":"social","linkedin.com":"social","instagram.com":"social","reddit.com":"social","medium.com":"blog","dev.to":"blog","hashnode.com":"blog","substack.com":"blog","wikipedia.org":"reference","mdn.mozilla.org":"reference","w3schools.com":"reference","amazon.com":"shopping","ebay.com":"shopping","etsy.com":"shopping"},E={"/docs":"documentation","/documentation":"documentation","/api":"api","/reference":"reference","/tutorial":"tutorial","/guide":"tutorial","/blog":"blog","/article":"blog","/video":"video","/watch":"video"},S={tutorial:"tutorial",guide:"tutorial","how to":"tutorial",documentation:"documentation",docs:"documentation",api:"api",reference:"reference",blog:"blog",article:"blog",news:"news",video:"video",course:"education",learning:"education",tool:"tool",app:"tool",software:"tool"};async function P(e){try{const t=await f(e);if(!t)return console.log(`Bookmark ${e} not found`),{success:!1,error:"Bookmark not found"};if(!t.url.startsWith("http://")&&!t.url.startsWith("https://"))return console.log(`Skipping non-http bookmark: ${t.url}`),{success:!1,error:"Not an HTTP URL",skipped:!0};if(t.description||t.category)return console.log(`Skipping already enriched bookmark: ${t.title}`),{success:!0,skipped:!0,alreadyEnriched:!0};console.log(`Enriching bookmark: ${t.title} (${t.url})`);const n=await async function(e){try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),r=await fetch(e,{method:"HEAD",signal:t.signal,redirect:"follow"});return clearTimeout(n),r.ok||r.status>=300&&r.status<400}catch(t){if("AbortError"===t.name)return console.log(`Timeout checking ${e}`),null;try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3);return await fetch(e,{method:"GET",mode:"no-cors",signal:t.signal}),clearTimeout(n),null}catch(t){return console.log(`Error checking ${e}:`,t.message),!1}}}(t.url);if(!1===n)return t.isAlive=!1,t.lastChecked=Date.now(),await d(t),await m(e,"enrichment",{isAlive:!1}),{success:!0,isAlive:!1,skipped:!0};const r=await async function(e){try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),r=await fetch(e,{signal:t.signal,redirect:"follow"});if(clearTimeout(n),!r.ok)return{};const i=await r.text(),o={meta:{},openGraph:{},twitterCard:{},jsonLd:[],other:{}},s=/<meta\s+([^>]*?)>/gi;let a;for(;null!==(a=s.exec(i));){const e=a[1],t=e.match(/(?:name|property)=["']([^"']+)["']/i),n=e.match(/content=["']([^"']+)["']/i);if(t&&n){const e=t[1],r=n[1];e.startsWith("og:")?o.openGraph[e]=r:e.startsWith("twitter:")?o.twitterCard[e]=r:o.meta[e]=r}}const u=/<script\s+type=["']application\/ld\+json["']>(.*?)<\/script>/gis;let c;for(;null!==(c=u.exec(i));)try{const e=JSON.parse(c[1]);o.jsonLd.push(e)}catch(e){}const l=i.match(/<title[^>]*>([^<]+)<\/title>/i);l&&(o.other.title=l[1].trim());const h=i.match(/<link\s+rel=["']canonical["']\s+href=["']([^"']+)["']/i)||i.match(/<link\s+href=["']([^"']+)["']\s+rel=["']canonical["']/i);h&&(o.other.canonical=h[1]);const f=i.match(/<html[^>]*\slang=["']([^"']+)["']/i);f&&(o.other.language=f[1]),o.meta.author&&(o.other.author=o.meta.author);const d={description:null,keywords:[],faviconUrl:null,snippet:null,rawMetadata:o};d.description=o.openGraph["og:description"]||o.meta.description||o.twitterCard["twitter:description"]||null,o.meta.keywords&&(d.keywords=o.meta.keywords.split(",").map(e=>e.trim()).filter(e=>e.length>0).slice(0,10));const p=i.match(/<link\s+([^>]*rel=["'](?:icon|shortcut icon)["'][^>]*)>/i);if(p){const t=p[1].match(/href=["']([^"']+)["']/i);if(t)try{d.faviconUrl=new URL(t[1],e).href}catch(e){}}const g=i.match(/<p[^>]*>([^<]+)</i);return g&&(d.snippet=g[1].replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim().substring(0,200)),d}catch(t){return"AbortError"===t.name?console.log(`Timeout fetching metadata for ${e}`):console.error(`Error fetching metadata for ${e}:`,t),{}}}(t.url),i=function(e,t={}){try{const n=new URL(e.url),r=n.hostname.toLowerCase(),i=n.pathname.toLowerCase(),o=e.title.toLowerCase(),s=(t.description||"").toLowerCase();for(const[e,t]of Object.entries(A))if(r.includes(e))return t;for(const[e,t]of Object.entries(E))if(i.includes(e))return t;const a=`${o} ${s}`;for(const[e,t]of Object.entries(S))if(a.includes(e))return t;if(t.keywords&&t.keywords.length>0){const e=t.keywords.join(" ").toLowerCase();for(const[t,n]of Object.entries(S))if(e.includes(t))return n}return null}catch(e){return console.error("Error categorizing bookmark:",e),null}}(t,r);return t.description=r.description||t.description,t.keywords=r.keywords||t.keywords,t.category=i||t.category,t.isAlive=n,t.lastChecked=Date.now(),t.faviconUrl=r.faviconUrl||t.faviconUrl,t.contentSnippet=r.snippet||t.contentSnippet,t.rawMetadata=r.rawMetadata||t.rawMetadata,await d(t),await m(e,"enrichment",{success:!0,category:i,hasDescription:!!r.description}),{success:!0,category:i,description:r.description,isAlive:n}}catch(t){return console.error(`Error enriching bookmark ${e}:`,t),await m(e,"enrichment",{success:!1,error:t.message}),{success:!1,error:t.message}}}function O(e){return new Promise(t=>setTimeout(t,e))}
/**!
 * FlexSearch.js v0.8.212 (Bundle/Module)
 * Author and Copyright: Thomas Wilkerling
 * Licence: Apache-2.0
 * Hosted by Nextapps GmbH
 * https://github.com/nextapps-de/flexsearch
 */var C;function j(e,t,n){const r=typeof n,i=typeof e;if("undefined"!==r){if("undefined"!==i){if(n){if("function"===i&&r===i)return function(t){return e(n(t))};if((t=e.constructor)===n.constructor){if(t===Array)return n.concat(e);if(t===Map){var o=new Map(n);for(var s of e)o.set(s[0],s[1]);return o}if(t===Set){for(o of(s=new Set(n),e.values()))s.add(o);return s}}}return e}return n}return"undefined"===i?t:e}function B(e,t){return void 0===e?t:e}function K(){return Object.create(null)}function I(e){return"string"==typeof e}function D(e){return"object"==typeof e}function q(e,t){if(I(t))e=e[t];else for(let n=0;e&&n<t.length;n++)e=e[t[n]];return e}const T=/[^\p{L}\p{N}]+/u,M=/(\d{3})/g,R=/(\D)(\d{3})/g,F=/(\d{3})(\D)/g,z=/[\u0300-\u036f]/g;function N(e={}){if(!this||this.constructor!==N)return new N(...arguments);if(arguments.length)for(e=0;e<arguments.length;e++)this.assign(arguments[e]);else this.assign(e)}function L(e){e.F=null,e.B.clear(),e.D.clear()}function $(e,t,n){n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):n=e),n&&(e=n.query||e,t=n.limit||t);let r=""+(t||0);n&&(r+=(n.offset||0)+!!n.context+!!n.suggest+(!1!==n.resolve)+(n.resolution||this.resolution)+(n.boost||0)),e=(""+e).toLowerCase(),this.cache||(this.cache=new U);let i=this.cache.get(e+r);if(!i){const o=n&&n.cache;o&&(n.cache=!1),i=this.search(e,t,n),o&&(n.cache=o),this.cache.set(e+r,i)}return i}function U(e){this.limit=e&&!0!==e?e:1e3,this.cache=new Map,this.h=""}(C=N.prototype).assign=function(e){this.normalize=j(e.normalize,!0,this.normalize);let t,n=e.include,r=n||e.exclude||e.split;if(r||""===r){if("object"==typeof r&&r.constructor!==RegExp){let e="";t=!n,n||(e+="\\p{Z}"),r.letter&&(e+="\\p{L}"),r.number&&(e+="\\p{N}",t=!!n),r.symbol&&(e+="\\p{S}"),r.punctuation&&(e+="\\p{P}"),r.control&&(e+="\\p{C}"),(r=r.char)&&(e+="object"==typeof r?r.join(""):r);try{this.split=new RegExp("["+(n?"^":"")+e+"]+","u")}catch(e){this.split=/\s+/}}else this.split=r,t=!1===r||"a1a".split(r).length<2;this.numeric=j(e.numeric,t)}else{try{this.split=j(this.split,T)}catch(e){this.split=/\s+/}this.numeric=j(e.numeric,j(this.numeric,!0))}if(this.prepare=j(e.prepare,null,this.prepare),this.finalize=j(e.finalize,null,this.finalize),r=e.filter,this.filter="function"==typeof r?r:j(r&&new Set(r),null,this.filter),this.dedupe=j(e.dedupe,!0,this.dedupe),this.matcher=j((r=e.matcher)&&new Map(r),null,this.matcher),this.mapper=j((r=e.mapper)&&new Map(r),null,this.mapper),this.stemmer=j((r=e.stemmer)&&new Map(r),null,this.stemmer),this.replacer=j(e.replacer,null,this.replacer),this.minlength=j(e.minlength,1,this.minlength),this.maxlength=j(e.maxlength,1024,this.maxlength),this.rtl=j(e.rtl,!1,this.rtl),(this.cache=r=j(e.cache,!0,this.cache))&&(this.F=null,this.L="number"==typeof r?r:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const e of this.matcher.keys())this.h+=(this.h?"|":"")+e;if(this.stemmer)for(const e of this.stemmer.keys())this.A+=(this.A?"|":"")+e;return this},C.addStemmer=function(e,t){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(e,t),this.A+=(this.A?"|":"")+e,this.K=null,this.cache&&L(this),this},C.addFilter=function(e){return"function"==typeof e?this.filter=e:(this.filter||(this.filter=new Set),this.filter.add(e)),this.cache&&L(this),this},C.addMapper=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length>1?this.addMatcher(e,t):(this.mapper||(this.mapper=new Map),this.mapper.set(e,t),this.cache&&L(this),this)},C.addMatcher=function(e,t){return"object"==typeof e?this.addReplacer(e,t):e.length<2&&(this.dedupe||this.mapper)?this.addMapper(e,t):(this.matcher||(this.matcher=new Map),this.matcher.set(e,t),this.h+=(this.h?"|":"")+e,this.J=null,this.cache&&L(this),this)},C.addReplacer=function(e,t){return"string"==typeof e?this.addMatcher(e,t):(this.replacer||(this.replacer=[]),this.replacer.push(e,t),this.cache&&L(this),this)},C.encode=function(e,t){if(this.cache&&e.length<=this.H)if(this.F){if(this.B.has(e))return this.B.get(e)}else this.F=setTimeout(L,50,this);this.normalize&&(e="function"==typeof this.normalize?this.normalize(e):z?e.normalize("NFKD").replace(z,"").toLowerCase():e.toLowerCase()),this.prepare&&(e=this.prepare(e)),this.numeric&&e.length>3&&(e=e.replace(R,"$1 $2").replace(F,"$1 $2").replace(M,"$1 "));const n=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let r,i,o=[],s=K(),a=this.split||""===this.split?e.split(this.split):[e];for(let e,c,l=0;l<a.length;l++)if((e=c=a[l])&&!(e.length<this.minlength||e.length>this.maxlength)){if(t){if(s[e])continue;s[e]=1}else{if(r===e)continue;r=e}if(n)o.push(e);else if(!this.filter||("function"==typeof this.filter?this.filter(e):!this.filter.has(e))){if(this.cache&&e.length<=this.I)if(this.F){var u=this.D.get(e);if(u||""===u){u&&o.push(u);continue}}else this.F=setTimeout(L,50,this);if(this.stemmer){let t;for(this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));t!==e&&e.length>2;)t=e,e=e.replace(this.K,e=>this.stemmer.get(e))}if(e&&(this.mapper||this.dedupe&&e.length>1)){u="";for(let t,n,r=0,i="";r<e.length;r++)t=e.charAt(r),t===i&&this.dedupe||((n=this.mapper&&this.mapper.get(t))||""===n?n===i&&this.dedupe||!(i=n)||(u+=n):u+=i=t);e=u}if(this.matcher&&e.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),e=e.replace(this.J,e=>this.matcher.get(e))),e&&this.replacer)for(u=0;e&&u<this.replacer.length;u+=2)e=e.replace(this.replacer[u],this.replacer[u+1]);if(this.cache&&c.length<=this.I&&(this.D.set(c,e),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),e){if(e!==c)if(t){if(s[e])continue;s[e]=1}else{if(i===e)continue;i=e}o.push(e)}}}return this.finalize&&(o=this.finalize(o)||o),this.cache&&e.length<=this.H&&(this.B.set(e,o),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),o},U.prototype.set=function(e,t){this.cache.set(this.h=e,t),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)},U.prototype.get=function(e){const t=this.cache.get(e);return t&&this.h!==e&&(this.cache.delete(e),this.cache.set(this.h=e,t)),t},U.prototype.remove=function(e){for(const t of this.cache){const n=t[0];t[1].includes(e)&&this.cache.delete(n)}},U.prototype.clear=function(){this.cache.clear(),this.h=""};const W={normalize:!1,numeric:!1,dedupe:!1},V={},Q=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),G=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),Y=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],H={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,"":2,d:3,t:3,l:4,m:5,n:5,r:6};var J={Exact:W,Default:V,Normalize:V,LatinBalance:{mapper:Q},LatinAdvanced:{mapper:Q,matcher:G,replacer:Y},LatinExtra:{mapper:Q,replacer:Y.concat([/(?!^)[aeo]/g,""]),matcher:G},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(e){for(let n=0;n<e.length;n++){var t=e[n];let r=t.charAt(0),i=H[r];for(let e,n=1;n<t.length&&(e=t.charAt(n),"h"===e||"w"===e||!(e=H[e])||e===i||(r+=e,i=e,4!==r.length));n++);e[n]=r}}},CJK:{split:""},LatinExact:W,LatinDefault:V,LatinSimple:V};function X(e,t,n,r){let i=[];for(let o,s=0;s<e.index.length;s++)if(o=e.index[s],t>=o.length)t-=o.length;else{const s=(t=o[r?"splice":"slice"](t,n)).length;if(s&&(i=i.length?i.concat(t):t,n-=s,r&&(e.length-=s),!n))break;t=0}return i}function Z(e){if(!this||this.constructor!==Z)return new Z(e);this.index=e?[e]:[],this.length=e?e.length:0;const t=this;return new Proxy([],{get:(e,n)=>"length"===n?t.length:"push"===n?function(e){t.index[t.index.length-1].push(e),t.length++}:"pop"===n?function(){if(t.length)return t.length--,t.index[t.index.length-1].pop()}:"indexOf"===n?function(e){let n=0;for(let r,i,o=0;o<t.index.length;o++){if(r=t.index[o],i=r.indexOf(e),i>=0)return n+i;n+=r.length}return-1}:"includes"===n?function(e){for(let n=0;n<t.index.length;n++)if(t.index[n].includes(e))return!0;return!1}:"slice"===n?function(e,n){return X(t,e||0,n||t.length,!1)}:"splice"===n?function(e,n){return X(t,e||0,n||t.length,!0)}:"constructor"===n?Array:"symbol"!=typeof n?(e=t.index[n/2**31|0])&&e[n]:void 0,set:(e,n,r)=>(e=n/2**31|0,(t.index[e]||(t.index[e]=[]))[n]=r,t.length++,!0)})}function ee(e=8){if(!this||this.constructor!==ee)return new ee(e);this.index=K(),this.h=[],this.size=0,e>32?(this.B=re,this.A=BigInt(e)):(this.B=ne,this.A=e)}function te(e=8){if(!this||this.constructor!==te)return new te(e);this.index=K(),this.h=[],this.size=0,e>32?(this.B=re,this.A=BigInt(e)):(this.B=ne,this.A=e)}function ne(e){let t=2**this.A-1;if("number"==typeof e)return e&t;let n=0,r=this.A+1;for(let i=0;i<e.length;i++)n=(n*r^e.charCodeAt(i))&t;return 32===this.A?n+2**31:n}function re(e){let t=BigInt(2)**this.A-BigInt(1);var n=typeof e;if("bigint"===n)return e&t;if("number"===n)return BigInt(e)&t;n=BigInt(0);let r=this.A+BigInt(1);for(let i=0;i<e.length;i++)n=(n*r^BigInt(e.charCodeAt(i)))&t;return n}let ie,oe,se,ae,ue;async function ce(e){var t=(e=e.data).task;const n=e.id;let r=e.args;if("init"===t)oe=e.options||{},(t=e.factory)?(Function("return "+t)()(self),ie=new self.FlexSearch.Index(oe),delete self.FlexSearch):ie=new Ze(oe),postMessage({id:n});else{let i;"export"===t&&(r[1]?(r[0]=oe.export,r[2]=0,r[3]=1):r=null),"import"===t?r[0]&&(e=await oe.import.call(ie,r[0]),ie.import(r[0],e)):((i=r&&ie[t].apply(ie,r))&&i.then&&(i=await i),i&&i.await&&(i=await i.await),"search"===t&&i.result&&(i=i.result)),postMessage("search"===t?{id:n,msg:i}:{id:n})}}function le(e){fe.call(e,"add"),fe.call(e,"append"),fe.call(e,"search"),fe.call(e,"update"),fe.call(e,"remove"),fe.call(e,"searchCache")}function he(){se=ue=0}function fe(e){this[e+"Async"]=function(){const t=arguments;var n=t[t.length-1];let r;if("function"==typeof n&&(r=n,delete t[t.length-1]),se?ue||(ue=Date.now()-ae>=this.priority*this.priority*3):(se=setTimeout(he,0),ae=Date.now()),ue){const n=this;return new Promise(r=>{setTimeout(function(){r(n[e+"Async"].apply(n,t))},0)})}const i=this[e].apply(this,t);return n=i.then?i:new Promise(e=>e(i)),r&&n.then(r),n}}Z.prototype.clear=function(){this.index.length=0},Z.prototype.push=function(){},ee.prototype.get=function(e){const t=this.index[this.B(e)];return t&&t.get(e)},ee.prototype.set=function(e,t){var n=this.B(e);let r=this.index[n];r?(n=r.size,r.set(e,t),(n-=r.size)&&this.size++):(this.index[n]=r=new Map([[e,t]]),this.h.push(r),this.size++)},te.prototype.add=function(e){var t=this.B(e);let n=this.index[t];n?(t=n.size,n.add(e),(t-=n.size)&&this.size++):(this.index[t]=n=new Set([e]),this.h.push(n),this.size++)},(C=ee.prototype).has=te.prototype.has=function(e){const t=this.index[this.B(e)];return t&&t.has(e)},C.delete=te.prototype.delete=function(e){const t=this.index[this.B(e)];t&&t.delete(e)&&this.size--},C.clear=te.prototype.clear=function(){this.index=K(),this.h=[],this.size=0},C.values=te.prototype.values=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].values())yield t},C.keys=te.prototype.keys=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].keys())yield t},C.entries=te.prototype.entries=function*(){for(let e=0;e<this.h.length;e++)for(let t of this.h[e].entries())yield t};let de=0;function pe(e={},t){function n(n){function s(e){const t=(e=e.data||e).id,n=t&&o.h[t];n&&(n(e.msg),delete o.h[t])}if(this.worker=n,this.h=K(),this.worker)return i?this.worker.on("message",s):this.worker.onmessage=s,e.config?new Promise(function(t){de>1e9&&(de=0),o.h[++de]=function(){t(o)},o.worker.postMessage({id:de,task:"init",factory:r,options:e})}):(this.priority=e.priority||4,this.encoder=t||null,this.worker.postMessage({task:"init",factory:r,options:e}),this)}if(!this||this.constructor!==pe)return new pe(e);let r="undefined"!=typeof self?self._factory:"undefined"!=typeof window?window._factory:null;r&&(r=r.toString());const i="undefined"==typeof window,o=this,s=function(e,t,n){return t?"undefined"!=typeof module?new(require("worker_threads").Worker)(__dirname+"/worker/node.js"):Promise.resolve().then(function(){return xt}).then(function(e){return new e.Worker(import.meta.dirname+"/node/node.mjs")}):e?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+ce.toString()],{type:"text/javascript"}))):new window.Worker("string"==typeof n?n:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}(r,i,e.worker);return s.then?s.then(function(e){return n.call(o,e)}):n.call(this,s)}function ge(e){pe.prototype[e]=function(){const t=this,n=[].slice.call(arguments);var r=n[n.length-1];let i;return"function"==typeof r&&(i=r,n.pop()),r=new Promise(function(r){"export"===e&&"function"==typeof n[0]&&(n[0]=null),de>1e9&&(de=0),t.h[++de]=r,t.worker.postMessage({task:e,id:de,args:n})}),i?(r.then(i),this):r}}function me(e,t,n,r,i,o){if(e=e[i],r===n.length-1)t[i]=o||e;else if(e)if(e.constructor===Array)for(t=t[i]=Array(e.length),i=0;i<e.length;i++)me(e,t,n,r,i);else t=t[i]||(t[i]=K()),i=n[++r],me(e,t,n,r,i)}function ye(e,t,n,r,i,o,s,a){if(e=e[s])if(r===t.length-1){if(e.constructor===Array){if(n[r]){for(t=0;t<e.length;t++)i.add(o,e[t],!0,!0);return}e=e.join(" ")}i.add(o,e,a,!0)}else if(e.constructor===Array)for(s=0;s<e.length;s++)ye(e,t,n,r,i,o,s,a);else s=t[++r],ye(e,t,n,r,i,o,s,a)}function ve(e,t,n,r){if(!e.length)return e;if(1===e.length)return e=e[0],e=n||e.length>t?e.slice(n,n+t):e,r?Ie.call(this,e):e;let i=[];for(let o,s,a=0;a<e.length;a++)if((o=e[a])&&(s=o.length)){if(n){if(n>=s){n-=s;continue}o=o.slice(n,n+t),s=o.length,n=0}if(s>t&&(o=o.slice(0,t),s=t),!i.length&&s>=t)return r?Ie.call(this,o):o;if(i.push(o),!(t-=s))break}return i=i.length>1?[].concat.apply([],i):i[0],r?Ie.call(this,i):i}function be(e,t,n,r){var i=r[0];if(i[0]&&i[0].query)return e[t].apply(e,i);if(!("and"!==t&&"not"!==t||e.result.length||e.await||i.suggest))return r.length>1&&(i=r[r.length-1]),(r=i.resolve)?e.await||e.result:e;let o,s,a,u,c,l=[],h=0,f=0;for(t=0;t<r.length;t++)if(i=r[t]){var d=void 0;if(i.constructor===Se)d=i.await||i.result;else if(i.then||i.constructor===Array)d=i;else{h=i.limit||0,f=i.offset||0,a=i.suggest,s=i.resolve,o=((u=i.highlight||e.highlight)||i.enrich)&&s,d=i.queue;let n=i.async||d,r=i.index,p=i.query;if(r?e.index||(e.index=r):r=e.index,p||i.tag){const o=i.field||i.pluck;if(o&&(!p||e.query&&!u||(e.query=p,e.field=o,e.highlight=u),r=r.index.get(o)),d&&(c||e.await)){let o;c=1;const s=e.C.length,a=new Promise(function(e){o=e});(function(t,r){a.h=function(){r.index=null,r.resolve=!1;let i=n?t.searchAsync(r):t.search(r);return i.then?i.then(function(t){return e.C[s]=t=t.result||t,o(t),t}):(i=i.result||i,o(i),i)}})(r,Object.assign({},i)),e.C.push(a),l[t]=a;continue}i.resolve=!1,i.index=null,d=n?r.searchAsync(i):r.search(i),i.resolve=s,i.index=r}else if(i.and)d=we(i,"and",r);else if(i.or)d=we(i,"or",r);else if(i.not)d=we(i,"not",r);else{if(!i.xor)continue;d=we(i,"xor",r)}}d.await?(c=1,d=d.await):d.then?(c=1,d=d.then(function(e){return e.result||e})):d=d.result||d,l[t]=d}if(c&&!e.await&&(e.await=new Promise(function(t){e.return=t})),c){const t=Promise.all(l).then(function(r){for(let i=0;i<e.C.length;i++)if(e.C[i]===t){e.C[i]=function(){return n.call(e,r,h,f,o,s,a,u)};break}Pe(e)});e.C.push(t)}else{if(!e.await)return n.call(e,l,h,f,o,s,a,u);e.C.push(function(){return n.call(e,l,h,f,o,s,a,u)})}return s?e.await||e.result:e}function we(e,t,n){const r=(e=e[t])[0]||e;return r.index||(r.index=n),n=new Se(r),e.length>1&&(n=n[t].apply(n,e.slice(1))),n}function ke(e,t,n,r,i,o,s){return e.length&&(this.result.length&&e.push(this.result),e.length<2?this.result=e[0]:(this.result=Ce(e,t,n,!1,this.h),n=0)),i&&(this.await=null),i?this.resolve(t,n,r,s):this}function xe(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;let a;if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{let r=0;for(let t,n,i=0;i<e.length;i++)if((t=e[i])&&(n=t.length))r<n&&(r=n);else if(!o){r=0;break}r?(this.result=Oe(e,r,t,n,o,this.h,i),a=!0):this.result=[]}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function _e(e,t,n,r,i,o,s){if(e.length)if(this.result.length&&e.unshift(this.result),e.length<2)this.result=e[0];else{e:{o=n;var a=this.h;const r=[],s=K();let u=0;for(let t,n=0;n<e.length;n++)if(t=e[n]){u<t.length&&(u=t.length);for(let e,n=0;n<t.length;n++)if(e=t[n])for(let t,n=0;n<e.length;n++)t=e[n],s[t]=s[t]?2:1}for(let n,c=0,l=0;c<u;c++)for(let u,h=0;h<e.length;h++)if((u=e[h])&&(n=u[c]))for(let u,f=0;f<n.length;f++)if(u=n[f],1===s[u])if(o)o--;else if(i){if(r.push(u),r.length===t){e=r;break e}}else{const n=c+(h?a:0);if(r[n]||(r[n]=[]),r[n].push(u),++l===t){e=r;break e}}e=r}this.result=e,a=!0}else o||(this.result=e);return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function Ae(e,t,n,r,i,o,s){if(!o&&!this.result.length)return i?this.result:this;if(e.length&&this.result.length){e:{o=n;var a=[];e=new Set(e.flat().flat());for(let n,r=0,s=0;r<this.result.length;r++)if(n=this.result[r])for(let u,c=0;c<n.length;c++)if(u=n[c],!e.has(u))if(o)o--;else if(i){if(a.push(u),a.length===t){e=a;break e}}else if(a[r]||(a[r]=[]),a[r].push(u),++s===t){e=a;break e}e=a}this.result=e,a=!0}return i&&(this.await=null),i?this.resolve(t,n,r,s,a):this}function Ee(e,t,n,r,i){let o,s,a;"string"==typeof i?(o=i,i=""):o=i.template,s=o.indexOf("$1"),a=o.substring(s+2),s=o.substring(0,s);let u=i&&i.boundary,c=!i||!1!==i.clip,l=i&&i.merge&&a&&s&&new RegExp(a+" "+s,"g");var h=0;if("object"==typeof(i=i&&i.ellipsis)){var f=i.template;h=f.length-2,i=i.pattern}let d,p;"string"!=typeof i&&(i=!1===i?"":"..."),h&&(i=f.replace("$1",i)),f=i.length-h,"object"==typeof u&&(d=u.before,0===d&&(d=-1),p=u.after,0===p&&(p=-1),u=u.total||9e5),h=new Map;for(let I,D,T,M=0;M<t.length;M++){let R;if(r)R=t,T=r;else{var g=t[M];if(T=g.field,!T)continue;R=g.result}D=n.get(T),I=D.encoder,"string"!=typeof(g=h.get(I))&&(g=I.encode(e),h.set(I,g));for(let e=0;e<R.length;e++){var m=R[e].doc;if(!m)continue;if(!(m=q(m,T)))continue;var y=m.trim().split(/\s+/);if(!y.length)continue;m="";var v=[];let t=[];for(var b=-1,w=-1,k=0,x=0;x<y.length;x++){var _=y[x],A=I.encode(_);let e;if((A=A.length>1?A.join(" "):A[0])&&_){for(var E=_.length,S=(I.split?_.replace(I.split,""):_).length-A.length,P="",O=0,C=0;C<g.length;C++){var j=g[C];if(j){var B=j.length;B+=S<0?0:S,O&&B<=O||(j=A.indexOf(j))>-1&&(P=(j?_.substring(0,j):"")+s+_.substring(j,j+B)+a+(j+B<E?_.substring(j+B):""),O=B,e=!0)}}P&&(u&&(b<0&&(b=m.length+(m?1:0)),w=m.length+(m?1:0)+P.length,k+=E,t.push(v.length),v.push({match:P})),m+=(m?" ":"")+P)}if(e){if(u&&k>=u)break}else m+=(m?" ":"")+(_=y[x]),u&&v.push({text:_})}if(k=t.length*(o.length-2),d||p||u&&m.length-k>u)if(x=w-b,d>0&&(x+=d),p>0&&(x+=p),x<=(k=u+k-2*f))y=d?b-(d>0?d:0):b-((k-x)/2|0),v=p?w+(p>0?p:0):y+k,c||(y>0&&" "!==m.charAt(y)&&" "!==m.charAt(y-1)&&((y=m.indexOf(" ",y))<0&&(y=0)),v<m.length&&" "!==m.charAt(v-1)&&" "!==m.charAt(v)&&((v=m.lastIndexOf(" ",v))<w?v=w:++v)),m=(y?i:"")+m.substring(y,v)+(v<m.length?i:"");else{for(w=[],b={},k={},x={},_={},A={},P=S=E=0,C=O=1;;){var K=void 0;for(let e,n=0;n<t.length;n++){if(e=t[n],P)if(S!==P){if(x[n+1])continue;if(e+=P,b[e]){E-=f,k[n+1]=1,x[n+1]=1;continue}if(e>=v.length-1){if(e>=v.length){x[n+1]=1,e>=y.length&&(k[n+1]=1);continue}E-=f}if(m=v[e].text,B=p&&A[n]){if(!(B>0)){x[n+1]=1;continue}if(m.length>B){if(x[n+1]=1,!c)continue;m=m.substring(0,B)}(B-=m.length)||(B=-1),A[n]=B}if(E+m.length+1<=u)m=" "+m,w[n]+=m;else{if(!c){x[n+1]=1;continue}(K=u-E-1)>0&&(m=" "+m.substring(0,K),w[n]+=m),x[n+1]=1}}else{if(x[n])continue;if(e-=S,b[e]){E-=f,x[n]=1,k[n]=1;continue}if(e<=0){if(e<0){x[n]=1,k[n]=1;continue}E-=f}if(m=v[e].text,B=d&&_[n]){if(!(B>0)){x[n]=1;continue}if(m.length>B){if(x[n]=1,!c)continue;m=m.substring(m.length-B)}(B-=m.length)||(B=-1),_[n]=B}if(E+m.length+1<=u)m+=" ",w[n]=m+w[n];else{if(!c){x[n]=1;continue}(K=m.length+1-(u-E))>=0&&K<m.length&&(m=m.substring(K)+" ",w[n]=m+w[n]),x[n]=1}}else{let t;if(m=v[e].match,d&&(_[n]=d),p&&(A[n]=p),n&&E++,e?!n&&f&&(E+=f):(k[n]=1,x[n]=1),e>=y.length-1||e<v.length-1&&v[e+1].match?t=1:f&&(E+=f),E-=o.length-2,n&&!(E+m.length<=u)){K=O=C=k[n]=0;break}w[n]=m,t&&(k[n+1]=1,x[n+1]=1)}E+=m.length,K=b[e]=1}if(K)S===P?P++:S++;else{if(S===P?O=0:C=0,!O&&!C)break;O?P=++S:P++}}m="";for(let e,t=0;t<w.length;t++)e=(k[t]?t?" ":"":(t&&!i?" ":"")+i)+w[t],m+=e;i&&!k[w.length]&&(m+=i)}l&&(m=m.replace(l," ")),R[e].highlight=m}if(r)break}return t}function Se(e,t){if(!this||this.constructor!==Se)return new Se(e,t);let n,r,i,o,s,a,u=0;if(e&&e.index){const n=e;if(t=n.index,u=n.boost||0,r=n.query){i=n.field||n.pluck,o=n.highlight;const r=n.resolve;e=n.async||n.queue,n.resolve=!1,n.index=null,e=e?t.searchAsync(n):t.search(n),n.resolve=r,n.index=t,e=e.result||e}else e=[]}if(e&&e.then){const t=this;n=[e=e.then(function(e){t.C[0]=t.result=e.result||e,Pe(t)})],e=[],s=new Promise(function(e){a=e})}this.index=t||null,this.result=e||[],this.h=u,this.C=n||[],this.await=s||null,this.return=a||null,this.highlight=o||null,this.query=r||"",this.field=i||""}function Pe(e,t){let n=e.result;var r=e.await;e.await=null;for(let t,i=0;i<e.C.length;i++)if(t=e.C[i])if("function"==typeof t)n=t(),e.C[i]=n=n.result||n,i--;else if(t.h)n=t.h(),e.C[i]=n=n.result||n,i--;else if(t.then)return e.await=r;return r=e.return,e.C=[],e.return=null,t||r(n),n}function Oe(e,t,n,r,i,o,s){const a=e.length;let u,c,l=[];u=K();for(let h,f,d,p,g=0;g<t;g++)for(let t=0;t<a;t++)if(d=e[t],g<d.length&&(h=d[g]))for(let e=0;e<h.length;e++){if(f=h[e],(c=u[f])?u[f]++:(c=0,u[f]=1),p=l[c]||(l[c]=[]),!s){let e=g+(t||!i?0:o||0);p=p[e]||(p[e]=[])}if(p.push(f),s&&n&&c===a-1&&p.length-r===n)return r?p.slice(r):p}if(e=l.length)if(i)l=l.length>1?Ce(l,n,r,s,o):(l=l[0])&&n&&l.length>n||r?l.slice(r,n+r):l;else{if(e<a)return[];if(l=l[e-1],n||r)if(s)(l.length>n||r)&&(l=l.slice(r,n+r));else{i=[];for(let e,t=0;t<l.length;t++)if(e=l[t])if(r&&e.length>r)r-=e.length;else if((n&&e.length>n||r)&&(e=e.slice(r,n+r),n-=e.length,r&&(r-=e.length)),i.push(e),!n)break;l=i}}return l}function Ce(e,t,n,r,i){const o=[],s=K();let a;var u=e.length;let c;if(r){for(i=u-1;i>=0;i--)if(c=(r=e[i])&&r.length)for(u=0;u<c;u++)if(a=r[u],!s[a])if(s[a]=1,n)n--;else if(o.push(a),o.length===t)return o}else for(let l,h=u-1,f=0;h>=0;h--){l=e[h];for(let e=0;e<l.length;e++)if(c=(r=l[e])&&r.length)for(let l=0;l<c;l++)if(a=r[l],!s[a])if(s[a]=1,n)n--;else{let n=(e+(h<u-1&&i||0))/(h+1)|0;if((o[n]||(o[n]=[])).push(a),++f===t)return o}}return o}function je(e,t,n,r,i){const o=K(),s=[];for(let e,n=0;n<t.length;n++){e=t[n];for(let t=0;t<e.length;t++)o[e[t]]=1}if(i){for(let t,i=0;i<e.length;i++)if(t=e[i],o[t])if(r)r--;else if(s.push(t),o[t]=0,n&&0===--n)break}else for(let n,r,i=0;i<e.result.length;i++)for(n=e.result[i],t=0;t<n.length;t++)r=n[t],o[r]&&((s[i]||(s[i]=[])).push(r),o[r]=0);return s}function Be(e){const t=[],n=K(),r=K();for(let i,o,s,a,u,c,l,h=0;h<e.length;h++){i=e[h],o=i.field,s=i.result;for(let e=0;e<s.length;e++)u=s[e],"object"!=typeof u?u={id:a=u}:a=u.id,(c=n[a])?c.push(o):(u.field=n[a]=[o],t.push(u)),(l=u.highlight)&&(c=r[a],c||(r[a]=c={},u.highlight=c),c[o]=l)}return t}function Ke(e,t,n,r,i){return(e=this.tag.get(e))&&(e=e.get(t))?((t=e.length-r)>0&&((n&&t>n||r)&&(e=e.slice(r,r+n)),i&&(e=Ie.call(this,e))),e):[]}function Ie(e){if(!this||!this.store)return e;if(this.db)return this.index.get(this.field[0]).db.enrich(e);const t=Array(e.length);for(let n,r=0;r<e.length;r++)n=e[r],t[r]={id:n,doc:this.store.get(n)};return t}function De(e){if(!this||this.constructor!==De)return new De(e);const t=e.document||e.doc||e;let n,r;if(this.B=[],this.field=[],this.D=[],this.key=(n=t.key||t.id)&&Te(n,this.D)||"id",(r=e.keystore||0)&&(this.keystore=r),this.fastupdate=!!e.fastupdate,this.reg=!this.fastupdate||e.worker||e.db?r?new te(r):new Set:r?new ee(r):new Map,this.h=(n=t.store||null)&&n&&!0!==n&&[],this.store=n?r?new ee(r):new Map:null,this.cache=(n=e.cache||null)&&new U(n),e.cache=!1,this.worker=e.worker||!1,this.priority=e.priority||4,this.index=qe.call(this,e,t),this.tag=null,(n=t.tag)&&("string"==typeof n&&(n=[n]),n.length)){this.tag=new Map,this.A=[],this.F=[];for(let e,t,r=0;r<n.length;r++){if(e=n[r],t=e.field||e,!t)throw Error("The tag field from the document descriptor is undefined.");e.custom?this.A[r]=e.custom:(this.A[r]=Te(t,this.D),e.filter&&("string"==typeof this.A[r]&&(this.A[r]=new String(this.A[r])),this.A[r].G=e.filter)),this.F[r]=t,this.tag.set(t,new Map)}}if(this.worker){this.fastupdate=!1,e=[];for(const t of this.index.values())t.then&&e.push(t);if(e.length){const t=this;return Promise.all(e).then(function(e){let n=0;for(const r of t.index.entries()){const i=r[0];let o=r[1];o.then&&(o=e[n],t.index.set(i,o),n++)}return t})}}else e.db&&(this.fastupdate=!1,this.mount(e.db))}function qe(e,t){const n=new Map;let r=t.index||t.field||t;I(r)&&(r=[r]);for(let t,o,s=0;s<r.length;s++){if(t=r[s],I(t)||(o=t,t=t.field),o=D(o)?Object.assign({},e,o):e,this.worker){var i=void 0;i=new pe(o,i=(i=o.encoder)&&i.encode?i:new N("string"==typeof i?J[i]:i||{})),n.set(t,i)}this.worker||n.set(t,new Ze(o,this.reg)),o.custom?this.B[s]=o.custom:(this.B[s]=Te(t,this.D),o.filter&&("string"==typeof this.B[s]&&(this.B[s]=new String(this.B[s])),this.B[s].G=o.filter)),this.field[s]=t}if(this.h){I(e=t.store)&&(e=[e]);for(let t,n,r=0;r<e.length;r++)t=e[r],n=t.field||t,t.custom?(this.h[r]=t.custom,t.custom.O=n):(this.h[r]=Te(n,this.D),t.filter&&("string"==typeof this.h[r]&&(this.h[r]=new String(this.h[r])),this.h[r].G=t.filter))}return n}function Te(e,t){const n=e.split(":");let r=0;for(let i=0;i<n.length;i++)"]"===(e=n[i])[e.length-1]&&(e=e.substring(0,e.length-2))&&(t[r]=!0),e&&(n[r++]=e);return r<n.length&&(n.length=r),r>1?n:n[0]}function Me(e,t=0){let n=[],r=[];t&&(t=25e4/t*5e3|0);for(const i of e.entries())r.push(i),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function Re(e,t){t||(t=new Map);for(let n,r=0;r<e.length;r++)n=e[r],t.set(n[0],n[1]);return t}function Fe(e,t=0){let n=[],r=[];t&&(t=25e4/t*1e3|0);for(const i of e.entries())r.push([i[0],Me(i[1])[0]||[]]),r.length===t&&(n.push(r),r=[]);return r.length&&n.push(r),n}function ze(e,t){t||(t=new Map);for(let n,r,i=0;i<e.length;i++)n=e[i],r=t.get(n[0]),t.set(n[0],Re(n[1],r));return t}function Ne(e){let t=[],n=[];for(const r of e.keys())n.push(r),25e4===n.length&&(t.push(n),n=[]);return n.length&&t.push(n),t}function Le(e,t){t||(t=new Set);for(let n=0;n<e.length;n++)t.add(e[n]);return t}function $e(e,t,n,r,i,o,s=0){const a=r&&r.constructor===Array;var u=a?r.shift():r;if(!u)return this.export(e,t,i,o+1);if((u=e((t?t+".":"")+(s+1)+"."+n,JSON.stringify(u)))&&u.then){const c=this;return u.then(function(){return $e.call(c,e,t,n,a?r:null,i,o,s+1)})}return $e.call(this,e,t,n,a?r:null,i,o,s+1)}function Ue(e,t){let n="";for(const r of e.entries()){e=r[0];const i=r[1];let o="";for(let e,n=0;n<i.length;n++){e=i[n]||[""];let r="";for(let n=0;n<e.length;n++)r+=(r?",":"")+("string"===t?'"'+e[n]+'"':e[n]);r="["+r+"]",o+=(o?",":"")+r}o='["'+e+'",['+o+"]]",n+=(n?",":"")+o}return n}function We(e,t){let n=0;var r=void 0===t;if(e.constructor===Array){for(let i,o,s,a=0;a<e.length;a++)if((i=e[a])&&i.length){if(r)return 1;if(o=i.indexOf(t),o>=0){if(i.length>1)return i.splice(o,1),1;if(delete e[a],n)return 1;s=1}else{if(s)return 1;n++}}}else for(let i of e.entries())r=i[0],We(i[1],t)?n++:e.delete(r);return n}ge("add"),ge("append"),ge("search"),ge("update"),ge("remove"),ge("clear"),ge("export"),ge("import"),pe.prototype.searchCache=$,le(pe.prototype),De.prototype.add=function(e,t,n){if(D(e)&&(e=q(t=e,this.key)),t&&(e||0===e)){if(!n&&this.reg.has(e))return this.update(e,t);for(let o,s=0;s<this.field.length;s++){o=this.B[s];var r=this.index.get(this.field[s]);if("function"==typeof o){var i=o(t);i&&r.add(e,i,n,!0)}else(!(i=o.G)||i(t))&&(o.constructor===String?o=[""+o]:I(o)&&(o=[o]),ye(t,o,this.D,0,r,e,o[0],n))}if(this.tag)for(r=0;r<this.A.length;r++){var o=this.A[r];i=this.tag.get(this.F[r]);let a=K();if("function"==typeof o){if(!(o=o(t)))continue}else{var s=o.G;if(s&&!s(t))continue;o.constructor===String&&(o=""+o),o=q(t,o)}if(i&&o){I(o)&&(o=[o]);for(let t,r,u=0;u<o.length;u++)if(t=o[u],!a[t]&&(a[t]=1,(s=i.get(t))?r=s:i.set(t,r=[]),!n||!r.includes(e))){if(r.length===2**31-1){if(s=new Z(r),this.fastupdate)for(let e of this.reg.values())e.includes(r)&&(e[e.indexOf(r)]=s);i.set(t,r=s)}r.push(e),this.fastupdate&&((s=this.reg.get(e))?s.push(r):this.reg.set(e,[r]))}}}if(this.store&&(!n||!this.store.has(e))){let r;if(this.h){r=K();for(let e,i=0;i<this.h.length;i++){if(e=this.h[i],(n=e.G)&&!n(t))continue;let o;if("function"==typeof e){if(o=e(t),!o)continue;e=[e.O]}else if(I(e)||e.constructor===String){r[e]=t[e];continue}me(t,r,e,0,e[0],o)}}this.store.set(e,r||t)}this.worker&&(this.fastupdate||this.reg.add(e))}return this},Se.prototype.or=function(){return be(this,"or",ke,arguments)},Se.prototype.and=function(){return be(this,"and",xe,arguments)},Se.prototype.xor=function(){return be(this,"xor",_e,arguments)},Se.prototype.not=function(){return be(this,"not",Ae,arguments)},(C=Se.prototype).limit=function(e){if(this.await){const t=this;this.C.push(function(){return t.limit(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)if(n=this.result[r]){if(!(n.length<=e)){t[r]=n.slice(0,e);break}if(t[r]=n,!(e-=n.length))break}this.result=t}return this},C.offset=function(e){if(this.await){const t=this;this.C.push(function(){return t.offset(e).result})}else if(this.result.length){const t=[];for(let n,r=0;r<this.result.length;r++)(n=this.result[r])&&(n.length<=e?e-=n.length:(t[r]=n.slice(e),e=0));this.result=t}return this},C.boost=function(e){if(this.await){const t=this;this.C.push(function(){return t.boost(e).result})}else this.h+=e;return this},C.resolve=function(e,t,n,r,i){let o=this.await?Pe(this,!0):this.result;if(o.then){const s=this;return o.then(function(){return s.resolve(e,t,n,r,i)})}return o.length&&("object"==typeof e?(r=e.highlight||this.highlight,n=!!r||e.enrich,t=e.offset,e=e.limit):(r=r||this.highlight,n=!!r||n),o=i?n?Ie.call(this.index,o):o:ve.call(this.index,o,e||100,t,n)),this.finalize(o,r)},C.finalize=function(e,t){if(e.then){const n=this;return e.then(function(e){return n.finalize(e,t)})}t&&e.length&&this.query&&(e=Ee(this.query,e,this.index.index,this.field,t));const n=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",n&&n(e),e},De.prototype.search=function(e,t,n,r){n||(!t&&D(e)?(n=e,e=""):D(t)&&(n=t,t=0));let i=[];var o=[];let s,a,u,c,l,h,f,d,p=0,g=!0;if(n){n.constructor===Array&&(n={index:n}),e=n.query||e,s=n.pluck,a=n.merge,c=n.boost,h=s||n.field||(h=n.index)&&(h.index?null:h);var m=this.tag&&n.tag;u=n.suggest,g=!1!==n.resolve,l=n.cache,f=g&&this.store&&n.highlight;var y=!!f||g&&this.store&&n.enrich;t=n.limit||t;var v=n.offset||0;if(t||(t=g?100:0),m&&(!this.db||!r)){m.constructor!==Array&&(m=[m]);var b=[];for(let e,t=0;t<m.length;t++)if(e=m[t],e.field&&e.tag){var w=e.tag;if(w.constructor===Array)for(var k=0;k<w.length;k++)b.push(e.field,w[k]);else b.push(e.field,w)}else{w=Object.keys(e);for(let t,n,r=0;r<w.length;r++)if(t=w[r],n=e[t],n.constructor===Array)for(k=0;k<n.length;k++)b.push(t,n[k]);else b.push(t,n)}if(m=b,!e){if(o=[],b.length)for(m=0;m<b.length;m+=2){if(this.db){if(!(r=this.index.get(b[m])))continue;o.push(r=r.db.tag(b[m+1],t,v,y))}else r=Ke.call(this,b[m],b[m+1],t,v,y);i.push(g?{field:b[m],tag:b[m+1],result:r}:[r])}if(o.length){const e=this;return Promise.all(o).then(function(t){for(let e=0;e<t.length;e++)g?i[e].result=t[e]:i[e]=t[e];return g?i:new Se(i.length>1?Oe(i,1,0,0,u,c):i[0],e)})}return g?i:new Se(i.length>1?Oe(i,1,0,0,u,c):i[0],this)}}g||s||!(h=h||this.field)||(I(h)?s=h:(h.constructor===Array&&1===h.length&&(h=h[0]),s=h.field||h.index)),h&&h.constructor!==Array&&(h=[h])}h||(h=this.field),b=(this.worker||this.db)&&!r&&[];for(let s,a,c,_=0;_<h.length;_++){if(a=h[_],this.db&&this.tag&&!this.B[_])continue;let A;if(I(a)||(A=a,a=A.field,e=A.query||e,t=B(A.limit,t),v=B(A.offset,v),u=B(A.suggest,u),f=g&&this.store&&B(A.highlight,f),y=!!f||g&&this.store&&B(A.enrich,y),l=B(A.cache,l)),r)s=r[_];else{k=(w=A||n||{}).enrich;var x=this.index.get(a);if(m&&(this.db&&(w.tag=m,w.field=h,d=x.db.support_tag_search),!d&&k&&(w.enrich=!1),d||(w.limit=0,w.offset=0)),s=l?x.searchCache(e,m&&!d?0:t,w):x.search(e,m&&!d?0:t,w),m&&!d&&(w.limit=t,w.offset=v),k&&(w.enrich=k),b){b[_]=s;continue}}if(c=(s=s.result||s)&&s.length,m&&c){if(w=[],k=0,this.db&&r){if(!d)for(x=h.length;x<r.length;x++){let e=r[x];if(e&&e.length)k++,w.push(e);else if(!u)return g?i:new Se(i,this)}}else for(let e,t,n=0;n<m.length;n+=2){if(e=this.tag.get(m[n]),!e){if(u)continue;return g?i:new Se(i,this)}if(t=(e=e&&e.get(m[n+1]))&&e.length)k++,w.push(e);else if(!u)return g?i:new Se(i,this)}if(k){if(s=je(s,w,t,v,g),c=s.length,!c&&!u)return g?s:new Se(s,this);k--}}if(c)o[p]=a,i.push(s),p++;else if(1===h.length)return g?i:new Se(i,this)}if(b){if(this.db&&m&&m.length&&!d)for(y=0;y<m.length;y+=2){if(!(o=this.index.get(m[y]))){if(u)continue;return g?i:new Se(i,this)}b.push(o.db.tag(m[y+1],t,v,!1))}const r=this;return Promise.all(b).then(function(i){return n&&(n.resolve=g),i.length&&(i=r.search(e,t,n,i)),i})}if(!p)return g?i:new Se(i,this);if(s&&(!y||!this.store))return i=i[0],g?i:new Se(i,this);for(b=[],v=0;v<o.length;v++){if(m=i[v],y&&m.length&&void 0===m[0].doc&&(this.db?b.push(m=this.index.get(this.field[0]).db.enrich(m)):m=Ie.call(this,m)),s)return g?f?Ee(e,m,this.index,s,f):m:new Se(m,this);i[v]={field:o[v],result:m}}if(y&&this.db&&b.length){const t=this;return Promise.all(b).then(function(n){for(let e=0;e<n.length;e++)i[e].result=n[e];return f&&(i=Ee(e,i,t.index,s,f)),a?Be(i):i})}return f&&(i=Ee(e,i,this.index,s,f)),a?Be(i):i},(C=De.prototype).mount=function(e){let t=this.field;if(this.tag)for(let e,r=0;r<this.F.length;r++){e=this.F[r];var n=void 0;this.index.set(e,n=new Ze({},this.reg)),t===this.field&&(t=t.slice(0)),t.push(e),n.tag=this.tag.get(e)}n=[];const r={db:e.db,type:e.type,fastupdate:e.fastupdate};for(let i,o,s=0;s<t.length;s++){r.field=o=t[s],i=this.index.get(o);const a=new e.constructor(e.id,r);a.id=e.id,n[s]=a.mount(i),i.document=!0,s?i.bypass=!0:i.store=this.store}const i=this;return this.db=Promise.all(n).then(function(){i.db=!0})},C.commit=async function(){const e=[];for(const t of this.index.values())e.push(t.commit());await Promise.all(e),this.reg.clear()},C.destroy=function(){const e=[];for(const t of this.index.values())e.push(t.destroy());return Promise.all(e)},C.append=function(e,t){return this.add(e,t,!0)},C.update=function(e,t){return this.remove(e).add(e,t)},C.remove=function(e){for(var t of(D(e)&&(e=q(e,this.key)),this.index.values()))t.remove(e,!0);if(this.reg.has(e)){if(this.tag&&!this.fastupdate)for(let n of this.tag.values())for(let r of n){t=r[0];const i=r[1],o=i.indexOf(e);o>-1&&(i.length>1?i.splice(o,1):n.delete(t))}this.store&&this.store.delete(e),this.reg.delete(e)}return this.cache&&this.cache.remove(e),this},C.clear=function(){const e=[];for(const t of this.index.values()){const n=t.clear();n.then&&e.push(n)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),e.length?Promise.all(e):this},C.contain=function(e){return this.db?this.index.get(this.field[0]).db.has(e):this.reg.has(e)},C.cleanup=function(){for(const e of this.index.values())e.cleanup();return this},C.get=function(e){return this.db?this.index.get(this.field[0]).db.enrich(e).then(function(e){return e[0]&&e[0].doc||null}):this.store.get(e)||null},C.set=function(e,t){return"object"==typeof e&&(e=q(t=e,this.key)),this.store.set(e,t),this},C.searchCache=$,C.export=function(e,t,n=0,r=0){if(n<this.field.length){const i=this.field[n];if((t=this.index.get(i).export(e,i,n,r=1))&&t.then){const r=this;return t.then(function(){return r.export(e,i,n+1)})}return this.export(e,i,n+1)}let i,o;switch(r){case 0:i="reg",o=Ne(this.reg),t=null;break;case 1:i="tag",o=this.tag&&Fe(this.tag,this.reg.size),t=null;break;case 2:i="doc",o=this.store&&Me(this.store),t=null;break;default:return}return $e.call(this,e,t,i,o||null,n,r)},C.import=function(e,t){var n=e.split(".");"json"===n[n.length-1]&&n.pop();const r=n.length>2?n[0]:"";if(n=n.length>2?n[2]:n[1],this.worker&&r)return this.index.get(r).import(e);if(t){if("string"==typeof t&&(t=JSON.parse(t)),r)return this.index.get(r).import(n,t);switch(n){case"reg":this.fastupdate=!1,this.reg=Le(t,this.reg);for(let e,t=0;t<this.field.length;t++)e=this.index.get(this.field[t]),e.fastupdate=!1,e.reg=this.reg;if(this.worker){t=[];for(const n of this.index.values())t.push(n.import(e));return Promise.all(t)}break;case"tag":this.tag=ze(t,this.tag);break;case"doc":this.store=Re(t,this.store)}}},le(De.prototype),Ze.prototype.remove=function(e,t){const n=this.reg.size&&(this.fastupdate?this.reg.get(e):this.reg.has(e));if(n){if(this.fastupdate){for(let t,r,i=0;i<n.length;i++)if((t=n[i])&&(r=t.length))if(t[r-1]===e)t.pop();else{const n=t.indexOf(e);n>=0&&t.splice(n,1)}}else We(this.map,e),this.depth&&We(this.ctx,e);t||this.reg.delete(e)}return this.db&&(this.commit_task.push({del:e}),this.M&&et(this)),this.cache&&this.cache.remove(e),this};const Ve={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};function Qe(e,t,n,r,i,o,s){let a,u;if(!(a=t[n])||s&&!a[s]){if(s?((t=a||(t[n]=K()))[s]=1,u=e.ctx,(a=u.get(s))?u=a:u.set(s,u=e.keystore?new ee(e.keystore):new Map)):(u=e.map,t[n]=1),(a=u.get(n))?u=a:u.set(n,u=a=[]),o)for(let n,o=0;o<a.length;o++)if((n=a[o])&&n.includes(i)){if(o<=r)return;n.splice(n.indexOf(i),1),e.fastupdate&&(t=e.reg.get(i))&&t.splice(t.indexOf(n),1);break}if(u=u[r]||(u[r]=[]),u.push(i),u.length===2**31-1){if(t=new Z(u),e.fastupdate)for(let n of e.reg.values())n.includes(u)&&(n[n.indexOf(u)]=t);a[r]=u=t}e.fastupdate&&((r=e.reg.get(i))?r.push(u):e.reg.set(i,[u]))}}function Ge(e,t,n,r,i){return n&&e>1?t+(r||0)<=e?n+(i||0):(e-1)/(t+(r||0))*(n+(i||0))+1|0:0}function Ye(e,t,n,r,i,o,s){let a=e.length,u=e;if(a>1)u=Oe(e,t,n,r,i,o,s);else if(1===a)return s?ve.call(null,e[0],n,r):new Se(e[0],this);return s?u:new Se(u,this)}function He(e,t,n,r,i,o,s){return e=Xe(this,e,t,n,r,i,o,s),this.db?e.then(function(e){return i?e||[]:new Se(e,this)}):e&&e.length?i?ve.call(this,e,n,r):new Se(e,this):i?[]:new Se([],this)}function Je(e,t,n,r){let i=[];if(e&&e.length){if(e.length<=r)return void t.push(e);for(let t,n=0;n<r;n++)(t=e[n])&&(i[n]=t);if(i.length)return void t.push(i)}if(!n)return i}function Xe(e,t,n,r,i,o,s,a){let u;return n&&(u=e.bidirectional&&t>n)&&(u=n,n=t,t=u),e.db?e.db.get(t,n,r,i,o,s,a):e=n?(e=e.ctx.get(n))&&e.get(t):e.map.get(t)}function Ze(e,t){if(!this||this.constructor!==Ze)return new Ze(e);if(e){var n=I(e)?e:e.preset;n&&(e=Object.assign({},Ve[n],e))}else e={};const r=!0===(n=e.context)?{depth:1}:n||{},i=I(e.encoder)?J[e.encoder]:e.encode||e.encoder||{};this.encoder=i.encode?i:"object"==typeof i?new N(i):{encode:i},this.resolution=e.resolution||9,this.tokenize=n=(n=e.tokenize)&&"default"!==n&&"exact"!==n&&n||"strict",this.depth="strict"===n&&r.depth||0,this.bidirectional=!1!==r.bidirectional,this.fastupdate=!!e.fastupdate,this.score=e.score||null,(n=e.keystore||0)&&(this.keystore=n),this.map=n?new ee(n):new Map,this.ctx=n?new ee(n):new Map,this.reg=t||(this.fastupdate?n?new ee(n):new Map:n?new te(n):new Set),this.N=r.resolution||3,this.rtl=i.rtl||e.rtl||!1,this.cache=(n=e.cache||null)&&new U(n),this.resolve=!1!==e.resolve,(n=e.db)&&(this.db=this.mount(n)),this.M=!1!==e.commit,this.commit_task=[],this.commit_timer=null,this.priority=e.priority||4}function et(e){e.commit_timer||(e.commit_timer=setTimeout(function(){e.commit_timer=null,e.db.commit(e)},1))}Ze.prototype.add=function(e,t,n,r){if(t&&(e||0===e)){if(!r&&!n&&this.reg.has(e))return this.update(e,t);r=this.depth;const c=(t=this.encoder.encode(t,!r)).length;if(c){const l=K(),h=K(),f=this.resolution;for(let d=0;d<c;d++){let p=t[this.rtl?c-1-d:d];var i=p.length;if(i&&(r||!h[p])){var o=this.score?this.score(t,p,d,null,0):Ge(f,c,d),s="";switch(this.tokenize){case"tolerant":if(Qe(this,h,p,o,e,n),i>2){for(let t,r,a,u,c=1;c<i-1;c++)t=p.charAt(c),r=p.charAt(c+1),a=p.substring(0,c)+r,u=p.substring(c+2),Qe(this,h,s=a+t+u,o,e,n),Qe(this,h,s=a+u,o,e,n);Qe(this,h,p.substring(0,p.length-1),o,e,n)}break;case"full":if(i>2){for(let r,u=0;u<i;u++)for(o=i;o>u;o--){s=p.substring(u,o),r=this.rtl?i-1-u:u;var a=this.score?this.score(t,p,d,s,r):Ge(f,c,d,i,r);Qe(this,h,s,a,e,n)}break}case"bidirectional":case"reverse":if(i>1){for(a=i-1;a>0;a--){s=p[this.rtl?i-1-a:a]+s;var u=this.score?this.score(t,p,d,s,a):Ge(f,c,d,i,a);Qe(this,h,s,u,e,n)}s=""}case"forward":if(i>1){for(a=0;a<i;a++)Qe(this,h,s+=p[this.rtl?i-1-a:a],o,e,n);break}default:if(Qe(this,h,p,o,e,n),r&&c>1&&d<c-1)for(i=this.N,s=p,o=Math.min(r+1,this.rtl?d+1:c-d),a=1;a<o;a++){p=t[this.rtl?c-1-d-a:d+a];Qe(this,l,(u=this.bidirectional&&p>s)?s:p,this.score?this.score(t,s,d,p,a-1):Ge(i+(c/2>i?0:1),c,d,o-1,a-1),e,n,u?p:s)}}}}this.fastupdate||this.reg.add(e)}}return this.db&&(this.commit_task.push(n?{ins:e}:{del:e}),this.M&&et(this)),this},Ze.prototype.search=function(e,t,n){if(n||(t||"object"!=typeof e?"object"==typeof t&&(n=t,t=0):(n=e,e="")),n&&n.cache)return n.cache=!1,e=this.searchCache(e,t,n),n.cache=!0,e;let r,i,o,s,a,u,c,l,h=[],f=0;n&&(e=n.query||e,t=n.limit||t,f=n.offset||0,i=n.context,o=n.suggest,l=(s=n.resolve)&&n.enrich,u=n.boost,c=n.resolution,a=this.db&&n.tag),void 0===s&&(s=this.resolve),i=this.depth&&!1!==i;let d=this.encoder.encode(e,!i);if(r=d.length,t=t||(s?100:0),1===r)return He.call(this,d[0],"",t,f,s,l,a);if(2===r&&i&&!o)return He.call(this,d[1],d[0],t,f,s,l,a);let p,g=K(),m=0;if(i&&(p=d[0],m=1),c||0===c||(c=p?this.N:this.resolution),this.db){if(this.db.search&&!1!==(n=this.db.search(this,d,t,f,o,s,l,a)))return n;const e=this;return async function(){for(let t,n;m<r;m++){if((n=d[m])&&!g[n]){if(g[n]=1,t=await Xe(e,n,p,0,0,!1,!1),t=Je(t,h,o,c)){h=t;break}p&&(o&&t&&h.length||(p=n))}o&&p&&m===r-1&&!h.length&&(c=e.resolution,p="",m=-1,g=K())}return Ye(h,c,t,f,o,u,s)}()}for(let e,t;m<r;m++){if((t=d[m])&&!g[t]){if(g[t]=1,e=Xe(this,t,p,0,0,!1,!1),e=Je(e,h,o,c)){h=e;break}p&&(o&&e&&h.length||(p=t))}o&&p&&m===r-1&&!h.length&&(c=this.resolution,p="",m=-1,g=K())}return Ye(h,c,t,f,o,u,s)},(C=Ze.prototype).mount=function(e){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),e.mount(this)},C.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)},C.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()},C.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this},C.append=function(e,t){return this.add(e,t,!0)},C.contain=function(e){return this.db?this.db.has(e):this.reg.has(e)},C.update=function(e,t){const n=this,r=this.remove(e);return r&&r.then?r.then(()=>n.add(e,t)):this.add(e,t)},C.cleanup=function(){return this.fastupdate?(We(this.map),this.depth&&We(this.ctx),this):this},C.searchCache=$,C.export=function(e,t,n=0,r=0){let i,o;switch(r){case 0:i="reg",o=Ne(this.reg);break;case 1:i="cfg",o=null;break;case 2:i="map",o=Me(this.map,this.reg.size);break;case 3:i="ctx",o=Fe(this.ctx,this.reg.size);break;default:return}return $e.call(this,e,t,i,o,n,r)},C.import=function(e,t){if(t)switch("string"==typeof t&&(t=JSON.parse(t)),e=e.split("."),"json"===e[e.length-1]&&e.pop(),3===e.length&&e.shift(),e=e.length>1?e[1]:e[0],e){case"reg":this.fastupdate=!1,this.reg=Le(t,this.reg);break;case"map":this.map=Re(t,this.map);break;case"ctx":this.ctx=ze(t,this.ctx)}},C.serialize=function(e=!0){let t="",n="",r="";if(this.reg.size){let e;for(var i of this.reg.keys())e||(e=typeof i),t+=(t?",":"")+("string"===e?'"'+i+'"':i);t="index.reg=new Set(["+t+"]);",n=Ue(this.map,e),n="index.map=new Map(["+n+"]);";for(const t of this.ctx.entries()){i=t[0];let n=Ue(t[1],e);n="new Map(["+n+"])",n='["'+i+'",'+n+"]",r+=(r?",":"")+n}r="index.ctx=new Map(["+r+"]);"}return e?"function inject(index){"+t+n+r+"}":t+n+r},le(Ze.prototype);const tt="undefined"!=typeof window&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),nt=["map","ctx","tag","reg","cfg"],rt=K();function it(e,t,n){const r=e.value;let i,o=0;for(let e,s=0;s<r.length;s++){if(e=n?r:r[s]){for(let n,o,a=0;a<t.length;a++)if(o=t[a],n=e.indexOf(o),n>=0){if(i=1,!(e.length>1)){r[s]=[];break}e.splice(n,1)}o+=e.length}if(n)break}o?i&&e.update(r):e.delete(),e.continue()}function ot(e,t){return new Promise((n,r)=>{e.onsuccess=e.oncomplete=function(){t&&t(this.result),t=null,n(this.result)},e.onerror=e.onblocked=r,e=null})}C=function e(t,n={}){if(!this||this.constructor!==e)return new e(t,n);"object"==typeof t&&(n=t,t=t.name),t||console.info("Default storage space was used, because a name was not passed."),this.id="flexsearch"+(t?":"+t.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=n.field?n.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=n.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}.prototype,C.mount=function(e){return e.index?e.mount(this):(e.db=this,this.open())},C.open=function(){if(this.db)return this.db;let e=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),rt[e.id]||(rt[e.id]=[]),rt[e.id].push(e.field);const t=tt.open(e.id,1);return t.onupgradeneeded=function(){const t=e.db=this.result;for(let n,r=0;r<nt.length;r++){n=nt[r];for(let r,i=0;i<rt[e.id].length;i++)r=rt[e.id][i],t.objectStoreNames.contains(n+("reg"!==n&&r?":"+r:""))||t.createObjectStore(n+("reg"!==n&&r?":"+r:""))}},e.db=ot(t,function(t){e.db=t,e.db.onversionchange=function(){e.close()}})},C.close=function(){this.db&&this.db.close(),this.db=null},C.destroy=function(){return ot(tt.deleteDatabase(this.id))},C.clear=function(){const e=[];for(let t,n=0;n<nt.length;n++){t=nt[n];for(let n,r=0;r<rt[this.id].length;r++)n=rt[this.id][r],e.push(t+("reg"!==t&&n?":"+n:""))}const t=this.db.transaction(e,"readwrite");for(let n=0;n<e.length;n++)t.objectStore(e[n]).clear();return ot(t)},C.get=function(e,t,n=0,r=0,i=!0,o=!1){e=this.db.transaction((t?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((t?"ctx":"map")+(this.field?":"+this.field:"")).get(t?t+":"+e:e);const s=this;return ot(e).then(function(e){let t=[];if(!e||!e.length)return t;if(i){if(!n&&!r&&1===e.length)return e[0];for(let i,o=0;o<e.length;o++)if((i=e[o])&&i.length){if(r>=i.length){r-=i.length;continue}const e=n?r+Math.min(i.length-r,n):i.length;for(let n=r;n<e;n++)t.push(i[n]);if(r=0,t.length===n)break}return o?s.enrich(t):t}return e})},C.tag=function(e,t=0,n=0,r=!1){e=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(e);const i=this;return ot(e).then(function(e){return!e||!e.length||n>=e.length?[]:t||n?(e=e.slice(n,n+t),r?i.enrich(e):e):e})},C.enrich=function(e){"object"!=typeof e&&(e=[e]);const t=this.db.transaction("reg","readonly").objectStore("reg"),n=[];for(let r=0;r<e.length;r++)n[r]=ot(t.get(e[r]));return Promise.all(n).then(function(t){for(let n=0;n<t.length;n++)t[n]={id:e[n],doc:t[n]?JSON.parse(t[n]):null};return t})},C.has=function(e){return ot(e=this.db.transaction("reg","readonly").objectStore("reg").getKey(e)).then(function(e){return!!e})},C.search=null,C.info=function(){},C.transaction=function(e,t,n){e+="reg"!==e&&this.field?":"+this.field:"";let r=this.h[e+":"+t];if(r)return n.call(this,r);let i=this.db.transaction(e,t);this.h[e+":"+t]=r=i.objectStore(e);const o=n.call(this,r);return this.h[e+":"+t]=null,ot(i).finally(function(){return o})},C.commit=async function(e){let t=e.commit_task,n=[];e.commit_task=[];for(let e,r=0;r<t.length;r++)e=t[r],e.del&&n.push(e.del);n.length&&await this.remove(n),e.reg.size&&(await this.transaction("map","readwrite",function(t){for(const n of e.map){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;var i;if(n&&n.length){const e=Math.max(n.length,r.length);for(let t,o,s=0;s<e;s++)if((o=r[s])&&o.length){if((t=n[s])&&t.length)for(i=0;i<o.length;i++)t.push(o[i]);else n[s]=o;i=1}}else n=r,i=1;i&&t.put(n,e)})}}),await this.transaction("ctx","readwrite",function(t){for(const n of e.ctx){const e=n[0],r=n[1];for(const n of r){const r=n[0],i=n[1];i.length&&(t.get(e+":"+r).onsuccess=function(){let n=this.result;var o;if(n&&n.length){const e=Math.max(n.length,i.length);for(let t,r,s=0;s<e;s++)if((r=i[s])&&r.length){if((t=n[s])&&t.length)for(o=0;o<r.length;o++)t.push(r[o]);else n[s]=r;o=1}}else n=i,o=1;o&&t.put(n,e+":"+r)})}}}),e.store?await this.transaction("reg","readwrite",function(t){for(const n of e.store){const e=n[0],r=n[1];t.put("object"==typeof r?JSON.stringify(r):1,e)}}):e.bypass||await this.transaction("reg","readwrite",function(t){for(const n of e.reg.keys())t.put(1,n)}),e.tag&&await this.transaction("tag","readwrite",function(t){for(const n of e.tag){const e=n[0],r=n[1];r.length&&(t.get(e).onsuccess=function(){let n=this.result;n=n&&n.length?n.concat(r):r,t.put(n,e)})}}),e.map.clear(),e.ctx.clear(),e.tag&&e.tag.clear(),e.store&&e.store.clear(),e.document||e.reg.clear())},C.remove=function(e){return"object"!=typeof e&&(e=[e]),Promise.all([this.transaction("map","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&it(t,e)}}),this.transaction("ctx","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&it(t,e)}}),this.transaction("tag","readwrite",function(t){t.openCursor().onsuccess=function(){const t=this.result;t&&it(t,e,!0)}}),this.transaction("reg","readwrite",function(t){for(let n=0;n<e.length;n++)t.delete(e[n])})])};const st=De;let at=null,ut=!1;async function ct(){console.log("Building FlexSearch index..."),at=new st({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}});const e=await h();for(const t of e)await lt(t);ut=!0;try{const t=await at.export();await y("flexsearch_index",{serialized:t,timestamp:Date.now()}),console.log(`Indexed ${e.length} bookmarks`)}catch(e){console.error("Error caching index:",e)}return at}async function lt(e){at||await async function(){if(ut)return at;console.log("Initializing FlexSearch index...");const e=await v("flexsearch_index");if(e&&e.serialized)try{return at=new st({document:{id:"id",index:["title","url","description","keywords","category","domain"],store:!0},tokenize:"forward",cache:!0,optimize:!0,resolution:9,context:{depth:3,bidirectional:!0}}),at.import(e.serialized),ut=!0,console.log("Loaded FlexSearch index from cache"),at}catch(e){console.error("Error loading cached index:",e)}return await ct(),at}();const t={id:e.id,title:e.title||"",url:e.url||"",description:e.description||"",keywords:Array.isArray(e.keywords)?e.keywords.join(" "):"",category:e.category||"",domain:e.domain||""};await at.add(t)}async function ht(e){at&&await at.remove(e)}async function ft(){try{console.log("Starting bookmark sync...");const e=await chrome.bookmarks.getTree(),t=[];function n(e,r=""){for(const i of e)if(i.url){let e="unknown";try{if(i.url.startsWith("http://")||i.url.startsWith("https://")){e=new URL(i.url).hostname}else e=i.url.startsWith("chrome://")||i.url.startsWith("chrome-extension://")?"chrome-internal":i.url.startsWith("file://")?"local-file":i.url.startsWith("javascript:")?"javascript-bookmarklet":i.url.startsWith("data:")?"data-uri":i.url.startsWith("mailto:")||i.url.startsWith("tel:")?"contact-link":"other-protocol"}catch(t){e="invalid-url"}t.push({id:i.id,title:i.title||"Untitled",url:i.url,domain:e,dateAdded:i.dateAdded||Date.now(),folderPath:r,parentId:i.parentId,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0})}else if(i.children){const e=r?`${r}/${i.title}`:i.title;n(i.children,e)}}n(e),await p(t),await chrome.storage.local.set({bookmarks:t,lastSyncTime:Date.now()}),console.log(`Synced ${t.length} bookmarks`);if((await Promise.resolve().then(function(){return _}).then(e=>e.getSettings())).enrichmentEnabled){console.log("Queueing new bookmarks for enrichment...");for(const r of t)!r.url.startsWith("http://")&&!r.url.startsWith("https://")||r.description||r.category||await b(r.id,0)}}catch(i){console.error("Error syncing bookmarks:",i)}}async function dt(e){try{const t=[];let n=e;for(;n;){const[e]=await chrome.bookmarks.get(n);if(e.title&&t.unshift(e.title),n=e.parentId,t.length>10)break}return t.join("/")}catch(e){return""}}async function pt(){await chrome.alarms.clear("enrichmentPipeline"),console.log("Enrichment is manual-only - no automatic alarms set")}chrome.runtime.onInstalled.addListener(async e=>{console.log("Extension installed/updated:",e.reason),await x(),"install"===e.reason?(console.log("First install - syncing bookmarks..."),await ft(),console.log("Building initial search index..."),await ct(),await pt()):"update"===e.reason&&(console.log("Extension updated - syncing bookmarks..."),await ft(),console.log("Rebuilding search index..."),await ct(),await pt())}),chrome.bookmarks.onCreated.addListener(async(e,t)=>{await async function(e){try{console.log("Bookmark created:",e);const[t]=await chrome.bookmarks.get(e);if(t.url){let n="unknown";try{(t.url.startsWith("http://")||t.url.startsWith("https://"))&&(n=new URL(t.url).hostname)}catch(e){n="invalid-url"}const r=await dt(t.parentId),i={id:t.id,title:t.title||"Untitled",url:t.url,domain:n,dateAdded:t.dateAdded||Date.now(),folderPath:r,parentId:t.parentId,description:null,keywords:[],category:null,tags:[],isAlive:null,lastChecked:null,faviconUrl:null,contentSnippet:null,lastAccessed:null,accessCount:0};await d(i),await lt(i),await m(e,"create");(await Promise.resolve().then(function(){return _}).then(e=>e.getSettings())).enrichmentEnabled&&(i.url.startsWith("http://")||i.url.startsWith("https://"))&&await b(e,10)}}catch(e){console.error("Error handling bookmark creation:",e)}}(e)}),chrome.bookmarks.onRemoved.addListener(async(e,t)=>{await async function(e){try{console.log("Bookmark removed:",e),await ht(e),await g(e),await m(e,"delete")}catch(e){console.error("Error handling bookmark removal:",e)}}(e)}),chrome.bookmarks.onChanged.addListener(async(e,t)=>{await async function(e,t){try{console.log("Bookmark changed:",e,t);const[n]=await chrome.bookmarks.get(e);if(n.url){let r="unknown";try{(n.url.startsWith("http://")||n.url.startsWith("https://"))&&(r=new URL(n.url).hostname)}catch(e){r="invalid-url"}const i=await dt(n.parentId),o={...await Promise.resolve().then(function(){return _}).then(t=>t.getBookmark(e))||{},id:n.id,title:void 0!==t.title?t.title:n.title,url:void 0!==t.url?t.url:n.url,domain:r,dateAdded:n.dateAdded||Date.now(),folderPath:i,parentId:n.parentId};if(await async function(e){await ht(e.id),await lt(e)}(o),await d(o),await m(e,"update",t),t.url){(await Promise.resolve().then(function(){return _}).then(e=>e.getSettings())).enrichmentEnabled&&await b(e,5)}}}catch(e){console.error("Error handling bookmark change:",e)}}(e,t)}),chrome.bookmarks.onMoved.addListener(async(e,t)=>{await async function(e,t){try{console.log("Bookmark moved:",e);const[n]=await chrome.bookmarks.get(e),r=await dt(t.parentId),i=await Promise.resolve().then(function(){return _}).then(t=>t.getBookmark(e));i&&(i.folderPath=r,i.parentId=t.parentId,await d(i),await m(e,"update",{moved:!0}))}catch(e){console.error("Error handling bookmark move:",e)}}(e,t)}),chrome.runtime.onMessage.addListener((e,t,n)=>{if("syncBookmarks"===e.action)return ft().then(()=>{n({success:!0})}).catch(e=>{n({success:!1,error:e.message})}),!0;if("getEnrichmentStatus"===e.action)return Promise.resolve().then(function(){return _}).then(async e=>{const t=await e.getEnrichmentQueueSize(),r=await e.getSettings();n({success:!0,queueSize:t,enabled:r.enrichmentEnabled})}).catch(e=>{n({success:!1,error:e.message})}),!0;if("runEnrichment"===e.action){const t=e=>{chrome.runtime.sendMessage({action:"enrichmentProgress",progress:e}).catch(()=>{})};return async function(e=10,t=null,n=3){try{const r=await c();if(!r.enrichmentEnabled)return console.log("Enrichment is disabled"),{processed:0,success:0,failed:0,skipped:0};const i=n||r.enrichmentConcurrency||3;console.log(`Using concurrency: ${i} parallel requests`);const o=await w(e);if(0===o.length)return console.log("No bookmarks in enrichment queue"),{processed:0,success:0,failed:0,skipped:0};console.log(`Processing ${o.length} bookmarks from enrichment queue with ${i} concurrent workers`);let s=0,a=0,u=0,l=0;const h=async(e,n)=>{try{const r=await Promise.resolve().then(function(){return _}).then(t=>t.getBookmark(e.bookmarkId));t&&r&&t({current:n+1,total:o.length,completed:l,bookmarkId:e.bookmarkId,url:r.url,title:r.title,status:"processing"});const i=await P(e.bookmarkId);return i.success?i.alreadyEnriched||i.skipped?u++:s++:i.skipped?u++:a++,l++,t&&r&&t({current:n+1,total:o.length,completed:l,bookmarkId:e.bookmarkId,url:r.url,title:r.title,status:i.success?"completed":"failed",result:i}),await k(e.queueId),{success:!0,result:i}}catch(r){return console.error(`Error processing bookmark ${e.bookmarkId}:`,r),a++,l++,await k(e.queueId),t&&t({current:n+1,total:o.length,completed:l,bookmarkId:e.bookmarkId,status:"error",error:r.message}),{success:!1,error:r.message}}},f=[];let d=0;const p=async()=>{for(;d<o.length;){const e=d++,t=o[e];await h(t,e),d<o.length&&await O(100)}};for(let e=0;e<Math.min(i,o.length);e++)f.push(p());return await Promise.all(f),console.log(`Processed ${o.length} bookmarks: ${s} success, ${a} failed, ${u} skipped`),{processed:o.length,success:s,failed:a,skipped:u}}catch(e){return console.error("Error processing enrichment batch:",e),{processed:0,success:0,failed:0,skipped:0,error:e.message}}}(e.batchSize||10,t,e.concurrency||3).then(e=>{n({success:!0,result:e})}).catch(e=>{n({success:!1,error:e.message})}),!0}return"updateSettings"===e.action?(Promise.resolve().then(function(){return _}).then(async t=>{await t.updateSettings(e.settings),void 0!==e.settings.trackBrowsingBehavior&&(yt=e.settings.trackBrowsingBehavior,console.log("Behavior tracking "+(yt?"enabled":"disabled")),yt&&!mt&&vt()),n({success:!0})}).catch(e=>{n({success:!1,error:e.message})}),!0):void 0}),chrome.alarms.onAlarm.addListener(async e=>{"enrichmentPipeline"===e.name&&console.log("Alarm triggered but enrichment is manual-only")});let gt=new Map,mt=!1,yt=!1;async function vt(){try{const e=await s.bookmarks.toArray();gt.clear();for(const t of e)if(t.url){const e=bt(t.url);gt.set(e,t.id)}mt=!0,console.log(`URL cache built with ${gt.size} entries`)}catch(e){console.error("Error building URL cache:",e)}}function bt(e){try{const t=new URL(e);let n=t.hostname.replace(/^www\./,"")+t.pathname;return n=n.replace(/\/$/,""),n.toLowerCase()}catch(t){return e.toLowerCase()}}async function wt(e,t){try{const n=await s.bookmarks.get(e);return n&&await s.bookmarks.update(e,{lastAccessed:Date.now(),accessCount:(n.accessCount||0)+1}),await m(e,"access",{url:t}),console.log(`Recorded access for bookmark: ${e}`),!0}catch(e){return console.error("Error recording bookmark access:",e),!1}}async function kt(e){mt||await vt();const t=bt(e);if(gt.has(t))return gt.get(t);const n=t.split("?")[0];return gt.has(n)?gt.get(n):null}chrome.tabs.onUpdated.addListener(async(e,t,n)=>{if(yt&&"complete"===t.status&&n.url){if(!n.url.startsWith("http://")&&!n.url.startsWith("https://"))return;try{const e=await kt(n.url);e&&await wt(e,n.url)}catch(e){console.error("Error in tab update handler:",e)}}}),chrome.tabs.onActivated.addListener(async e=>{if(yt)try{const t=await chrome.tabs.get(e.tabId);if(!t.url||!t.url.startsWith("http://")&&!t.url.startsWith("https://"))return;const n=await kt(t.url);if(n){const e=await s.bookmarks.get(n);e&&(!e.lastAccessed||Date.now()-e.lastAccessed>3e5)&&await wt(n,t.url)}}catch(e){console.error("Error in tab activation handler:",e)}}),chrome.bookmarks.onCreated.addListener(async(e,t)=>{if(t.url){const e=bt(t.url);gt.set(e,t.id)}}),chrome.bookmarks.onRemoved.addListener(async(e,t)=>{mt=!1}),chrome.bookmarks.onChanged.addListener(async(e,t)=>{t.url&&(mt=!1)}),async function(){yt=await async function(){try{return!0===(await c()).trackBrowsingBehavior}catch(e){return!1}}(),console.log("Behavior tracking: "+(yt?"enabled":"disabled (default)"))}().then(()=>{yt&&vt()}),console.log("Bookmark Insights background service worker loaded");var xt=Object.freeze({__proto__:null,default:{}});
//# sourceMappingURL=background.js.map
